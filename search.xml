<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>yuque-helper 1.0 发布了</title>
      <link href="/posts/f63c25b0/"/>
      <url>/posts/f63c25b0/</url>
      
        <content type="html"><![CDATA[<p><img src="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture&a=0.5370183293516069"></p><h2 id="什么是-yuque-helper"><a href="#什么是-yuque-helper" class="headerlink" title="什么是 yuque-helper"></a>什么是 yuque-helper</h2><p>yuque-helper 是一个开源免费的语雀 chrome 小插件. 目前功能如下:</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608641868668-b69e058f-dbfb-492c-b06b-46e3f5149323.png#align=left&display=inline&height=366&margin=%5Bobject%20Object%5D&name=image.png&originHeight=366&originWidth=232&size=30301&status=done&style=none&width=232" alt="image.png"></p><p>另外还有一个在配置项里的自定义字体功能.</p><p>具体功能的细节与使用方法见下文.</p><h2 id="为什么会有-yuque-helper"><a href="#为什么会有-yuque-helper" class="headerlink" title="为什么会有 yuque-helper"></a>为什么会有 yuque-helper</h2><p>语雀可能是我这几年使用过的最惊艳的笔记工具了, 大概是 18 年 5 月开始入坑, 一见如故, 把自己所有笔记的工作全部迁移到了语雀. 语雀的公共空间大概已经有了 530 篇文档.</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608643595469-846464ca-ba8d-4d55-a88d-e7b953db09d7.png#align=left&display=inline&height=217&margin=%5Bobject%20Object%5D&name=image.png&originHeight=217&originWidth=315&size=11540&status=done&style=none&width=315" alt="image.png"></p><p>在不断使用的过程中, 也见证着语雀功能变得的更加丰富与强大. 但是每个人的使用场景不同, 语雀也无法面面俱到. 对于一些我个人觉得很有用的小功能, 在语雀的排期应该很靠后, 甚至没有排期. 很早就萌生写插件去实现我想要的功能, 但是一直没有实施.</p><p>直到，语雀经过通盘考虑删除了原来的 markdown 视图的功能。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608643993026-dbfd12f6-9409-4bed-b9c1-1aa7978855f1.png#align=left&display=inline&height=960&margin=%5Bobject%20Object%5D&name=image.png&originHeight=960&originWidth=1082&size=170514&status=done&style=none&width=1082" alt="image.png"></p><p>有些东西真的是拥有的时候, 你不知道哪里好, 直到失去才感受到他的重要.</p><p>没有这个功能后, 真的给我带了很大的不便, 以前只要点击一下按钮就可以的操作, 我现在不得不先下载 markdown 文件, 再到文件夹找到他, 然后打开文件, 再复制. 操作的步骤大大的延长, 全是摩擦阻力.</p><p>直到有一天, 看到语雀团队的仙森 ᵒᵏ 大佬的这篇文章</p><p>发现, 只是隐藏了相关按钮, 但是功能还是在的, 只在要网页后面拼接相应参数即可.</p><p>这的确解决了燃眉之急, 但是我还是想要之前点一下就打开的快捷, 所以就有了这个插件雏形.</p><h2 id="如何使用-yuque-helper"><a href="#如何使用-yuque-helper" class="headerlink" title="如何使用 yuque-helper"></a>如何使用 yuque-helper</h2><h3 id="如何安装"><a href="#如何安装" class="headerlink" title="如何安装"></a>如何安装</h3><p><del>~ 目前只支持, 通过压缩包安装, 这种方式的好处是, 你不需要会科学上网. 按下面的步骤操作即可, 坏处是没办法升级, 下次有更新, 你还需手动下载, 重新安装, 不过我已经提交到 chrome 的官方插件市场审核了, 顺利的话, 本周就可以直接在官方插件市场直接安装了. ~</del>（审核通过了）</p><p>网上应用商店安装：</p><p><a href="https://chrome.google.com/webstore/detail/yuque-helper/nkhfaopgdfgoedlecdnecpiindnkkpai?utm_source=chrome-ntp-icon">yuque-helper - Chrome 网上应用店</a></p><p>打开上面地址直接安装即可：</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608711228754-546f147d-8c35-4a9c-92bf-fd91b32c8fb7.png#align=left&display=inline&height=599&margin=%5Bobject%20Object%5D&name=image.png&originHeight=599&originWidth=1303&size=106194&status=done&style=none&width=1303" alt="image.png"></p><p>压缩包安装:</p><p><a href="https://www.yuque.com/attachments/yuque/0/2020/zip/119443/1608645487731-07a5d33f-aca4-4c13-9951-c09ce7e43f00.zip?_lake_card=%7B%22uid%22:%221608645484786-0%22,%22src%22:%22https://www.yuque.com/attachments/yuque/0/2020/zip/119443/1608645487731-07a5d33f-aca4-4c13-9951-c09ce7e43f00.zip%22,%22name%22:%22yuque-helper-v1.0.0.zip%22,%22size%22:623958,%22type%22:%22application/zip%22,%22ext%22:%22zip%22,%22progress%22:%7B%22percent%22:99%7D,%22status%22:%22done%22,%22percent%22:0,%22id%22:%22w4C5O%22,%22card%22:%22file%22%7D">yuque-helper-v1.0.0.zip</a></p><p>首先下载上面的 zip 文件到你的本地, 然后放在一个不会被不小心删除的地方, 解压好.</p><p>按如下图所示菜单进件选择, 打开 扩展程序 页面<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608359004415-c649c96b-fe21-4c76-b7a1-cfd3dfc5259d.png#align=left&display=inline&height=628&margin=%5Bobject%20Object%5D&name=image.png&originHeight=628&originWidth=729&size=333918&status=done&style=none&width=729" alt="image.png"></p><p>点击 加载已解压的扩展程序 按钮<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608645690310-f8a2c70c-8658-4b4d-9b52-bb53caa53c95.png#align=left&display=inline&height=250&margin=%5Bobject%20Object%5D&name=image.png&originHeight=250&originWidth=1054&size=24879&status=done&style=none&width=1054" alt="image.png"></p><p>选择你刚刚解压 zip 文件的目录, 点击选择即可<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608359131799-e73ac1f2-26c5-4717-8016-036e4aed1fab.png#align=left&display=inline&height=376&margin=%5Bobject%20Object%5D&name=image.png&originHeight=376&originWidth=728&size=48747&status=done&style=none&width=728" alt="image.png"></p><p>如果操作正常, 你会看到你的 扩展程序面板 多了一个 yuque-helper 的卡片, 说明你安装成功了.<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608359149077-05abd223-047f-4e75-9465-d6f299a210c0.png#align=left&display=inline&height=234&margin=%5Bobject%20Object%5D&name=image.png&originHeight=234&originWidth=417&size=17367&status=done&style=none&width=417" alt="image.png"></p><p>不知道 chrome 哪版开始, 安装的插件默认不会在地址栏显示, 为了方便使用, 你可以按如下图所示, 固定本插件, 当然本步非必须操作, 看个人喜好.<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608359452502-a64235ec-1631-42b4-9380-b8980e9dd388.png#align=left&display=inline&height=582&margin=%5Bobject%20Object%5D&name=image.png&originHeight=582&originWidth=383&size=84209&status=done&style=none&width=383" alt="image.png"></p><h3 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h3><h4 id="1-Markdown-视图"><a href="#1-Markdown-视图" class="headerlink" title="1. Markdown 视图"></a>1. Markdown 视图</h4><p>上文也说了, 快捷显示 markdown 视图是本插件的初衷, 所以他是第一个, 功能很简单, 只是在点击时, 自动跳到当前页面地址 + markdown 参数的页面, 当然, 如果你不是在语雀文章面点击此按钮, 应该会看到 404<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608366730274-1818b3fb-c6e6-4364-9570-04ac0ae6edd6.gif#align=left&display=inline&height=1029&margin=%5Bobject%20Object%5D&name=markdown.gif&originHeight=1029&originWidth=1851&size=2312929&status=done&style=none&width=1851" alt="markdown.gif"></p><h4 id="2-Html-视图"><a href="#2-Html-视图" class="headerlink" title="2. Html 视图"></a>2. Html 视图</h4><p>与 markdown 类似, 只是打开的 html 视图页面<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608366745533-64146ac0-3921-47fc-8188-9c3e231d08e6.gif#align=left&display=inline&height=1072&margin=%5Bobject%20Object%5D&name=html.gif&originHeight=1072&originWidth=1846&size=17895175&status=done&style=none&width=1846" alt="html.gif"></p><h4 id="3-复制-Url"><a href="#3-复制-Url" class="headerlink" title="3. 复制 Url"></a>3. 复制 Url</h4><p>这个功能, 主要是在文章时需要引用一些页面, markdown 通过语法需要这样写</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[网页标题](https://www..com)</span><br></pre></td></tr></table></figure><p>所以要引用一个网页的地址, 我至少要复制一次网页的标题, 再复制一次网页地址. 我觉得太麻烦, 加了一个小功能, 点击按钮后, 会自动生成当前页面的 markdown 链接引用到你的粘贴板.</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608366753210-7725d6b7-abd7-4ee5-afee-82581d2a8805.gif#align=left&display=inline&height=1080&margin=%5Bobject%20Object%5D&name=copy_url.gif&originHeight=1080&originWidth=1918&size=650376&status=done&style=none&width=1918" alt="copy_url.gif"></p><h4 id="4-生成-TOC"><a href="#4-生成-TOC" class="headerlink" title="4. 生成 TOC"></a>4. 生成 TOC</h4><p>如果对于 markdown 比较熟悉的同学, 应该见过有些编辑器是支持 toc 语法的, 可以首页生成本文的大纲, 不过语雀有侧边栏大纲, 此功能聊胜于无.<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608641394070-62c9f7b7-6ea6-4efb-9f5f-236151bde854.gif#align=left&display=inline&height=1074&margin=%5Bobject%20Object%5D&name=toc.gif&originHeight=1074&originWidth=1919&size=334245&status=done&style=none&width=1919" alt="toc.gif"></p><h4 id="5-插入-bing-图片"><a href="#5-插入-bing-图片" class="headerlink" title="5. 插入 bing 图片"></a>5. 插入 bing 图片</h4><p>我写文章时, 因为有些会发到个人的公众号上, 所以喜欢在文章开始配个首图. 通常使用 bing 的随机图就够了. 此按钮功能就是在文首接入一张随机的 bing 的配图. (配图要在外网获取, 看个人网速, 可能加载缓慢)<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608641408226-4a8eab13-7fd9-42bd-be15-3bdbfdd4d024.gif#align=left&display=inline&height=1076&margin=%5Bobject%20Object%5D&name=bing.gif&originHeight=1076&originWidth=1918&size=479648&status=done&style=none&width=1918" alt="bing.gif"></p><h4 id="6-首行缩进"><a href="#6-首行缩进" class="headerlink" title="6. 首行缩进"></a>6. 首行缩进</h4><p>顾名思义, 给每段开头加两个空格.</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608641692095-18921f06-80a8-41e7-af49-d5222ccc1fa9.gif#align=left&display=inline&height=652&margin=%5Bobject%20Object%5D&name=2020-12-22%2020.52.43.gif&originHeight=652&originWidth=874&size=128539&status=done&style=none&width=874" alt="2020-12-22 20.52.43.gif"></p><h4 id="7-文本格式化"><a href="#7-文本格式化" class="headerlink" title="7. 文本格式化"></a>7. 文本格式化</h4><p>本功能还不太完善, 使用前请先学会语雀的历史版本功能, 在出现问题时, 自行恢复历史版本.</p><p>本功能主要是为了一键格式化文本, 比如在中文与英文或者数字之前自动加个空格, 使阅读体验更好, 或修复一些标点符号错误的用法等.</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608641726708-dda9376e-a023-4698-ab18-a7028a83772c.gif#align=left&display=inline&height=491&margin=%5Bobject%20Object%5D&name=2020-12-22%2020.53.58.gif&originHeight=491&originWidth=851&size=137737&status=done&style=none&width=851" alt="2020-12-22 20.53.58.gif"></p><h4 id="8-获得目录列表"><a href="#8-获得目录列表" class="headerlink" title="8. 获得目录列表"></a>8. 获得目录列表</h4><p>此功能一般没啥用, 初衷是语雀出了个人页面, 有些同学喜欢把个人页面上列出自己的文章列表, 但是一个一个复制又太麻烦了, 此功能就是在目录页面生成当前展开的文章到你的剪切板, 减少一定的重复劳动.<br><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608641426368-1da03a9e-7c6b-48f4-83e1-4a0456fdf9c9.gif#align=left&display=inline&height=1079&margin=%5Bobject%20Object%5D&name=book.gif&originHeight=1079&originWidth=1920&size=15582858&status=done&style=none&width=1920" alt="book.gif"></p><h4 id="9-插入表情"><a href="#9-插入表情" class="headerlink" title="9. 插入表情"></a>9. 插入表情</h4><p>写这个功能的时候, 语雀还没有在表情按钮, 写完之后, 发现语雀上线这个功能, 不过, 还好表情重复的不多, 不然就白写了 😂 . 而且不光支持评论框插入还支持文章.</p><p>这些表情及插件的图标均来自下文<br>不过写本文的时候, 好像删除了…</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608366769884-8fee8377-bad5-4261-98ab-64e2b13e58c3.gif#align=left&display=inline&height=1039&margin=%5Bobject%20Object%5D&name=mood1.gif&originHeight=1039&originWidth=1584&size=347305&status=done&style=none&width=1584" alt="mood1.gif"></p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608366787135-6f07e7a3-de2b-4c37-b7ac-7420e93e3862.gif#align=left&display=inline&height=1013&margin=%5Bobject%20Object%5D&name=mood2.gif&originHeight=1013&originWidth=1692&size=373803&status=done&style=none&width=1692" alt="mood2.gif"></p><h4 id="10-自定义字体"><a href="#10-自定义字体" class="headerlink" title="10. 自定义字体"></a>10. 自定义字体</h4><p>语雀毕竟是用来看的, 一种字体看多了, 难免审美疲劳, 加了一个自定义设置字体的功能, 当然你设置的字体必须要是你本地安装过的.</p><p>注意看演示图, 此设置需在选项页内设置, 需右击插件图标, 打开选项页面进行设置. 可以同时设置多个字体, 建议先配置一个英文的, 再配置一个中文的.<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608689788099-068aff17-d255-42d7-b80d-d8ca18b07c09.png#align=left&display=inline&height=237&margin=%5Bobject%20Object%5D&name=image.png&originHeight=237&originWidth=321&size=16528&status=done&style=none&width=321" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1608372757318-ea2f1458-0ff2-4a20-b7e8-70cf0c40abfc.gif#align=left&display=inline&height=1064&margin=%5Bobject%20Object%5D&name=font.gif&originHeight=1064&originWidth=1911&size=17458069&status=done&style=none&width=1911" alt="font.gif"></p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="开源地址"><a href="#开源地址" class="headerlink" title="开源地址"></a>开源地址</h3><p>温馨提示: 如果你是抱着学习的目的去看这个项目, 这明显不是一个好主意, 我其实是一个后端开发, 本插件都是我贫瘠的散装前端知识写成的, 希望各位前端大佬一起帮忙完善它.</p><p><a href="https://github.com/kiwiflydream/yuque-helper">kiwiflydream/yuque-helper: yuque-helper 是一个开源免费的语雀 chrome 小插件</a></p><h3 id="联系我"><a href="#联系我" class="headerlink" title="联系我"></a>联系我</h3><p>如果使用上有问题, 可以加我的微信, 当然如果你有好的想法, 想教我做产品, 想教我写代码, 或者仅仅只是想多交一个朋友都欢迎.</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1608700862146-31cbfa9d-b9a9-47f3-a35b-8c8a08dd70aa.png#align=left&display=inline&height=430&margin=%5Bobject%20Object%5D&name=image.png&originHeight=430&originWidth=430&size=52117&status=done&style=none&width=430" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/f63c25b0/">https://blog.coder4j.cn/posts/f63c25b0/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>【keynote】神奇的神奇移动</title>
      <link href="/posts/15ecccae/"/>
      <url>/posts/15ecccae/</url>
      
        <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前几天，看了一篇技术文章，《<a href="https://juejin.im/post/6890545920883032071">做了一夜动画，就为让大家更好的理解 Vue3 的 Composition Api</a>》，里面的动态演示图秀了我一脸，下载了他的原文件，发现大量使用了一个叫做『神奇移动』的效果，然后一查，发现我以前 keynote 简直是幼儿园水平。这个功能小到做一张动态演示图，大到做视频动画都可以，限制它的只有你的想象力。</p><p>观看提示，keynote 是苹果系统特有的软件，需要有 mac 或 ipad 等苹果设备才能使用。当然也可以装黑苹果。如果都没有的话，我查了一下 ppt 也有相类似的功能，可以自行搜索。另外看本文对于 keynote 也有点基础要求，但是很少，只要会导入、导出图片即可。</p><p>话不多说，我们开始吧。</p><h2 id="什么是神奇移动？"><a href="#什么是神奇移动？" class="headerlink" title="什么是神奇移动？"></a>什么是神奇移动？</h2><p>神奇移动是 keynote 提供的一种过渡效果，它会创建对象从一张幻灯片的位置到下一张幻灯片的新位置的效果。个人理解神奇移动就是帮我们在两幅幻灯片之间进行智能补帧，用来帮助图像演示的更加平滑。</p><h2 id="为什么需要神奇移动？"><a href="#为什么需要神奇移动？" class="headerlink" title="为什么需要神奇移动？"></a>为什么需要神奇移动？</h2><p>比如下面这两幅画。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1604840527173-f41f6cb0-fc1a-4adb-acef-e9b1d435de25.png#align=left&display=inline&height=578&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1156&originWidth=2072&size=61305&status=done&style=none&width=1036" alt="image.png"></p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1604840849835-b99bae17-bedf-4b97-b273-e6e951691482.png#align=left&display=inline&height=583&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1166&originWidth=2080&size=52029&status=done&style=none&width=1040" alt="image.png"></p><p>第一幅画，是一个黑底的蓝色大圆圈。</p><p>第二幅画，是一个白底的绿色小圆圈。</p><p>现在我们想要把这两幅画变成一个连续的动画，首先我们不用神奇移动，直接用 keynote 导出看看效果。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1604841188553-02692612-a637-4f87-8bfc-a1a89d203428.gif#align=left&display=inline&height=608&margin=%5Bobject%20Object%5D&name=1.gif&originHeight=608&originWidth=1080&size=147506&status=done&style=none&width=1080" alt="1.gif"></p><p>是不是闪瞎了眼睛，不光伤眼，还非常生硬。</p><p>为什么会这样呢？因为我们没有过渡动画，直接使用一张开始的图片，一张结束的图片。</p><p>那如何解决呢？其实很简单，我们只要在这两幅画中添加一些过渡图片就可以解决。那需要什么样的过渡图片呢？</p><p>先从大小来看，我们可以看到第一幅图片的圆比较大，而最后一幅的圆很小，所以可以添加一个大小介于他们之间的圆圈。</p><p>然后再从颜色来看，第一幅的背景是黑色，最后一幅是白色。我们可以添加一个色域在黑白之间的色彩作为背景色。同理，圆圈的颜色也设成蓝绿之间。</p><p>最后从位置来看，两个圆圈相隔比较远，所以可以在中间位置进行添加，效果如下图。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1604841968075-3bf44d65-fefa-475e-ae44-1fead5e9e82a.gif#align=left&display=inline&height=608&margin=%5Bobject%20Object%5D&name=3.gif&originHeight=608&originWidth=1080&size=212330&status=done&style=none&width=1080" alt="3.gif"></p><p>可以看到，效果稍微好一点，我们可以按这个方法，不断添加中间的过渡图片。图片添加的越多，会使的动画越平滑。</p><p><strong>But</strong>, 这样效率太低了，为了图片尽可能过渡的平滑，你要花很多工夫添加中间图片。那有没有便捷的方式帮我们生成呢？答案就是『神奇移动』。</p><h2 id="如何使用神奇移动"><a href="#如何使用神奇移动" class="headerlink" title="如何使用神奇移动"></a>如何使用神奇移动</h2><p>keynote 使用神奇移动非常简单，只需要 3 步即可</p><ol><li>点击你要添加神奇动画的图片右侧的『动画效果』按钮</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1604844266418-3a4cbc1e-e42e-4e9d-9369-fa49942cb3b6.png#align=left&display=inline&height=900&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1800&originWidth=2880&size=729628&status=done&style=none&width=1440" alt="image.png"></p><ol start="2"><li>点击『添加效果』按钮</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1604844336575-16af279d-b32d-4f9c-96db-63924ce97e59.png#align=left&display=inline&height=319&margin=%5Bobject%20Object%5D&name=image.png&originHeight=638&originWidth=746&size=77367&status=done&style=none&width=373" alt="image.png"></p><ol start="3"><li>选择上步弹出的列表中的『神奇移动』选项</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1604844373204-92be524d-a6cf-41a5-a008-224dfbff5f7d.png#align=left&display=inline&height=499&margin=%5Bobject%20Object%5D&name=image.png&originHeight=998&originWidth=600&size=423077&status=done&style=none&width=300" alt="image.png"></p><p>我们现在导出添加『神奇移动』后的图片看看效果。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/gif/119443/1604844522843-dd64c955-12a3-434e-95cd-f965792af3c7.gif#align=left&display=inline&height=608&margin=%5Bobject%20Object%5D&name=4.gif&originHeight=608&originWidth=1080&size=291890&status=done&style=none&width=1080" alt="4.gif"></p><p>完美的违反广告法。</p><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><p>强烈推荐 <a href="https://space.bilibili.com/10958217">PM 宋先生的个人空间 - 哔哩哔哩 ( ゜- ゜)つロ 乾杯~ Bilibili</a> 的 keynote 教程，简单明了，下面是关于 『神奇移动』的两节</p><ul><li><a href="https://www.bilibili.com/video/BV1k64y1u7LQ">【PM 宋先生】Keynote 教学第二期：神奇移动。老罗如何演示锤子手机用户体验？苹果喜欢用哪种方式介绍 iPhone 名字？_哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></li><li><a href="https://www.bilibili.com/video/BV1rh411R7rP">【PM 宋先生】Keynote 教学第七期：神奇移动进阶。苹果和华为发布会上最常用的动画。_哔哩哔哩 (゜-゜)つロ 干杯~-bilibili</a></li></ul><p>这是苹果官方的文档：</p><ul><li><a href="https://support.apple.com/kb/PH16959?locale=zh_CN">用于 Mac 的 Keynote: 添加“神奇移动”过渡</a></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/15ecccae/">https://blog.coder4j.cn/posts/15ecccae/</a> </p>]]></content>
      
      
      <categories>
          
          <category> keynote </category>
          
      </categories>
      
      
        <tags>
            
            <tag> keynote </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【BREW】brew mysql 无法连接问题</title>
      <link href="/posts/adc594bd/"/>
      <url>/posts/adc594bd/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/119443/1601123705416-12a12cdd-e97e-41ed-b3a8-65717e386197.jpeg#align=left&display=inline&height=1080&margin=%5Bobject%20Object%5D&originHeight=1080&originWidth=1920&size=0&status=done&style=none&width=1920"></p><h2 id="故障现象"><a href="#故障现象" class="headerlink" title="故障现象"></a>故障现象</h2><p>今天本地项目怎么都启动不了，查看日志发现是连接本地数据库超时，报错信息如下：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.</span><br></pre></td></tr></table></figure><h2 id="排查过程"><a href="#排查过程" class="headerlink" title="排查过程"></a>排查过程</h2><p>首先查看代码，发现也没有修改到数据库相关的内容，突然出现有点诡异。</p><p>转念一想会不会是数据库出了问题，果然，使用数据库管理工具 <strong>Datagrip</strong>  连接的时候也报了同样的错误,所以基本确定是 <strong>mysql</strong>  出了问题。</p><p>首先查看 <strong>brew **安装的本地 **mysql</strong>  服务的状态，这里有三种方法查看：</p><ol><li>通过 <code>ps</code>  命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep mysql</span><br></pre></td></tr></table></figure><p>通过 <code>ps</code> 命令加 <code>grep</code>  过滤，可以查看是否有 <strong>msyql</strong>  进程在进行。</p><ol start="2"><li>通过 <code>lsof</code>  命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:3306</span><br></pre></td></tr></table></figure><p>也可以通过 <code>lsof</code>  命令，查看指定端口有没有启动，我当时创建的时候用的默认端口 <strong>3306</strong>  端口，如果你设置了其它端口，可以改成对应的</p><ol start="3"><li>通过  <strong>brew</strong>  的  <code>services</code>  查看（推荐）</li></ol><p><strong>brew</strong>  的  <code>services</code>  是用来管理后台服务命令，它主要有如下功能：</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1601123715009-69a4540e-ca74-457f-9455-2be248759b3f.png">好的，直接使用  <code>brew services</code>  命令看看  <strong>mysql</strong>  的状态</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1601086520165-06b0710b-2d98-43f6-81fa-c47cc0a3b366.png#align=left&display=inline&height=372&margin=%5Bobject%20Object%5D&name=image.png&originHeight=372&originWidth=300&size=165629&status=done&style=none&width=300" alt="image.png"></p><p>可以看到列出的状态通常有三种，分别是：</p><ol><li>stopped</li><li>黄色的 started</li><li>绿色的 started</li></ol><p>其中  <strong>stopped</strong>  没啥好说的就是此服务是关闭的。那黄色的与绿色的  <strong>started</strong>  分别代表什么呢？首先绿色的  <strong>started</strong>  代表服务是启动的并且正常运行。黄色查了半天，发现代表未知，也就是说可能正常启动着，也可能出现问题，那为什么不直接显示未知呢？看样子是为了兼容，具体可以看这篇文章 <a href="https://stackoverflow.com/questions/41873704/what-is-the-meaning-yellow-service-started-status-on-homebrew/55798920">What is the meaning yellow service “started” status on Homebrew? - Stack Overflow</a>。</p><p>很不幸的是，这个黄色对我来说是故障。</p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>本来想重启一下就可以了，首先重启  <strong>mysql</strong>  服务： <code>brew services restart mysql</code> ，结果重启完还是不行。然后我重启电脑，好吧，还是失败。</p><p>接着搜索。</p><p>在  <strong>google</strong>  搜索  <strong>brew services yellow mysql</strong>  可以发现不只我一个人遇到。很多人给了解决方案，但是还是折腾了很久，才找到对于我有用的，这里直接贴两个。</p><ol><li><a href="https://stackoverflow.com/questions/51511863/brew-services-list-shows-mysql-running-but-cannot-connect/51512118">homebrew - brew services list shows mysql running but cannot connect - Stack Overflow</a></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1601087796013-c9fe8663-e7b8-476a-8057-40fd9259dff7.png#align=left&display=inline&height=638&margin=%5Bobject%20Object%5D&name=image.png&originHeight=638&originWidth=762&size=85161&status=done&style=none&width=762" alt="image.png"></p><p>这个方案大致是关服务、卸载服务、删除服务数据、升级  <strong>brew</strong> 、再重新安装服务。我主要看他评论下面两个  <strong>Thanks</strong>  觉得应该可以，结果还是不行。可能不适合我这种情况。</p><ol start="2"><li>完全重装 mysql</li></ol><p>但是重装之路也很艰难，怎么都启动不了，出现了其它问题。应该是没有卸载干净，后来按照这个 <a href="https://stackoverflow.com/questions/4359131/brew-install-mysql-on-macos">brew install mysql on macOS - Stack Overflow</a> 解决了。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1601088301638-85569ea4-0147-435a-a88d-bab2953eb93f.png#align=left&display=inline&height=881&margin=%5Bobject%20Object%5D&name=image.png&originHeight=881&originWidth=590&size=104888&status=done&style=none&width=590" alt="image.png"></p><p>发现之前没有使用  <strong>remove &amp; cleanup</strong>  命令，可能导致没有卸载干净。按步骤一步一步来就好了。</p><p>😔 难受，莫名其妙出现的问题，折腾了几个小时，谨以此文纪念我逝去的几个小时的青春。</p><h2 id="引用"><a href="#引用" class="headerlink" title="引用"></a>引用</h2><ol><li><a href="https://stackoverflow.com/questions/41873704/what-is-the-meaning-yellow-service-started-status-on-homebrew/55798920">What is the meaning yellow service “started” status on Homebrew? - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/51511863/brew-services-list-shows-mysql-running-but-cannot-connect/51512118">homebrew - brew services list shows mysql running but cannot connect - Stack Overflow</a></li><li><a href="https://stackoverflow.com/questions/4359131/brew-install-mysql-on-macos">brew install mysql on macOS - Stack Overflow</a></li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/adc594bd/">https://blog.coder4j.cn/posts/adc594bd/</a> </p>]]></content>
      
      
      <categories>
          
          <category> BREW </category>
          
      </categories>
      
      
        <tags>
            
            <tag> BREW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【GITBOOK】git book 导出 pdf 与 epub</title>
      <link href="/posts/6f9fe2cd/"/>
      <url>/posts/6f9fe2cd/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/119443/1601123738980-85811d51-3cf3-4ef5-bede-9e38cb17bf9d.jpeg#align=left&display=inline&height=1080&margin=%5Bobject%20Object%5D&originHeight=1080&originWidth=1920&size=0&status=done&style=none&width=1920"></p><h3 id="1-打开-gitbook-项目源码地址，并下载源码于本地"><a href="#1-打开-gitbook-项目源码地址，并下载源码于本地" class="headerlink" title="1. 打开 gitbook 项目源码地址，并下载源码于本地"></a>1. 打开 gitbook 项目源码地址，并下载源码于本地</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1601122977787-833fc996-1f21-4295-b07f-f91d9539693c.png#align=left&display=inline&height=576&margin=%5Bobject%20Object%5D&name=image.png&originHeight=576&originWidth=1561&size=115361&status=done&style=none&width=1561" alt="image.png"></p><h3 id="2-相关工具安装"><a href="#2-相关工具安装" class="headerlink" title="2. 相关工具安装"></a>2. 相关工具安装</h3><h4 id="2-1-npm"><a href="#2-1-npm" class="headerlink" title="2.1 npm"></a>2.1 npm</h4><p>gitbook 依赖 npm 需要提交安装好 npm</p><h4 id="2-2-gitbook-cli"><a href="#2-2-gitbook-cli" class="headerlink" title="2.2 gitbook-cli"></a>2.2 gitbook-cli</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g gitbook-cli</span><br></pre></td></tr></table></figure><h4 id="2-3-安装-calibre"><a href="#2-3-安装-calibre" class="headerlink" title="2.3 安装 calibre"></a>2.3 安装 calibre</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew cask install calibre</span><br></pre></td></tr></table></figure><p>calibrew 用于生成 epub 格式的工具</p><h3 id="3-进入-gitbook-项目要目录，并执行对应生成命令"><a href="#3-进入-gitbook-项目要目录，并执行对应生成命令" class="headerlink" title="3. 进入 gitbook 项目要目录，并执行对应生成命令"></a>3. 进入 gitbook 项目要目录，并执行对应生成命令</h3><h4 id="3-1-pdf"><a href="#3-1-pdf" class="headerlink" title="3.1 pdf"></a>3.1 pdf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook pdf .</span><br></pre></td></tr></table></figure><h4 id="3-2-epub"><a href="#3-2-epub" class="headerlink" title="3.2 epub"></a>3.2 epub</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitbook epub .</span><br></pre></td></tr></table></figure><p>如果正常结束，目录类会多一个 book.pdf 或 book.epub</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/6f9fe2cd/">https://blog.coder4j.cn/posts/6f9fe2cd/</a> </p>]]></content>
      
      
      <categories>
          
          <category> GITBOOK </category>
          
      </categories>
      
      
        <tags>
            
            <tag> GITBOOK </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Java拾遗】不可不知的 Java 序列化</title>
      <link href="/posts/bee4a1b6/"/>
      <url>/posts/bee4a1b6/</url>
      
        <content type="html"><![CDATA[<p><img src="https://i.loli.net/2020/09/22/5MLOlX9Hx34ZoIn.png#align=left&display=inline&height=383&margin=%5Bobject%20Object%5D&originHeight=383&originWidth=900&status=uploading&style=none&width=900"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在程序运行的生命周期中，序列化与反序列化的操作，几乎无时无刻不在发生着。对于任何一门语言来说，不管它是编译型还是解释型，只要它需要通讯或者持久化时，就必然涉及到序列化与反序列化操作。但是，又正因为序列化与反序列化太过重要，太过普遍，大部分编程语言和框架都对其进行了很好的封装，又因为他的润物细无声，使得我们很多时候根本没有意识到，代码下面其实进行了许许多多序列化相关的操作。今天我们就一起去探寻这位最熟悉的陌生人。</p><h2 id="序列化是什么"><a href="#序列化是什么" class="headerlink" title="序列化是什么"></a>序列化是什么</h2><p><a href="https://baike.baidu.com/item/%E5%BA%8F%E5%88%97%E5%8C%96">百度百科</a>中给序列化的定义是『序列化 (Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。』。似乎有点抽象，下面用一个例子简单类比一下。</p><p>日常生活中，总少不了人跟人之间的交流与沟通。而沟通的前提是先要把我们大脑中想的内容，通过某种形式表达出来。然后别人再通过我们表达出的内容去理解。</p><p><img src="https://i.loli.net/2020/09/21/rQjm4GuIt2pNUdT.jpg#align=left&display=inline&height=360&margin=%5Bobject%20Object%5D&originHeight=360&originWidth=360&status=uploading&style=none&width=360"></p><p>而表达的方式多种多样，最常见的就是说话，我们通过说一些话，把我们脑海里想的内容表达出来，对方听了这些话立刻明白了我们的想法。当然表达也可以是文字，比如你正在看的本文，不也是在与你交流吗？导演通过电影去表达自己对于世界的理解，画家通过画作述说的对美的渴望，音乐家通过乐符描述着对自由的向往。凡此种种，不胜枚举。</p><p>所以，这些又跟我们的主题 <strong>序列化</strong> 有什么关系呢？</p><p>其实人与人之间少不了沟通交流，程序与程序之间，机器与机器之间也少不了沟通交流。只不过通常不会说是沟通，我们会说请求、响应、传输、通讯…… 同样的内容只是换了一种说法。</p><p>上文中提到，人与人之间的沟通需要一种表达方式。通过这种表达方式把我们大脑中所想的内容，转化成他人可以理解的内容。而机器与机器之间的通讯也需要这样一种表达方式，通过这种表达方式把内存中的内容，转化成其它机器可以读取的内容。</p><p><img src="https://i.loli.net/2020/09/21/7lALSKXjU3xpkzf.png#align=left&display=inline&height=804&margin=%5Bobject%20Object%5D&originHeight=804&originWidth=1022&status=uploading&style=none&width=1022"></p><p>所以序列化可以简单的理解成是 <strong>机器内存中信息的表达方式</strong> 。</p><h2 id="为什么需要序列化"><a href="#为什么需要序列化" class="headerlink" title="为什么需要序列化"></a>为什么需要序列化</h2><p>通常情况下，我们的语言一方面用于交流，比如聊天，把我脑海中的思想，通过语言表达出来，对方听到我们的话语，会意我们的想法。</p><p>另一方面，我们的语言除了用于沟通交流，还可以用于记录。有一句话叫做『好记性不如烂笔头』。说的就是记录的重要性，因为话在我们的脑子里，很容易就忘了，通过记录下来可以保存更久。</p><p>而序列化功能又正好对应这两点，一个是用来传输信息，另一个是用来持久化。序列化用来传输的作用，前文已经说过了，关于持久化的作用，也很好理解。首先明确一个问题，序列化的是什么内容？通常是内存中的内容。而内存有一个特点我们都知道，那就是一重启就没了。对于部分内容，我们想在重启后还存在（比如说 tomcat 中 session 里面的对象），要怎么办呢？答案就是把内存中的对象保存到磁盘上，这样就不怕重启了，而持久化就需要用到序列化技术。</p><h2 id="如何实现序列化"><a href="#如何实现序列化" class="headerlink" title="如何实现序列化"></a>如何实现序列化</h2><p>人与人之间有许许多多的表达方式，而且机器与机器之间也同样，序列化的方式多种多样。</p><h3 id="Java-原生形式"><a href="#Java-原生形式" class="headerlink" title="Java 原生形式"></a>Java 原生形式</h3><p>对于如此普遍的序列化需求，Java 其实早在 JDK 1.1 开始就在语言层面进行了支持。而且使用起来非常方便，下面我们就一起看看具体代码。</p><ol><li>首先我们要把想序列化的类实现 Java 自带的 <code>java.io.Serializable</code> 接口</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) 2016-2020 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.serialization;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"><span class="keyword">import</span> java.util.StringJoiner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> HaveSerialization.java, v 0.1 2020-09-17 16:58 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HaveSerialization</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">4504407589319471384L</span>;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name value to be assigned to property name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> age value to be assigned to property age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> StringJoiner(<span class="string">&quot;, &quot;</span>, HaveSerialization.class.getSimpleName() + &quot;[&quot;, &quot;]&quot;)</span><br><span class="line">                .add(<span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&quot;</span>)</span><br><span class="line">                .add(<span class="string">&quot;age=&quot;</span> + age)</span><br><span class="line">                .toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>需要注意的是，虽说是实现了 <code>java.io.Serializable</code> 接口，但是我们其实没有覆盖任何方法。这是为什么呢？我们一起看一下 <code>java.io.Serializable</code> 的源码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>没错，是个空接口，除了接口定义部分，啥也没有。通常遇到这种情况，我们称之为标记接口，主要为了标记某些类，标记的原因是，把它与其它类区别出来，方便我们后面专门处理。而  <strong>Serializable</strong> 这个标记接口，就是为了让我们知道这个类是要进行序列化操作的类，仅此而已。</p><p>另外，虽然我们只实现一个空接口，但是细心的你，肯定发现了我们的类中多了一个 <strong>serialVersionUID</strong> 属性。那么这个属性的作用是什么呢？</p><p>它主要目的就是为了验证序列化与反序列化的类是否一致。比如上面 <code>HaveSerialization</code> 这个类现在有业务属性 <code>name</code> 与 <code>age</code> ，现在因为业务需要，我们要添加一个 <code>address</code> 的属性。序列化操作是没有问题的，但是把序列化信息传输给其它机器，其它机器在反序列化的时候，就出现了问题。因为其它机器的 <code>HaveSerialization</code> 没有 <code>address</code> 这个属性。</p><p>为了解决这个问题，JDK 通过使用 <strong>serialVersionUID</strong> 在作为该类的版本号，在反序列化时比较传输的类的值与要反序列化类的值是否一致，不一致就会报 <strong>InvalidCastException</strong> 。</p><p>当然，出发点是好的，但是直接抛异常会导致业务无法进行下去，通常 <strong>serialVersionUID</strong> 生成好后，我们不会再更新，序列化如果没有更新，对应变更的属性会为空，我们只要在业务里做好兼容就好了。</p><ol start="2"><li>序列化对象</li></ol><p>好了，我们已经完成了第一步，定义了一个序列化类，下面我们就把他给序列化掉。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 序列化对象（保存序列化文件）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSaveSerializationObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="keyword">final</span> HaveSerialization haveSerialization = <span class="keyword">new</span> HaveSerialization();</span><br><span class="line">    haveSerialization.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line">    haveSerialization.setAge(<span class="number">18</span>);</span><br><span class="line">    <span class="comment">// 创建序列化对象保存的文件</span></span><br><span class="line">    <span class="keyword">final</span> File file = <span class="keyword">new</span> File(<span class="string">&quot;haveSerialization.ser&quot;</span>);</span><br><span class="line">    <span class="comment">// 创建对象输出流</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="keyword">final</span> ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(file))) &#123;</span><br><span class="line">        <span class="comment">// 将对象输出到序列化文件</span></span><br><span class="line">        objectOutputStream.writeObject(haveSerialization);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到代码十分简单，大体分成如下 4 步：</p><ol><li>创建要序列化的对象<br>其实就是你上面的实现 <code>java.io.Serializable</code> 的类，如果没有实现，在这里会报 <code>NotSerializableException</code> 异常</li><li>创建一个 <code>File</code> 对象，用来保存序列化后的二进制数据。<br>注意这里文件名我用的是 <code>*.ser</code> ，这个 <strong>ser</strong> 后缀并没有强制要求，只是方便理解，你可能写成其它后缀</li><li>创建对象输出流<br>创建一个 <code>ObjectOutputStream</code> 对象输出流的对象，并把上面定义的序列化文件对象通过构造函数传给它。</li><li>通过输出流把对象写到序列化文件里<br>注意这里我用的 <strong>JDK 8</strong> 的 <code>try with resource</code> 语法，所以不用手动 <code>close</code></li></ol><p>好了，到这里我们序列化也完成了。</p><ol start="3"><li>反序列化对象</li></ol><p>既然有序列化，那肯定也有反序列化。反序列化可以理解成是序列化的逆向操作，既然序列化把内存中的对象转成一个可以持久化的文件，那么反序列化要做的就是把这个文件再加载到内存中的对象。话不多说，直接看代码。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 反序列化对象（从序列化文件中读取对象）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLoadSerializationObject</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    <span class="comment">// 创建对象输出流</span></span><br><span class="line">    <span class="keyword">try</span> (ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(</span><br><span class="line">            <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">&quot;haveSerialization.ser&quot;</span>)))) &#123;</span><br><span class="line">        <span class="comment">// 从输出流中创建对象</span></span><br><span class="line">        <span class="keyword">final</span> Object obj = objectInputStream.readObject();</span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>是的，反序列化代码比序列化代码还少，主要分成如下 2 步：</p><ol><li>创建对象输入流<br>创建一个 <code>ObjectInputStream</code> 对象，并把序列化文件通过构造函数传给它</li><li>从对象输入流中读取对象<br>直接通过 <code>readObject</code> 方法即可，注意读取后是 <code>Object</code> 类型，后续使用需手动强转一次</li></ol><p>到这里，我们便通过 JDK 原生的方法完成了序列化与反序列化操作，是不是还很简单。但是日常工作不太推荐直接使用原生的方式实现序列化，一方面它生成的序列化文件较大，一方面也比一些第三方框架生成的慢，但是序列化原理大致类似。下面我们简单看一下其它方式如何序列化。</p><h3 id="通用对象序列化"><a href="#通用对象序列化" class="headerlink" title="通用对象序列化"></a>通用对象序列化</h3><p>通常序列化是与语言绑定的，比如说通过上面 <strong>JDK</strong> 序列化的文件，不可能拿给 <strong>PHP</strong> 应用反序列化成 <strong>PHP</strong> 的对象。不过可以通过某些特殊的通用对象结构序列化来实现跨语言使用，比较常见的是 <strong>JSON</strong> 、<strong>XML</strong> 。下面我们以 <strong>JSON</strong> 为例看一下</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试序列化通过json</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSerializationByJSON</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//-------------序列化操作---------------</span></span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="keyword">final</span> HaveSerialization haveSerialization = <span class="keyword">new</span> HaveSerialization();</span><br><span class="line">    haveSerialization.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line">    haveSerialization.setAge(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化成 JSON 字符串</span></span><br><span class="line">    <span class="keyword">final</span> String jsonString = JSON.toJSONString(haveSerialization);</span><br><span class="line">    System.out.println(<span class="string">&quot;JSON:&quot;</span> + jsonString);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-------------反序列化操作---------------</span></span><br><span class="line">    <span class="keyword">final</span> HaveSerialization haveSerializationByJSON = JSON.parseObject(jsonString, HaveSerialization.class);</span><br><span class="line">    System.out.println(haveSerializationByJSON);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">JSON:&#123;&quot;age&quot;:18,&quot;name&quot;:&quot;kiwi&quot;&#125;</span><br><span class="line">HaveSerialization[name=&#x27;kiwi&#x27;, age=18]</span><br></pre></td></tr></table></figure><p>上述代码使用的 <strong>JSON</strong> 框架是 <a href="https://github.com/alibaba/fastjson">alibaba/fastjson</a> 。但是大部分 <strong>JSON</strong> 框架使用起来都大同小异。可以按个人喜好去替换。</p><h3 id="序列化框架"><a href="#序列化框架" class="headerlink" title="序列化框架"></a>序列化框架</h3><p>序列化框架其实有很多，比如 <code>kryo</code> 、 <code>hessian</code> 、 <code>protostuff</code> 。它们各有优缺点，详细的比较可以看这篇文章 <a href="https://www.iteye.com/blog/x-rip-1555293">序列化框架 kryo VS hessian VS Protostuff VS java</a> 。大家可以按各自的使用场景选择使用，下文以 <code>kryo</code> 为例演示。</p><ol><li>依赖</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.esotericsoftware<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kryo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.0.0-RC9<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>具体代码</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 测试序列化通过kryo</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSerializationByKryo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException </span>&#123;</span><br><span class="line">    <span class="comment">//-------------序列化操作---------------</span></span><br><span class="line">    <span class="comment">// 创建对象</span></span><br><span class="line">    <span class="keyword">final</span> HaveSerialization haveSerialization = <span class="keyword">new</span> HaveSerialization();</span><br><span class="line">    haveSerialization.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line">    haveSerialization.setAge(<span class="number">18</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">final</span> Kryo kryo = <span class="keyword">new</span> Kryo();</span><br><span class="line">    <span class="comment">// 注册序列化类</span></span><br><span class="line">    kryo.register(HaveSerialization.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化操作</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="keyword">final</span> Output output = <span class="keyword">new</span> Output(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;haveSerialization.kryo&quot;</span>))) &#123;</span><br><span class="line">        kryo.writeObject(output, haveSerialization);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="keyword">final</span> Input input = <span class="keyword">new</span> Input(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;haveSerialization.kryo&quot;</span>))) &#123;</span><br><span class="line">        <span class="keyword">final</span> HaveSerialization haveSerializationByKryo = kryo.readObject(input, HaveSerialization.class);</span><br><span class="line">        System.out.println(haveSerializationByKryo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其实看代码可以发现跟 <strong>JDK</strong> 的流程几乎一样，其中有几点需要注意的，<code>kryo</code> 在序列化前，要手动通过 <code>register</code> 注册序列化的类，有点类似 <strong>JDK</strong> 实现 <code>java.io.Serializable</code> 接口。然后 <code>Input</code> 、 <code>Output</code> 对象不是 <strong>JDK</strong> 的。是 <code>kryo</code> 提供的。另外 <code>Kryo</code> 有不少需要注意的地方，可以查看参考链接部分的内容学习。</p><h2 id="源码地址"><a href="#源码地址" class="headerlink" title="源码地址"></a>源码地址</h2><p>因文章篇幅有限，无法展示所有代码，已经另外把完整代码上传到 github，具体链接如下：</p><pre><code>[https://github.com/kiwiflydream/study-example/tree/master/study-serialization-example](https://github.com/kiwiflydream/study-example/tree/master/study-serialization-example)</code></pre><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://www.iteye.com/blog/x-rip-1555293">序列化框架 kryo VS hessian VS Protostuff VS java - 知其然，知其所以然 - ITeye 博客</a></li><li><a href="https://www.cnblogs.com/hntyzgn/p/7122709.html">Kryo 使用指南 - hntyzgn - 博客园</a></li><li><a href="https://www.cnkirito.moe/rpc-serialize-1/">深入理解 RPC 之序列化篇 –Kryo | 徐靖峰|个人博客</a></li><li><a href="https://github.com/EsotericSoftware/kryo">EsotericSoftware/kryo: Java binary serialization and cloning: fast, efficient, automatic</a></li></ol><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文主要介绍了 Java 序列化的相关内容，主要介绍序列化是什么？与人与人之间沟通的表达方式做类比，得到是 <strong>机器内存中信息的表达方式</strong> 。而为什么需要序列化，我们通过举例说明了序列化 <strong>信息传输与持久化</strong> 的功能。最后我们一起从 <strong>JDK 原生的实现 java.io.Serializable</strong> 的方式，再到通用对象序列化的 <strong>JSON、XML</strong> 方式，最终到第三方框架 <strong>kryo</strong> 的形式了解如何去实现序列化。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/bee4a1b6/">https://blog.coder4j.cn/posts/bee4a1b6/</a> </p>]]></content>
      
      
      <categories>
          
          <category> Java拾遗 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java拾遗 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【译】10 个有用的 git log 技巧</title>
      <link href="/posts/ca4b1f56/"/>
      <url>/posts/ca4b1f56/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1598968984592-22efb69a-a3ac-4eab-84bf-9c327a3bf2ff.png#align=left&display=inline&height=383&margin=%5Bobject%20Object%5D&name=image.png&originHeight=383&originWidth=900&size=470432&status=done&style=none&width=900" alt="image.png"></p><blockquote><p>原作者：Srebalaji<br>原文地址：<a href="https://hackernoon.com/ten-useful-git-log-tricks-7nt3yxy">Ten Useful Git Log Tricks | Hacker Noon</a><br>译者：<a href="https://blog.coder4j.cn/">KIWI 的碎碎念</a></p></blockquote><p>If you are using Git for a while you should have come across git log. As everyone knows, the git log is a simple command that helps us to view the changes or project history.</p><p>（如果你在使用 Git 一段时间后，应该会遇到访问 git 日志的场景。众所周知，git log 是一个帮助我们查看项目变更或项目历史的简单命令。）</p><p>Even with that simplicity, it is a very powerful tool and it comes with numerous options that help us to view the project changes and its structure. We will see some of the most used options in this article.</p><p>（尽管它是非常简单的，但是它是一个非常强大的命令工具，可以通过它提供的数量众多的选项来帮助我们去查看项目的变更与结构。在这篇文章里，我们将看到一些它最常使用的选项）</p><h2 id="git-log-—oneline"><a href="#git-log-—oneline" class="headerlink" title="git log —oneline"></a>git log —oneline</h2><p>This command helps you to view the commits in a cleaner way. It condenses each commit to a line and has only minimal information like shorter commit hash, commit message.</p><p>（这条命令可以帮助你以简洁的方式查看提交记录。它把提交记录浓缩在了一行，而且只保留类似较短的提交哈希值和提交信息）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --oneline</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1598875762622-319e4d6c-1ea0-4897-a17f-7bb26163c100.png#align=left&display=inline&height=182&margin=%5Bobject%20Object%5D&name=image.png&originHeight=230&originWidth=813&size=194191&status=done&style=none&width=643" alt="image.png"></p><h2 id="Filter-commits-by-time-period"><a href="#Filter-commits-by-time-period" class="headerlink" title="Filter commits by time period"></a>Filter commits by time period</h2><p>（根据时间段筛选提交信息）</p><p>These commands will filter out the commits by the given time period. For example, — after will only filter commits after the given time period and — before will only filter commits before the given time period.</p><p>(这些命令可以筛选出指定时间段的提交记录，例如，**–after** 会筛选出指定时间之后的提交记录，**–before ** 会筛选出指定时间之前的提交记录。)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --after&#x3D;&quot;2020-05-15&quot;</span><br></pre></td></tr></table></figure><blockquote><p>// 译者注：注意原文这里的日期格式是 2020-15-05 ，年日月？我本地测试时间不对，不知道是不是跟原作者配置或环境不一样，大家可以试一下自己本地可以支持哪种格式，后文的日期格式都是如此，不再赘述。</p></blockquote><p>The above command will show only commits after May 15th, 2020</p><p>(上面这条命令将只显示 2020 年 5 月 15 日 之后的提交记录)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --after&#x3D;&quot;2020-05-15&quot; --before&#x3D;&quot;2020-05-25&quot;</span><br></pre></td></tr></table></figure><p>The above command will show only commits from May 15 to May 25</p><p>(上面这条命令将只显示 5 月 15 号到 5 月 25 日之间的提交记录)</p><p>You can also use the following date formats</p><p>(你也可以使用如下的日期格式)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">git log --after&#x3D;&quot;yesterday&quot; &#x2F;&#x2F; shows only commits from yeserday</span><br><span class="line"></span><br><span class="line">(只显示昨天之后的提交记录)</span><br><span class="line"></span><br><span class="line">git log --after&#x3D;&quot;today&quot; &#x2F;&#x2F; shows only today commits</span><br><span class="line"></span><br><span class="line">(只显示今天的提交记录)</span><br><span class="line"></span><br><span class="line">git log --before&#x3D;&quot;10 day ago&quot; &#x2F;&#x2F; omits last 10 days commits</span><br><span class="line"></span><br><span class="line">(只显示 10 天前的提交记录)</span><br><span class="line"></span><br><span class="line">git log --after&#x3D;&quot;1 week ago&quot; &#x2F;&#x2F;show only commits from last week</span><br><span class="line"></span><br><span class="line">(只显示最近一周的提交记录)</span><br><span class="line"></span><br><span class="line">git log --after&#x3D;&quot;2 week ago&quot;</span><br><span class="line"></span><br><span class="line">（只显示最近两周的提交记录）</span><br><span class="line"></span><br><span class="line">git log --after&#x3D;&quot;2 month ago&quot; &#x2F;&#x2F; shows only last 2 months commits</span><br><span class="line"></span><br><span class="line">（只显示最近两个月的提交记录）</span><br></pre></td></tr></table></figure><h2 id="git-log-with-diff-changes"><a href="#git-log-with-diff-changes" class="headerlink" title="git log with diff changes"></a>git log with diff changes</h2><p>（带变更差异信息的 git 日志）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -p</span><br></pre></td></tr></table></figure><p>This command will show the log with the diff changes. So that you can know the changes done in each commit.</p><p>(这条命令将显示带变更差异信息的提交记录。所以你可以很清楚的知道每次提交都有哪些变更。)</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1598879462726-ad6b0dab-458d-40d5-bcfe-7aaede1f1dc9.png#align=left&display=inline&height=501&margin=%5Bobject%20Object%5D&name=image.png&originHeight=546&originWidth=620&size=350268&status=done&style=none&width=569" alt="image.png"></p><p>In the above image, you can see the git diff changes.</p><p>（在上面的图片里，你可以看到 git 的变更差异信息）</p><h2 id="Filter-commits-by-author"><a href="#Filter-commits-by-author" class="headerlink" title="Filter commits by author"></a>Filter commits by author</h2><p>（根据作者筛选提交记录）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --author&#x3D;&quot;Srebalaji&quot;</span><br></pre></td></tr></table></figure><p>The above command will filter out the commits done by the particular author. Note that the Git filters out by regex pattern. So don’t worry about the exact name match or case sensitivity.</p><p>（上面这条命令可以通过指定的作者名称过滤提交信息。注意 git 是通过正则表达式进行过滤的。所以不用担心精确的名称匹配或大小写敏感的匹配）</p><p>Git log can take multiple options so you can combine options for your need. For example,</p><p>（Git 日志是支持多选项的，所以你可以按你的需要自由组合选项。例如：）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --after&#x3D;&quot;1 week ago&quot; --author&#x3D;&quot;srebalji&quot; -p</span><br></pre></td></tr></table></figure><p>The above command will filter commits for the past week by the respective author and also shows the diff changes.</p><p>(上面这条命令将过滤出最近一周相应作者的提交记录并且同时显示变更差异信息)</p><h2 id="Filter-commits-by-log-messages"><a href="#Filter-commits-by-log-messages" class="headerlink" title="Filter commits by log messages"></a>Filter commits by log messages</h2><p>(根据日志提交信息过滤提交记录)</p><p>Sometimes, you need to filter commits by log messages. Git accepts a regex pattern to search for the log messages and displays all the matched commits.</p><p>（有时候，你需要根据日志信息过滤提交记录。Git 支持通过正则表达式去查询日志消息并且显示所有匹配的提交记录）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --grep&#x3D;&quot;ISSUE-43560&quot;</span><br></pre></td></tr></table></figure><p>The above command will filter commits by the respective pattern. And remember by default it’s case sensitive.</p><p>(上面这条命令将根据相应的正则表达式过滤提交记录。需要知道的是，它默认是大小写敏感的。)</p><p>To make the search case insensitive, you can pass -i parameter</p><p>（如果想使用大小写不敏感查询，你可以通过 <strong>-i</strong> 参数）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -i --grep&#x3D;&quot;issue-43560&quot;</span><br></pre></td></tr></table></figure><p>The below command is using a regex pattern search and will search for both the issue ids.</p><p>(下面这条命令通过两条 issue ids 的正式表达式查询提交记录)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -i --grep&#x3D;&quot;issue-43560\|issue-89786&quot;</span><br></pre></td></tr></table></figure><h2 id="Filter-commits-by-files"><a href="#Filter-commits-by-files" class="headerlink" title="Filter commits by files"></a>Filter commits by files</h2><p>（通过文件过滤提交记录）</p><p>Sometimes you need all commits changes that have affected some particular files. This will come in hand in many places.</p><p>（有时候你需要一些指定的变更文件的提交记录。这在很多地方都有使用。）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log main.rb</span><br></pre></td></tr></table></figure><p>This command will filter commits that made changes to the respective file.</p><p>（这条命令将按相应的文件过滤提交记录）</p><p>You can also pass multiple files to it.</p><p>（你也可以同时过滤多个文件）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log main.rb search.rb login.rb</span><br></pre></td></tr></table></figure><p>You can see I have passed three files to filter out.</p><p>（你能看到我通过三个文件去过滤提交记录。）</p><p>Remember you can also pass multiple options.</p><p>（记得你也可以通过多个选项去使用。）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -i --grep&#x3D;&quot;fix &quot; main.rb search.rb</span><br></pre></td></tr></table></figure><p>This command will filter out commits changes done to the specified files and also will match the log message by the given search pattern.</p><p>（这条命令将通过指定的文件和指定的日志消息的正则表达式去过滤提交记录）</p><h2 id="Filter-commits-by-file-content"><a href="#Filter-commits-by-file-content" class="headerlink" title="Filter commits by file content"></a>Filter commits by file content</h2><p>（根据文件内容过滤提交记录）</p><p>You may need to search for a specific string in the source code that has been added in the commit history. This can be possible by</p><p>（你也许需要在已经添加到提交历史的源码中查询指定字符串。这可能是如下的）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -S&quot;function login()&quot;</span><br></pre></td></tr></table></figure><p>The above command will search for the string “function login()”. By default, it’s case sensitive.</p><p>(上面这条命令将通过字符串 『function login()』查询。它默认是大小写敏感的)</p><p>You can make it case-insensitive by adding -i. And to view the content you can view the diff changes.</p><p>(你也可以通过添加 -i 来设置大小写不敏感的。并且同时显示差异变更的内容)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log -i -S&quot;function login()&quot; -p</span><br></pre></td></tr></table></figure><h2 id="Show-only-merge-commits"><a href="#Show-only-merge-commits" class="headerlink" title="Show only merge commits"></a>Show only merge commits</h2><p>（只显示合并提交）</p><p>This command helps us in knowing the merges done to the current branch.</p><p>（这条命令帮助我们知道当前分支的合并情况）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --merges</span><br></pre></td></tr></table></figure><p>The above command will show only the merge commits in the current branch. Nothing more.</p><p>(上面这条命令只显示当前分支的合并提交记录，仅此而已)</p><h2 id="Showing-diff-between-branches"><a href="#Showing-diff-between-branches" class="headerlink" title="Showing diff between branches"></a>Showing diff between branches</h2><p>（显示两个分支的差异）</p><p>We have already seen this command in one of our previous issues.</p><p>（在先前的问题中，我们已经见过这个命令了）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log master..develop</span><br></pre></td></tr></table></figure><p>This command will help you show all the commits from develop but that are not present in the master branch. In this way, you can know that how many new commits are added to the develop branch that is not present in the master branch. And make sure you have the updated changes in the local before comparing.</p><p>(这条命令将帮助我们查看所有在 develop 分支中的但又不在 master 分支的提交记录。通过这个方法，你可以知道在 develop 分支上有多少新的提交，但是 master 又不存在的。确保你在比较前，本地有修改的变更。)</p><h2 id="Custom-formatting-log-messages"><a href="#Custom-formatting-log-messages" class="headerlink" title="Custom formatting log messages"></a>Custom formatting log messages</h2><p>（自定义日志消息的格式）</p><p>Git also provides options to custom format our log messages. You can check out custom pretty options for more options.</p><p>（Git 也提供了自定义格式化日志消息的选项。你可以查看自定义的 pretty 选项的更多选项）</p><p>For example,</p><p>（例如，）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log --pretty&#x3D;format:&quot;%Cred%an - %ar%n %Cblue %h -%Cgreen %s %n&quot;</span><br></pre></td></tr></table></figure><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1598963580711-84d3c9cc-3a45-4155-92ec-1a9462be0eef.png#align=left&display=inline&height=524&margin=%5Bobject%20Object%5D&name=image.png&originHeight=524&originWidth=642&size=315411&status=done&style=none&width=642" alt="image.png"></p><p>You can see in the above image that the commit logs are custom formatted. It’s pretty easy and it comes in handy if you want to view only specific details of the log.</p><p>(你可以看到上面的图片的提交记录是自定义格式的。如果你只想查询日志的特定信息，它是非常简单与容易的。)</p><p>That’s it. Hope you learned something new :)</p><p>（就这样了，希望你学到了一些新的东西 😀）</p><p>Thank you for reading :) :)</p><p>（感谢你的阅读）</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/ca4b1f56/">https://blog.coder4j.cn/posts/ca4b1f56/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 译 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 译 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【随笔】外卖与影子</title>
      <link href="/posts/42ae089e/"/>
      <url>/posts/42ae089e/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/jpeg/119443/1598085674717-7de8bea9-c78a-4322-906f-a0c024260b1c.jpeg#align=left&display=inline&height=397&margin=%5Bobject%20Object%5D&name=mmexport1597409074531.jpg&originHeight=397&originWidth=540&size=25289&status=done&style=none&width=540" alt="mmexport1597409074531.jpg"></p><h3 id="失败的外卖"><a href="#失败的外卖" class="headerlink" title="失败的外卖"></a>失败的外卖</h3><p>前几天点喜茶，很不开心，外卖小哥把能犯的错误全都犯了。</p><p>首先送晚了，并且在还没送到时，就提前很久，点了已送达。另外，外卖几乎全撒了，点了 12 杯奶茶，送到时只剩 3 杯，其他 9 杯压根没见到。</p><p>这些其实都可以理解，但是最终送到时，小哥却一直在甩锅，非说我地址填错了，他导航时一直报偏离路线，还导致他其他单都超时，仿佛错的都是我。</p><p>首先，地址绝对是没问题的，用这个地址收了几年的外卖跟快递，第一次遇到说这个地址找不到的。其次，他说导航一直报偏离路线，按道理来说偏离路线，这就说明他没按导航规划的路线走。最重要的是外卖漏洒跟地址正不正确并没有关联关系，这个理由完全站不住脚。这种明明做错了，但是强词夺理让人很反感。</p><h3 id="讨厌的影子"><a href="#讨厌的影子" class="headerlink" title="讨厌的影子"></a>讨厌的影子</h3><p>很久之前，看过一句话 – <strong>你讨厌的人身上也一定有你自己的影子。</strong>我第一次听到时觉得十分的扯淡，我讨厌的人身上怎么会有我的影子，难道我讨厌我自己？但是后来随着经历的事情变多，发觉它还是有一定的合理性的。甚至在心理学上还有一个类型的概念 – 《<a href="https://baike.baidu.com/item/%E6%8A%95%E5%B0%84">投射</a>》 理论。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1598089411507-9219f306-785f-48ce-838f-82896033500e.png#align=left&display=inline&height=467&margin=%5Bobject%20Object%5D&name=image.png&originHeight=934&originWidth=1500&size=159758&status=done&style=none&width=750" alt="image.png"></p><p>自从明白这个道理后，我在遇到让我反感的人或事后。我就会想想这个人或这件事有没有我的影子。有则改之，无则加勉。有点类似老祖宗说的『<strong>见贤思齐焉，见不贤而内自省也</strong>』。</p><p>晚到、提前关单、漏洒。这些我都能理解，但是最后的甩锅行为却让我十分的反感。反感之后，就在思考这件事上是不是有我自己的影子。</p><p>其实整件事上最大的槽点，就是最后的甩锅行为。当时只要稍微表达一丝丝歉意，而不是一上来就盛气凌人，反而指责他人有问题，况且还在他人并没有错误的情况下。即使他人也有问题，这也不能掩盖自己的错误事实。</p><p>这样一想，发现自己身上还的确有同样的问题。把送外卖换成写代码，把晚到、提前关单、漏洒换成出现 bug，就变得很明显了。</p><p>当出现线上 bug 时，我可能会有一大堆理由，这个逻辑是产品经理设计的、开发时间太紧、在我本地是好的、测试是怎么测的，有 bug 还能上线。。。仿佛我自己才是最委屈的那个。但是细想一下，又跟 <strong>因为地址写错，所以漏洒</strong> 一样都是一些站不住脚的借口。</p><p>逻辑是产品设计的，但是实现是自己实现的，也经过产品评审会、技术评审会，而且没有提出异意。开发时间太紧，这也是最常遇到的，工期太紧的确会出现产品质量下降，但是也不是必然的理由。如果时间太紧有没有向上提出异意，如果时间无法延长，在保证核心业务的情况下，是否同产品商量过削减其它不紧急的业务逻辑，如果都不可以，是否向上反馈了质量风险。最后，出现线上问题，一般来说，测试同学有很大的责任，但是测试同学，特别是功能测试，很难完全覆盖所有的业务分支，最了解自己代码逻辑的只有自己，单元测试的覆盖率是否达标。</p><p>其实又何止打代码这一件事，生活中例子比比皆是，<strong>错了不可怕，怕的是认识不到自己错了</strong>。拿外界或他人的过错来掩盖自己的问题，是没法进步的。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1598093265108-073f57ea-d1d9-41b4-95eb-b13a349c89e4.png#align=left&display=inline&height=164&margin=%5Bobject%20Object%5D&name=image.png&originHeight=328&originWidth=600&size=309171&status=done&style=none&width=300" alt="image.png"></p><h3 id="差评的权力"><a href="#差评的权力" class="headerlink" title="差评的权力"></a>差评的权力</h3><p>再说回外卖的事，我到最后也没有给小哥打差评。事实上无论是在网购、外卖还是打车。。。有评分功能的产品上，我几乎没有打过差评，除非我认为对方是恶意为之。大部分情况下我都表示理解。每次我想打差评的时候，都会脑补一个外卖小哥幸幸苦苦跑一天，结果因为一次失误被投诉，一天的收入被罚款。一个司机一天兢兢业业的开车，结果因为某次接乘客的时候，走错一个路口，导致出现延误被差评。</p><p>感性上，让我一直不要打差评，但是理性上，我又一直告诉我自己这样做是错误的。</p><p>不知道从什么时候开始，外卖平台都多了个 **准时赔付 **的功能。平台会估算一个送达时间，你可以按餐额的一定比例买份准时赔付险。如果没有按时送达，会进行赔付。刚开始看到这个功能的时候，我觉得很好。但是没用几次，我发现这个功能就是个鸡肋。因为那些准时的外卖小哥，不管你买不买赔付险，他们一般都会准时送到。而那些不太准时的外卖小哥，通常在时间期限快到的时候，打个电话给你，说他在楼下了，或者快到了，他们先点已送达然后关闭订单了，更有甚者直接一声不吭点了已送达，实际上超过约定时间很久才送到。而赔付险是按外卖小哥点击已送达的时间为准，所以几乎没有什么约束力。</p><p>为什么会出现这种情况呢？我觉得就是因为我放弃了差评的权力，没有及时的负面反馈，事情就向更负面的方向发展。</p><p>如果仔细想想这个 <strong>准时赔付险</strong> 本身就是很荒唐的一件事。也是消费者放弃自己差评权力造成的。试想我买了一份外卖，平台告诉我会在某个时间送达，这算是一种契约了，但是我为了外卖小哥按平台约定的时间送到，我需再额外加钱买个 <strong>准时赔付险 **让他去履行当初本该履行的契约。外卖费用就变成了 **本身餐费 + 运送费 + 准时送到的额外费 **。这就像 A 借给 B 100 块钱，然后快到了还钱的时候，B 对 A 说，</strong>如果想让我准时还钱。那你得先给我钱。**</p><p>记得有一次《奇葩说》，好像有一个类似给不给差评的辩题。有一个发言让我印象深刻，她说 <strong>对于出错的外卖小哥，她表示感情上的理解，但是她还是要给差评，因为如果不给，那就是对那些没有出错的外卖小哥不公平，</strong>我深以为然。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/42ae089e/">https://blog.coder4j.cn/posts/42ae089e/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【测试】 Java如何优雅的生成测试数据</title>
      <link href="/posts/ca9ab046/"/>
      <url>/posts/ca9ab046/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1596466683511-3126376c-fb13-4a4c-9b14-3b31d8aa198c.png#align=left&display=inline&height=383&margin=%5Bobject%20Object%5D&name=image.png&originHeight=383&originWidth=900&size=38900&status=done&style=none&width=900" alt="image.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在日常的测试中，我们经常需要提前准备一大堆测试数据，用来验证业务逻辑。当然对于简单的数据类型完全可以通过 JDK 自带的  <code>Random</code>  类来实现。但是对于一个比较复杂的类，或者参数的格式有特殊要求的时候，<code>Random</code>  就不适用了，这个时候就需要借助一些能够生成测试数据的框架。</p><h2 id="相关框架"><a href="#相关框架" class="headerlink" title="相关框架"></a>相关框架</h2><p>我在实际调研中，找到了 2 个在个人看来还不错的生成框架，他们分别是：</p><ol><li><a href="https://github.com/jsonzou/jmockdata">jmockdata</a></li><li><a href="https://github.com/DiUS/java-faker">java-faker</a></li></ol><p>下面我将一一介绍这些框架的优缺点以及适用场景。话不多说，直接开始撸代码。</p><h3 id="JmockData"><a href="#JmockData" class="headerlink" title="JmockData"></a>JmockData</h3><p>首先出场的是 JmockData 框架，它是官方定义如下：</p><blockquote><p>一款实现模拟 JAVA 类型或对象的实例化并随机初始化对象的数据的工具框架。</p></blockquote><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.jsonzou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmockdata<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="基础类型数据生成"><a href="#基础类型数据生成" class="headerlink" title="基础类型数据生成"></a>基础类型数据生成</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testBaseType</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 基础数据类型</span></span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">byte</span>.class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">int</span>.class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">long</span>.class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">double</span>.class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">float</span>.class));</span><br><span class="line">    System.out.println(JMockData.mock(String.class));</span><br><span class="line">    System.out.println(JMockData.mock(BigDecimal.class));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 基础数据类型的数组</span></span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">byte</span>[].class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">int</span>[].class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">long</span>[].class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">double</span>[].class));</span><br><span class="line">    System.out.println(JMockData.mock(<span class="keyword">float</span>[].class));</span><br><span class="line">    System.out.println(JMockData.mock(String[].class));</span><br><span class="line">    System.out.println(JMockData.mock(BigDecimal[].class));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="运行结果"><a href="#运行结果" class="headerlink" title="运行结果"></a>运行结果</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2610</span></span><br><span class="line"><span class="number">3401</span></span><br><span class="line"><span class="number">8582.18</span></span><br><span class="line"><span class="number">7194.44</span></span><br><span class="line"><span class="number">5</span>Xu7</span><br><span class="line"><span class="number">9051.92</span></span><br><span class="line">[B@<span class="number">7f</span>be847c</span><br><span class="line">[I@<span class="number">41975e01</span></span><br><span class="line">[J<span class="meta">@c2e1f26</span></span><br><span class="line">[D<span class="meta">@dcf3e99</span></span><br><span class="line">[F@<span class="number">6d</span>9c638</span><br><span class="line">[Ljava.lang.String;@<span class="number">7d</span>c5e7b4</span><br><span class="line">[Ljava.math.BigDecimal;@<span class="number">1</span>ee0005</span><br></pre></td></tr></table></figure><h4 id="JavaBean-类型数据生成"><a href="#JavaBean-类型数据生成" class="headerlink" title="JavaBean 类型数据生成"></a>JavaBean 类型数据生成</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * java bean 测试</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJavaBean</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Person mock = JMockData.mock(Person.class);</span><br><span class="line">    System.out.println(mock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="运行结果-1"><a href="#运行结果-1" class="headerlink" title="运行结果"></a>运行结果</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person[address=RrayfQIK,age=<span class="number">5863</span>,idCard=SDn,name=j]</span><br></pre></td></tr></table></figure><p>这里可以看到，使用 <code>JMockdata.mock(xx.class);</code> 可以很容易的生成一个 JavaBean。框架通过反射，在底层遍历获得类的属性与类型，然后填充数据。</p><p>但是与此同时，大家也发现了，虽然我们可以的的确确的生成了一个 <code>Person</code> 类，也给它的每个属性都填充了值，但是生成的数据只是根据类型简单生成的，比如 <code>age</code> 字段被填充的是 5863。如果数据有现实含义，没有规则的随机就很容易出现乌龙。</p><p>要解决这个问题，我们就要限制随机数据的范围，可以通过它的配置功能实现。</p><h4 id="使用随机配置"><a href="#使用随机配置" class="headerlink" title="使用随机配置"></a>使用随机配置</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJavaBeanWithConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    MockConfig mockConfig =</span><br><span class="line">            <span class="keyword">new</span> MockConfig()</span><br><span class="line">                    .subConfig(<span class="string">&quot;age&quot;</span>)</span><br><span class="line">                    <span class="comment">// 设置 int 的范围</span></span><br><span class="line">                    .intRange(<span class="number">1</span>, <span class="number">100</span>)</span><br><span class="line">                    .subConfig(<span class="string">&quot;email&quot;</span>)</span><br><span class="line">                    <span class="comment">// 设置生成邮箱正则</span></span><br><span class="line">                    .stringRegex(<span class="string">&quot;[a-z0-9]&#123;5,15&#125;\\@\\w&#123;3,5&#125;\\.[a-z]&#123;2,3&#125;&quot;</span>)</span><br><span class="line">                    .globalConfig();</span><br><span class="line"></span><br><span class="line">    Person mock = JMockData.mock(Person.class, mockConfig);</span><br><span class="line">    System.out.println(mock);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="运行结果-2"><a href="#运行结果-2" class="headerlink" title="运行结果"></a>运行结果</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person[address=hXttj2s,age=<span class="number">2</span>,email=w14hnn<span class="meta">@UvFB9</span>.kt,idCard=V5bBdX,name=KM8]</span><br></pre></td></tr></table></figure><p>可以看到 <code>age</code> 跟 <code>email</code> 已经正常了，可以通过他强大的配置功能对于数据进行生成的限制，但是你也发现了，对于一些有简单边界的数据，这样做可以，否则就像 address 、 name 这样的数据，很难通过简单规则去生成。</p><p>而对于有现实意义的数据生成，可以使用 java-faker 框架。</p><h3 id="Java-faker"><a href="#Java-faker" class="headerlink" title="Java-faker"></a>Java-faker</h3><h4 id="依赖-1"><a href="#依赖-1" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.javafaker<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javafaker<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="数据生成"><a href="#数据生成" class="headerlink" title="数据生成"></a>数据生成</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testRandomName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Faker faker = <span class="keyword">new</span> Faker();</span><br><span class="line">    <span class="keyword">final</span> Name name = faker.name();</span><br><span class="line">    System.out.println(<span class="string">&quot;firstName : &quot;</span> + name.firstName());</span><br><span class="line">    System.out.println(<span class="string">&quot;username : &quot;</span> + name.username());</span><br><span class="line">    System.out.println(<span class="string">&quot;bloodGroup : &quot;</span> + name.bloodGroup());</span><br><span class="line">    System.out.println(<span class="string">&quot;suffix : &quot;</span> + name.suffix());</span><br><span class="line">    System.out.println(<span class="string">&quot;title : &quot;</span> + name.title());</span><br><span class="line">    System.out.println(<span class="string">&quot;lastName : &quot;</span> + name.lastName());</span><br><span class="line">    System.out.println(<span class="string">&quot;nameWithMiddle : &quot;</span> + name.nameWithMiddle());</span><br><span class="line">    System.out.println(<span class="string">&quot;fullName : &quot;</span> + name.fullName());</span><br><span class="line">    System.out.println(<span class="string">&quot;name : &quot;</span> + name.name());</span><br><span class="line">    System.out.println(<span class="string">&quot;prefix : &quot;</span> + name.prefix());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="生成结果"><a href="#生成结果" class="headerlink" title="生成结果"></a>生成结果</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">firstName : Hollis</span><br><span class="line">username : cristy.white</span><br><span class="line">bloodGroup : O-</span><br><span class="line">suffix : Sr.</span><br><span class="line">title : Product Implementation Specialist</span><br><span class="line">lastName : Johnston</span><br><span class="line">nameWithMiddle : Alesia Hagenes Kiehn</span><br><span class="line">fullName : Dr. Pat Marvin</span><br><span class="line">name : Ms. Jamal Rau</span><br><span class="line">prefix : Mr.</span><br></pre></td></tr></table></figure><p>可以看到 java-faker 生成数据特别的方便，基本格式如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">      Faker faker = <span class="keyword">new</span> Faker();</span><br><span class="line">      <span class="keyword">final</span> Xx xx = faker.xx();</span><br><span class="line">xx.yyyy;</span><br></pre></td></tr></table></figure><p>步骤：</p><ol><li>创建 faker 对象</li><li>通过 faker 对象获得要生成的实体对象</li><li>调用实体对象获得对于生成的部分</li></ol><p>这里的实体对象，对应上面的 name，也就说我们要生成姓名相关的数据，拿到实体对象后还可以只获得其中的部分数据，比如姓名中的姓或名，还有前缀，甚至血型，可以说是非常全面。</p><p>而且 java-faker 支持的实体对象特别的多，如下：</p><blockquote><ul><li>Address</li><li>Ancient</li><li>Animal</li><li>App</li><li>Aqua Teen Hunger Force</li><li>Artist</li><li>Avatar</li><li>Back To The Future</li><li>Aviation</li><li>Basketball</li><li>Beer</li><li>Bojack Horseman</li><li>Book</li><li>Bool</li><li>Business</li><li>ChuckNorris</li><li>Cat</li><li>Code</li><li>Coin</li><li>Color</li><li>Commerce</li><li>Company</li><li>Crypto</li><li>DateAndTime</li><li>Demographic</li><li>Disease</li><li>Dog</li><li>DragonBall</li><li>Dune</li><li>Educator</li><li>Esports</li><li>File</li><li>Finance</li><li>Food</li><li>Friends</li><li>FunnyName</li><li>GameOfThrones</li><li>Gender</li><li>Hacker</li><li>HarryPotter</li><li>Hipster</li><li>HitchhikersGuideToTheGalaxy</li><li>Hobbit</li><li>HowIMetYourMother</li><li>IdNumber</li><li>Internet</li><li>Job</li><li>Kaamelott</li><li>LeagueOfLegends</li><li>Lebowski</li><li>LordOfTheRings</li><li>Lorem</li><li>Matz</li><li>Music</li><li>Name</li><li>Nation</li><li>Number</li><li>Options</li><li>Overwatch</li><li>PhoneNumber</li><li>Pokemon</li><li>Princess Bride</li><li>Relationship Terms</li><li>RickAndMorty</li><li>Robin</li><li>RockBand</li><li>Shakespeare</li><li>SlackEmoji</li><li>Space</li><li>StarTrek</li><li>Stock</li><li>Superhero</li><li>Team</li><li>TwinPeaks</li><li>University</li><li>Weather</li><li>Witcher</li><li>Yoda</li><li>Zelda</li></ul></blockquote><p>从身份证到姓名再到地址、动物、书籍、头像、职位等等，基本上覆盖了我们生活中的方方页面。</p><p>另外，java-faker 更贴心的是帮我们实现了国际化，可能刚才看了姓名的例子，有些朋友觉得这个框架好看但不好用，就拿生成姓名来说，生成都是 Johnston、Tom、Kiwi 之类英文名，在国内很少用到这些数据。其实 java-faker 已经考虑到这个问题。而且只要改一行代码就可以了。</p><h5 id="修改后的代码"><a href="#修改后的代码" class="headerlink" title="修改后的代码"></a>修改后的代码</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原代码 Faker faker = new Faker();</span></span><br><span class="line"><span class="comment">// 新代码</span></span><br><span class="line">      Faker faker = <span class="keyword">new</span> Faker(Locale.CHINA);</span><br><span class="line">      <span class="keyword">final</span> Name name = faker.name();</span><br><span class="line">      System.out.println(<span class="string">&quot;firstName : &quot;</span> + name.firstName());</span><br><span class="line">      System.out.println(<span class="string">&quot;username : &quot;</span> + name.username());</span><br><span class="line">      System.out.println(<span class="string">&quot;bloodGroup : &quot;</span> + name.bloodGroup());</span><br><span class="line">      System.out.println(<span class="string">&quot;suffix : &quot;</span> + name.suffix());</span><br><span class="line">      System.out.println(<span class="string">&quot;title : &quot;</span> + name.title());</span><br><span class="line">      System.out.println(<span class="string">&quot;lastName : &quot;</span> + name.lastName());</span><br><span class="line">      System.out.println(<span class="string">&quot;nameWithMiddle : &quot;</span> + name.nameWithMiddle());</span><br><span class="line">      System.out.println(<span class="string">&quot;fullName : &quot;</span> + name.fullName());</span><br><span class="line">      System.out.println(<span class="string">&quot;name : &quot;</span> + name.name());</span><br><span class="line">      System.out.println(<span class="string">&quot;prefix : &quot;</span> + name.prefix());</span><br></pre></td></tr></table></figure><h5 id="生成结果-1"><a href="#生成结果-1" class="headerlink" title="生成结果"></a>生成结果</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">firstName : 熠彤</span><br><span class="line">username : 烨霖.龙</span><br><span class="line">bloodGroup : A-</span><br><span class="line">suffix : IV</span><br><span class="line">title : Investor Division Engineer</span><br><span class="line">lastName : 范</span><br><span class="line">nameWithMiddle : 胡思</span><br><span class="line">fullName : 孟鸿涛</span><br><span class="line">name : 黎航</span><br><span class="line">prefix : Miss</span><br></pre></td></tr></table></figure><p>只需要，把之前的 Faker faker = new Faker(); 改成 Faker faker = new Faker(Locale.CHINA); 即可。如果你想生成其它国家的内容也是可以的，java-faker 支持的国家如下：</p><blockquote><ul><li>bg</li><li>ca</li><li>ca-CAT</li><li>da-DK</li><li>de</li><li>de-AT</li><li>de-CH</li><li>en</li><li>en-AU</li><li>en-au-ocker</li><li>en-BORK</li><li>en-CA</li><li>en-GB</li><li>en-IND</li><li>en-MS</li><li>en-NEP</li><li>en-NG</li><li>en-NZ</li><li>en-PAK</li><li>en-SG</li><li>en-UG</li><li>en-US</li><li>en-ZA</li><li>es</li><li>es-MX</li><li>fa</li><li>fi-FI</li><li>fr</li><li>he</li><li>hu</li><li>in-ID</li><li>it</li><li>ja</li><li>ko</li><li>nb-NO</li><li>nl</li><li>pl</li><li>pt</li><li>pt-BR</li><li>ru</li><li>sk</li><li>sv</li><li>sv-SE</li><li>tr</li><li>uk</li><li>vi</li><li>zh-CN</li><li>zh-TW</li></ul></blockquote><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><h3 id="JmockData-1"><a href="#JmockData-1" class="headerlink" title="JmockData"></a>JmockData</h3><p>个人感觉它是 plus 版的 Random 类，方便简单的按类型生成数据，也可以自己给定配置与规则去生成，缺点，上文也说了，生成的数据没有太多实际意义，简单数据还好，如果像姓名、地址等有现实意义的数据，就不太合适了。</p><h3 id="Java-faker-1"><a href="#Java-faker-1" class="headerlink" title="Java-faker"></a>Java-faker</h3><p>java-faker 其实是迁移自 ruby 中大名鼎鼎的 faker。很多语言都有他的对应迁移，比如 python、java。所以数据量和功能是很完善并且经过考验的，使用起来也很方便。实际工作中，可以优化使用。如果要说缺点，个人觉得他有些地方国际化的并不全面，比如车牌、身份证之类的。如果对于这些数据有比较严格的要求，推荐另一个项目 <a href="https://github.com/yindz/common-random">yindz/common-random: 简单易用的随机数据生成器。</a>这个项目对于本地化数据，做了很多处理，基本够用。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/ca9ab046/">https://blog.coder4j.cn/posts/ca9ab046/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【随笔】开源之殇</title>
      <link href="/posts/3bff6daa/"/>
      <url>/posts/3bff6daa/</url>
      
        <content type="html"><![CDATA[<h1 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585665681398-9d34e534-df66-4ee2-a177-8ac14fbdfc86.png#align=left&display=inline&height=383&name=image.png&originHeight=383&originWidth=900&size=288525&status=done&style=none&width=900" alt="image.png"></h1><h1 id="1"><a href="#1" class="headerlink" title="1"></a>1</h1><p>这两天有个<a href="https://www.ithome.com/0/480/137.htm">新闻</a>比较火，一个叫丹尼斯·普什卡列夫的俄罗斯程序员，因为骑车撞人被判 18 个月。骑车撞人可能不是什么大新闻，造成严重后果的，被判刑也无可厚非。</p><p>可问题就出在这个撞人的程序员上，他是前端知名开源框架 <a href="https://github.com/zloirock/core-js">core-js</a> 的作者。这个库有多知名呢？反正苹果公司在使用，并且 vue 也依赖这个项目。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585656907662-cfbdaf7d-0893-4853-bdc5-53462a4f28f9.png#align=left&display=inline&height=441&name=image.png&originHeight=882&originWidth=2550&size=257910&status=done&style=none&width=1275" alt="image.png"></p><p>上图是 core-js 在 npm 的项目截图，可以看到每周有 2600w+ 次的下载量。这个体量可以说是一个前端生态的基础框架了。</p><p>说了这么多，我只想表达这个项目真的很重要，有很多很多人每天都在使用。</p><p>所以在得知作者被判刑之后引起了很多人的担忧，项目没人维护了，在项目的 github 上的 issues 就有人直接了当的问作者，入狱之后这个项目怎么办。</p><p>有人提议作者转移 core-js 的控制权，毕竟他有很长一段时间是没法维护的。甚至还有人建议作者在监狱的图书馆里继续维护这个项目。</p><p>总之大多人关心的是这个开源项目未来是否能继续稳定的使用，而不是作者本人以及交通事故的受害者。虽说不上对错，但总感悲凉，人都已经入狱了，还被人催着维护项目。</p><h1 id="2"><a href="#2" class="headerlink" title="2"></a>2</h1><p>另一件事，部分人可能有些印象，2017 年的年中的时候，有一篇文章在开源界传的很广。帖子的标题叫作  <a href="https://www.v2ex.com/t/367424">知名公司（努比亚/中兴）拿我的开源软件（ XXL-JOB）申请国家知识专利，我该怎么办？</a>部分内容如下：</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585659106524-005508a6-23a1-4bd7-ad4c-0ae1ea443947.png#align=left&display=inline&height=591&name=image.png&originHeight=1182&originWidth=1518&size=460162&status=done&style=none&width=759" alt="image.png"></p><p>一家国内知名企业把一个开源项目一字未改的拿取申请了国家专利。也就是说你辛辛苦苦写的代码，无偿给别人使用，别人拿着你的代码去申请了知识产权，到头来自己使用自己的项目都可能被告侵权。是不是很魔幻。</p><p>其实这个开源项目在业内有一定的知名度，作者本身也有一定的影响力。甚至当时开源中国网站也介入维权。下面是开源中国官方的<a href="https://my.oschina.net/javayou/blog/918941">维权进展报告</a>。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585660110740-818e47fa-3771-428b-b6f0-9100343f4b77.png#align=left&display=inline&height=621&name=image.png&originHeight=1242&originWidth=1848&size=300281&status=done&style=none&width=924" alt="image.png"></p><p>注意这个最新进展报告的发布时间及文章的最后一句话。到写本文时（2020-03-31），我仍然可以在专利网站上找到这个专利申请。大概率永远也不会有什么改变。</p><h1 id="3"><a href="#3" class="headerlink" title="3"></a>3</h1><p>去年，我在 v 站看到了一篇帖子，一直在脑海里久久不能平息，帖子的标题是  <a href="https://www.v2ex.com/t/625470">程序员总喜欢自断后路，难怪职业生涯只能到 35 岁</a> 。原帖内容如下：</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585660758808-70f7f05f-4962-4b4f-b8a3-04403d9cbb41.png#align=left&display=inline&height=891&name=image.png&originHeight=1783&originWidth=1520&size=625284&status=done&style=none&width=760" alt="image.png"></p><p>如果早几年，我还在学校，或者刚刚接触 IT 行业，我点开这篇文章，肯定一喷到底。现在看到这样的内容，只能无言以对。我知道作者只是一时情绪激动，通过偏激的方式去表达，但是我能感同身受到作者的那种愤怒与无奈。</p><h1 id="4"><a href="#4" class="headerlink" title="4"></a>4</h1><p>刚接触到 github 的时候，我感到很震惊，怎么会有人把自己写的代码无偿的提供给其它人使用。接触久了，我又觉得理所应当，熟视无睹后，觉得 IT 行业本来就应该是这样的。但是再久点，我又开始疑惑，真的是理所应当的吗？我接触到的各行各业，从来没有看到过任何一个行业，有 IT 行业，这种如此普遍的共享与开源精神。</p><p>时至今日，我仍不明白开源的精神究竟是什么，又是什么力量驱动着无数程序员为之通宵达旦，呕心沥血而不求回报。</p><p>我想，开源也许是独属于程序员的浪漫主义吧。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585667451352-29d2a9e3-1fbd-479e-b51c-3b100f2ddea7.png#align=left&display=inline&height=266&name=image.png&originHeight=250&originWidth=450&size=109976&status=done&style=none&width=479" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/3bff6daa/">https://blog.coder4j.cn/posts/3bff6daa/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Maven】maven 插件开发实战</title>
      <link href="/posts/7e8b6a7/"/>
      <url>/posts/7e8b6a7/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585583078647-c0a12206-3334-4eaf-9588-fd384bd43d3b.png#align=left&display=inline&height=383&name=image.png&originHeight=383&originWidth=900&size=137499&status=done&style=none&width=900" alt="image.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>众所周知，maven 实质上是一个插件执行框架，所有的工作都是通过插件完成的。包括我们日常使用到的类似 install、clean、deploy、compiler。。。这些命令，其实底层都是一个一个的 maven 插件。</p><h2 id="如何开发自己的插件"><a href="#如何开发自己的插件" class="headerlink" title="如何开发自己的插件"></a>如何开发自己的插件</h2><h3 id="1-maven-插件的命名规范"><a href="#1-maven-插件的命名规范" class="headerlink" title="1. maven 插件的命名规范"></a>1. maven 插件的命名规范</h3><p>在写一个项目之前，第一件事就是确定一个名称。maven 插件也不例外。它有着自己的一套命名规范。但是规范很简单，一句话就可以概括，<strong>官方插件命名的格式为 maven-xxx-plugin,非官方的插件命名为 xxx-maven-plugin 。</strong>是不是觉得很眼熟，没错，spring boot starter 的命名也有类似的规范。</p><p>好的，我们的第一个 maven 插件项目就叫 demo-maven-plugin 吧。</p><h3 id="2-创建项目"><a href="#2-创建项目" class="headerlink" title="2. 创建项目"></a>2. 创建项目</h3><p>名称起好了，下一步就是创建这个项目。如果你使用 idea 的话，那么创建十分的便捷，按如下步骤即可：</p><h4 id="2-1-选择-org-apache-maven-archetypes-maven-archetype-mojo-为骨架创建项目"><a href="#2-1-选择-org-apache-maven-archetypes-maven-archetype-mojo-为骨架创建项目" class="headerlink" title="2.1 选择 org.apache.maven.archetypes:maven-archetype-mojo 为骨架创建项目"></a>2.1 选择 org.apache.maven.archetypes:maven-archetype-mojo 为骨架创建项目</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585576537171-8acf6bd7-2bf5-4db9-8d03-cd17ce0073ea.png#align=left&display=inline&height=605&name=image.png&originHeight=1210&originWidth=2462&size=415035&status=done&style=none&width=1231" alt="image.png"></p><ol><li>选择创建新项目</li><li>选择通过 maven 创建</li><li>勾选 Create from archetype 通过项目骨架创建</li><li>选择  org.apache.maven.archetypes:maven-archetype-mojo</li><li>点击下一步</li></ol><h4 id="2-2-输入在第一步起的项目名"><a href="#2-2-输入在第一步起的项目名" class="headerlink" title="2.2 输入在第一步起的项目名"></a>2.2 输入在第一步起的项目名</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585576749262-5321d41f-c5c2-484b-9449-fc8f18f51d8e.png#align=left&display=inline&height=605&name=image.png&originHeight=1210&originWidth=2462&size=165287&status=done&style=none&width=1231" alt="image.png"></p><p>点击 Next</p><h4 id="2-3-点击-Finish-完成项目创建"><a href="#2-3-点击-Finish-完成项目创建" class="headerlink" title="2.3 点击 Finish 完成项目创建"></a>2.3 点击 Finish 完成项目创建</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585576887162-6f6a5e25-7aa6-4edb-9f38-e04697661b8d.png#align=left&display=inline&height=605&name=image.png&originHeight=1210&originWidth=2462&size=183559&status=done&style=none&width=1231" alt="image.png"></p><h4 id="2-4-分析项目文件"><a href="#2-4-分析项目文件" class="headerlink" title="2.4  分析项目文件"></a>2.4  分析项目文件</h4><h5 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h5><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585577595314-252a1194-e2df-4087-952e-6c03b6b5bbb4.png#align=left&display=inline&height=155&name=image.png&originHeight=310&originWidth=802&size=35169&status=done&style=none&width=401" alt="image.png"></p><blockquote><p>可以看到生成的项目就是我们最最常见的 maven 项目的结构，生成的文件也很少，一个 pom.xml 文件，一个 MyMojo 文件，简单介绍一下这两个文件</p></blockquote><h5 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.coder4j.study.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>maven-plugin<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-mavne-plugin Maven Mojo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.8.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>首先生成的项目 pom.xml 中，自动依赖了两个项目，一个是 maven-plugin-api ，这个是开发 maven 插件必须依赖的核心包。另一个是单元测试时使用的 junit 包。这两个没什么要注意的，真正要注意的是这个项目的 packaging，通常我遇到的 packaging 都是 jar、war、pom，这里比较特殊是 maven-plugin。</p></blockquote><h5 id="MyMojo-java"><a href="#MyMojo-java" class="headerlink" title="MyMojo.java"></a>MyMojo.java</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.coder4j.study.example;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2001-2005 The Apache Software Foundation.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.AbstractMojo;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.MojoExecutionException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Goal which touches a timestamp file.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@goal</span> touch</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@phase</span> process-sources</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMojo</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractMojo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Location of the file.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@parameter</span> expression=&quot;$&#123;project.build.directory&#125;&quot;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@required</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> File outputDirectory;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> MojoExecutionException</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        File f = outputDirectory;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( !f.exists() )</span><br><span class="line">        &#123;</span><br><span class="line">            f.mkdirs();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        File touch = <span class="keyword">new</span> File( f, <span class="string">&quot;touch.txt&quot;</span> );</span><br><span class="line"></span><br><span class="line">        FileWriter w = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            w = <span class="keyword">new</span> FileWriter( touch );</span><br><span class="line"></span><br><span class="line">            w.write( <span class="string">&quot;touch.txt&quot;</span> );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> ( IOException e )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> MojoExecutionException( <span class="string">&quot;Error creating file &quot;</span> + touch, e );</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ( w != <span class="keyword">null</span> )</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    w.close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">catch</span> ( IOException e )</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// ignore</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>首先生成的类继承了  AbstractMojo 这个抽象类，这里是 maven 插件的规范要求，maven 插件必须要继承  AbstractMojo  并实现他的  execute 方法。</p><p>另外可以看到类与方法使用了很多 tag。注意是 tag 而不是注解，注解是直接标记的，而 tag 是在文档注释里面的。</p><p>其中  @goal 这个 tag 的作用是指定插件的命名，比如我们常用的 mvn clean，这个 clean 就是他的  @goal 。</p><p>而 @phase 是绑定插件执行的生成周期，比如你绑定在 clean 这个周期，那你在执行 clean 的时候会自动触发你的插件。</p><p>@parameter 用来指定插件的参数。</p><p>小朋友你是否有很多问号？tag 这个东西写在文档注释里面的东西，方便是方便但是容易写错呀，写错没有语法报错，写对时候也没有语法提示，为什么不直接用注解的形式呢？原因是 java 的注解是 jdk1.5 之后才有的，而实现 maven 的时候还没有这种语法。所以要一条路走到黑，一直背这个历史包袱吗？当然不是，后面我们会说解决办法。另外，这种写法虽然不推荐使用了，但是有些 maven 的经典插件由于完成时间比较早，熟悉这些 tag 对于理解代码也有帮助。</p><h3 id="3-开发插件"><a href="#3-开发插件" class="headerlink" title="3. 开发插件"></a>3. 开发插件</h3><h4 id="3-1-代码未动，依赖先行-pom-xml"><a href="#3-1-代码未动，依赖先行-pom-xml" class="headerlink" title="3.1 代码未动，依赖先行  pom.xml"></a>3.1 代码未动，依赖先行  pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.coder4j.study.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>maven-plugin<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>demo-mavne-plugin Maven Mojo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugin-tools<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-plugin-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>相较于默认的 pom.xml 文件，我们做了如下几个变动：</p><ol><li>升级 maven-plugin-api 的插件版本到  3.5.2 。原生的 2.0 实在是太老了。</li><li>添加  maven-plugin-annotations 这个依赖，还记得上面说的 tag 的事吗？有了这个依赖就可以直接使用注解了</li><li>添加  maven-plugin-plugin 插件依赖，添加这个依赖主要是为了在 jdk1.8 能编译通过，否则会报错</li></ol><h4 id="3-2-DemoMojo-java"><a href="#3-2-DemoMojo-java" class="headerlink" title="3.2 DemoMojo.java"></a>3.2 DemoMojo.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) 2016-2020 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.AbstractMojo;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.MojoExecutionException;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.MojoFailureException;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.Mojo;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.Parameter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> DemoMojo.java, v 0.1 2020-03-30 22:51 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Mojo(name = &quot;hello&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoMojo</span> <span class="keyword">extends</span> <span class="title">AbstractMojo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter(name = &quot;name&quot;, defaultValue = &quot;kiwi&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">throws</span> MojoExecutionException, MojoFailureException </span>&#123;</span><br><span class="line">        getLog().info(<span class="string">&quot;hello &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>首先，同生成的类一样，我们的类必须继承  AbstractMojo 并实现他的 execute 方法，而 execute 方法其实就是这个插件的入口类。</p><p>示例代码中有两个很重要的注解，一个是 @Mojo ，它主要用来定义插件相关的信息相当于上面说的 @goal ，其中 name 属性用来指定这个插件名称，同 clean 类似。</p><p>另外一个重要注解  @Parameter ，则是用来指定插件运行时使用的参数，其中 name 是参数名，defaultValue 顾名思义是默认值，也就是在用户没有设置的时候使用的值。</p><p>详细的插件及作用如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.maven.execution.MavenSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.AbstractMojo;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.MojoExecution;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugin.descriptor.PluginDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.Component;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.Execute;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.InstantiationStrategy;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.LifecyclePhase;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.Mojo;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.Parameter;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.plugins.annotations.ResolutionScope;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.project.MavenProject;</span><br><span class="line"><span class="keyword">import</span> org.apache.maven.settings.Settings;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 此Mojo对应的目标的名称</span></span><br><span class="line"><span class="meta">@Mojo( name = &quot;&lt;goal-name&gt;&quot;,</span></span><br><span class="line"><span class="meta">       aggregator = &lt;false|true&gt;,</span></span><br><span class="line"><span class="meta">       configurator = &quot;&lt;role hint&gt;&quot;,</span></span><br><span class="line"><span class="meta">       // 执行策略</span></span><br><span class="line"><span class="meta">       executionStrategy = &quot;&lt;once-per-session|always&gt;&quot;,</span></span><br><span class="line"><span class="meta">       inheritByDefault = &lt;true|false&gt;,</span></span><br><span class="line"><span class="meta">       // 实例化策略</span></span><br><span class="line"><span class="meta">       instantiationStrategy = InstantiationStrategy.&lt;strategy&gt;,</span></span><br><span class="line"><span class="meta">       // 如果用户没有在POM中明确设置此Mojo绑定到的phase，那么绑定一个MojoExecution到那个phase</span></span><br><span class="line"><span class="meta">       defaultPhase = LifecyclePhase.&lt;phase&gt;,</span></span><br><span class="line"><span class="meta">       requiresDependencyResolution = ResolutionScope.&lt;scope&gt;,</span></span><br><span class="line"><span class="meta">       requiresDependencyCollection = ResolutionScope.&lt;scope&gt;,</span></span><br><span class="line"><span class="meta">       // 提示此Mojo需要被直接调用（而非绑定到生命周期阶段）</span></span><br><span class="line"><span class="meta">       requiresDirectInvocation = &lt;false|true&gt;,</span></span><br><span class="line"><span class="meta">       // 提示此Mojo不能在离线模式下运行</span></span><br><span class="line"><span class="meta">       requiresOnline = &lt;false|true&gt;,</span></span><br><span class="line"><span class="meta">       // 提示此Mojo必须在一个Maven项目内运行</span></span><br><span class="line"><span class="meta">       requiresProject = &lt;true|false&gt;,</span></span><br><span class="line"><span class="meta">       // 提示此Mojo是否线程安全，线程安全的Mojo支持在并行构建中被并发的调用</span></span><br><span class="line"><span class="meta">       threadSafe = &lt;false|true&gt; )</span> <span class="comment">// (since Maven 3.0)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 何时执行此Mojo</span></span><br><span class="line"><span class="meta">@Execute( goal = &quot;&lt;goal-name&gt;&quot;,           // 如果提供goal，则隔离执行此Mojo</span></span><br><span class="line"><span class="meta">          phase = LifecyclePhase.&lt;phase&gt;, // 在此生命周期阶段自动执行此Mojo</span></span><br><span class="line"><span class="meta">          lifecycle = &quot;&lt;lifecycle-id&gt;&quot; )</span>  <span class="comment">// 在此生命周期中执行此Mojo</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMojo</span></span></span><br><span class="line"><span class="class">    <span class="keyword">extends</span> <span class="title">AbstractMojo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( name = &quot;parameter&quot;,</span></span><br><span class="line"><span class="meta">                // 在POM中可使用别名来配置参数</span></span><br><span class="line"><span class="meta">                alias = &quot;myAlias&quot;,</span></span><br><span class="line"><span class="meta">                property = &quot;a.property&quot;,</span></span><br><span class="line"><span class="meta">                defaultValue = &quot;an expression, possibly with $&#123;variables&#125;&quot;,</span></span><br><span class="line"><span class="meta">                readonly = &lt;false|true&gt;,</span></span><br><span class="line"><span class="meta">                required = &lt;false|true&gt; )</span></span><br><span class="line">    <span class="keyword">private</span> String parameter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Component( role = MyComponentExtension.class,</span></span><br><span class="line"><span class="meta">                hint = &quot;...&quot; )</span></span><br><span class="line">    <span class="keyword">private</span> MyComponent component;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;session&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> MavenSession session;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;project&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> MavenProject project;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;mojoExecution&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> MojoExecution mojo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;plugin&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> PluginDescriptor plugin;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;settings&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> Settings settings;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;project.basedir&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> File basedir;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Parameter( defaultValue = &quot;$&#123;project.build.directory&#125;&quot;, readonly = true )</span></span><br><span class="line">    <span class="keyword">private</span> File target;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回到示例上了，我们这个插件作用很简单，根据配置输出 hello xxx，如果没有配置就输出 hello kiwi。我们在写插件时，当然不会这样写，但是通过这个 demo，你就掌握了 maven 插件的大部分知识，可以自己做一些很有趣的插件。</p><h3 id="4-使用插件"><a href="#4-使用插件" class="headerlink" title="4. 使用插件"></a>4. 使用插件</h3><p>首先上面我们的代码写完了，必须要 Install 一下，否则别的项目无法直接依赖，如果你还想给其它人使用，那还需上传到 maven 仓库。</p><h4 id="4-1-依赖插件"><a href="#4-1-依赖插件" class="headerlink" title="4.1 依赖插件"></a>4.1 依赖插件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.coder4j.study.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在我们想使用插件的项目中，添加如上配置，其中 plugin 中使用我们插件的   GAV 信息。</p><h4 id="4-2-启动插件"><a href="#4-2-启动插件" class="headerlink" title="4.2 启动插件"></a>4.2 启动插件</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585581578390-50d9cb76-2506-4cae-8cba-d93d21bbd7fa.png#align=left&display=inline&height=326&name=image.png&originHeight=652&originWidth=904&size=126075&status=done&style=none&width=452" alt="image.png"></p><p>如果上面配置的都正确，那么在 idea 右侧的 Maven 中，你配置的项目的 Plugins 下会多了一个 demo（具体根据你插件项目的名称），而 demo 里面会有一个 demo:hello，其中这个 demo 对应你插件项目的名称，而 hello 对应你插件的名称也就是 @Mojo 中的 name 。</p><p>好的，我们双击一下，demo:hello ，会输出如下日志：</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585581782947-f0d0ee16-4c02-4925-85e7-039229934079.png#align=left&display=inline&height=340&name=image.png&originHeight=680&originWidth=1766&size=109127&status=done&style=none&width=883" alt="image.png"></p><p>这样，我们的第一个 Maven 插件就好了。</p><h4 id="4-3-配置参数"><a href="#4-3-配置参数" class="headerlink" title="4.3 配置参数"></a>4.3 配置参数</h4><p>可能你还记得，我们在写 DemoMojo 的时候还指定了一个 name 属性，并且为它指定了一个  Parameter，这个如何使用。只要在依赖的插件下面添加 configuration 标签就可以了。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.coder4j.study.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demo-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>tom<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>其中  configuration 标签内的标签，对应你定义的参数名称，而且 idea 还有语法提示，很 nice。</p><p>好的，我们再运行一下，结果如下：</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585582062275-b8dfb9e9-bddc-4eea-bd3b-ec6e1aca2d6c.png#align=left&display=inline&height=338&name=image.png&originHeight=676&originWidth=1788&size=107447&status=done&style=none&width=894" alt="image.png"></p><p>好的，大功告成。</p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="https://blog.gmem.cc/maven-plugin-development">Maven 插件开发</a></p><p><a href="https://www.cnblogs.com/sniffs/p/11985699.html">Maven 插件编写</a></p><h3 id="项目源码"><a href="#项目源码" class="headerlink" title="项目源码"></a>项目源码</h3><p>因为篇幅有限，无法贴完所有代码，如遇到问题可到 <a href="https://github.com/kiwiflydream/study-example/tree/master/demo-maven-plugin">github</a> 上查看源码。</p><h2 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h2><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1585582500755-9deeb99d-1ffa-4dfd-9812-2dfd9a399013.png#align=left&display=inline&height=250&name=image.png&originHeight=500&originWidth=900&size=291174&status=done&style=none&width=450" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/7e8b6a7/">https://blog.coder4j.cn/posts/7e8b6a7/</a> </p>]]></content>
      
      
      <categories>
          
          <category> Maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【qdox】Java 代码解析利器 QDox</title>
      <link href="/posts/2a8bb95f/"/>
      <url>/posts/2a8bb95f/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1584882725192-78d7799b-f010-48a2-b59a-0a16cf76ea10.png#align=left&display=inline&height=383&name=image.png&originHeight=383&originWidth=900&size=300248&status=done&style=none&width=900" alt="image.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近在写 maven 插件，涉及到了 java 代码解析这块内容。需要解析 java 源码，然后对于类中的不同部分进行处理。发现手写还是很难的，找了一圈发现了两个不错的工具可以使用，一个是  <a href="https://github.com/javaparser/javaparser">javaparser</a>，另一个是  <a href="https://github.com/paul-hammant/qdox">qdox</a> 。个人感觉 javaparser 强大一些，更新与维护也比较勤，但是相对来说上手难一点，从他的使用文档独立成书在买，可见一斑，而 qdox 比较小巧，上手很快，功能也满足大部分需求，最终还是选择了 qdox。</p><h2 id="什么是-QDox"><a href="#什么是-QDox" class="headerlink" title="什么是 QDox"></a>什么是 QDox</h2><p>官方的介绍是:</p><blockquote><p>QDox - full extractor of Java class/interface/method definitions (including annotations, parameters, param names)</p></blockquote><p>大概意思是一款完整的 java 类、接口、方法定义的提取器，包括了注释、参数及参数名称。其实核心功能就是我输入一个 java 类的源码，他可以把这个 java 类解析成一个对象，我们通过这个对象可以获取很方便的获取解析的类的不同组成，比如我可以获得这个类有哪些方法，这个方法的参数是什么，返回值又是什么，他们的类型又分别是什么？还有这个方法上有哪些注释、哪些 tag。也能获取类中有哪些的 field。。。总之把这个类庖丁解牛般解析好，使得调用者很方便的获取到自己感兴趣的信息。</p><h2 id="为什么使用-QDox"><a href="#为什么使用-QDox" class="headerlink" title="为什么使用 QDox"></a>为什么使用 QDox</h2><p>除了上面说的 QDox 上手比较快外，他的运行速度及占用空间都十分优秀。</p><p>另外不得不说的是这个项目可以说是一个上古时期的项目了，看了 github 上的提交记录，最早的一条提交记录是 2002 年的时候，因为这个项目之前使用的是 svn，所以具体时间可能更早。一个开源项目维护了快 20 年也是一件挺令人钦佩的事。不过到目前为止，这个项目在 github 上只有 151 个 star，如果这个项目对你有所帮助，希望大家可以给作者一个 star。github 上有太多类似的项目默默无闻的出现，又默默无闻的消逝。</p><p>扯远了，虽然项目关注的人比较少，但是使用它的项目还是比较多的。maven 的官方 javadoc 插件  maven-javadoc-plugin 就是使用它来解析代码中的 doc tags 的。所以可能你没有直接使用它，但是它其中已经在你本地的 maven 仓库内躺着了。有官方背书，对于它的使用就比较放心了。</p><h2 id="什么情况下适合使用-QDox"><a href="#什么情况下适合使用-QDox" class="headerlink" title="什么情况下适合使用 QDox"></a>什么情况下适合使用 QDox</h2><p>这个就比较多了，通常只要我们需要解析源码的内容就可以使用，比如我想获得指定类文件中的全部方法。就可以使用。可能有些人感到不解了，为什么不通过反射拿到这些内容，这样不是更方便吗？首先，反射的前提是你能拿到这个类的实例，或者你项目中就有这个类。即使这些条件都满足，但是一个很常见的需求反射没法满足，比如说拿到方法的注释及 tags 等，这类在编译时就被抹除了。这种情况就不得不用源码解析的方法了。</p><p>另外它不只是能解析，他同时可以生成 java 类文件，所以你可以动态的生成一些 java 类。</p><p>无论是解析还是生成，在写插件的时候肯定需要会有这样的场景，比如我想通过代码里的 javadoc 这些 tags 生成一个接口文档给前端，这样就不用我一个一个手写了。再比如我想通过数据表的信息，自动生成 model 类，service 类。。。使用场景的限制主要是个人的想象力。</p><h2 id="如何使用-QDox"><a href="#如何使用-QDox" class="headerlink" title="如何使用 QDox"></a>如何使用 QDox</h2><h3 id="创建-java-项目-builder-对象"><a href="#创建-java-项目-builder-对象" class="headerlink" title="创建 java 项目 builder 对象"></a>创建 java 项目 builder 对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 java 项目 builder 对象</span></span><br><span class="line">JavaProjectBuilder javaProjectBuilder = <span class="keyword">new</span> JavaProjectBuilder();</span><br></pre></td></tr></table></figure><h3 id="添加-java-源文件"><a href="#添加-java-源文件" class="headerlink" title="添加 java 源文件"></a>添加 java 源文件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加 java 源文件</span></span><br><span class="line">javaProjectBuilder.addSource(<span class="keyword">new</span> File(<span class="string">&quot;/Users/kiwi/study/code/study-example/study-qdox-example/src/main/java/cn/coder4j/study/example/qdox/Demo.java&quot;</span>));</span><br></pre></td></tr></table></figure><blockquote><p>demo 示例是通过文件添加的，其实支持很多种类型，比如 URL、Reader 甚至直接添加一个目录，框架会自己扫描目录下的所有 java 文件</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1584875079407-bec0607d-34a3-413d-be2a-1787fa13f162.png#align=left&display=inline&height=197&name=image.png&originHeight=394&originWidth=1538&size=114763&status=done&style=none&width=769" alt="image.png"></p><h3 id="获得解析后的-JavaClass-对象"><a href="#获得解析后的-JavaClass-对象" class="headerlink" title="获得解析后的 JavaClass 对象"></a>获得解析后的 JavaClass 对象</h3><blockquote><p>经过上面两步，准备工作就已经结束了，可以直接获得解析后的 JavaClass 对象了，有两种方式获取，一种是直接获得解析后的类集合，为什么是集合呢？因为上面也说了是可以添加目录的，而且 addSource 可以多次调用，添加多个文件。另一种是在知道类名称的情况下直接使用 getClassByName 获得</p></blockquote><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1584880098195-0ea64ff6-f3d0-47f8-95b2-dd54217c0d32.png#align=left&display=inline&height=107&name=image.png&originHeight=214&originWidth=1554&size=75807&status=done&style=none&width=777" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得解析后的类</span></span><br><span class="line">Collection&lt;JavaClass&gt; classes = javaProjectBuilder.getClasses();</span><br><span class="line"><span class="keyword">for</span> (JavaClass javaClass : classes) &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="JavaClass-接口定义"><a href="#JavaClass-接口定义" class="headerlink" title="JavaClass 接口定义"></a>JavaClass 接口定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.thoughtworks.qdox.model;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Licensed to the Apache Software Foundation (ASF) under one</span></span><br><span class="line"><span class="comment"> * or more contributor license agreements.  See the NOTICE file</span></span><br><span class="line"><span class="comment"> * distributed with this work for additional information</span></span><br><span class="line"><span class="comment"> * regarding copyright ownership.  The ASF licenses this file</span></span><br><span class="line"><span class="comment"> * to you under the Apache License, Version 2.0 (the</span></span><br><span class="line"><span class="comment"> * &quot;License&quot;); you may not use this file except in compliance</span></span><br><span class="line"><span class="comment"> * with the License.  You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   http://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing,</span></span><br><span class="line"><span class="comment"> * software distributed under the License is distributed on an</span></span><br><span class="line"><span class="comment"> * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></span><br><span class="line"><span class="comment"> * KIND, either express or implied.  See the License for the</span></span><br><span class="line"><span class="comment"> * specific language governing permissions and limitations</span></span><br><span class="line"><span class="comment"> * under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.thoughtworks.qdox.library.ClassLibrary;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class&#125;, providing the most important methods.</span></span><br><span class="line"><span class="comment"> * Where the original Class is using an Array, this model is using a List.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Robert Scholte</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">JavaClass</span> <span class="keyword">extends</span> <span class="title">JavaModel</span>, <span class="title">JavaType</span>, <span class="title">JavaAnnotatedElement</span>, <span class="title">JavaGenericDeclaration</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The compilation unit, which includes the imports, the public and anonymous classes</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the &#123;<span class="doctag">@link</span> JavaSource&#125; of this element</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaSource <span class="title">getSource</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.Class#isInterface()&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Determines if the specified &lt;code&gt;Class&lt;/code&gt; object represents an interface type.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this object represents an interface, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isInterface</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.Class#isEnum()&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Returns &lt;code&gt;true&lt;/code&gt; if and only if this class was declared as an enum in the source code.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this object represents an enum, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEnum</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.Class#isAnnotation()&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;Returns true if this &lt;code&gt;Class&lt;/code&gt; object represents an annotation type.</span></span><br><span class="line"><span class="comment">     *    Note that if this method returns true, &#123;<span class="doctag">@link</span> #isInterface()&#125; would also return true, as all annotation types are also interfaces.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this object represents an annotation, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAnnotation</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">JavaClass <span class="title">getDeclaringClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">JavaType <span class="title">getSuperClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Shorthand for getSuperClass().getJavaClass() with null checking.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the super class as &#123;<span class="doctag">@link</span> JavaClass&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaClass <span class="title">getSuperJavaClass</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;JavaType&gt; <span class="title">getImplements</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getInterfaces()&#125;</span></span><br><span class="line"><span class="comment">     *  Determines the interfaces implemented by the class or interface represented by this object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a list of interfaces, never &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaClass&gt; <span class="title">getInterfaces</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getCodeBlock</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">JavaSource <span class="title">getParentSource</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getPackage()&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the package</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaPackage <span class="title">getPackage</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * If this class has a package, the packagename will be returned.</span></span><br><span class="line"><span class="comment">     * Otherwise an empty String.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the name of the package, otherwise an empty String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">getPackageName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this class is an inner class, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isInner</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getMethods()&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the methods declared or overridden in this class</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaMethod&gt; <span class="title">getMethods</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getConstructors()&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the list of constructors</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaConstructor&gt; <span class="title">getConstructors</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the constructor, can be &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching constructor, otherwise &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaConstructor <span class="title">getConstructor</span><span class="params">(List&lt;JavaType&gt; parameterTypes)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the constructor, can be &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> varArg define is the constructor has varArgs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching constructor, otherwise &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaConstructor <span class="title">getConstructor</span><span class="params">(List&lt;JavaType&gt; parameterTypes, <span class="keyword">boolean</span> varArg)</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Return declared methods and optionally the inherited methods</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses &#123;<span class="doctag">@code</span> true&#125; if inherited methods should be returned as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> all methods</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaMethod&gt; <span class="title">getMethods</span><span class="params">( <span class="keyword">boolean</span> superclasses )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the method, can be &lt;code&gt;null&lt;/code&gt;.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching method, otherwise &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaMethod <span class="title">getMethodBySignature</span><span class="params">( String name, List&lt;JavaType&gt; parameterTypes )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This should be the signature for getMethodBySignature.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the method, can be &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> varArgs define if the method has varArgs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching method, otherwise  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaMethod <span class="title">getMethod</span><span class="params">( String name, List&lt;JavaType&gt; parameterTypes, <span class="keyword">boolean</span> varArgs )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the method, can be  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses to define if superclasses should be included as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching method, otherwise  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaMethod <span class="title">getMethodBySignature</span><span class="params">( String name, List&lt;JavaType&gt; parameterTypes, <span class="keyword">boolean</span> superclasses )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the method, can be  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses &#123;<span class="doctag">@code</span> true&#125; if inherited methods should be matched as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> varArg define if the method has varArgs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching method, otherwise  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaMethod <span class="title">getMethodBySignature</span><span class="params">( String name, List&lt;JavaType&gt; parameterTypes, <span class="keyword">boolean</span> superclasses, <span class="keyword">boolean</span> varArg )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the method, can be  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses &#123;<span class="doctag">@code</span> true&#125; if inherited methods should be matched as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching methods, otherwise  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaMethod&gt; <span class="title">getMethodsBySignature</span><span class="params">( String name, List&lt;JavaType&gt; parameterTypes, <span class="keyword">boolean</span> superclasses )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the method</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> parameterTypes the parameter types of the method, can be  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses &#123;<span class="doctag">@code</span> true&#125; if inherited methods should be matched as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> varArg define if the method has varArgs</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the matching methods, otherwise  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaMethod&gt; <span class="title">getMethodsBySignature</span><span class="params">( String name, List&lt;JavaType&gt; parameterTypes, <span class="keyword">boolean</span> superclasses,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                   <span class="keyword">boolean</span> varArg )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getFields()&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a list of fiels, never  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaField&gt; <span class="title">getFields</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getField(String)&#125;, where this method can resolve every field</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the field</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the field</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaField <span class="title">getFieldByName</span><span class="params">( String name )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Based on &#123;<span class="doctag">@link</span> java.lang.Class#getEnumConstants()&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a List of enum constants if this class is an &lt;code&gt;enum&lt;/code&gt;, otherwise  &#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaField&gt; <span class="title">getEnumConstants</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name the name of the enum constant</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the enumConstant matching the &#123;<span class="doctag">@code</span> name&#125;, otherwise &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaField <span class="title">getEnumConstantByName</span><span class="params">( String name )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> Class#getDeclaredClasses()&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a list of declared classes, never &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaClass&gt; <span class="title">getNestedClasses</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">JavaClass <span class="title">getNestedClassByName</span><span class="params">( String name )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fullyQualifiedName the FQN to match with</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if this is of type FQN, otherwise &#123;<span class="doctag">@code</span> false&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isA</span><span class="params">( String fullyQualifiedName )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> javaClass the JavaClass to match with</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if this is of type &#123;<span class="doctag">@literal</span> javaClass&#125;, otherwise &#123;<span class="doctag">@code</span> false&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isA</span><span class="params">( JavaClass javaClass )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Returns the depth of this array, 0 if it&#x27;s not an array</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> The depth of this array, at least &lt;code&gt;0&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getDimensions</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this JavaClass is an array, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isArray</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this JavaClass is a void, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0 (was part of Type since 1.6)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isVoid</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> Class#getComponentType()&#125;</span></span><br><span class="line"><span class="comment">     * If this type is an array, return its component type</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the type of array if it&#x27;s one, otherwise &lt;code&gt;null&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">JavaClass <span class="title">getComponentType</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets bean properties without looking in superclasses or interfaces.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the bean properties</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;BeanProperty&gt; <span class="title">getBeanProperties</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses to define if superclasses should be included as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the bean properties</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;BeanProperty&gt; <span class="title">getBeanProperties</span><span class="params">( <span class="keyword">boolean</span> superclasses )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Gets bean property without looking in superclasses or interfaces.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> propertyName the name of the property</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the bean property</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">BeanProperty <span class="title">getBeanProperty</span><span class="params">( String propertyName )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> propertyName the name of the property</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> superclasses to define if superclasses should be included as well</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the bean property</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 1.3</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">BeanProperty <span class="title">getBeanProperty</span><span class="params">( String propertyName, <span class="keyword">boolean</span> superclasses )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> Class#getClasses()&#125;</span></span><br><span class="line"><span class="comment">     * Gets the known derived classes. That is, subclasses or implementing classes.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the derived classes</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaClass&gt; <span class="title">getDerivedClasses</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;DocletTag&gt; <span class="title">getTagsByName</span><span class="params">( String name, <span class="keyword">boolean</span> superclasses )</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">ClassLibrary <span class="title">getJavaClassLibrary</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * A list if &#123;<span class="doctag">@link</span> JavaInitializer&#125;, either static or instance initializers.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a List of initializers</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;JavaInitializer&gt; <span class="title">getInitializers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getName()&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the name of the entity (class, interface, array class, primitive type, or void) represented by this Class object, as a String.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> java.lang.Class#getSimpleName()&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the simple name of the underlying class as given in the source code.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 2.0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">String <span class="title">getSimpleName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Equivalent of &#123;<span class="doctag">@link</span> Class#getModifiers()&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * &lt;strong&gt;This does not follow the java-api&lt;/strong&gt;</span></span><br><span class="line"><span class="comment">     * The Class.getModifiers() returns an &lt;code&gt;int&lt;/code&gt;, which should be decoded with the &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier&#125;.</span></span><br><span class="line"><span class="comment">     * This method will return a list of strings representing the modifiers.</span></span><br><span class="line"><span class="comment">     * If this member was extracted from a source, it will keep its order.</span></span><br><span class="line"><span class="comment">     * Otherwise if will be in the preferred order of the java-api.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> all modifiers is this member</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">List&lt;String&gt; <span class="title">getModifiers</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier#isPublic(int)&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Return &lt;code&gt;true&lt;/code&gt; if the class includes the public modifier, &lt;code&gt;false&lt;/code&gt; otherwise.</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if class has the public modifier, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isPublic</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier#isProtected(int)&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Return &lt;code&gt;true&lt;/code&gt; if the class includes the protected modifier, &lt;code&gt;false&lt;/code&gt; otherwise.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if class has the protected modifier, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isProtected</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier#isPrivate(int)&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Return &lt;code&gt;true&lt;/code&gt; if the class includes the private modifier, &lt;code&gt;false&lt;/code&gt; otherwise.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if class has the private modifier, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isPrivate</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier#isFinal(int)&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Return &lt;code&gt;true&lt;/code&gt; if the class includes the final modifier, &lt;code&gt;false&lt;/code&gt; otherwise.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if class has the final modifier, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isFinal</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier#isStatic(int)&#125;)</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;</span></span><br><span class="line"><span class="comment">     * Return &lt;code&gt;true&lt;/code&gt; if the class includes the static modifier, &lt;code&gt;false&lt;/code&gt; otherwise.</span></span><br><span class="line"><span class="comment">     * &lt;/p&gt;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if class the static modifier, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isStatic</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.reflect.Modifier#isAbstract(int)&#125;)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Return &lt;code&gt;true&lt;/code&gt; if the class includes the abstract modifier, &lt;code&gt;false&lt;/code&gt; otherwise.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if class has the abstract modifier, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAbstract</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *  Equivalent of  &#123;<span class="doctag">@link</span> java.lang.Class#isPrimitive()&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> &lt;code&gt;true&lt;/code&gt; if this class represents a primitive, otherwise &lt;code&gt;false&lt;/code&gt;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isPrimitive</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * (API description of &#123;<span class="doctag">@link</span> java.lang.Class#toString()&#125;)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * Converts the object to a string.</span></span><br><span class="line"><span class="comment">     * The string representation is the string &quot;class&quot; or &quot;interface&quot;, followed by a space, and then by the fully qualified name of the class in the format returned by &lt;code&gt;getName&lt;/code&gt;.</span></span><br><span class="line"><span class="comment">     * If this &lt;code&gt;Class&lt;/code&gt; object represents a primitive type, this method returns the name of the primitive type.</span></span><br><span class="line"><span class="comment">     * If this &lt;code&gt;Class&lt;/code&gt; object represents void this method returns &quot;void&quot;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a string representation of this class object.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function">String <span class="title">toString</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到 JavaClass 提供的方法还是很多的，主要有如下这些，大概可以分成两类:</p><p>一类是 getXXX 这个是通过获得类中不同的组成部分的，比较常用有 getFields ，可以获得类所有的 Field 变量的对象，通过 Field 又可以获得 Field 上的注解以及注释，类型。。。所有关于 field 的信息。又比如 getTags、getMethods 顾名思义是获得 javadoc 的注释及方法列表。</p><p>另一类是 isXXX ，这个是用来判断类的一定特性的，比如 isEnum 判断类是否是枚举，isInterface 判断是否是接口。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这些方法名，其实也是用 QDox 打印出来的</span></span><br><span class="line">getBeanProperties</span><br><span class="line">getBeanProperty</span><br><span class="line">getCodeBlock</span><br><span class="line">getComponentType</span><br><span class="line">getConstructor</span><br><span class="line">getConstructors</span><br><span class="line">getDeclaringClass</span><br><span class="line">getDerivedClasses</span><br><span class="line">getDimensions</span><br><span class="line">getEnumConstantByName</span><br><span class="line">getEnumConstants</span><br><span class="line">getFieldByName</span><br><span class="line">getFields</span><br><span class="line">getImplements</span><br><span class="line">getInitializers</span><br><span class="line">getInterfaces</span><br><span class="line">getJavaClassLibrary</span><br><span class="line">getMethod</span><br><span class="line">getMethodBySignature</span><br><span class="line">getMethods</span><br><span class="line">getMethodsBySignature</span><br><span class="line">getModifiers</span><br><span class="line">getName</span><br><span class="line">getNestedClassByName</span><br><span class="line">getNestedClasses</span><br><span class="line">getPackage</span><br><span class="line">getPackageName</span><br><span class="line">getParentSource</span><br><span class="line">getSimpleName</span><br><span class="line">getSource</span><br><span class="line">getSuperClass</span><br><span class="line">getSuperJavaClass</span><br><span class="line">getTagsByName</span><br><span class="line">isA</span><br><span class="line">isAbstract</span><br><span class="line">isAnnotation</span><br><span class="line">isArray</span><br><span class="line">isEnum</span><br><span class="line">isFinal</span><br><span class="line">isInner</span><br><span class="line">isInterface</span><br><span class="line">isPrimitive</span><br><span class="line">isPrivate</span><br><span class="line">isProtected</span><br><span class="line">isPublic</span><br><span class="line">isStatic</span><br><span class="line">isVoid</span><br></pre></td></tr></table></figure><h3 id="完整-Demo"><a href="#完整-Demo" class="headerlink" title="完整 Demo"></a>完整 Demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) 2016-2020 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.qdox;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.thoughtworks.qdox.JavaProjectBuilder;</span><br><span class="line"><span class="keyword">import</span> com.thoughtworks.qdox.model.JavaClass;</span><br><span class="line"><span class="keyword">import</span> com.thoughtworks.qdox.model.JavaMethod;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> DemoParser.java, v 0.1 2020-03-22 19:03 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoParser</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">// 创建 java 项目 builder 对象</span></span><br><span class="line">        JavaProjectBuilder javaProjectBuilder = <span class="keyword">new</span> JavaProjectBuilder();</span><br><span class="line">        <span class="comment">// 添加 java 源文件</span></span><br><span class="line">        javaProjectBuilder.addSource(<span class="keyword">new</span> File(<span class="string">&quot;/Users/kiwi/study/code/study-example/study-qdox-example/src/main/java/cn/coder4j/study/example/qdox/Demo.java&quot;</span>));</span><br><span class="line">        <span class="comment">// 获得解析后的类</span></span><br><span class="line">        Collection&lt;JavaClass&gt; classes = javaProjectBuilder.getClasses();</span><br><span class="line">        <span class="keyword">for</span> (JavaClass javaClass : classes) &#123;</span><br><span class="line">            <span class="comment">// 打印类相关信息</span></span><br><span class="line">            System.out.println(<span class="string">&quot;类名:&quot;</span> + javaClass.getName());</span><br><span class="line">            System.out.println(<span class="string">&quot;实现了哪些类：&quot;</span> + javaClass.getImplements());</span><br><span class="line">            System.out.println(<span class="string">&quot;继承哪个类：&quot;</span> + javaClass.getSuperJavaClass());</span><br><span class="line">            System.out.println(<span class="string">&quot;注释：&quot;</span> + javaClass.getComment());</span><br><span class="line">            <span class="comment">// 获得方法列表</span></span><br><span class="line">            List&lt;JavaMethod&gt; methods = javaClass.getMethods();</span><br><span class="line">            <span class="keyword">for</span> (JavaMethod method : methods) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;方法名是：&quot;</span> + method.getName());</span><br><span class="line">                System.out.println(<span class="string">&quot;方法的 Tags 有哪些：&quot;</span> + method.getTags().stream().map(it -&gt; it.getName() + <span class="string">&quot;-&gt;&quot;</span>+ it.getValue()).collect(Collectors.joining(<span class="string">&quot;\n&quot;</span>)));</span><br><span class="line">                System.out.println(<span class="string">&quot;方法的参数有哪些：&quot;</span> + method.getParameters());</span><br><span class="line">                System.out.println(<span class="string">&quot;方法的返回值有哪些：&quot;</span> + method.getReturns());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">类名:Demo</span><br><span class="line">实现了哪些类：[java.io.Serializable]</span><br><span class="line">继承哪个类：<span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">Object</span></span></span><br><span class="line"><span class="class">注释：这是一个 <span class="title">demo</span> 类</span></span><br><span class="line"><span class="class">方法名是：<span class="title">hello</span></span></span><br><span class="line"><span class="class">方法的 <span class="title">Tags</span> 有哪些：<span class="title">param</span>-&gt;<span class="title">name</span> 姓名</span></span><br><span class="line"><span class="class"><span class="title">return</span>-&gt;<span class="title">hello</span> </span>&#123;name&#125;</span><br><span class="line">方法的参数有哪些：[String name]</span><br><span class="line">方法的返回值有哪些：java.lang.String</span><br></pre></td></tr></table></figure><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="项目代码"><a href="#项目代码" class="headerlink" title="项目代码"></a>项目代码</h3><p>因为篇幅有限，无法贴完所有代码，如遇到问题可到  <a href="https://github.com/kiwiflydream/study-example/tree/master/study-qdox-example">github</a> 上查看源码。</p><h3 id="关于我"><a href="#关于我" class="headerlink" title="关于我"></a>关于我</h3><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1584883444778-7ccbdded-8a8a-4281-b645-0ac585337440.png#align=left&display=inline&height=500&name=image.png&originHeight=500&originWidth=900&size=292275&status=done&style=none&width=900" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/2a8bb95f/">https://blog.coder4j.cn/posts/2a8bb95f/</a> </p>]]></content>
      
      
      <categories>
          
          <category> qdox </category>
          
      </categories>
      
      
        <tags>
            
            <tag> qdox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【并发那些事】线程有序化神器CompletionService</title>
      <link href="/posts/3df73832/"/>
      <url>/posts/3df73832/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1582037585459-bd2594d2-21f6-4801-af65-dcf70611bfe0.png#align=left&display=inline&height=383&name=image.png&originHeight=383&originWidth=900&size=662400&status=done&style=none&width=900" alt="image.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>话说有一天，产品经理突然找到正在摸鱼的你。</p><p>产品：『我们要加一个聚合搜索功能，当用户在我们网站查询一件商品时，我们分别从 A、B、C 三个网站上查询这个信息，然后再把得到的结果返回给用户』</p><p>你：『哦，就是写个爬虫，从 3 个网站上抓取数据是吧？』</p><p>产品：『呸，爬虫是犯法的，这叫数据分析，怎么样，能实现吧？』</p><p>你：『可以』</p><p>产品：『好的，明天上线』</p><p>你：『。。。』</p><h2 id="Code-1-0"><a href="#Code-1-0" class="headerlink" title="Code 1.0"></a>Code 1.0</h2><p>你很快完成了开发，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) B0A6-B0B0 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> TestCompletionService.java, v 0.A B0B0-0B-A8 A9:0C buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCompletionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查询信息</span></span><br><span class="line">        String queryName = <span class="string">&quot;java&quot;</span>;</span><br><span class="line">        <span class="comment">// 调用查询接口</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        List&lt;String&gt; result = queryInfoCode1(queryName);</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时: &quot;</span> + (System.currentTimeMillis() - startTime));</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询信息 code 1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">queryInfoCode1</span><span class="params">(String queryName)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; resultList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">        String webA = searchWebA(queryName);</span><br><span class="line">        resultList.add(webA);</span><br><span class="line"></span><br><span class="line">        String webB = searchWebB(queryName);</span><br><span class="line">        resultList.add(webB);</span><br><span class="line"></span><br><span class="line">        String webC = searchWebC(queryName);</span><br><span class="line">        resultList.add(webC);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站 A</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebA</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站B</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebB</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站C</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebC</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>你运行了一下代码，结果如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">耗时: <span class="number">8512</span></span><br><span class="line">[webA, webB, webC]</span><br></pre></td></tr></table></figure><p>我去，怎么请求一下要 8 秒多？上线了，产品还不砍死我。</p><p>debug 了一下代码，发现问题出在了请求的网站上：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询网站 A</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebA</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    ThreadUtil.sleep(<span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;webA&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询网站B</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebB</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    ThreadUtil.sleep(<span class="number">3000</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;webB&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 查询网站C</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebC</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">    ThreadUtil.sleep(<span class="number">500</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;webC&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>网站 A、网站 B 因为年久失修，没人维护，接口响应很慢，平均响应时间一个是 5 秒，一个是 3 秒（这里使用 sleep 模拟）。网站 C 性能还可以，平均响应时间 0.5 秒。 而我们程序的执行时间就是 <strong>网站 A 响应时间 + 网站 B 响应时间 + 网站 C 响应时间。</strong></p><h2 id="Code-2-0"><a href="#Code-2-0" class="headerlink" title="Code 2.0"></a>Code 2.0</h2><p>好了，问题知道了，因为请求的网站太慢了，那么如何解决呢？总不能打电话找他们把网站优化一下让我爬吧。书上教导我们要先从自己身上找问题。先看看自己代码哪里可以优化。</p><p>一分析代码发现，我们的代码全是串行化， A 网站请求完，再请求 B 网站，B 网站请求完再请求 C 网站。突然想到提高效率的第一要义，提高代码的并行率。为什么要一个一个串行请求，而不是 A、B、C 三个网站一起请求呢，Java 的多线程很轻松就可以实现，代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) B0A6-B0B0 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> TestCompletionService.java, v 0.A B0B0-0B-A8 A9:0C buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCompletionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 查询信息</span></span><br><span class="line">        String queryName = <span class="string">&quot;java&quot;</span>;</span><br><span class="line">        <span class="comment">// 调用查询接口</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        List&lt;String&gt; result = queryInfoCode2(queryName);</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时: &quot;</span> + (System.currentTimeMillis() - startTime));</span><br><span class="line">        System.out.println(result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询信息 code 1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">queryInfoCode1</span><span class="params">(String queryName)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; resultList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">        String webA = searchWebA(queryName);</span><br><span class="line">        resultList.add(webA);</span><br><span class="line"></span><br><span class="line">        String webB = searchWebB(queryName);</span><br><span class="line">        resultList.add(webB);</span><br><span class="line"></span><br><span class="line">        String webC = searchWebC(queryName);</span><br><span class="line">        resultList.add(webC);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询信息 code 2</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">queryInfoCode2</span><span class="params">(String queryName)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        List&lt;String&gt; resultList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建3个线程的线程池</span></span><br><span class="line">        ExecutorService pool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建任务的 feature</span></span><br><span class="line">            Future&lt;String&gt; webAFuture = pool.submit(() -&gt; searchWebA(queryName));</span><br><span class="line">            Future&lt;String&gt; webBFuture = pool.submit(() -&gt; searchWebB(queryName));</span><br><span class="line">            Future&lt;String&gt; webCFuture = pool.submit(() -&gt; searchWebC(queryName));</span><br><span class="line">            <span class="comment">// 得到任务结果</span></span><br><span class="line">            resultList.add(webAFuture.get());</span><br><span class="line">            resultList.add(webBFuture.get());</span><br><span class="line">            resultList.add(webCFuture.get());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭线程池</span></span><br><span class="line">            pool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站 A</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebA</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站B</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebB</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站C</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebC</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的重点代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 聚合查询信息 code 2</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">queryInfoCode2</span><span class="params">(String queryName)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    List&lt;String&gt; resultList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建3个线程的线程池</span></span><br><span class="line">    ExecutorService pool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 创建任务的 feature</span></span><br><span class="line">        Future&lt;String&gt; webAFuture = pool.submit(() -&gt; searchWebA(queryName));</span><br><span class="line">        Future&lt;String&gt; webBFuture = pool.submit(() -&gt; searchWebB(queryName));</span><br><span class="line">        Future&lt;String&gt; webCFuture = pool.submit(() -&gt; searchWebC(queryName));</span><br><span class="line">        <span class="comment">// 得到任务结果</span></span><br><span class="line">        resultList.add(webAFuture.get());</span><br><span class="line">        resultList.add(webBFuture.get());</span><br><span class="line">        resultList.add(webCFuture.get());</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 关闭线程池</span></span><br><span class="line">        pool.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resultList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请求网站的代码其实一行没变，变的是我们调用请求方法的地方，把之前串行的代码，变成了多线程的形式，而且还不是普通的多线程的形式，因为我们要在主线程获得线程的结果，所以还要使用 Future 的形式。（这里可以参考之前的文章<a href="https://mp.weixin.qq.com/s?__biz=MzIzODE1NzA1MA==%E2%88%A3=2650157695&idx=1&sn=780603b41fb81746c173c0993b3d25b7&chksm=f13f3feac648b6fc112d222954e63546a0ed48d8ce0daa614768cbe7e126bd056a5c51b9bf0f&scene=0&xtrack=1#rd">【并发那些事】创建线程的三种方式</a>）。</p><p>好的运行一下代码，看看效果，结果如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">耗时: <span class="number">5058</span></span><br><span class="line">[webA, webB, webC]</span><br></pre></td></tr></table></figure><p>嗯，效果明显，从 8 秒多下降到了 5 秒多，但是还是很长，没法接受的长。做为一个有追求的程序员，还要去优化。我们分析一下，刚开始代码是串行的，流程如下，总请求时间是三次请求的总时长。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1582032480701-8034db7e-8864-4610-bd6d-f928495f7d1d.png#align=left&display=inline&height=738&name=image.png&originHeight=738&originWidth=1898&size=53851&status=done&style=none&width=1898" alt="image.png"><br>然后我们优化了一下，把串行请求给并行化，流程如下：<br><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1582032638666-1948978c-9778-4534-a9e0-848a2eafdf70.png#align=left&display=inline&height=1268&name=image.png&originHeight=1268&originWidth=788&size=50053&status=done&style=none&width=788" alt="image.png"><br>因为是并行化，类似木桶效应，决定最长时间的因素，是你请求中最耗时的的那个操作，这里是时间为 5 秒的请求 A 网站操作。</p><h2 id="Code-3-0"><a href="#Code-3-0" class="headerlink" title="Code 3.0"></a>Code 3.0</h2><p>其实分析到这里，在不能优化 AB 网站的请求时间的前提下，已经很难优化了。但是方法总比困难多，我们的确没办法再去压缩总请求时间，但是可以让用户体验更好一点，这里需要引入两个技术一个是 Websocket，一个是 <strong>CompletionService。</strong>其中 websocket 可以简单的理解成服务端推送技术，就是不需要客户端主动请求，而是通过服务端主动推送消息（ws 在本文中不是重点，会一笔带过，具体实现可以参考前文<a href="https://mp.weixin.qq.com/s?__biz=MzIzODE1NzA1MA==%E2%88%A3=2650157699&idx=1&sn=879d72a187e65d2ccd297ab44ca50d2c&chksm=f13f3f16c648b6006483c92a5811402726761eb7ea139488623d91029759f7c651f9dd6e3de7&scene=0&xtrack=1#rd">【websocket】spring boot 集成 websocket 的四种方式</a>），下面我们直接上代码</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) B0A6-B0B0 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.thread.ThreadUtil;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorCompletionService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> TestCompletionService.java, v 0.A B0B0-0B-A8 A9:0C buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCompletionService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 查询信息</span></span><br><span class="line">        String queryName = <span class="string">&quot;java&quot;</span>;</span><br><span class="line">        <span class="comment">// 调用查询接口</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        queryInfoCode3(queryName);</span><br><span class="line">        System.out.println(<span class="string">&quot;耗时: &quot;</span> + (System.currentTimeMillis() - startTime));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询信息 code 1</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">queryInfoCode1</span><span class="params">(String queryName)</span> </span>&#123;</span><br><span class="line">        List&lt;String&gt; resultList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">        String webA = searchWebA(queryName);</span><br><span class="line">        resultList.add(webA);</span><br><span class="line"></span><br><span class="line">        String webB = searchWebB(queryName);</span><br><span class="line">        resultList.add(webB);</span><br><span class="line"></span><br><span class="line">        String webC = searchWebC(queryName);</span><br><span class="line">        resultList.add(webC);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询信息 code 2</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">queryInfoCode2</span><span class="params">(String queryName)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        List&lt;String&gt; resultList = Lists.newArrayList();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建3个线程的线程池</span></span><br><span class="line">        ExecutorService pool = Executors.newFixedThreadPool(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 创建任务的 feature</span></span><br><span class="line">            Future&lt;String&gt; webAFuture = pool.submit(() -&gt; searchWebA(queryName));</span><br><span class="line">            Future&lt;String&gt; webBFuture = pool.submit(() -&gt; searchWebB(queryName));</span><br><span class="line">            Future&lt;String&gt; webCFuture = pool.submit(() -&gt; searchWebC(queryName));</span><br><span class="line">            <span class="comment">// 得到任务结果</span></span><br><span class="line">            resultList.add(webAFuture.get());</span><br><span class="line">            resultList.add(webBFuture.get());</span><br><span class="line">            resultList.add(webCFuture.get());</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// 关闭线程池</span></span><br><span class="line">            pool.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> resultList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 聚合查询信息 code 3</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">queryInfoCode3</span><span class="params">(String queryName)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">// 开始时间</span></span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 创建 CompletionService</span></span><br><span class="line">        ExecutorCompletionService executorCompletionService = <span class="keyword">new</span> ExecutorCompletionService(Executors.newFixedThreadPool(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建任务的 feature</span></span><br><span class="line">        executorCompletionService.submit(() -&gt; searchWebA(queryName));</span><br><span class="line">        executorCompletionService.submit(() -&gt; searchWebB(queryName));</span><br><span class="line">        executorCompletionService.submit(() -&gt; searchWebC(queryName));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            Future take = executorCompletionService.take();</span><br><span class="line">            System.out.println(<span class="string">&quot;获得请求结果 -&gt; &quot;</span> + take.get());</span><br><span class="line">            System.out.println(<span class="string">&quot;通过 ws 推送给客户端,总共耗时&quot;</span> + (System.currentTimeMillis() - startTime));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站 A</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebA</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">5000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webA&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站B</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebB</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">3000</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webB&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 查询网站C</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">searchWebC</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        ThreadUtil.sleep(<span class="number">500</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;webC&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>核心代码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 聚合查询信息 code 3</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> queryName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">queryInfoCode3</span><span class="params">(String queryName)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">// 开始时间</span></span><br><span class="line">    <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">    <span class="comment">// 创建 CompletionService</span></span><br><span class="line">    ExecutorCompletionService executorCompletionService = <span class="keyword">new</span> ExecutorCompletionService(Executors.newFixedThreadPool(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建任务的 feature</span></span><br><span class="line">    executorCompletionService.submit(() -&gt; searchWebA(queryName));</span><br><span class="line">    executorCompletionService.submit(() -&gt; searchWebB(queryName));</span><br><span class="line">    executorCompletionService.submit(() -&gt; searchWebC(queryName));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">        Future take = executorCompletionService.take();</span><br><span class="line">        System.out.println(<span class="string">&quot;获得请求结果 -&gt; &quot;</span> + take.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;通过 ws 推送给客户端,总共耗时&quot;</span> + (System.currentTimeMillis() - startTime));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>先看执行结果：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">获得请求结果 -&gt; webC</span><br><span class="line">通过 ws 推送给客户端,总共耗时<span class="number">561</span></span><br><span class="line">获得请求结果 -&gt; webB</span><br><span class="line">通过 ws 推送给客户端,总共耗时<span class="number">3055</span></span><br><span class="line">获得请求结果 -&gt; webA</span><br><span class="line">通过 ws 推送给客户端,总共耗时<span class="number">5060</span></span><br><span class="line">耗时: <span class="number">5060</span></span><br></pre></td></tr></table></figure><p>我们来分析一下执行结果，首先总耗时时间还是 5 秒多没变，但是我们不是等全部执行完再推送给客户端，而是执行完一个就推送一个，并且发现了一个规律，最先推送的是请求最快的，然后是第二快的，最后推最慢的那一个。也就是说推送结果是有序的。给用户的体验就是点击按钮后，1 秒内会展示网站 C 的数据，然后过了 2 秒又在原有基础上又添加导示了网站 B 数据，又过了 2 秒，又增加展示了网站 A 数据。 这种体验要比用户一直白屏 5 秒，然后一下返回所有数据要好的多。</p><p>是不是很神奇，这背后的功臣就是 CompletionService，他的源码如下：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> java.util.concurrent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * A service that decouples the production of new asynchronous tasks</span></span><br><span class="line"><span class="comment"> * from the consumption of the results of completed tasks.  Producers</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> submit&#125; tasks for execution. Consumers &#123;<span class="doctag">@code</span> take&#125;</span></span><br><span class="line"><span class="comment"> * completed tasks and process their results in the order they</span></span><br><span class="line"><span class="comment"> * complete.  A &#123;<span class="doctag">@code</span> CompletionService&#125; can for example be used to</span></span><br><span class="line"><span class="comment"> * manage asynchronous I/O, in which tasks that perform reads are</span></span><br><span class="line"><span class="comment"> * submitted in one part of a program or system, and then acted upon</span></span><br><span class="line"><span class="comment"> * in a different part of the program when the reads complete,</span></span><br><span class="line"><span class="comment"> * possibly in a different order than they were requested.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Typically, a &#123;<span class="doctag">@code</span> CompletionService&#125; relies on a separate</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> Executor&#125; to actually execute the tasks, in which case the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> CompletionService&#125; only manages an internal completion</span></span><br><span class="line"><span class="comment"> * queue. The &#123;<span class="doctag">@link</span> ExecutorCompletionService&#125; class provides an</span></span><br><span class="line"><span class="comment"> * implementation of this approach.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Memory consistency effects: Actions in a thread prior to</span></span><br><span class="line"><span class="comment"> * submitting a task to a &#123;<span class="doctag">@code</span> CompletionService&#125;</span></span><br><span class="line"><span class="comment"> * &lt;a href=&quot;package-summary.html#MemoryVisibility&quot;&gt;&lt;i&gt;happen-before&lt;/i&gt;&lt;/a&gt;</span></span><br><span class="line"><span class="comment"> * actions taken by that task, which in turn &lt;i&gt;happen-before&lt;/i&gt;</span></span><br><span class="line"><span class="comment"> * actions following a successful return from the corresponding &#123;<span class="doctag">@code</span> take()&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CompletionService</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Submits a value-returning task for execution and returns a Future</span></span><br><span class="line"><span class="comment">     * representing the pending results of the task.  Upon completion,</span></span><br><span class="line"><span class="comment">     * this task may be taken or polled.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task the task to submit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a Future representing pending completion of the task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RejectedExecutionException if the task cannot be</span></span><br><span class="line"><span class="comment">     *         scheduled for execution</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the task is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Future&lt;V&gt; <span class="title">submit</span><span class="params">(Callable&lt;V&gt; task)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Submits a Runnable task for execution and returns a Future</span></span><br><span class="line"><span class="comment">     * representing that task.  Upon completion, this task may be</span></span><br><span class="line"><span class="comment">     * taken or polled.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task the task to submit</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> result the result to return upon successful completion</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a Future representing pending completion of the task,</span></span><br><span class="line"><span class="comment">     *         and whose &#123;<span class="doctag">@code</span> get()&#125; method will return the given</span></span><br><span class="line"><span class="comment">     *         result value upon completion</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> RejectedExecutionException if the task cannot be</span></span><br><span class="line"><span class="comment">     *         scheduled for execution</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> NullPointerException if the task is null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Future&lt;V&gt; <span class="title">submit</span><span class="params">(Runnable task, V result)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieves and removes the Future representing the next</span></span><br><span class="line"><span class="comment">     * completed task, waiting if none are yet present.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the Future representing the next completed task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException if interrupted while waiting</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Future&lt;V&gt; <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieves and removes the Future representing the next</span></span><br><span class="line"><span class="comment">     * completed task, or &#123;<span class="doctag">@code</span> null&#125; if none are present.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the Future representing the next completed task, or</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> null&#125; if none are present</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Future&lt;V&gt; <span class="title">poll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Retrieves and removes the Future representing the next</span></span><br><span class="line"><span class="comment">     * completed task, waiting if necessary up to the specified wait</span></span><br><span class="line"><span class="comment">     * time if none are yet present.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> timeout how long to wait before giving up, in units of</span></span><br><span class="line"><span class="comment">     *        &#123;<span class="doctag">@code</span> unit&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit a &#123;<span class="doctag">@code</span> TimeUnit&#125; determining how to interpret the</span></span><br><span class="line"><span class="comment">     *        &#123;<span class="doctag">@code</span> timeout&#125; parameter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the Future representing the next completed task or</span></span><br><span class="line"><span class="comment">     *         &#123;<span class="doctag">@code</span> null&#125; if the specified waiting time elapses</span></span><br><span class="line"><span class="comment">     *         before one is present</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> InterruptedException if interrupted while waiting</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Future&lt;V&gt; <span class="title">poll</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以看到  CompletionService 方法，分别如下：</p><ol><li><p>Future<V> submit(Callable<V> task);</p><blockquote><p>submit 用于提交一个 Callable 对象，用于提交一个可以获得结果的线程任务</p></blockquote></li><li><p>Future<V> submit(Runnable task, V result);</p><blockquote><p>submit 用于提交一个 Runnable 对象及 result 对象，类似于上面的 submit，但是 runnable 的返回值 void 无法获得线程的结果，所以添加了 result 用于做为参数的桥梁</p></blockquote></li><li><p>Future<V> take() throws InterruptedException;</p><blockquote><p>take 用于取出最新的线程执行结果，注意这里是阻塞的</p></blockquote></li><li><p>Future<V> poll();</p><blockquote><p>take 用于取出最新的线程执行结果，是非阻塞的，如果没有结果就返回 null</p></blockquote></li><li><p>Future<V> poll(long timeout, TimeUnit unit) throws InterruptedException;</p><blockquote><p>同上，只是加了一个超时时间</p></blockquote></li></ol><p>另外，CompletionService 是接口，无法直接使用，通常使用他的实现类  ExecutorCompletionService，具体使用方法如上面的 demo。</p><p>可能看到这里会很好奇  ExecutorCompletionService 实现原理，其实原理很简单，他在内部维护了一个阻塞队列，提交的任务，先执行完的先进入队列，所以你通过 poll 或 take 获得的肯定是最先执行完的任务结果。</p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="1-项目代码"><a href="#1-项目代码" class="headerlink" title="1. 项目代码"></a>1. 项目代码</h3><p>因为篇幅有限，无法贴完所有代码，如遇到问题可到<a href="https://github.com/kiwiflydream/study-example/tree/master/study-thread-example">github</a>上查看源码。</p><h2 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h2><p>欢迎关注我的个人公众号 <strong>KIWI 的碎碎念</strong> ，关注后回复 <strong>福利</strong>，海量学习内容免费分享！</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1578492545265-0511dd63-d473-4260-acd9-2e9bad7dec18.png#align=left&display=inline&height=137&name=image.png&originHeight=130&originWidth=453&size=34316&status=done&style=none&width=476#align=left&display=inline&height=130&originHeight=130&originWidth=453&status=done&style=none&width=453" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/3df73832/">https://blog.coder4j.cn/posts/3df73832/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 并发那些事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 并发那些事 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【Jasypt】给你的配置加把锁</title>
      <link href="/posts/d0687c8b/"/>
      <url>/posts/d0687c8b/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1577972231962-a66da8bd-c22b-4924-bee6-ae77fd583bf9.png#align=left&display=inline&height=1584&name=image.png&originHeight=3168&originWidth=4752&size=2493712&status=done&style=none&width=2376" alt="image.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前几天，有个前同事向我吐槽，他们公司有个大神把公司的项目代码全部上传到了 github，并且是公开项目，所有人都可以浏览。更加恐怖的是项目里面包含配置文件，数据库信息、redis 配置、各种公钥私钥密码全在项目里面，也一同上传了。</p><p>如果只是单纯的业务代码泄露，情况倒还好，因为别人知道你代码，要想搞你，他必须要把源码看一遍，分析漏洞。 又因为代码上线，经过了层层测试，漏洞也不好找，至少短时间内不好找。但是别人拿到你的数据库信息，那就开启了上帝模式，想怎么玩就怎么玩，删库都不用跑路的。</p><p>不过，还好他们发现的及时，第一时间删除了 github 上的项目，但是不能保证当时的项目没有人拉到本地，所以第二就是把配置文件内的各项配置都更改一遍，改配置听起来简单，但是要知道有些配置是不能热更新的。很多配置要把前一个配置修改后才能使用，新老配置不能共存，你改的瞬间运行的项目就崩了，必须要停机维护才可以。为了变更配置他们花了大量的人力物力与精力。</p><p>其实这种惨痛的教训本可以避免的，防止配置泄露，通用的有两种形式。一种是使用配置中心，本地不保存配置，启动的时候从配置中心获取，这应该是最优解了。但是很多时候你所做的项目并没有使用配置中心，配置就在项目里面裸奔。这个时候就需要本地加密的形式防止配置泄露了，常用框架是  jasypt。同时它也是本文的主题，话不多说，直接开始，看看如果使用  jasypt 进行配置加密。</p><h2 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h2><h3 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.ulisesbocchio<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jasypt-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>如果你使用了 spring boot 那么使用  jasypt 很简单，只要依赖一个  jasypt-spring-boot-starter 包就可以了。</p><p>至于  jasypt-maven-plugin 是方便我们加密解密配置的 maven 插件，后面会说用法。</p><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="application-properties"><a href="#application-properties" class="headerlink" title="application.properties"></a>application.properties</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">my.conf.test1=123</span><br><span class="line">my.conf.test2=DEC(123)</span><br><span class="line"><span class="comment"># 记得看最佳实践</span></span><br><span class="line">jasypt.encryptor.password=lE1rl5K$</span><br></pre></td></tr></table></figure><h3 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h3><p>总共有三个配置，第一个配置  <strong>my.conf.test1</strong> 是不需要加密的配置，第二个配置 <strong>my.conf.test2</strong> 是需要加密的配置，要加密的内容是 <strong>123</strong>。注意他的格式的是 <strong>DEC(待加密内容)**。第三个 **jasypt.encryptor.password</strong>  配置是我们的加密私钥，默认使用的加密算法是  <strong>PBEWITHHMACSHA512ANDAES_256</strong> ，这个密钥可以是任意字符串，而    <strong>lE1rl5K$</strong> 只是我随机生成的，你可以自由发挥。</p><h2 id="生成加密内容"><a href="#生成加密内容" class="headerlink" title="生成加密内容"></a>生成加密内容</h2><p>好了，到目前为止，我们的配置还是明文的。<strong>my.conf.test2</strong> 是我们想加密的配置，他与  <strong>my.conf.test1</strong> 唯一的区别就是多了一个 <strong>DEC()</strong> 包裹，这算哪门子加密，其实我们还差一步。还记得我们上面加依赖的时候，配置了一个 Maven 插件吗？现在就是用到他的时候，在我们的项目目录路径下执行如下命令：</p><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn jasypt:encrypt -Djasypt.encryptor.password=<span class="string">&quot;lE1rl5K$&quot;</span></span><br></pre></td></tr></table></figure><p>注意在执行的时候，password 要换成你自己在上文配置的密钥。执行完后，看到终端输出了一大堆日志，然后就没有然后了。但是真的是这样吗？</p><p>你再打开  <strong>application.properties</strong> 看一下，有什么不一样的地方。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my.conf.test1=123</span><br><span class="line">my.conf.test2=ENC(0ZWzuD2DH0BZ8ANGMZxQyC6wv84sQLJtE6u7bcRjU+DntbMgkBvE2Z4fSzKKhYN8)</span><br><span class="line">jasypt.encryptor.password=lE1rl5K$</span><br></pre></td></tr></table></figure><p>我们发现，三个配置中其它两个是原来的样子，但是  <strong>my.conf.test2</strong> 变了，首先格式从之前 <strong>DEC(xxx)</strong> 变成了 <strong>ENC(xxx)</strong> 。另外括号的 <strong>123</strong> 变成了  <strong>0ZWzuD2DH0BZ8ANGMZxQyC6wv84sQLJtE6u7bcRjU+DntbMgkBvE2Z4fSzKKhYN8</strong> 。</p><p>这其实就是配置加密后的样子。这条命令的功能其实很简单:</p><ol><li>从配置文件中加载配置</li><li>从配置中找到有 <strong>DEC(xxx)</strong> 格式并且不是 <strong>jasypt</strong> 开头的配置</li><li>使用配置的密钥加密并覆盖配置为 <strong>ENC(加密后的值)</strong></li></ol><p>另外通过插件也可以解密，使用</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn jasypt:decrypt -Djasypt.encryptor.password=<span class="string">&quot;lE1rl5K$&quot;</span></span><br></pre></td></tr></table></figure><p>执行这条命令会反过来，把 <strong>ENC(xxx)</strong> 内容的配置解密成 <strong>DEC(明文)</strong> 打印在控制台，注意是控制台，而不是把配置文件变回去，作者说这样是为了安全。</p><h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><h3 id="TestController-java"><a href="#TestController-java" class="headerlink" title="TestController.java"></a>TestController.java</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.jasypt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> TestController.java, v 0.1 2019-12-26 10:55 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my.conf.test1&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confTest1;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;my.conf.test2&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String confTest2;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/getConf/&#123;type&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getConfTest</span><span class="params">(<span class="meta">@PathVariable</span> Integer type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> confTest1;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> confTest2;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h3><p>代码其实很简单，首先通过  <a href="#">@Value</a>  的方式读取配置，同时把没有加密的配置与加密的配置都读出来，然后通过接口，当路径参数为 1 的时候返回没有经过加密的参数，当路径参数为 2 的时候返回加密过的参数。要是都返回 123 说明我们成功了。</p><p>为了方便验证，直接用 IDEA 的内置工具，下面是验证结果：</p><h4 id="未加密的参数"><a href="#未加密的参数" class="headerlink" title="未加密的参数"></a>未加密的参数</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1578230853814-3c4fa873-3041-4c12-8548-83e7ab0780e3.png#align=left&display=inline&height=143&name=image.png&originHeight=286&originWidth=2082&size=51195&status=done&style=none&width=1041" alt="image.png"></p><h4 id="经过加密的参数"><a href="#经过加密的参数" class="headerlink" title="经过加密的参数"></a>经过加密的参数</h4><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1578230873283-6946fb5e-49bb-4059-ba48-84842ab57f18.png#align=left&display=inline&height=123&name=image.png&originHeight=246&originWidth=1616&size=37724&status=done&style=none&width=808" alt="image.png"></p><p>结果如我们所料，加密成功。</p><p>获取配置的大致流程其中跟上面加密配置的流程大致反过来：</p><ol><li>拦截获取配置的操作</li><li>如果拦截到的配置是 <strong>ENC(xxx)</strong> 格式</li><li>读取  <strong>jasypt.encryptor.password</strong> 密钥</li><li>通过密钥解密配置</li></ol><h2 id="最佳实践"><a href="#最佳实践" class="headerlink" title="最佳实践"></a>最佳实践</h2><h3 id="密钥与配置分开保存"><a href="#密钥与配置分开保存" class="headerlink" title="密钥与配置分开保存"></a>密钥与配置分开保存</h3><p>可以看到，通过  jasypt 十分的方便，第一依赖，第二配置，其中配置除加密内容外还有一个  <strong>jasypt.encryptor.password</strong> 。这个前文也说了是用于加密与解密的密码，通过它可以加解密配置。</p><p><img src="https://cdn.nlark.com/yuque/0/2020/png/119443/1578231764351-ed960bdc-af01-4417-85e1-d0d130d69e34.png#align=left&display=inline&height=191&name=image.png&originHeight=381&originWidth=300&size=71153&status=done&style=none&width=150" alt="image.png"></p><p>回到开头，我们加密的目的是为了防止代码泄露的时候把配置一起给泄露出去了。配置是没有问题了，我们加密了，但是我们同时把密钥也放在配置文件中了。这相当于什么呢？<strong>就像你把门给锁了，但是钥匙还插在锁上。</strong></p><p>所以密钥一定要跟配置分开保存，通常是通过启动命令传给应用，比如下面这种：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -Djasypt.encryptor.password=<span class="string">&quot;password&quot;</span> -jar my-application.jar</span><br></pre></td></tr></table></figure><p>如果再保险一点，可以把密钥放在环境变量中，再通过命令传给应用。</p><h3 id="非对称加密"><a href="#非对称加密" class="headerlink" title="非对称加密"></a>非对称加密</h3><p>默认使用的加密算法为对称加密  HHMAC ，既然有对称那肯定也有非对称。</p><p>这里的对称与非对称指的是密钥的保存方式，对称加密是指的是加密与解密共用一个密钥，也就是说我用这个密钥即可以用来加密也可以用来解密。上一条说为了安全我们要把配置跟密钥分开保存，一般保存在两个地方，一个是线上服务器，一个是项目负责人的电脑上了，因为他要把配置从明文变成密文。为什么是项目负责人的电脑上，因为密钥不可能人手一份，那样又会增大泄露风险。</p><p>但是这样的话又会出来一种问题，一个项目涉及了太多配置，我加一个配置找下项目负责人帮我生成个密文，加一个生成一个，项目负责人变成工具人了。</p><p>这个时候我们可以通过非对称加密的方式来解决，这种方式的好处就是有一对密码，分别称为公钥与私钥，公钥用来生成加密数据，可以放心大胆人手一份，而私钥放在服务器上进行运行时候的解密工作，因篇幅有限，具体使用方式可以通过文末的链接查看官方文档。</p><h3 id="环境隔离"><a href="#环境隔离" class="headerlink" title="环境隔离"></a>环境隔离</h3><p>配置肯定是区分环境的，有些环境安全等级没有那么高，比如开发与测试环境，没有必要加密。而预发及生产环境就需要加密，并且推荐使用不同的密钥，这样最大程度的避免安全问题。</p><h2 id="其实相关"><a href="#其实相关" class="headerlink" title="其实相关"></a>其实相关</h2><ol><li><a href="https://github.com/ulisesbocchio/jasypt-spring-boot">jasypt-spring-boot</a> (jasypt 的 github 地址，有着详尽的文档)</li><li><a href="https://github.com/kiwiflydream/study-example/tree/master/study-jasypt-example">本文 DEMO</a> （因为文章篇幅有限，只展示部分代码，具体代码已上传 github）</li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/d0687c8b/">https://blog.coder4j.cn/posts/d0687c8b/</a> </p>]]></content>
      
      
      <categories>
          
          <category> Jasypt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Jasypt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【xmind】 使用 Java 生成思维导图</title>
      <link href="/posts/a9d13c35/"/>
      <url>/posts/a9d13c35/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1575186922937-956f55b0-1608-49c9-8ea9-0b09666ce294.png#align=left&display=inline&height=397&name=image.png&originHeight=793&originWidth=1280&size=285620&status=done&style=none&width=640" alt="image.png"></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>在日常的工作与学习中，我们经常会使用思维导图这个工具，来把抽象而又无形的思考转换成有形并且具体的图像，是理清思路，梳理逻辑的一大神器。</p><p>准确的说，思维导图并不是一个具体的工具，而是一种方法。是道而不是术。实际落地时，我们通常还需要借助外部的工具。从最原始的纸和笔，到各种软件，可以说是应用尽有。目前我在使用的是 xmind 这款软件，下面就会以 xmind 为媒介间接的通过 Java 代码画思维导图。</p><h2 id="放码过来"><a href="#放码过来" class="headerlink" title="放码过来"></a>放码过来</h2><h3 id="通过目录生成思维导图"><a href="#通过目录生成思维导图" class="headerlink" title="通过目录生成思维导图"></a>通过目录生成思维导图</h3><p>我在看书的时候有一个习惯，先通过思维导图画出一本书的大纲，然后通过这个大纲来分主次的去阅读。可能有些同学感到疑惑，还没读过书，如何了解大纲呢？其实一本书的目录就是这本书最好的大纲。</p><p>本文通过把一个目录生成思维导图的例子来学习 xmind 基本的 api 使用。当然如果想系统学习的同学，可以参考文末给出的官方 api 链接。下图就是我们最终要生成的结果。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1575300845565-aeda8243-cba9-4f3e-b218-d526af74c949.png#align=left&display=inline&height=817&name=image.png&originHeight=1633&originWidth=2776&size=765424&status=done&style=none&width=1388" alt="image.png"></p><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>xmind 最开始是在 eclipse 上进行定制开发而来（对，这个 eclipse 就是你在遇到 idea 后，喜新厌旧抛弃的那个编程软件），所以天生就对 Java 有良好的支持。这个<a href="https://github.com/xmindltd/xmind">地址</a>就是 xmind 在 github 上的仓库。对 xmind 的操作的 api 全在  org.xmind.core 包下，按官方提示把代码拉下来在本地打个包，再引入就 ok 了。但是呢？偷懒是第一生产力。立马跑到 maven 仓库搜索了一下，发现果然有人把官方的打包上传了，直接拿来使用。（时间有点老，但是基本操作已经够了，如果想用新功能，可以拉代码自行打包）</p><ul><li>pom.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.eljah<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>xmindjbehaveplugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h3><p>我们要生成思维导图，首先得有数据。这里的数据就是一本书的目录。</p><p>首先，书籍我选的是《<a href="https://book.douban.com/subject/26437061/">一本书读懂 24 种互联网思维</a>》，选这本书，并不是因为这本书有多好，而是因为他比较典型，典型就典型在，看过这本书的目录后就没有必要再读这本书了，因为目录已经把要说的内容说的很清楚了。</p><p>那知道书名，怎么获取书的目录呢？很简单，打开豆瓣，找到这本书的详情，里面就有书籍的目录，直接把它 copy 下来就可以了，目录如下图。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1575302109090-065fc60c-8041-4a80-acc9-e41eb42482d2.png#align=left&display=inline&height=363&name=image.png&originHeight=726&originWidth=1170&size=132601&status=done&style=none&width=585" alt="image.png"></p><h3 id="开始编码"><a href="#开始编码" class="headerlink" title="开始编码"></a>开始编码</h3><ul><li>GeneratorDoubanXmind</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *  * *</span></span><br><span class="line"><span class="comment"> *  *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *  *</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.io.FileUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.ReUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.system.SystemUtil;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> org.xmind.core.Core;</span><br><span class="line"><span class="keyword">import</span> org.xmind.core.CoreException;</span><br><span class="line"><span class="keyword">import</span> org.xmind.core.ISheet;</span><br><span class="line"><span class="keyword">import</span> org.xmind.core.ITopic;</span><br><span class="line"><span class="keyword">import</span> org.xmind.core.IWorkbook;</span><br><span class="line"><span class="keyword">import</span> org.xmind.core.IWorkbookBuilder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> GeneratorDoubanXmind.java, v 0.1 2019-12-02 22:54 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GeneratorDoubanXmind</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 当前类路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String CLASS_PATH = GeneratorDoubanXmind.class.getResource(&quot;/&quot;).getPath();</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 文件分隔符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String FILE_SEPARATOR = SystemUtil.getOsInfo().getFileSeparator();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, CoreException </span>&#123;</span><br><span class="line">        <span class="comment">// 读取目录</span></span><br><span class="line">        String bookName = <span class="string">&quot;一本书读懂24种互联网思维&quot;</span>;</span><br><span class="line">        List&lt;String&gt; contents = FileUtil.readLines(CLASS_PATH + bookName + <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建思维导图的工作空间</span></span><br><span class="line">        IWorkbookBuilder workbookBuilder = Core.getWorkbookBuilder();</span><br><span class="line">        IWorkbook workbook = workbookBuilder.createWorkbook();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得默认sheet</span></span><br><span class="line">        ISheet primarySheet = workbook.getPrimarySheet();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获得根主题</span></span><br><span class="line">        ITopic rootTopic = primarySheet.getRootTopic();</span><br><span class="line">        <span class="comment">// 设置根主题的标题</span></span><br><span class="line">        rootTopic.setTitleText(bookName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 章节 topic 的列表</span></span><br><span class="line">        ArrayList&lt;ITopic&gt; chapterTopics = Lists.newArrayList();</span><br><span class="line">        <span class="keyword">for</span> (String content : contents) &#123;</span><br><span class="line">            <span class="comment">// 如果是数字开头为章节名称</span></span><br><span class="line">            <span class="keyword">if</span> (ReUtil.isMatch(<span class="string">&quot;^[1-24].*?&quot;</span>, content)) &#123;</span><br><span class="line">                <span class="comment">// 创建章节节点</span></span><br><span class="line">                ITopic topic = workbook.createTopic();</span><br><span class="line">                topic.setTitleText(content);</span><br><span class="line">                chapterTopics.add(topic);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 创建小节节点</span></span><br><span class="line">                ITopic topic = workbook.createTopic();</span><br><span class="line">                topic.setTitleText(content);</span><br><span class="line">                chapterTopics.get(chapterTopics.size() - <span class="number">1</span>).add(topic, ITopic.ATTACHED);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 把章节节点添加到要节点上</span></span><br><span class="line">        chapterTopics.forEach(it -&gt; rootTopic.add(it, ITopic.ATTACHED));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存</span></span><br><span class="line">        workbook.save(CLASS_PATH + FILE_SEPARATOR + bookName + <span class="string">&quot;.xmind&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h3><p>基本上代码都做了注释，对于核心代码再简单分析一下。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 读取目录</span></span><br><span class="line">String bookName = <span class="string">&quot;一本书读懂24种互联网思维&quot;</span>;</span><br><span class="line">List&lt;String&gt; contents = FileUtil.readLines(CLASS_PATH + bookName + <span class="string">&quot;.txt&quot;</span>, <span class="string">&quot;utf-8&quot;</span>);</span><br></pre></td></tr></table></figure><p>首先前两行不必说，我把目录数据保存到了 resources 目录下的 一本书读懂 24 种互联网思维.txt，这两行代码就是简单读取数据。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建思维导图的工作空间</span></span><br><span class="line">IWorkbookBuilder workbookBuilder = Core.getWorkbookBuilder();</span><br><span class="line">IWorkbook workbook = workbookBuilder.createWorkbook();</span><br></pre></td></tr></table></figure><p>然后的两行代码，通过 Core 类创建工作空间构建者类，再通过它的  createWorkbook 方法创建出一个空白的工作空间，这个创建完就会得到一个没有任何节点的空白导图。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获得默认sheet</span></span><br><span class="line">ISheet primarySheet = workbook.getPrimarySheet();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获得根主题</span></span><br><span class="line">ITopic rootTopic = primarySheet.getRootTopic();</span><br><span class="line"><span class="comment">// 设置根主题的标题</span></span><br><span class="line">rootTopic.setTitleText(bookName);</span><br></pre></td></tr></table></figure><p>再接着，通过刚刚创建 工作空间 得到主 sheet，这个 sheet 跟 excel 的概念差不多，就像浏览器的一个 tab 一样。效果如下图</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1575302706137-d42e7fb0-fcd1-4566-b88b-a9d788e9b67d.png#align=left&display=inline&height=30&name=image.png&originHeight=60&originWidth=816&size=10859&status=done&style=none&width=408" alt="image.png"></p><p>另外还通过主 sheet 获得了根 topic，并设置他的标题为书名，它对应下图</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1575377884589-67911a43-9e0b-4465-bf73-708155fe00f3.png#align=left&display=inline&height=122&name=image.png&originHeight=244&originWidth=720&size=35758&status=done&style=none&width=360" alt="image.png"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 章节 topic 的列表</span></span><br><span class="line">ArrayList&lt;ITopic&gt; chapterTopics = Lists.newArrayList();</span><br><span class="line"><span class="keyword">for</span> (String content : contents) &#123;</span><br><span class="line">    <span class="comment">// 如果是数字开头为章节名称</span></span><br><span class="line">    <span class="keyword">if</span> (ReUtil.isMatch(<span class="string">&quot;^[1-24].*?&quot;</span>, content)) &#123;</span><br><span class="line">        <span class="comment">// 创建章节节点</span></span><br><span class="line">        ITopic topic = workbook.createTopic();</span><br><span class="line">        topic.setTitleText(content);</span><br><span class="line">        chapterTopics.add(topic);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 创建小节节点</span></span><br><span class="line">        ITopic topic = workbook.createTopic();</span><br><span class="line">        topic.setTitleText(content);</span><br><span class="line">        chapterTopics.get(chapterTopics.size() - <span class="number">1</span>).add(topic, ITopic.ATTACHED);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这段代码比较多，但是重点是创建 topic 的操作，每个 topic 就是思维导图的一个节点，可以通过  workbook.createTopic() 来创建，同样的通过  setTitleText 设置标题。这段代码其实是分析了目录的规律，有 1-24 开头的是大章节，而后面紧跟的是小章节，一个大章节下是多个小章节（可以看上面的目录截图）。所以判断是大章节就创建一个新的节点，判断是小章节就往最后一个大章节上添加（通过 add 方法）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把章节节点添加到要节点上</span></span><br><span class="line">chapterTopics.forEach(it -&gt; rootTopic.add(it, ITopic.ATTACHED));</span><br></pre></td></tr></table></figure><p>刚才说了把小章节都添加到了大章节上了，但是大章节现在还是无依无靠的，所以通过一个循环全部添加到了根 Topic 上。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存</span></span><br><span class="line">workbook.save(CLASS_PATH + FILE_SEPARATOR + bookName + <span class="string">&quot;.xmind&quot;</span>);</span><br></pre></td></tr></table></figure><p>到此我们编码结束了，但是这些操作还在内存中，我们需要通过 workbook 的 save 方法把文件保存到硬盘上，另外文件后缀记得改成 xmind，否则软件无法识别。</p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>因为篇幅有限，无法贴完所有代码，如遇到问题可到相关链接里面的 example 上，查看源码。</p><h3 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h3><ol><li><a href="https://github.com/xmindltd/xmind/wiki/UsingXmindAPI">xmind api 地址</a></li><li><a href="https://github.com/kiwiflydream/study-example/tree/master/study-xmind-example">study-xmind-example</a></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1575379205600-702b996e-3229-40f4-a982-199adfccdf60.png#align=left&display=inline&height=178&name=image.png&originHeight=178&originWidth=621&size=39510&status=done&style=none&width=621" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/a9d13c35/">https://blog.coder4j.cn/posts/a9d13c35/</a> </p>]]></content>
      
      
      <categories>
          
          <category> xmind </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xmind </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【并发那些事】可见性问题的万恶之源</title>
      <link href="/posts/b2d626fd/"/>
      <url>/posts/b2d626fd/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574562962418-a57cff00-17f5-4cf6-b3e4-8f9706a83f4e.png#align=left&display=inline&height=540&name=image.png&originHeight=1080&originWidth=1080&size=1776469&status=done&width=540" alt="image.png"></p><blockquote><p><strong>硬件工程师为均衡 CPU 与 缓存之间的速度差异，特意加的 CPU 缓存，竟然在多核的场景下阴差阳错的成为了并发可见性问题的万恶之源！(**</strong>本文过长，如果不是特别无聊，看到这里就可以了*<strong>*)</strong></p></blockquote><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>还记得那些年，你写的那些多线程 BUG 吗？明明只想得到个 1 + 1 = 2 的预期，结果他有时候得到 1，有时候得到 3，但偏偏有时候他也会返回正确的 2。明明在本地运行的好好的，一上线一堆诡异的 BUG。你一遍一遍的检查代码，一行一行 debug，结果无功而返。</p><p>变量为何突然变异？代码为何乱序运行？条件为何形同虚设？欢迎收看今天的《走进科学》之半夜。。。哦，不对，欢迎阅读今天的《并发那些事》之可见性问题的万恶之源。就像上面说的，我们在写并发程序时，经常会出现超出我们认识与直觉的问题，而按我们的以往的经验，很难去察觉到他的问题所在。而又因为我们不了解他发生的诱因，即使我们按照书上的方案解决了，但是下次还是会出现。所以本文的主旨并不是解决问题的术，而是解决问题的道。一起来探究多线程问题的根源。</p><p>首先揭开谜底，大多数并发问题的发生都是这三个问题导致的，<strong>可见性问题、原子性问题、有序性问题</strong>。那么又是什么导致这三个问题的出现呢？本文将一步步解析可见性问题出现的原因。</p><h3 id="核心矛盾"><a href="#核心矛盾" class="headerlink" title="核心矛盾"></a>核心矛盾</h3><p>众所周知，电脑由很多的部件组成。其中最最最重要的有三个，它们分别是 CPU 、内存、IO（硬盘）。一般来说它们三个的性能高低直接影响到了电脑的整体的性能优劣。</p><p>但是从它们诞生之初，就有一个核心矛盾，即使过了几十年后的现在，科技的飞速发展依旧没能解决。那么是什么矛盾呢？</p><p>在说矛盾之前，先说我个同事，他是个电竞高手，英雄联盟、王者荣耀什么的意识特别历害。每次看比赛的时候那种指点江山、挥斥方遒的英姿闪闪发光。但是呢，一上手打游戏，一顿操作猛如虎，一看战绩 0 杠 5，刚开始我们以为他是个青铜，但是呢，很多时候游戏的真的就像他说的那样，他的预判，他的操作其实都相当的风骚。一直很疑惑，直到我们得出了一个结论，其实他的确是一个王者，因为他满脑子都是骚操作，但是呢？他的双手跟不上他风骚的大脑。</p><p>问题就在这里，<strong>核心矛盾就是速度的差异</strong>。CPU 就像是那位同事的大脑，很强很风骚，但是奈何 IO 就像那双跟不上节奏的手，限制了发挥。而且它们之间的速度差异要远远超出我们的想像，CPU 就好比是火箭，那么内存就是三轮车，IO 可能就是马路旁一只不起眼的小蜗牛。</p><h3 id="各方的努力"><a href="#各方的努力" class="headerlink" title="各方的努力"></a>各方的努力</h3><p>既然有了这个问题，那就要想办法解决，首先这个问题出在硬件层，所以首当其冲的硬件工作师想了很多方式试图去解决。经过内存跟 IO 硬件工程师的不懈努力，这两个组件的速度都得到了大幅提升。但是呢？CPU 的工程师也没闲着，甚至英特尔的 CEO–高登·摩尔还宣布了一个以自己姓名定义的<a href="https://zh.wikipedia.org/zh-hans/%E6%91%A9%E5%B0%94%E5%AE%9A%E5%BE%8B">摩尔定律</a>。其内容大致如下：</p><blockquote><p>集成电路上可容纳的晶体管数目，约每 18 个月便会增加一倍</p></blockquote><p>可以简单的理解，CPU 每 18 个月性能就能翻一倍。这就让内存跟 IO 的硬件工程师很绝望了，不怕别人比你聪明，就怕比你聪明的人还比你努力。这还是怎么玩？</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574585299298-c565ad72-4ea6-49e2-a561-a20e4b44ae39.png#align=left&display=inline&height=140&name=image.png&originHeight=280&originWidth=496&size=191303&status=done&width=248" alt="image.png"></p><p>当然，独木不成林，CPU 工程师也意识到了这个问题，我再怎么独领风骚，以 1V5。没有用呀？打的正嗨，一回头，家被推了。我下了一部电影，双击打开，CPU 飞速运行，IO 在缓慢加载。我 CPU 运行到冒烟也没用呀，IO 制约了。结果就是电影变成了 PPT，一秒一停。这样下去大家都没得玩。眼看其它队友带不动，CPU 工程师想出了一个办法，我在 CPU 里面划一块出来做为缓存，这个缓存介于 CPU 与 内存之间，跟我们常用的缓存功能差不多，为了均衡 CPU 与内存之间的速度差，在执行的时候会把数据先从 IO 加载到 内存，再把内存中的数据加载到 CPU 的缓存之中。将常用或者将用的数据缓存在 CPU 中后，CPU 每次处理时就不用老是等内存了，这极大的提高了 CPU 的利用率。</p><p>到这里，硬件工程师圆满的完成了任务，下面轮到了我们软件工程师登场了。</p><p>虽然说加了缓存之后，CPU 的利用率成倍上升，从当初的运行 5 分钟，加载 2 小时。变成了，运行 2 分钟，加载 1 小时，但是体验还是很差。还拿电影举例，看电影的时候不光有画面，还得有声音呀，你运行是快了，但是先放视频，再放声音。就像是先看一部默片，再听一遍广播，这种音画分离的观感没比 PPT 强多少。</p><p>后来在软硬工程师的天才努力后，发明了一种神奇的东西–线程。说线程之前我们先说一下进程，这个东西可是我们能看到的东西，比始你启动的浏览器，比如你正在使用的微信，这些软件启动后，在操作系统中都是一个进程。而线程呢？它可以简单理解成是一个进程的子集，也就是说进程其实是一堆线程组成。而且操作系统通常会把所有硬件资源，包括内存之内的全分配给进程，进程就像一个包工头一样再分配给底下的线程。但是唯独有一样资源，操作系统是直接分配给线程的，那就是 CPU 资源。</p><p>这样的设置其实是有深意的。可能有人觉得，分给进程也可以呀，但是进程要比线程重的多，切换的开销过大，得不尝试。就像是你想打开一个新的网页，是打开一个新浏览器快呢？还是打开一个新的 Tab 页快呢？总之有了线程之后，我们就有了一个很酷炫的操作–线程切换。他能带来什么呢？接着说电影的事，我们其实还是先播视频再放声音。但是与上面不同的是，我们是先放一会视频，再放一会声音。只要单次播放的够短，两种操作之间的切换够快，就会让人感觉其实视频与声音是同时播的错觉。而轻量的线程以及提供的切换能力给这种操作提供了可能。</p><p>至此，问题在无数硬件与软件工程师的努力下，得到了比较完美的解决。</p><h3 id="新的问题"><a href="#新的问题" class="headerlink" title="新的问题"></a>新的问题</h3><p>事情到了这里，本该皆大欢喜、功德圆满。结果英特尔又出来搞事，但其实他这次也是被逼无奈。</p><p>还记得我们上面说的以英特尔 CEO–高登·摩尔命名的摩尔定律吗？这个定律其实并不是根据严谨的科学研究得出来的，而是通过英特尔的过往表现推导出的这个结论。按理说这是极不符合科学规律的，就像我遇到的每个程序员都背个电脑包，但是我在大街上不能随便看到一个背着电脑包的人就说他是程序员。但是英特尔就是这么 NB，他在的大街上全是程序员。英特尔就这样维护着这个定律每 18 个月把 CPU 的性能翻一倍，持续了每多年。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574604678575-fb41c370-e4ce-4fef-82ed-b36a0acfee5d.png#align=left&display=inline&height=150&name=image.png&originHeight=300&originWidth=400&size=250612&status=done&width=200" alt="image.png"></p><p>直到第四任 CEO 的时候，摩尔定律突然不灵了，上图就是时任英特尔 CEO–克瑞格·贝瑞特。在一次技术大会上，向与会者下跪。为一再延期直至最终失败放弃的  4GHz 主频奔 4 处理器致歉。</p><p>到此，摩尔定律终结，CPU 的发展进入了瓶颈。直到有一天一个脑门闪光的硬件工程师敲响了克瑞格·贝瑞特办公室的大门。”老板你不用跪了，我有个办法可以把 CPU 性能提高一倍”。</p><p>一句话让克瑞格老泪纵横，那一天，回想起了，受那些家伙支配的恐怖……被囚禁在鸟笼中的屈辱……</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574605677580-71cae468-27d2-4acd-af28-e46bf1765dd5.png#align=left&display=inline&height=163&name=image.png&originHeight=326&originWidth=580&size=311704&status=done&width=290" alt="image.png"></p><p>克瑞格激动的问道：”什么方案？”</p><p>硬件工程师：”很简单呀，我们只要把现在两个的 CPU 装到一个大号的 CPU 里面，那么他的性能就是两个 CPU 的性能呀！我可真是一个小机灵鬼呢”</p><p>做了一辈子 CPU 的克瑞格，气的差点进了 ICU。”我老克就算跪一辈子，也不会做这种傻事”。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574606349112-83cb0491-0d01-4d5b-811e-f4c7bf0bb1f5.png#align=left&display=inline&height=205&name=image.png&originHeight=409&originWidth=700&size=606446&status=done&width=350" alt="image.png"></p><p>上图为英特尔发布的 28 核 CPU。嗯？</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574607088161-ecd5069f-55d9-44a3-815f-f53ab5aa67df.png#align=left&display=inline&height=144&name=image.png&originHeight=288&originWidth=373&size=189407&status=done&width=186.5" alt="image.png"></p><p>当然上面其实有些戏谑的成分，但是 CPU 的发展结果也的确是往更多的核心数去发展。从单核到双核再 6 核、8 核不停的增长核心数，CPU 的性能也的确跟着增长。这其实跟我们软件工程师常用的分布式架构一样，当单机的性能达到了瓶颈，不可能再通过纵向的增加服务器的性能提高系统负载，只能通过把单机系统，拆成多个分布式服务来进行横向的扩展。</p><p>通过增加 CPU 的核心数，硬件工程师看似圆满的完成时代交给他的任务。结果一口大锅甩在了咱们软件工程师的头上。</p><p>来，我们回顾一下，上面我们说 CPU、内存、IO 他们有一个核心矛盾，这个矛盾就是速度的差异。而且这个差异仍然没有解决。但是我们变相的解决了。解决方案是什么？硬件工程师在 CPU 的核心里划了一块地方做为缓存，通过这个缓存均衡他们之间的差异。而软件工程师呢，为了最大的提高 CPU 的利用率，搞了一个叫线程的东西，通过多线程之间的切换圆满解决问题。</p><p>嗯，这个方案很完美，没有问题。但是，前提是运行在单核的 CPU 下。</p><p>刚才我们说了 CPU 的核心，会有一块地方缓存从内存里加载的数据，这样就不用每次从内存里加载了，提高了效率。但是呢，单核有一个缓存，多核就会出现多个缓存，再加上我们多线程的运行，会出现什么情况呢？下面我们以真实代码为例子：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestCount</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        TestCount testCount = <span class="keyword">new</span> TestCount();</span><br><span class="line">        Thread threadOne = <span class="keyword">new</span> Thread(() -&gt; testCount.add());</span><br><span class="line">        Thread threadTwo = <span class="keyword">new</span> Thread(() -&gt; testCount.add());</span><br><span class="line">        threadOne.start();</span><br><span class="line">        threadTwo.start();</span><br><span class="line"></span><br><span class="line">        threadOne.join();</span><br><span class="line">        threadTwo.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(testCount.count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>代码很简单，两个线程都调用一个 add 方法，而这个 add 方法的操作是循环 10 w 次，每次都把这两个线程共享的 count 变量加 1 。按照我们的直觉来说，count 开始是 0，每个线程加 10 w，总共两个线程，所以 10 w * 2 = 20 w。</p><p>可是呢？结果并不是我们想的那样，我运行的结果是：113595。而且每次运行的结果都不一样，你可以试试。结果基本上都在 10w ~ 20w 之间，而且无限趋向于 10w。</p><p>这是什么鬼？还记得前面说的 CPU 缓存吗？没错，他就是这只鬼。为了便于说明问题，我画了几张图。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574609355807-ddc7bcbb-6119-49c1-a6fd-688bdcea9fb3.png#align=left&display=inline&height=536&name=image.png&originHeight=1072&originWidth=948&size=44887&status=done&width=474" alt="image.png"><br>上图是在单核的情况下，首先这个 count 会被加载到内存中。这时他是初始值 0。然后如图所示，第 1 步他被加载到了 CPU 的缓存中，CPU 处理器把他从缓存中取出来，然后进行 add 操作，加完之后再放入缓存中，缓存再把 count 写入内存中，最终我们就得到了结果。可见单核情况下，因为共享缓存与内存，没有任何问题，我们接着看多核的情况下。</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1574610745538-8ef09482-0b23-4bf9-8e44-66fcbdd7d968.png#align=left&display=inline&height=531&name=image.png&originHeight=1062&originWidth=1978&size=85959&status=done&width=989" alt="image.png"><br>如上是多核场景下的运算过程，具体步骤如下：</p><ol><li>首先 count 被加载到内存，紧接着线程 1 被 CPU 1 调用，把内存的 count = 0 加载到了缓存中</li><li>然后 CPU 1 把缓存中 count = 0 加载到处理器中，一个时间片处理后  13595</li><li>CPU 把 count = 13595 存入到缓存，准备下次接着算</li><li>缓存 把 count  = 13595 刷新加内存，等下个时间片再加载</li><li>线程 2 得到了 CPU2 时间片，从内存中把刚刚线程 1 算了一半的  count  = 13595 加载到了缓存</li><li>CPU 2 把 count  = 13595 加载到了处理器，开始运算。与些同时 CPU 1 把时间片又分配给了线程 1，线程接着刚才的  count = 13595 运算，很快算完得到 10 w ，并把结果最终刷进了内存，现在内存中的数据为 count = 10w。</li><li>线程 2 也很快运行完了 10w 次，现在他得到的结果  13595 + 10w = 113595。然后同样把结果最终的刷新进了内存，现在内存中的数据为 count = 113595。</li></ol><p>看到问题了吗？可以理解缓存中的 count 是内存中的 count 的一份拷贝。在缓存中修改时并不会变更内存中的值，而是过一段时间后刷新回内存，而线程 1 把计算了一半的值，刷新进内存后，线程 2 把这个新值加载到了 CPU2 中，然后计算。与些同时 CPU 1 完成了计算，并把值刷新进了内存，CPU2 仍在计算，因为他不知道 CPU1 把值改变了，计算完了，把自己计算的值也刷新进了内存中，这样就把刚刚 CPU1 忙乎半天的结果覆盖了。</p><p>出现这个问题的根本原因就是，CPU 1 与 CPU 2 各自的操作对于双方不可见。在这种情况下，运行期间其实总共有 3 个 count 变量，一个是内存中的 count，一个是 CPU1 中的 count 拷贝，最后一个是 CPU2 中的 count 拷贝。</p><h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p><strong>硬件工程师为均衡 CPU 与 缓存之间的速度差异，而特意加的 CPU 缓存，竟然在多核的场景下阴差阳错的成为了并发问题中可见性的根源！</strong></p><h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><p>本文是《并发那些事》的第三篇，前两篇如下：</p><ol><li><a href="https://mp.weixin.qq.com/s?__biz=MzIzODE1NzA1MA==%E2%88%A3=2650157695&idx=1&sn=780603b41fb81746c173c0993b3d25b7&chksm=f13f3feac648b6fc112d222954e63546a0ed48d8ce0daa614768cbe7e126bd056a5c51b9bf0f&scene=0&xtrack=1#rd">【并发那些事】创建线程的三种方式</a></li><li><a href="https://mp.weixin.qq.com/s?__biz=MzIzODE1NzA1MA==%E2%88%A3=2650157708&idx=1&sn=30aa27b6a2463ba38c9f61438863329d&chksm=f13f3f19c648b60f5e03a02c733adf138b36447943ae9c624974e1a842dd7d37251bbe7a69b7&scene=0&xtrack=1#rd">【并发那些事】生产者消费者问题</a></li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/b2d626fd/">https://blog.coder4j.cn/posts/b2d626fd/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 并发那些事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 并发那些事 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【并发那些事】生产者消费者问题</title>
      <link href="/posts/48faaa95/"/>
      <url>/posts/48faaa95/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1573212056903-3511b031-63e5-4a9b-95f0-f9d05a784f14.jpeg#align=left&display=inline&height=1080&originHeight=1080&originWidth=1920&size=0&status=done&width=1920"></p><h2 id="Step-1-什么是生产者消费者问题"><a href="#Step-1-什么是生产者消费者问题" class="headerlink" title="Step 1. 什么是生产者消费者问题"></a>Step 1. 什么是生产者消费者问题</h2><p><strong>生产者消费者问题</strong>也叫<strong>有限缓冲问题</strong>，是多线程同步的一个最最最经典的问题。这个问题描述的场景是对于一个有固定大小的缓冲区，同时共享给两个线程去使用。而这两个线程会分为两个角色，一个负责往这个缓冲区里放入一定的数据，我们叫他<strong>生产者</strong>。另一个负责从缓冲区里取数据，我们叫他<strong>消费者</strong>。<br>这里就会有两个问题，第一个问题是生产者不可能无限制的放数据去缓冲区，因为缓冲区是有大小的，当缓冲区满的时候，生产者就必须停止生产。第二个问题亦然，消费者也不可能无限制的从缓冲区去取数据，取数据的前提是缓冲区里有数据，所以当缓冲区空的时候，消费者就必须停止生产。<br>这两个问题看起来简单，但是在实际编码的时候还是会有许多坑，稍不留意就会铸成大错。而且上面只是单个消费者生产者问题，实现应用中，还会遇到多生产多消费等更复杂的场景。这些问题下面会详细叙述。</p><h2 id="Step-2-为什么会有这个问题"><a href="#Step-2-为什么会有这个问题" class="headerlink" title="Step 2. 为什么会有这个问题"></a>Step 2. 为什么会有这个问题</h2><p>通过上节的内容，我们知道了什么是生产者消费者问题。但是为什么会出现这种问题呢？<br>其实如果说『生产者消费者问题』，可能因为有了『问题』两个字而显得比较负面。我更喜欢称之为『生产者消费者模式』，就像我们学的那些代码设计模式一样。他其实是多线程情况下的一种设计模式，是某些场景下久经考验的最佳实践。<br>那么这种模式有哪些作用呢？<br><strong>他的第一个好处是解耦。</strong><br>举个外卖的例子。在没有美团、饿了么之前，肯定没有现在这么多满大街跑的外卖小哥。你打电话点了一份外卖，通常都是老板自己做菜自己送。你想像一下，老板洗菜、切菜、做菜，做好之后再打包，然后拎着打包盒，骑个自行车，再满小区找地址，最后送到你的手中。这里就会出现几个问题，第一，老板挺不容易的，要会洗菜、切菜、做菜烹饪一条龙，做好之后，还要会骑车，光会骑车还不行，他还要认路，哪哪小区在哪里，哪哪栋在哪里，从哪走比较近，哪个门口保安不让进。这样就把所有的职能都集中在了老板身上，做饭与送饭，其实是两条事，理论上没有什么联系，但是这里如果老板切菜时，一不小心切到了手，那不光菜做不了，后面也没法送。或者送外卖的路上，为赶时间闯红灯被交警拦了下来，不光饭送不了，还回不来做下一份。这就像我们的代码全都耦合在一起的后果，两个业务相互影响，一个业务出现问题另一个也跟着出现问题，一个业务变更就带着另一个业务变更。<br>我们想想，有了外卖小哥之后呢？老板只要关注于做菜就好了，做好给到外卖小哥。外卖小哥会送到用户手上。老板想的是怎么把菜做的更好吃，外卖小哥想的是怎么最快送达。职能清晰了，效率就更高了。这里可以把老板当成生产者，对应的外卖小哥就是消费者。<br><strong>他的第二个好处就是均衡生产者与消费者的能力。</strong><br>还是举外卖的例子。有些外卖是要实时准备的，比如说做菜就是这样，用户下单后，老板立刻洗菜、切菜、做菜然后打包。对于比较耗时的菜品，比如煲粥、炖汤之类的时间可能很长。而外卖小哥耗费的时间只是接到通知后来到这家店的时间。因为现在的外卖系统比较智能，通知的都是距离商户最近的外卖小哥，所以到店的时间一般比较短。这种场景下瓶颈就是商家的产能，高峰期就可能会造成排队。如下图：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573281333771-3b680f5c-8cad-4ac9-a32b-c9d1fff75c72.png#align=left&display=inline&height=375&name=image.png&originHeight=750&originWidth=750&size=1061047&status=done&width=375" alt="image.png"><br>再严重一点就会这样<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573281576665-5038306a-87f6-4601-bd2c-93cba5650ea8.png#align=left&display=inline&height=343&name=image.png&originHeight=686&originWidth=980&size=539819&status=done&width=490" alt="image.png"><br>对于这个问题的原因我们很清楚了，是因为生产者（商家）的产能跟不上消费者（外卖小哥）的消费（送餐）速度。因为我们把职能分开了，所以解决问题也很清晰，那就提高生产者的产能，比如说老板可以多雇几个厨师或者再开一家分店。这样就把生产者的产能提高到与消费者的产能平衡的位置。<br>还有另一种生产者比消费者快的情况，比如说一些小超市，他也有外卖服务。因为他的东西都是现成的，用户下完单后，只要按订单装好就可以了。这个时候反而是从外边过来的外卖小哥要慢的多。再或者是商品准备的时间很短，但是送餐的路途遥远，路况复杂。所以瓶颈到外卖小哥身上。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573282820149-c3875b83-8d5c-4c3d-8e4f-07756e12807b.png#align=left&display=inline&height=676&name=image.png&originHeight=1351&originWidth=640&size=164726&status=done&width=320" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573282524890-cab7a6e2-724c-490e-acc0-d5ecd776a1e1.png#align=left&display=inline&height=186&name=image.png&originHeight=372&originWidth=833&size=524932&status=done&width=416.5" alt="image.png"><br>这种情况下问题也很清晰了，消费者消耗的速度跟不上生产者的产能，那扩充消费者的数量好了。比如经常遇到的外卖转单，一个外卖小哥来不及了，转给了另一个外卖小哥。同样也能达到生产者与消费者的产能均衡。</p><h2 id="Step-3-怎么去实现生产者消费者模式"><a href="#Step-3-怎么去实现生产者消费者模式" class="headerlink" title="Step 3. 怎么去实现生产者消费者模式"></a>Step 3. 怎么去实现生产者消费者模式</h2><p>好了，说完了 what 还有 why，那么我们现在接着说怎么去实现生产者消费者模式，不再废话直接上代码。<br>首先我们写一个老板类：</p><h3 id="3-1-Boss-java-（老板）"><a href="#3-1-Boss-java-（老板）" class="headerlink" title="3.1 Boss.java （老板）"></a>3.1 Boss.java （老板）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * fshows.com</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2013-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 老板</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> Boss.java, v 0.1 2019-11-09 15:09 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Boss</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最大生产数量</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_NUM = <span class="number">5</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 桌子</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;String&gt; tables;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Boss</span><span class="params">(LinkedList&lt;String&gt; tables)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tables = tables;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 注意点1</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>.tables)&#123;</span><br><span class="line">                <span class="comment">// 注意点2</span></span><br><span class="line">                <span class="keyword">while</span> (tables.size() == MAX_NUM)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;通知外卖小哥取餐&quot;</span>);</span><br><span class="line">                    <span class="comment">// 注意点3</span></span><br><span class="line">                    <span class="keyword">this</span>.tables.notifyAll();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;老板开始休息了&quot;</span>);</span><br><span class="line">                        <span class="keyword">this</span>.tables.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                String goods = <span class="string">&quot;牛肉面&quot;</span> + tables.size();</span><br><span class="line">                System.out.println(<span class="string">&quot;老板做了一碗&quot;</span> + goods);</span><br><span class="line">                tables.addLast(goods);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>然后我们再写一个外卖小哥类，但是尴尬的是发现不知道外卖小哥英文怎么写，查了一下结果如下<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573285192485-5e231883-9aca-4558-91d2-e8dd02d2cd8d.png#align=left&display=inline&height=260&name=image.png&originHeight=520&originWidth=1322&size=47352&status=done&width=661" alt="image.png"><br>这个 brother 总感觉怪怪的，但是我读书少，他骗我也不知道，就用这个吧。 要是有英语大神可以留言回复一下正确怎么写。</p><h3 id="3-2-TakeawayBrother-java-（外卖小哥）"><a href="#3-2-TakeawayBrother-java-（外卖小哥）" class="headerlink" title="3.2 TakeawayBrother.java （外卖小哥）"></a>3.2 TakeawayBrother.java （外卖小哥）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * fshows.com</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2013-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 外卖小哥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> TakeawayBrother.java, v 0.1 2019-11-09 15:14 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TakeawayBrother</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> LinkedList&lt;String&gt; tables;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TakeawayBrother</span><span class="params">(LinkedList&lt;String&gt; tables)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tables = tables;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>)&#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (<span class="keyword">this</span>.tables)&#123;</span><br><span class="line">                <span class="keyword">while</span> (<span class="keyword">this</span>.tables == <span class="keyword">null</span> || <span class="keyword">this</span>.tables.size() == <span class="number">0</span>)&#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;催老板赶快做外卖&quot;</span>);</span><br><span class="line">                    <span class="keyword">this</span>.tables.notifyAll();</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        System.out.println(<span class="string">&quot;一边玩手机一边等外卖&quot;</span>);</span><br><span class="line">                        <span class="keyword">this</span>.tables.wait();</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                String goods = tables.removeFirst();</span><br><span class="line">                System.out.println(<span class="string">&quot;外卖小哥取餐了&quot;</span> + goods);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>事件发生总归有一个地方吧，一般老板把外卖给到外卖小哥都是在店铺里，最后我们再加一个店铺场景类吧</p><h3 id="3-3-StoreContext-java-（店铺）"><a href="#3-3-StoreContext-java-（店铺）" class="headerlink" title="3.3 StoreContext.java （店铺）"></a>3.3 StoreContext.java （店铺）</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * fshows.com</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2013-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.thread;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 店铺场景</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> StoreContext.java, v 0.1 2019-11-09 15:28 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StoreContext</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 先创建一张用于存放外卖的桌子</span></span><br><span class="line">        LinkedList&lt;String&gt; tables = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">        <span class="comment">// 再创建一个老板</span></span><br><span class="line">        Boss boss = <span class="keyword">new</span> Boss(tables);</span><br><span class="line">        <span class="comment">// 最后创建一个外卖小哥</span></span><br><span class="line">        TakeawayBrother takeawayBrother = <span class="keyword">new</span> TakeawayBrother(tables);</span><br><span class="line">        <span class="comment">// 创建线程对象</span></span><br><span class="line">        Thread bossThread = <span class="keyword">new</span> Thread(boss);</span><br><span class="line">        Thread takeawayBrotherThread = <span class="keyword">new</span> Thread(takeawayBrother);</span><br><span class="line">        <span class="comment">// 运行线程</span></span><br><span class="line">        bossThread.start();</span><br><span class="line">        takeawayBrotherThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-4-运行结果"><a href="#3-4-运行结果" class="headerlink" title="3.4 运行结果"></a>3.4 运行结果</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">老板做了一碗牛肉面<span class="number">0</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">1</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">2</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">3</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">4</span></span><br><span class="line">通知外卖小哥取餐</span><br><span class="line">老板开始休息了</span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">0</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">1</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">2</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">3</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">4</span></span><br><span class="line">催老板赶快做外卖</span><br><span class="line">一边玩手机一边等外卖</span><br><span class="line">老板做了一碗牛肉面<span class="number">0</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">1</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">2</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">3</span></span><br><span class="line">老板做了一碗牛肉面<span class="number">4</span></span><br><span class="line">通知外卖小哥取餐</span><br><span class="line">老板开始休息了</span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">0</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">1</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">2</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">3</span></span><br><span class="line">外卖小哥取餐了牛肉面<span class="number">4</span></span><br><span class="line">催老板赶快做外卖</span><br><span class="line">一边玩手机一边等外卖</span><br><span class="line">..........</span><br></pre></td></tr></table></figure><h2 id="Step-4-代码说明"><a href="#Step-4-代码说明" class="headerlink" title="Step 4. 代码说明"></a>Step 4. 代码说明</h2><p>首先上面的代码是一个最基本的单生产单消费的例子。如果你想要多生产多消费，那多创建几个 boss 或者  takeawayBrother 就可以了。<br>然后店铺场景类没什么可说的，只是基本的创建线程逻辑，如果对于线程创建不了解的，可以参考前文的<a href="https://mp.weixin.qq.com/s?__biz=MzIzODE1NzA1MA==%E2%88%A3=2650157695&idx=1&sn=780603b41fb81746c173c0993b3d25b7&chksm=f13f3feac648b6fc112d222954e63546a0ed48d8ce0daa614768cbe7e126bd056a5c51b9bf0f&scene=0&xtrack=1#rd">【并发那些事】创建线程的三种方式</a>。此文不再赘述。另外观察代码，可以发现生产者与消费者的代码极为相似，只是一个存一个取。这里我们以生产者为例子说明。<br>首先在 Boss 类中他有两个成员属性，一个是 MAX_NUM 一个是 tables。还记得我们在一开头提到的『固定大小的缓冲区』吗？这里的 MAX_NUM 对应的就是『固定大小』这几个字，这里我们设置的是 5 个。他的现实意义就是老板不可能从早到晚一刻不停的做菜，一般是在点单的时候开始做，也有一些在高峰期的时候提前做一点，但是他放菜的桌子只有那么大，放满了就不能接着做。而 tables 就对应着『缓冲区』这几个字。老板做完菜总要有一个地方先放着等外卖小哥来拿吧，缓冲区就是放菜的桌子。<br>然后我们再接着看代码逻辑，我在代码中标记了几个注意点。<br>第一个注意点是最外面一层的 while。这个是多线程通用写法，因为不写 while 的话，一次任务结束后代码就退出了。现实业务中我们通常想要业务一直持续的运行，所以加个 while 解决。<br>第二个注意点  while (tables.size() == MAX_NUM) 。这个信息量相对多一点，首先 while 的判断条件的意思是判断当前桌子上的外卖是不是已经达到上限，如果是会进入 while 代码块的内容，首先通知(notifyAll)外卖小哥可以拿外卖了，然后自己可以歇着了(wait)，否则接着往下走继续做。初次接触生产消费模型的同学，很容易出错的点就是把这里的 while 写成 if。因为这里本身也只是要判断当前缓冲区是否满足生产的条件。其实在语法与逻辑上没有问题，但是在多线程下就会出现 <strong>虚假唤醒</strong> 的问题。比如现在有两个生产者都处于调用 wait 的地方。突然消费者线程把数据消费完了，并通知了所有生产者去生产，两个生产者都接收到消息，但是只有一个生产者拿到锁，他就去生产了，生产完后，把锁就释放了，刚刚另一个接收到消息的生产者拿到锁就接着往下走，如果这里是 if 的话，因为都已经判断过了，不会再判断，但是明显另一个线程已经完了任务，他现在已经不符合条件。接着往下走就会出现问题。所以当这里换成 while 后，他醒来后还会接着判断一次，不满足就接着等待，这样就避免了虚假唤醒这种问题。<br>第三个注意点  this.tables.notifyAll()。关于第二个问题，大家可能要说了，出现问题是因为我们同时通知了两个生产者造成的，java 自带了一个唤醒单个线程的 notify 方法为什么不用，反而用唤醒所有线程的 notifyAll 方法。这是因为 notify 唤醒线程是 <strong>随机</strong> 的，也就是说你唤醒的可能是生产者也可能是消费者。比如说你是生产者，你生产够了，你想唤醒消费者，但是不幸的是你唤醒了另一个生产者，另一个生产者一觉醒来，发现菜都做完了，就接着睡，如果生产者一直唤醒的都是生产者，那么程序就会进入 <strong>假死</strong> 状态，消费者永远都处于等待状态。</p><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><h3 id="1-项目代码"><a href="#1-项目代码" class="headerlink" title="1. 项目代码"></a>1. 项目代码</h3><p>因为篇幅有限，无法贴完所有代码，如遇到问题可到<a href="https://github.com/kiwiflydream/study-example/tree/master/study-thread-example">github</a>上查看源码。</p><h3 id="2-参考链接"><a href="#2-参考链接" class="headerlink" title="2. 参考链接"></a>2. 参考链接</h3><ol><li><a href="https://zh.wikipedia.org/zh-hans/%E7%94%9F%E4%BA%A7%E8%80%85%E6%B6%88%E8%B4%B9%E8%80%85%E9%97%AE%E9%A2%98">生产者消费者问题[WIKI]</a></li><li><a href="https://www.cnblogs.com/xrq730/p/4855663.html">Java 多线程 14：生产者/消费者模型</a></li><li><a href="https://juejin.im/post/5aeec675f265da0b7c072c56">一篇文章，让你彻底弄懂生产者–消费者问题</a></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573289400369-254bf775-d595-407b-b4b5-20d964e4aa9a.png#align=left&display=inline&height=130&name=image.png&originHeight=178&originWidth=621&size=39726&status=done&width=453" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/48faaa95/">https://blog.coder4j.cn/posts/48faaa95/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 并发那些事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 并发那些事 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【spock】单测竟然可以如此丝滑</title>
      <link href="/posts/2022afcd/"/>
      <url>/posts/2022afcd/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572609587644-4b77e5fa-311b-407f-8b58-471ec19ecea0.png#align=left&display=inline&height=611&name=image.png&originHeight=611&originWidth=960&size=1179175&status=done&width=960" alt="image.png"></p><h2 id="0-为什么人人都讨厌写单测"><a href="#0-为什么人人都讨厌写单测" class="headerlink" title="0. 为什么人人都讨厌写单测"></a>0. 为什么人人都讨厌写单测</h2><p>在之前的关于<a href="https://mp.weixin.qq.com/s?__biz=MzIzODE1NzA1MA==%E2%88%A3=2650157673&idx=1&sn=ed8cb9a37722938344d2ea5520d99368&chksm=f13f3ffcc648b6ea26b86301bc3f3d2ccbf4bbb6dbfbdf09b55a14f6290f139e1636b9deb699&scene=0&xtrack=1#rd">swagger</a>文章里提到过，<strong>程序员最讨厌的两件事，一件是别人不写文档，另一件就是自己写文档。这里如果把文档换成单元测试也同样成立。</strong><br>每个开发人员都明白单元测试的作用，也都知道代码覆盖率越高越好。高覆盖率的代码，相对来说出现 BUG 的概率就越低，在线上运行就越稳定，接的锅也就越少，就也不会害怕测试同事突然的关心。<br>既然这么多好处，为什么还会讨厌他呢？至少在我看来，单测有如下几点让我喜欢不起来的理由。<br><strong>第一，要额外写很多很多的代码</strong>，一个高覆盖率的单测代码，往往比你要测试的，真正开发的业务代码要多，甚至是业务代码的好几倍。这让人觉得难以接受，你想想开发 5 分钟，单测 2 小时是什么样的心情。而且并不是单测写完就没事了，后面业务要是变更了，你所写的单测代码也要同步维护。<br>第二，即使你有那个耐心去写单测，但是在当前这个拼速度挤时间的大环境下，会给你那么多写单测的时间吗？<strong>写一个单测的时间可以实现一个需求</strong>，你会如何去选？<br><strong>第三，写单测通常是一件很无趣的事</strong>，因为他比较死，主要目的就是为了验证，相比之下他更像是个体力活，没有真正写业务代码那种创造的成就感。写出来，验证不出 bug 很失落，白写了，验证出 bug 又感到自己是在打自己脸。</p><h2 id="1-为什么人人又必须写单测"><a href="#1-为什么人人又必须写单测" class="headerlink" title="1. 为什么人人又必须写单测"></a>1. 为什么人人又必须写单测</h2><p>所以得到的结论就是不写单测？那么问题又来了，<strong>出来混迟早是要还的</strong>，上线出了问题，最终责任人是谁？不是提需求的产品、不是没发现问题的测试同学，他们顶多就是连带责任。最该负责的肯定是写这段代码的你。特别是对于那些从事金融、交易、电商等息息相关业务的开发人员，跟每行代码打交通的都是真金白银。每次明星搞事，微博就挂，已经被传为笑谈，毕竟只是娱乐相关，如果挂的是支付宝、微信，那用户就没有那么大的包容度了。这些业务如果出现严重问题，轻则扫地出门，然后整个职业生涯背负这个污点，<strong>重则直接从面向对象开发变成面向监狱开发</strong>。所以<strong>单元测试保护的不仅仅是程序，更保护的是写程序的你</strong>。<br>最后得出了一个无可奈何的结论，<strong>单测是个让人又爱又恨的东西，是不想做但又不得不做的事情</strong>。虽然我们没办法改变要写单测这件事，但是我们可以改变怎么去写单元测试这件事。</p><h2 id="2-SPOCK-可以帮你改善单测体验"><a href="#2-SPOCK-可以帮你改善单测体验" class="headerlink" title="2. SPOCK 可以帮你改善单测体验"></a>2. SPOCK 可以帮你改善单测体验</h2><p>当然，本文不是教你用旁门左道的方法提高代码覆盖率。而是通过一个神奇的框架 spock 去提高你编写单元测试的效率。spock 这名称来源，个人猜测是因为《星际迷航》的同名人物（封面图）。那么 spock 是如何提高编写单测的效率呢？我觉得有以下几点：<br><strong>第一，他可以用更少的代码去实现单元测试</strong>，让你可以更加专注于去验证结果而不是写单测代码的过程。那么他又是如何做到少写代码这件事呢？原来他使用一种叫做 groovy 的魔法。<br>groovy 其实是一门基于 jvm 的动态语言。可以简单的理解成跑在 jvm 上的 python 或 js。说到这里，可能没有接触过动态语言的同学，对它们都会有一个比较刻板的印象，太过于灵活，很容易出现问题，且可维护性差，所以有了那一句『动态一时爽，全家 xxx』的梗。首先，这些的确是他的问题，严格的说是使用不当时才带来的问题。所以主要还是看使用的人。比如安卓领域的官方依赖管理工具 gradle 就是基于 groovy 开发的。<br>另外不要误以为我学这门框架，还要多学一门语言，成本太大。其实大可不必担心，你如果会 groovy 当然更好，如果不会也没有关系。因为 groovy 是基于 java 的，所以完全可以放心大胆的使用 java 的语法，某些要用到的 groovy 独有的语法很少，而且后面都会告诉你。<br><strong>第二，他有更好的语义化，让你的单测代码可读性更高。</strong><br>语义化这个词可能不太好理解。举两个例子来说吧，第一个是语义化比较好的语言 – HTML。他的语法特点就是标签，不同的类型放在不同的标签里。比如 head 就是头部的信息，body 是主体内容的信息，table 就是表格的信息，对于没有编程经验的人来说，也可以很容易理解。第二个是语义化比较差的语言 – 正则。他可以说基本上没有语义这种东西，由此导致的直接问题就是，即使是你自己的写的正则，几天之后你都不知道当时写的是什么。比如下面这个正则，你能猜出他是什么意思吗？（可以留言回复）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((?:(?:25[0-5]|2[0-4]\d|[01]?\d?\d)\.)&#123;3&#125;(?:25[0-5]|2[0-4]\d|[01]?\d?\d))</span><br></pre></td></tr></table></figure><h2 id="3-领略-SPOCK-的魔法"><a href="#3-领略-SPOCK-的魔法" class="headerlink" title="3. 领略 SPOCK 的魔法"></a>3. 领略 SPOCK 的魔法</h2><h3 id="3-1-引入依赖"><a href="#3-1-引入依赖" class="headerlink" title="3.1 引入依赖"></a>3.1 引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--如果没有使得 spring boot，以下包可以省略--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入spock 核心包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.spockframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spock-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3-groovy-2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入spock 与 spring 集成包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.spockframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spock-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3-groovy-2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--引入 groovy 依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.groovy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>groovy-all<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>#####</p><h5 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h5><p>注释已经标明，第一个包是 spring boot 项目需要使用的，如果你只是想使用 spock，只要最下面 3 个即可。其中第一个包  <strong>spock-core</strong> 提供了 spock 的核心功能，第二个包  <strong>spock-spring</strong> 提供了与 spring 的集成（不用 spring 的情况下也可以不引入）。 注意这两个包的版本号 -&gt; <strong>1.3-groovy-2.5</strong>。第一个版本号 1.3 其实代表是 spock 的版本，第二个版本号代表的是 spock 所要依赖的 groovy 环境的版本。最后一个包就是我们要依赖的 groovy 。</p><h3 id="3-2-准备基础测试类"><a href="#3-2-准备基础测试类" class="headerlink" title="3.2 准备基础测试类"></a>3.2 准备基础测试类</h3><h4 id="3-2-1-Calculator-java"><a href="#3-2-1-Calculator-java" class="headerlink" title="3.2.1 Calculator.java"></a>3.2.1 <strong>Calculator.java</strong></h4><p>**</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * *</span><br><span class="line"> *  * blog.coder4j.cn</span><br><span class="line"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">package cn.coder4j.study.example.spock;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author buhao</span><br><span class="line"> * @version Calculator.java, v 0.1 2019-10-30 10:34 buhao</span><br><span class="line"> */</span><br><span class="line">public class Calculator &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 加操作</span><br><span class="line">     *</span><br><span class="line">     * @param num1</span><br><span class="line">     * @param num2</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static int add(int num1, int num2) &#123;</span><br><span class="line">        return num1 + num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 整型除操作</span><br><span class="line">     *</span><br><span class="line">     * @param num1</span><br><span class="line">     * @param num2</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static int divideInt(int num1, int num2) &#123;</span><br><span class="line">        return num1 / num2;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 浮点型操作</span><br><span class="line">     * @param num1</span><br><span class="line">     * @param num2</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static double divideDouble(double num1,  double num2)&#123;</span><br><span class="line">        return num1 / num2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>#####</p><h5 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h5><p>这是一个很简单的计算器类。只写了三个方法，一个是加法的操作、一个整型的除法操作、一个浮点类型的除法操作。</p><h3 id="3-3-开始单测-Calculator-java"><a href="#3-3-开始单测-Calculator-java" class="headerlink" title="3.3 开始单测  Calculator**.java**"></a>3.3 开始单测  <strong>Calculator**</strong>.java**</h3><h4 id="3-3-1-创建单测类-CalculatorTest-groovy"><a href="#3-3-1-创建单测类-CalculatorTest-groovy" class="headerlink" title="3.3.1 创建单测类  CalculatorTest.groovy"></a>3.3.1 创建单测类  CalculatorTest.groovy</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> <span class="keyword">extends</span>  <span class="title">Specification</span> &#123;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>#####</p><h5 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h5><p>这里一定要注意，之前我们已经说了 spock 是基于 groovy 。所以单测类的后缀不是 .java 而** .groovy<strong>。千万不要创建成普通 java 类了。否则创建没有问题，但是写一些 groovy 语法会报错。如果你用的是 IDEA 可以通过如下方式创建，以前创建 Java 类我们都是选择第一个选项，现在我们选择第三个 **Groovy Class</strong> 就可以了。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572754013592-b016e060-1811-497f-9f38-163cc96015ca.png#align=left&display=inline&height=226&name=image.png&originHeight=226&originWidth=1384&size=88592&status=done&width=1384" alt="image.png"><br>另外就是 spock 的测试类需要继承  **spock.lang.Specification **类。</p><h4 id="3-3-2-验证加操作-expect"><a href="#3-3-2-验证加操作-expect" class="headerlink" title="3.3.2 验证加操作 - expect"></a>3.3.2 验证加操作 - expect</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(<span class="number">1</span>, <span class="number">1</span>) == <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>#####</p><h5 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h5><p><strong>def</strong> 是 groovy 的关键字，可以用来定义变量跟方法名。后面 <strong>“test add” **是你单元测试的名称，也可以用中文。最后重点说明的是  **expect</strong> 这个关键字。<br>expect 字面上的意思是期望，我们期望什么样的事情发生。在使用其它单测框架时，与之类似的是 assert 。比如  <em>Assert.assertEquals(_Calculator.add(_1 + 1）, 2) <em>这样，表示我们断言加操作传入 1 与 1 相加结果为 2。如果结果是这样则用例通过，如果不是则用例失败。这与我们上面的代码功能上完成一致。<br>expect 的语法意义就是在 expect 的</em></em>块<strong>内，所有表达式成立则验证通过，反之有任一个不成立则验证失败。这里引入了一个</strong>块**的概念。怎么理解 spock 的块呢？我们上面说 spock 有良好的语义化及更好的阅读性就是因为这个块的作用。可以类比成 html 中的标签。html 的标签的范围是两个标签之间，而 spock 更简洁一点，从这个标签开始到下一个标签开始或代码结束的地方，就是他的范围。我们只要看到 expect  这个标签就明白，他的范围内都是我们预期要得到的结果。</p><h4 id="3-3-3-验证加操作-given-and"><a href="#3-3-3-验证加操作-given-and" class="headerlink" title="3.3.3  验证加操作 - given - and"></a>3.3.3  验证加操作 - given - and</h4><p>这里代码比较简单，参数我只使用了一次，所以直接写死。如果想复用，我就得把这些参数抽成变量。这个时候可以使用 spock 的 <strong>given</strong> 块。given 的语法意义相当于是一个初始化的代码块。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with given&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">given:</span></span><br><span class="line">    <span class="keyword">def</span> num1 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> num2 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> result = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当然你也可以像下面这样写，但是<strong>严重不推荐</strong>，因为虽然可以达到同样的效果，但是<strong>不符合 spock 的语义</strong>。就像我们一般是在 head 里面引入 js、css，但是你在 body 或者任何标签里都可以引入，语法没有问题但是破坏了语义，不便理解与维护。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">// 反倒</span></span><br><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with given&quot;</span>()&#123;</span><br><span class="line">       <span class="symbol">expect:</span></span><br><span class="line">       <span class="keyword">def</span> num1 = <span class="number">1</span></span><br><span class="line">       <span class="keyword">def</span> num2 = <span class="number">1</span></span><br><span class="line">       <span class="keyword">def</span> result = <span class="number">2</span></span><br><span class="line">       Calculator.add(num1, num2) == result</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>如果你还想让语义更好一点，我们可以把参数与结果分开定义，这个时候可以使用 <strong>and</strong> 块。它的语法功能可以理解成同他上面最近的一个标签。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with given and&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">given:</span></span><br><span class="line">    <span class="keyword">def</span> num1 = <span class="number">1</span></span><br><span class="line">    <span class="keyword">def</span> num2 = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">and:</span></span><br><span class="line">    <span class="keyword">def</span> result = <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####</p><h4 id="3-3-4-验证加操作-expect-where"><a href="#3-3-4-验证加操作-expect-where" class="headerlink" title="3.3.4 验证加操作 - expect - where"></a>3.3.4 验证加操作 - expect - where</h4><p>看了上面例子，可能觉得 spock 只是语义比较好，但是没有少写几行代码呀。别急，下面我们就来看 spock 的一大杀器 <strong>where</strong>。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with expect where&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line"></span><br><span class="line">    <span class="symbol">where:</span></span><br><span class="line">    num1    |   num2    |   result</span><br><span class="line">    <span class="number">1</span>       |   <span class="number">1</span>       |   <span class="number">2</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">2</span>       |   <span class="number">3</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">3</span>       |   <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>where 块可以理解成准备测试数据的地方</strong>，他可以跟 expect 组合使用。上面代码里 expect 块里面定义了三个变量 num1、num2、result。这些数据我们可以在 where 块里定义。where 块使用了一种很像 markdown 中表格的定义方法。第一行或者说表头，列出了我们要传数据的变量名称，这里要<strong>与 expect 中对应</strong>，不能少但是可以多。其它行都是数据行，与表头一样都是通过 『 | 』 号分隔。通过这样，spock 就会跑 3 次用例，分别是 1 + 2 = 2、1 + 2 = 3、1 + 3 = 4 这些用例。怎么样？是不是很方便，后面再扩充用例只要再加一行数据就可以了。</p><h4 id="3-3-5-验证加操作-expect-where-Unroll"><a href="#3-3-5-验证加操作-expect-where-Unroll" class="headerlink" title="3.3.5  验证加操作 - expect - where - @Unroll"></a>3.3.5  验证加操作 - expect - where - @Unroll</h4><p>上面这些用例都是正常可以跑通的，如果是 IDEA 跑完之后会如下所示：<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572768324618-0f7dba74-138d-43b9-a8c4-e8c5af4cbc7b.png#align=left&display=inline&height=312&name=image.png&originHeight=312&originWidth=616&size=33068&status=done&width=616" alt="image.png"><br>那么现在我们看看如果有用例不通过会怎么样，把上面代码的最后一个 4 改成 5</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with expect where&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line"></span><br><span class="line">    <span class="symbol">where:</span></span><br><span class="line">    num1    |   num2    |   result</span><br><span class="line">    <span class="number">1</span>       |   <span class="number">1</span>       |   <span class="number">2</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">2</span>       |   <span class="number">3</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">3</span>       |   <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再跑一次，IDEA 会出现如下显示<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572768428913-cdbbf710-0561-4204-bf39-77ffbdaf838f.png#align=left&display=inline&height=700&name=image.png&originHeight=700&originWidth=2226&size=153623&status=done&width=2226" alt="image.png"><br>左边标注出来的是用例执行结果，可以看出来虽然有 3 条数据，其中 2 条数据是成功，但是只会显示整体的成功与否，所以显示未通过。但是 3 条数据，我怎么知道哪条没通过呢？<br>右边标注出来的是 spock 打印的的错误日志。可以很清楚的看到，在 num1 为 1，num2 为 3，result 为 5 并且 他们之间的判断关系为 == 的结果是 false 才是正确的。 spock 的这个日志打印的是相当历害，如果是比较字符串，还会计算异常字符串与正确字符串之间的匹配度，有兴趣的同学，可以自行测试。<br>嗯，虽然可以通过日志知道哪个用例没通过，但是还是觉得有点麻烦。spock 也知道这一点。所以他还同时提供了一个** @Unroll **注解。我们在上面的代码上再加上这个注解：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Unroll</span></span><br><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with expect where unroll&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line"></span><br><span class="line">    <span class="symbol">where:</span></span><br><span class="line">    num1    |   num2    |   result</span><br><span class="line">    <span class="number">1</span>       |   <span class="number">1</span>       |   <span class="number">2</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">2</span>       |   <span class="number">3</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">3</span>       |   <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行结果如下： <img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572769065408-cb11433d-e02c-4943-ad4f-b2b11f8da82f.png#align=left&display=inline&height=584&name=image.png&originHeight=584&originWidth=1794&size=132542&status=done&width=1794" alt="image.png"><br>通过添加** @Unroll** 注解，spock 自动把上面的代码拆分成了 3 个独立的单测测试，分别运行，运行结果更清晰了。<br>那么还能更清晰吗？当然可以，我们发现 spock 拆分后，每个用例的名称其实都是你写的单测方法的名称，然后后面加一个数组下标，不是很直观。我们可以通过 groovy 的字符串语法，把变量放入用例名称中，代码如下：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Unroll</span></span><br><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with expect where unroll by #num1 + #num2 = #result&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line"></span><br><span class="line">    <span class="symbol">where:</span></span><br><span class="line">    num1    |   num2    |   result</span><br><span class="line">    <span class="number">1</span>       |   <span class="number">1</span>       |   <span class="number">2</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">2</span>       |   <span class="number">3</span></span><br><span class="line">    <span class="number">1</span>       |   <span class="number">3</span>       |   <span class="number">5</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如上，我们在方法名后加了一句  <strong>#num1 + #num2 = #result</strong>。这里有点类似我们在 mybatis 或者一些模板引擎中使用的方法。# 号拼接声明的变量就可以了，执行后结果如下。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572769683455-e6523c1c-3ca3-48c3-91c3-1390af47ea8c.png#align=left&display=inline&height=272&name=image.png&originHeight=272&originWidth=924&size=60232&status=done&width=924" alt="image.png"><br>这下更清晰了。<br>另外一点，就是 where 默认使用的是表格的这种形式：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">where:</span></span><br><span class="line">num1    |   num2    |   result</span><br><span class="line"><span class="number">1</span>       |   <span class="number">1</span>       |   <span class="number">2</span></span><br><span class="line"><span class="number">1</span>       |   <span class="number">2</span>       |   <span class="number">3</span></span><br><span class="line"><span class="number">1</span>       |   <span class="number">3</span>       |   <span class="number">5</span></span><br></pre></td></tr></table></figure><p>很直观，但是这种形式有一个弊端。上面 『 | 』 号对的这么整齐。都是我一个空格一个 TAG 按出来的。虽然语法不要求对齐，但是逼死强迫症。不过，好在还可以有另一种形式：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Unroll</span></span><br><span class="line"><span class="keyword">def</span> <span class="string">&quot;test add with expect where unroll arr by #num1 + #num2 = #result&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Calculator.add(num1, num2) == result</span><br><span class="line"></span><br><span class="line">    <span class="symbol">where:</span></span><br><span class="line">    num1 &lt;&lt; [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">    num2 &lt;&lt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">    result &lt;&lt; [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以通过 『&lt;&lt;』 符（注意方向），把一个数组赋给变量，等同于上面的数据表格，没有表格直观，但是比较简洁也不用考虑对齐问题，这两种形式看个人喜好了。</p><h4 id="3-3-6-验证整数除操作-when-then"><a href="#3-3-6-验证整数除操作-when-then" class="headerlink" title="3.3.6 验证整数除操作 - when - then"></a>3.3.6 验证整数除操作 - when - then</h4><p>我们都知道一个整数除以 0 会有抛出一个『/ by zero』异常，那么如果断言这个异常呢。用上面 expect 不太好操作，我们可以使用另一个类似的块** when … then**。</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Unroll</span></span><br><span class="line"><span class="keyword">def</span> <span class="string">&quot;test int divide zero exception&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">when:</span></span><br><span class="line">    Calculator.divideInt(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    <span class="keyword">def</span> ex = thrown(ArithmeticException)</span><br><span class="line">    ex.message == <span class="string">&quot;/ by zero&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**when … then **通常是成对出现的，它代表着当执行了 when 块中的操作，会出现 then 块中的期望。比如上面的代码说明了，当执行了  <em>Calculator.divideInt(1, 0) *的操作，就一定会抛出  *ArithmeticException</em> 异常，并且异常信息是  <em>/ by zero</em>。</p><h3 id="3-4-准备-Spring-测试类"><a href="#3-4-准备-Spring-测试类" class="headerlink" title="3.4 准备 Spring 测试类"></a>3.4 准备 Spring 测试类</h3><p>上面我们已经学会了 spock 的基础用法，下面我们将学习与 spring 整合的知识，首先创建几个用于测试的 demo 类</p><h4 id="3-4-1-User-java"><a href="#3-4-1-User-java" class="headerlink" title="3.4.1 User.java"></a>3.4.1 User.java</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.spock.model;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author buhao</span></span><br><span class="line"><span class="comment"> * @version User.java, v 0.1 2019-10-30 16:23 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String passwd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User(String name, Integer age, String passwd) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">        <span class="built_in">this</span>.passwd = passwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;passwd&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return property value of passwd</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String getPasswd() &#123;</span><br><span class="line">        <span class="keyword">return</span> passwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;passwd&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param passwd value to be assigned to property passwd</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> setPasswd(String passwd) &#123;</span><br><span class="line">        <span class="built_in">this</span>.passwd = passwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return property value of name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> String getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param name value to be assigned to property name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> setName(String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @return property value of age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> Integer getAge() &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param age value to be assigned to property age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> setAge(Integer age) &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">boolean</span> equals(Object o) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        User user = (User) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(name, user.name) &amp;&amp;</span><br><span class="line">                Objects.equals(age, user.age) &amp;&amp;</span><br><span class="line">                Objects.equals(passwd, user.passwd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> hashCode() &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(name, age, passwd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####</p><h4 id="3-4-2-UserDao-java"><a href="#3-4-2-UserDao-java" class="headerlink" title="3.4.2 UserDao.java"></a>3.4.2 UserDao.java</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.spock.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.spock.model.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author buhao</span></span><br><span class="line"><span class="comment"> * @version UserDao.java, v 0.1 2019-10-30 16:24 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 模拟数据库</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Map&lt;String, User&gt; userMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        userMap.put(<span class="string">&quot;k&quot;</span>,<span class="keyword">new</span> User(<span class="string">&quot;k&quot;</span>, <span class="number">1</span>, <span class="string">&quot;123&quot;</span>));</span><br><span class="line">        userMap.put(<span class="string">&quot;i&quot;</span>,<span class="keyword">new</span> User(<span class="string">&quot;i&quot;</span>, <span class="number">2</span>, <span class="string">&quot;456&quot;</span>));</span><br><span class="line">        userMap.put(<span class="string">&quot;w&quot;</span>,<span class="keyword">new</span> User(<span class="string">&quot;w&quot;</span>, <span class="number">3</span>, <span class="string">&quot;789&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过用户名查询用户</span></span><br><span class="line"><span class="comment">     * @param name</span></span><br><span class="line"><span class="comment">     * @return</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> User findByName(String name)&#123;</span><br><span class="line">        <span class="keyword">return</span> userMap.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####</p><h4 id="3-4-3-UserService-java"><a href="#3-4-3-UserService-java" class="headerlink" title="3.4.3 UserService.java"></a>3.4.3 UserService.java</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.spock.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.spock.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.spock.model.User;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @author buhao</span></span><br><span class="line"><span class="comment"> * @version UserService.java, v 0.1 2019-10-30 16:29 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User findByName(String name)&#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> loginAfter()&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> login(String name, String passwd)&#123;</span><br><span class="line">        User user = findByName(name);</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(name + <span class="string">&quot;不存在&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!user.getPasswd().equals(passwd))&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(name + <span class="string">&quot;密码输入错误&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        loginAfter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>####</p><h4 id="3-4-3-Application-java"><a href="#3-4-3-Application-java" class="headerlink" title="3.4.3 Application.java"></a>3.4.3 Application.java</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.spock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Application.<span class="keyword">class</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>###</p><h3 id="3-5-与-spring-集成测试"><a href="#3-5-与-spring-集成测试" class="headerlink" title="3.5 与 spring 集成测试"></a>3.5 与 spring 集成测试</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.spock.service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.spock.model.User</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest</span><br><span class="line"><span class="keyword">import</span> spock.lang.Specification</span><br><span class="line"><span class="keyword">import</span> spock.lang.Unroll</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserServiceFunctionTest</span> <span class="keyword">extends</span> <span class="title">Specification</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService userService</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Unroll</span></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&quot;test findByName with input #name return #result&quot;</span>() &#123;</span><br><span class="line">        <span class="symbol">expect:</span></span><br><span class="line">        userService.findByName(name) == result</span><br><span class="line"></span><br><span class="line">        <span class="symbol">where:</span></span><br><span class="line">        name &lt;&lt; [<span class="string">&quot;k&quot;</span>, <span class="string">&quot;i&quot;</span>, <span class="string">&quot;kk&quot;</span>]</span><br><span class="line">        result &lt;&lt; [<span class="keyword">new</span> User(<span class="string">&quot;k&quot;</span>, <span class="number">1</span>, <span class="string">&quot;123&quot;</span>), <span class="keyword">new</span> User(<span class="string">&quot;i&quot;</span>, <span class="number">2</span>, <span class="string">&quot;456&quot;</span>), <span class="literal">null</span>]</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Unroll</span></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&quot;test login with input #name and #passwd throw #errMsg&quot;</span>() &#123;</span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        userService.login(name, passwd)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="keyword">def</span> e = thrown(Exception)</span><br><span class="line">        e.message == errMsg</span><br><span class="line"></span><br><span class="line">        <span class="symbol">where:</span></span><br><span class="line">        name    |   passwd  |   errMsg</span><br><span class="line">        <span class="string">&quot;kd&quot;</span>     |   <span class="string">&quot;1&quot;</span>     |   <span class="string">&quot;$&#123;name&#125;不存在&quot;</span></span><br><span class="line">        <span class="string">&quot;k&quot;</span>     |   <span class="string">&quot;1&quot;</span>     |   <span class="string">&quot;$&#123;name&#125;密码输入错误&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>spock 与 spring 集成特别的简单，只要你加入了开头所说的  <strong>spock-spring</strong> 和  <strong>spring-boot-starter-test</strong>。再于测试代码的类上加上  <strong>@SpringBootTest</strong>  注解就可以了。想用的类直接注入进来就可以了，但是要注意的是这里只能算功能测试或集成测试，因为在跑用例时是会启动 spring 容器的，外部依赖也必须有。很耗时，而且有时候外部依赖本地也跑不了，所以我们通常都是通过 mock 来完成单元测试。</p><h3 id="3-6-与-spring-mock-测试"><a href="#3-6-与-spring-mock-测试" class="headerlink" title="3.6 与 spring mock 测试"></a>3.6 与 spring mock 测试</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.spock.service</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.spock.dao.UserDao</span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.spock.model.User</span><br><span class="line"><span class="keyword">import</span> spock.lang.Specification</span><br><span class="line"><span class="keyword">import</span> spock.lang.Unroll</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserServiceUnitTest</span> <span class="keyword">extends</span> <span class="title">Specification</span>  &#123;</span></span><br><span class="line"></span><br><span class="line">    UserService userService = <span class="keyword">new</span> UserService()</span><br><span class="line">    UserDao userDao = Mock(UserDao)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> setup()&#123;</span><br><span class="line">        userService.userDao = userDao</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&quot;test login with success&quot;</span>()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        userService.login(<span class="string">&quot;k&quot;</span>, <span class="string">&quot;p&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="number">1</span> * userDao.findByName(<span class="string">&quot;k&quot;</span>) &gt;&gt; <span class="keyword">new</span> User(<span class="string">&quot;k&quot;</span>, <span class="number">12</span>,<span class="string">&quot;p&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&quot;test login with error&quot;</span>()&#123;</span><br><span class="line">        <span class="symbol">given:</span></span><br><span class="line">        <span class="keyword">def</span> name = <span class="string">&quot;k&quot;</span></span><br><span class="line">        <span class="keyword">def</span> passwd = <span class="string">&quot;p&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        userService.login(name, passwd)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="number">1</span> * userDao.findByName(name) &gt;&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="keyword">def</span> e = thrown(RuntimeException)</span><br><span class="line">        e.message == <span class="string">&quot;$&#123;name&#125;不存在&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Unroll</span></span><br><span class="line">    <span class="keyword">def</span> <span class="string">&quot;test login with &quot;</span>()&#123;</span><br><span class="line">        <span class="symbol">when:</span></span><br><span class="line">        userService.login(name, passwd)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        userDao.findByName(<span class="string">&quot;k&quot;</span>) &gt;&gt; <span class="literal">null</span></span><br><span class="line">        userDao.findByName(<span class="string">&quot;k1&quot;</span>) &gt;&gt; <span class="keyword">new</span> User(<span class="string">&quot;k1&quot;</span>, <span class="number">12</span>, <span class="string">&quot;p&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="symbol">then:</span></span><br><span class="line">        <span class="keyword">def</span> e = thrown(RuntimeException)</span><br><span class="line">        e.message == errMsg</span><br><span class="line"></span><br><span class="line">        <span class="symbol">where:</span></span><br><span class="line">        name        |   passwd  |   errMsg</span><br><span class="line">        <span class="string">&quot;k&quot;</span>         |   <span class="string">&quot;k&quot;</span>     |   <span class="string">&quot;$&#123;name&#125;不存在&quot;</span></span><br><span class="line">        <span class="string">&quot;k1&quot;</span>        |   <span class="string">&quot;p1&quot;</span>     |   <span class="string">&quot;$&#123;name&#125;密码输入错误&quot;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>spock 使用 mock 也很简单，直接使用 <strong>Mock(类)</strong> 就可以了。如上代码  <em>UserDao userDao = Mock(UserDao) 。</em>上面写的例子中有几点要说明一下，以如下这个方法为例：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test login with error&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">given:</span></span><br><span class="line">    <span class="keyword">def</span> name = <span class="string">&quot;k&quot;</span></span><br><span class="line">    <span class="keyword">def</span> passwd = <span class="string">&quot;p&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">when:</span></span><br><span class="line">    userService.login(name, passwd)</span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    <span class="number">1</span> * userDao.findByName(name) &gt;&gt; <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    <span class="keyword">def</span> e = thrown(RuntimeException)</span><br><span class="line">    e.message == <span class="string">&quot;$&#123;name&#125;不存在&quot;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>given、when、then 不用说了，大家已经很熟悉了，但是第一个 then 里面的 <strong><em>1 \</em> userDao.findByName(name) &gt;&gt; null* *<em>是什么鬼？<br>首先，我们可以知道的是，一个用例中可以有多个 then 块，对于多个期望可以分别放在多个 then 中。<br>第二， **1 \</em> xx *<em>表示 期望 xx 操作执行了 1 次。_1 \</em> userDao.findByName(name)<em>*</em> **就表现当执行  <em>userService.login(name, passwd) 时我期望执行 1 次  userDao.findByName(name) <em>方法。如果期望不执行这个方法就是_0 _ xx</em>，这在条件代码的验证中很有用，然后 <em>&gt;&gt; null</em> 又是什么意思？他代表当执行了  _userDao.findByName(name) 方法后，我让他结果返回 null</em>。因为 userDao 这个对象是我们 mock 出来的，他就是一个假对象，为了让后续流程按我们的想法进行，我可以通过『 &gt;&gt;』 让 spock 模拟返回指定数据。<br>第三，要注意第二个 then 代码块使用</strong> ${name} <strong>引用变量，跟标题的</strong> #name** 是不同的。</p><h3 id="3-7-其它内容"><a href="#3-7-其它内容" class="headerlink" title="3.7 其它内容"></a>3.7 其它内容</h3><h4 id="3-7-1-公共方法"><a href="#3-7-1-公共方法" class="headerlink" title="3.7.1 公共方法"></a>3.7.1 公共方法</h4><table><thead><tr><th align="center"><strong>方法名</strong></th><th align="center"><strong>作用</strong></th></tr></thead><tbody><tr><td align="center">setup()</td><td align="center">每个方法执行前调用</td></tr><tr><td align="center">cleanup()</td><td align="center">每个方法执行后调用</td></tr><tr><td align="center">setupSpec()</td><td align="center">每个方法类加载前调用一次</td></tr><tr><td align="center">cleanupSpec()</td><td align="center">每个方法类执行完调用一次</td></tr></tbody></table><p>这些方法通常用于测试开始前的一些初始化操作，和测试完成后的清理操作，如下：</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> setup() &#123;</span><br><span class="line">    println <span class="string">&quot;方法开始前初始化&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> cleanup() &#123;</span><br><span class="line">    println <span class="string">&quot;方法执行完清理&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> setupSpec() &#123;</span><br><span class="line">    println <span class="string">&quot;类加载前开始前初始化&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> cleanupSpec() &#123;</span><br><span class="line">    println <span class="string">&quot;所以方法执行完清理&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-7-2-Timeout"><a href="#3-7-2-Timeout" class="headerlink" title="3.7.2 @Timeout"></a>3.7.2 @Timeout</h4><p>对于某些方法，需要规定他的时间，如果运行时间超过了指定时间就算失败，这时可以使用 timeout 注解</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Timeout</span>(value = <span class="number">900</span>, unit = TimeUnit.MILLISECONDS)</span><br><span class="line"><span class="keyword">def</span> <span class="string">&quot;test timeout&quot;</span>()&#123;</span><br><span class="line">    <span class="symbol">expect:</span></span><br><span class="line">    Thread.sleep(<span class="number">1000</span>)</span><br><span class="line">    <span class="number">1</span> == <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注解有两个值，一个是 value 我们设置的数值，unit 是数值的单位。</p><h4 id="3-7-3-with"><a href="#3-7-3-with" class="headerlink" title="3.7.3 with"></a>3.7.3 with</h4><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="string">&quot;test findByName by verity&quot;</span>() &#123;</span><br><span class="line">    <span class="symbol">given:</span></span><br><span class="line">    <span class="keyword">def</span> userDao = Mock(UserDao)</span><br><span class="line"></span><br><span class="line">    <span class="symbol">when:</span></span><br><span class="line">    userDao.findByName(<span class="string">&quot;kk&quot;</span>) &gt;&gt; <span class="keyword">new</span> User(<span class="string">&quot;kk&quot;</span>, <span class="number">12</span>, <span class="string">&quot;33&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="symbol">then:</span></span><br><span class="line">    <span class="keyword">def</span> user = userDao.findByName(<span class="string">&quot;kk&quot;</span>)</span><br><span class="line">    with(user) &#123;</span><br><span class="line">        name == <span class="string">&quot;kk&quot;</span></span><br><span class="line">        age == <span class="number">12</span></span><br><span class="line">        passwd == <span class="string">&quot;33&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>with</strong> 算是一个语法糖，没有他之前我们要判断对象的值只能，user.getXxx() == xx。如果属性过多也是挺麻烦的，用 with 包裹之后，只要在花括号内直接写属性名称即可，如上代码所示。</p><h2 id="4-其它"><a href="#4-其它" class="headerlink" title="4. 其它"></a>4. 其它</h2><h3 id="4-1-完整代码"><a href="#4-1-完整代码" class="headerlink" title="4.1 完整代码"></a>4.1 完整代码</h3><p>因为篇幅有限，无法贴完所有代码，完整代码已上传  <a href="https://github.com/kiwiflydream/study-example/tree/master/study-spock-example">github</a>。</p><h3 id="4-2-参考文档"><a href="#4-2-参考文档" class="headerlink" title="4.2 参考文档"></a>4.2 参考文档</h3><p>本文在瞻仰了如下博主的精彩博文后，再加上自身的学习总结加工而来，如果本文在看的时候有不明白的地方可以看一下下方链接。</p><ol><li><a href="https://juejin.im/post/5d982268e51d45782e6039bf">Spock in Java 慢慢爱上写单元测试</a></li><li><a href="https://www.cnblogs.com/lovesqcc/p/8647201.html">使用 Groovy+Spock 轻松写出更简洁的单测</a></li><li><a href="http://jvm123.com/2019/08/spock.html">Spock 测试框架的介绍和使用详解</a></li><li><a href="https://www.alicharles.com/article/spock/#_%E9%87%87%E7%94%A8groovy_spock%E9%92%88%E5%AF%B9userservice%E7%BC%96%E5%86%99%E6%B5%8B%E8%AF%95">Spock 基于 BDD 测试</a></li><li><a href="http://spockframework.org/spock/docs/1.3/all_in_one.html">Spock 官方文档</a></li><li><a href="http://www.liuhaihua.cn/archives/540855.html">Spock 测试框架</a></li><li><a href="https://stackoverflow.com/questions/19185596/spock-testing-exceptions-with-data-tables">spock-testing-exceptions-with-data-tables</a></li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572784460361-705b4d9a-b67c-4456-8cd3-42abbfe75f66.png#align=left&display=inline&height=154&name=image.png&originHeight=178&originWidth=621&size=39726&status=done&width=539" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/2022afcd/">https://blog.coder4j.cn/posts/2022afcd/</a> </p>]]></content>
      
      
      <categories>
          
          <category> spock </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spock </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【碎碎念】03</title>
      <link href="/posts/d18db60a/"/>
      <url>/posts/d18db60a/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1571922915604-f292746d-c365-4512-b514-06eca9c7cc66.jpeg#align=left&display=inline&height=1080&margin=%5Bobject%20Object%5D&originHeight=1080&originWidth=1920&size=0&status=done&style=none&width=1920"></p><blockquote><p>本文收集与整理日常生活中看到的各种信息，可能是一条微博、也可能是一张图片、甚至只是闲聊中的只言片语。总之，是一些能触动到我的东西，希望同样对你有用。当然因为这些内容都是可遇而不可求的，发布没有固定时间，每攒 15 条，发布一次。同时，如果你也有这样的碎碎念，欢迎私信，很可能就出现在下一次的文章中。</p></blockquote><ol><li>故障<blockquote><p>故障天然会发生，如何减少发生概率，发生了以后如何缩短故障恢复时间，如何减少故障影响面是工程技术角度要解决的最核心命题。<br>– <a href="https://mp.weixin.qq.com/s/TeaJ274o85IpcxWGM1ogHw">有赞崔玉松：请商家听我讲一讲「系统稳定性」</a></p></blockquote></li></ol><hr><ol start="2"><li>ETC</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1571923689895-2822265d-81a6-4854-86f7-633f9eca6bea.png#align=left&display=inline&height=166&margin=%5Bobject%20Object%5D&name=image.png&originHeight=332&originWidth=426&size=75553&status=done&style=none&width=213" alt="image.png"></p><hr><ol start="3"><li>夜景</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572447192478-dec8e046-d569-45de-88c6-d282f35841c6.png#align=left&display=inline&height=277&margin=%5Bobject%20Object%5D&name=image.png&originHeight=554&originWidth=600&size=477349&status=done&style=none&width=300" alt="image.png"></p><hr><ol start="4"><li>裂缝<blockquote><p>万物皆有裂缝处，那是光射进来的地方。 -莱昂纳多·科恩（加拿大歌手、诗人）</p></blockquote></li></ol><hr><ol start="5"><li>拖延</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572447326861-fed708fa-50ac-4abb-b33c-73b1ad2079b8.png#align=left&display=inline&height=963&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1926&originWidth=1080&size=642218&status=done&style=none&width=540" alt="image.png"></p><hr><ol start="6"><li>沉醉</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1572525481770-6111a212-fb7f-4e57-bdb9-5bbffe06e6b6.png#align=left&display=inline&height=458&name=image.png&originHeight=916&originWidth=1080&size=1372039&status=done&width=540" alt="image.png"><br>–《进击的巨人》</p><hr><ol start="7"><li>最重要的两天<blockquote><p>人生最重要的两天，你来到世界的那天，和你了解为什么你来到世界的那天。<br>– 马克吐温</p></blockquote></li></ol><hr><ol start="8"><li>职场</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573746376295-50ea6b3f-aca4-457d-859d-9f9095928fef.png#align=left&display=inline&height=454&name=image.png&originHeight=908&originWidth=828&size=363442&status=done&width=414" alt="image.png"></p><hr><ol start="9"><li>学习金字塔</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573746312458-4ae3fd1f-321f-4a28-a506-bcf359b9c096.png#align=left&display=inline&height=215&name=image.png&originHeight=429&originWidth=800&size=285153&status=done&width=400" alt="image.png"></p><hr><ol start="10"><li>欲望与理想</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573745668613-62abe0f5-4eff-46ab-9fd3-9a60e682f7b7.png#align=left&display=inline&height=477&name=image.png&originHeight=954&originWidth=1124&size=559394&status=done&width=562" alt="image.png"></p><hr><ol start="11"><li>TDD</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573745743007-7555926e-ed5f-4546-9ecf-2d87d2474b07.png#align=left&display=inline&height=144&name=image.png&originHeight=287&originWidth=989&size=58988&status=done&width=494.5" alt="image.png"></p><hr><ol start="12"><li>仰望星空<blockquote><p>我们都在阴沟里，但仍有人仰望星空（We are all in the gutter, but some of us are looking at the stars.）<br>–王尔德</p></blockquote></li></ol><hr><ol start="13"><li>道德与规则<blockquote><p>一个肮脏的国家，如果人人讲规则而不是谈道德，最终会变成一个有人味儿的正常国家，道德自然会逐渐回归；一个干净的国家，如果人人都不讲规则却大谈道德，谈高尚，天天没事儿就谈道德规范，人人大公无私，最终这个国家会堕落成为一个伪君子遍布的肮脏国家。<br>–胡适</p></blockquote></li></ol><hr><ol start="14"><li>迅速掌握知识点</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573746045219-941b6526-872b-4ef1-97b6-4686bf217f56.png#align=left&display=inline&height=2559&name=image.png&originHeight=5117&originWidth=720&size=2082222&status=done&width=360" alt="image.png"></p><ol start="15"><li>快乐</li></ol><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1573746198736-b9229c3b-d606-4a3e-a2de-fcb8af073ab2.png#align=left&display=inline&height=924&name=image.png&originHeight=1847&originWidth=1080&size=1385647&status=done&width=540" alt="image.png"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/d18db60a/">https://blog.coder4j.cn/posts/d18db60a/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 碎碎念 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【websocket】spring boot 集成 websocket 的四种方式</title>
      <link href="/posts/2bed5d1c/"/>
      <url>/posts/2bed5d1c/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1571838520170-96049339-d6e2-438f-9fe5-3119d6f5ebd5.jpeg#align=left&display=inline&height=1080&originHeight=1080&originWidth=1920&size=0&status=done&width=1920"></p><h2 id="集成-websocket-的四种方案"><a href="#集成-websocket-的四种方案" class="headerlink" title="集成 websocket 的四种方案"></a>集成 websocket 的四种方案</h2><h3 id="1-原生注解"><a href="#1-原生注解" class="headerlink" title="1. 原生注解"></a>1. 原生注解</h3><h4 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="WebSocketConfig"><a href="#WebSocketConfig" class="headerlink" title="WebSocketConfig"></a>WebSocketConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.standard.ServerEndpointExporter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> WebSocketConfig.java, v 0.1 2019-10-18 15:45 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServerEndpointExporter <span class="title">serverEndpoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ServerEndpointExporter();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h5><p>这个配置类很简单，通过这个配置 spring boot 才能去扫描后面的关于 websocket 的注解</p><h4 id="WsServerEndpoint"><a href="#WsServerEndpoint" class="headerlink" title="WsServerEndpoint"></a>WsServerEndpoint</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.ws;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnClose;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnMessage;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.OnOpen;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.Session;</span><br><span class="line"><span class="keyword">import</span> javax.websocket.server.ServerEndpoint;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> WsServerEndpoint.java, v 0.1 2019-10-18 16:06 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ServerEndpoint(&quot;/myWs&quot;)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WsServerEndpoint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接成功</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnOpen</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;连接成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 连接关闭</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnClose</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClose</span><span class="params">(Session session)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;连接关闭&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收到消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> text</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@OnMessage</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">onMsg</span><span class="params">(String text)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;servet 发送：&quot;</span> + text;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h5><p>这里有几个注解需要注意一下，首先是他们的包都在 **javax.websocket **下。并不是 spring 提供的，而 jdk 自带的，下面是他们的具体作用。</p><ol><li><strong>@ServerEndpoint</strong><ol><li>通过这个 spring boot 就可以知道你暴露出去的 ws 应用的路径，有点类似我们经常用的@RequestMapping。比如你的启动端口是 8080，而这个注解的值是 ws，那我们就可以通过 ws://127.0.0.1:8080/ws 来连接你的应用</li></ol></li><li><strong>@OnOpen</strong><ol><li>当 websocket 建立连接成功后会触发这个注解修饰的方法，注意它有一个  Session 参数</li></ol></li><li><strong>@OnClose</strong><ol><li>当 websocket 建立的连接断开后会触发这个注解修饰的方法，注意它有一个  Session 参数</li></ol></li><li><strong>@OnMessage</strong><ol><li>当客户端发送消息到服务端时，会触发这个注解修改的方法，它有一个 String 入参表明客户端传入的值</li></ol></li><li><strong>@OnError</strong><ol><li>当 websocket 建立连接时出现异常会触发这个注解修饰的方法，注意它有一个  Session 参数</li></ol></li></ol><p>另外一点就是服务端如何发送消息给客户端，服务端发送消息必须通过上面说的 Session 类，通常是在@OnOpen 方法中，当连接成功后把 session 存入 Map 的 value，key 是与 session 对应的用户标识，当要发送的时候通过 key 获得 session 再发送，这里可以通过  <strong>session.getBasicRemote*()<em>.sendText</em>(*)</strong> 来对客户端发送消息。</p><h3 id="2-Spring-封装"><a href="#2-Spring-封装" class="headerlink" title="2. Spring 封装"></a>2. Spring 封装</h3><h4 id="pom-xml-1"><a href="#pom-xml-1" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="HttpAuthHandler"><a href="#HttpAuthHandler" class="headerlink" title="HttpAuthHandler"></a>HttpAuthHandler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.websocket.config.WsSessionManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.CloseStatus;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.TextMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketSession;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.handler.TextWebSocketHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> MyWSHandler.java, v 0.1 2019-10-17 17:10 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HttpAuthHandler</span> <span class="keyword">extends</span> <span class="title">TextWebSocketHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * socket 建立成功事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionEstablished</span><span class="params">(WebSocketSession session)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object token = session.getAttributes().get(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 用户连接成功，放入在线用户缓存</span></span><br><span class="line">            WsSessionManager.add(token.toString(), session);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;用户登录已经失效!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收消息事件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> message</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">handleTextMessage</span><span class="params">(WebSocketSession session, TextMessage message)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// 获得客户端传来的消息</span></span><br><span class="line">        String payload = message.getPayload();</span><br><span class="line">        Object token = session.getAttributes().get(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;server 接收到 &quot;</span> + token + <span class="string">&quot; 发送的 &quot;</span> + payload);</span><br><span class="line">        session.sendMessage(<span class="keyword">new</span> TextMessage(<span class="string">&quot;server 发送给 &quot;</span> + token + <span class="string">&quot; 消息 &quot;</span> + payload + <span class="string">&quot; &quot;</span> + LocalDateTime.now().toString()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * socket 断开连接时</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> status</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterConnectionClosed</span><span class="params">(WebSocketSession session, CloseStatus status)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Object token = session.getAttributes().get(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (token != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 用户退出，移除缓存</span></span><br><span class="line">            WsSessionManager.remove(token.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h5><p>通过继承  <strong>TextWebSocketHandler</strong> 类并覆盖相应方法，可以对 websocket 的事件进行处理，这里可以同原生注解的那几个注解连起来看</p><ol><li><strong>afterConnectionEstablished</strong>  方法是在 socket 连接成功后被触发，同原生注解里的 @OnOpen 功能</li><li>**afterConnectionClosed  **方法是在 socket 连接关闭后被触发，同原生注解里的 @OnClose 功能</li><li>**handleTextMessage **方法是在客户端发送信息时触发，同原生注解里的  @OnMessage 功能</li></ol><h4 id="WsSessionManager"><a href="#WsSessionManager" class="headerlink" title="WsSessionManager"></a>WsSessionManager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketSession;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> WsSessionManager.java, v 0.1 2019-10-22 10:24 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WsSessionManager</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 保存连接 session 的地方</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> ConcurrentHashMap&lt;String, WebSocketSession&gt; SESSION_POOL = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加 session</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String key, WebSocketSession session)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 添加 session</span></span><br><span class="line">        SESSION_POOL.put(key, session);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除 session,会返回删除的 session</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> WebSocketSession <span class="title">remove</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 删除 session</span></span><br><span class="line">        <span class="keyword">return</span> SESSION_POOL.remove(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除并同步关闭连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">removeAndClose</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        WebSocketSession session = remove(key);</span><br><span class="line">        <span class="keyword">if</span> (session != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 关闭连接</span></span><br><span class="line">                session.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">                <span class="comment">// todo: 关闭出现异常处理</span></span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获得 session</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> WebSocketSession <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 获得 session</span></span><br><span class="line">        <span class="keyword">return</span> SESSION_POOL.get(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h5><p>这里简单通过  **ConcurrentHashMap **来实现了一个 session 池，用来保存已经登录的 web socket 的   session。前文提过，服务端发送消息给客户端必须要通过这个 session。</p><h4 id="MyInterceptor"><a href="#MyInterceptor" class="headerlink" title="MyInterceptor"></a>MyInterceptor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.interceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.hutool.core.util.StrUtil;</span><br><span class="line"><span class="keyword">import</span> cn.hutool.http.HttpUtil;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.server.ServerHttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.WebSocketHandler;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.server.HandshakeInterceptor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> MyInterceptor.java, v 0.1 2019-10-17 19:21 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandshakeInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 握手前</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wsHandler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> attributes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">beforeHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Map&lt;String, Object&gt; attributes)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;握手开始&quot;</span>);</span><br><span class="line">        <span class="comment">// 获得请求参数</span></span><br><span class="line">        HashMap&lt;String, String&gt; paramMap = HttpUtil.decodeParamMap(request.getURI().getQuery(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">        String uid = paramMap.get(<span class="string">&quot;token&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (StrUtil.isNotBlank(uid)) &#123;</span><br><span class="line">            <span class="comment">// 放入属性域</span></span><br><span class="line">            attributes.put(<span class="string">&quot;token&quot;</span>, uid);</span><br><span class="line">            System.out.println(<span class="string">&quot;用户 token &quot;</span> + uid + <span class="string">&quot; 握手成功！&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;用户登录已失效&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 握手后</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wsHandler</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterHandshake</span><span class="params">(ServerHttpRequest request, ServerHttpResponse response, WebSocketHandler wsHandler, Exception exception)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;握手完成&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h5><p>通过实现 <strong>HandshakeInterceptor</strong> 接口来定义握手拦截器，注意这里与上面 <strong>Handler</strong> 的事件是不同的，这里是建立握手时的事件，分为握手前与握手后，而   <strong>Handler</strong> 的事件是在握手成功后的基础上建立 socket 的连接。所以在如果把认证放在这个步骤相对来说最节省服务器资源。它主要有两个方法  <strong>beforeHandshake</strong> 与  **afterHandshake **，顾名思义一个在握手前触发，一个在握手后触发。</p><h4 id="WebSocketConfig-1"><a href="#WebSocketConfig-1" class="headerlink" title="WebSocketConfig"></a>WebSocketConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.websocket.handler.HttpAuthHandler;</span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.websocket.interceptor.MyInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> WebSocketConfig.java, v 0.1 2019-10-17 15:43 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocket</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> HttpAuthHandler httpAuthHandler;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyInterceptor myInterceptor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerWebSocketHandlers</span><span class="params">(WebSocketHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry</span><br><span class="line">                .addHandler(httpAuthHandler, <span class="string">&quot;myWS&quot;</span>)</span><br><span class="line">                .addInterceptors(myInterceptor)</span><br><span class="line">                .setAllowedOrigins(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h5><p>通过实现  <strong>WebSocketConfigurer</strong> 类并覆盖相应的方法进行 <strong>websocket</strong> 的配置。我们主要覆盖  <strong>registerWebSocketHandlers</strong> 这个方法。通过向  <strong>WebSocketHandlerRegistry</strong> 设置不同参数来进行配置。其中 <strong>addHandler **方法添加我们上面的写的 ws 的   handler 处理类，第二个参数是你暴露出的 ws 路径。</strong>addInterceptors <strong>添加我们写的握手过滤器。</strong>setAllowedOrigins(“*“) **这个是关闭跨域校验，方便本地调试，线上推荐打开。</p><h3 id="3-TIO"><a href="#3-TIO" class="headerlink" title="3. TIO"></a>3. TIO</h3><h4 id="pom-xml-2"><a href="#pom-xml-2" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.t-io<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>tio-websocket-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.5.v20191010-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="application-xml"><a href="#application-xml" class="headerlink" title="application.xml"></a>application.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tio:</span><br><span class="line">  websocket:</span><br><span class="line">    server:</span><br><span class="line">      port: 8989</span><br></pre></td></tr></table></figure><h5 id="说明-5"><a href="#说明-5" class="headerlink" title="说明"></a>说明</h5><p>这里只配置了 ws 的启动端口，还有很多配置，可以通过结尾给的链接去寻找</p><h4 id="MyHandler"><a href="#MyHandler" class="headerlink" title="MyHandler"></a>MyHandler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.tio.core.ChannelContext;</span><br><span class="line"><span class="keyword">import</span> org.tio.http.common.HttpRequest;</span><br><span class="line"><span class="keyword">import</span> org.tio.http.common.HttpResponse;</span><br><span class="line"><span class="keyword">import</span> org.tio.websocket.common.WsRequest;</span><br><span class="line"><span class="keyword">import</span> org.tio.websocket.server.handler.IWsMsgHandler;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> MyHandler.java, v 0.1 2019-10-21 14:39 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyHandler</span> <span class="keyword">implements</span> <span class="title">IWsMsgHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 握手</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HttpResponse <span class="title">handshake</span><span class="params">(HttpRequest httpRequest, HttpResponse httpResponse, ChannelContext channelContext)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> httpResponse;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 握手成功</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> httpResponse</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAfterHandshaked</span><span class="params">(HttpRequest httpRequest, HttpResponse httpResponse, ChannelContext channelContext)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;握手成功&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收二进制文件</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wsRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">onBytes</span><span class="params">(WsRequest wsRequest, <span class="keyword">byte</span>[] bytes, ChannelContext channelContext)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 断开连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wsRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">onClose</span><span class="params">(WsRequest wsRequest, <span class="keyword">byte</span>[] bytes, ChannelContext channelContext)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;关闭连接&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 接收消息</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> wsRequest</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> s</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> channelContext</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">onText</span><span class="params">(WsRequest wsRequest, String s, ChannelContext channelContext)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收文本消息:&quot;</span> + s);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-6"><a href="#说明-6" class="headerlink" title="说明"></a>说明</h5><p>这个同上个例子中的 handler 很像，也是通过实现接口覆盖方法来进行事件处理，实现的接口是<strong>IWsMsgHandler</strong>，它的方法功能如下</p><ol><li>handshake<ol><li>在握手的时候触发</li></ol></li><li>onAfterHandshaked<ol><li>在握手成功后触发</li></ol></li><li>onBytes<ol><li>客户端发送二进制消息触发</li></ol></li><li>onClose<ol><li>客户端关闭连接时触发</li></ol></li><li>onText<ol><li>客户端发送文本消息触发</li></ol></li></ol><h4 id="StudyWebsocketExampleApplication"><a href="#StudyWebsocketExampleApplication" class="headerlink" title="StudyWebsocketExampleApplication"></a>StudyWebsocketExampleApplication</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.tio.websocket.starter.EnableTioWebSocketServer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableTioWebSocketServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudyWebsocketExampleApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(StudyWebsocketExampleApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="说明-7"><a href="#说明-7" class="headerlink" title="说明"></a>说明</h5><p>这个类的名称不重要，它其实是你的 spring boot 启动类，只要记得加上**@EnableTioWebSocketServer**注解就可以了</p><h3 id="STOMP"><a href="#STOMP" class="headerlink" title="STOMP"></a>STOMP</h3><h4 id="pom-xml-3"><a href="#pom-xml-3" class="headerlink" title="pom.xml"></a>pom.xml</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-websocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="WebSocketConfig-2"><a href="#WebSocketConfig-2" class="headerlink" title="WebSocketConfig"></a>WebSocketConfig</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.config.MessageBrokerRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> WebSocketConfig.java, v 0.1 2019-10-21 16:32 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableWebSocketMessageBroker</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title">WebSocketMessageBrokerConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerStompEndpoints</span><span class="params">(StompEndpointRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 配置客户端尝试连接地址</span></span><br><span class="line">        registry.addEndpoint(<span class="string">&quot;/ws&quot;</span>).setAllowedOrigins(<span class="string">&quot;*&quot;</span>).withSockJS();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageBroker</span><span class="params">(MessageBrokerRegistry registry)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 设置广播节点</span></span><br><span class="line">        registry.enableSimpleBroker(<span class="string">&quot;/topic&quot;</span>, <span class="string">&quot;/user&quot;</span>);</span><br><span class="line">        <span class="comment">// 客户端向服务端发送消息需有/app 前缀</span></span><br><span class="line">        registry.setApplicationDestinationPrefixes(<span class="string">&quot;/app&quot;</span>);</span><br><span class="line">        <span class="comment">// 指定用户发送（一对一）的前缀 /user/</span></span><br><span class="line">        registry.setUserDestinationPrefix(<span class="string">&quot;/user/&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-8"><a href="#说明-8" class="headerlink" title="说明"></a>说明</h5><ol><li>通过实现  <strong>WebSocketMessageBrokerConfigurer</strong> 接口和加上**@EnableWebSocketMessageBroker**来进行 stomp 的配置与注解扫描。</li><li>其中覆盖  <strong>registerStompEndpoints</strong> 方法来设置暴露的 stomp 的路径，其它一些跨域、客户端之类的设置。</li><li>覆盖  **configureMessageBroker **方法来进行节点的配置。<ol><li>其中  **enableSimpleBroker **配置的广播节点，也就是服务端发送消息，客户端订阅就能接收消息的节点。</li><li>覆盖**setApplicationDestinationPrefixes **方法，设置客户端向服务端发送消息的节点。</li><li>覆盖 <strong>setUserDestinationPrefix</strong> 方法，设置一对一通信的节点。</li></ol></li></ol><h4 id="WSController"><a href="#WSController" class="headerlink" title="WSController"></a>WSController</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * *</span></span><br><span class="line"><span class="comment"> *  * blog.coder4j.cn</span></span><br><span class="line"><span class="comment"> *  * Copyright (C) 2016-2019 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.example.websocket.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.websocket.model.RequestMessage;</span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.example.websocket.model.ResponseMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.MessageMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.handler.annotation.SendTo;</span><br><span class="line"><span class="keyword">import</span> org.springframework.messaging.simp.SimpMessagingTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> WSController.java, v 0.1 2019-10-21 17:22 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WSController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> SimpMessagingTemplate simpMessagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@MessageMapping(&quot;/hello&quot;)</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;/topic/hello&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResponseMessage <span class="title">hello</span><span class="params">(RequestMessage requestMessage)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;接收消息：&quot;</span> + requestMessage);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResponseMessage(<span class="string">&quot;服务端接收到你发的：&quot;</span> + requestMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsgByUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function">Object <span class="title">sendMsgByUser</span><span class="params">(String token, String msg)</span> </span>&#123;</span><br><span class="line">        simpMessagingTemplate.convertAndSendToUser(token, <span class="string">&quot;/msg&quot;</span>, msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/sendMsgByAll&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function">Object <span class="title">sendMsgByAll</span><span class="params">(String msg)</span> </span>&#123;</span><br><span class="line">        simpMessagingTemplate.convertAndSend(<span class="string">&quot;/topic&quot;</span>, msg);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test-stomp.html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="说明-9"><a href="#说明-9" class="headerlink" title="说明"></a>说明</h5><ol><li>通过  <strong>@MessageMapping</strong> 来暴露节点路径，有点类似 <strong>@RequestMapping</strong>。注意这里虽然写的是 hello ，但是我们客户端调用的真正地址是** /app/hello<strong>。 因为我们在上面的 config 里配置了</strong>registry.setApplicationDestinationPrefixes(“/app”)**。</li><li><strong>@SendTo</strong>这个注解会把返回值的内容发送给订阅了  <strong>/topic/hello **的客户端，与之类似的还有一个</strong>@SendToUser** 只不过他是发送给用户端一对一通信的。这两个注解一般是应答时响应的，如果服务端主动发送消息可以通过  <strong>simpMessagingTemplate</strong>类的<strong>convertAndSend</strong>方法。注意  <strong>simpMessagingTemplate.convertAndSendToUser(token, “/msg”, msg) **，联系到我们上文配置的 **registry.setUserDestinationPrefix(“/user/“),**这里客户端订阅的是</strong>/user/{token}/msg**,千万不要搞错。</li></ol><h2 id="Session-共享的问题"><a href="#Session-共享的问题" class="headerlink" title="Session 共享的问题"></a>Session 共享的问题</h2><p>上面反复提到一个问题就是，服务端如果要主动发送消息给客户端一定要用到 session。而大家都知道的是 session 这个东西是不跨 jvm 的。如果有多台服务器，在 http 请求的情况下，我们可以通过把 session 放入缓存中间件中来共享解决这个问题，通过 spring session 几条配置就解决了。但是 web socket  不可以。他的 session 是不能序列化的，当然这样设计的目的不是为了为难你，而是出于对 http 与 web socket 请求的差异导致的。<br>目前网上找到的最简单方案就是通过 redis 订阅广播的形式，主要代码跟第二种方式差不多，你要在本地放个 map 保存请求的 session。也就是说每台服务器都会保存与他连接的 session 于本地。然后发消息的地方要修改，并不是现在这样直接发送，而通过 redis 的订阅机制。服务器要发消息的时候，你通过 redis 广播这条消息，所有订阅的服务端都会收到这个消息，然后本地尝试发送。最后肯定只有有这个对应用户 session 的那台才能发送出去。</p><h2 id="如何选择"><a href="#如何选择" class="headerlink" title="如何选择"></a>如何选择</h2><ol><li>如果你在使用 tio，那推荐使用 tio 的集成。因为它已经实现了很多功能，包括上面说的通过 redis 的 session 共享，只要加几个配置就可以了。但是 tio 是半开源，文档是需要收费的。如果没有使用，那就忘了他。</li><li>如果你的业务要求比较灵活多变，推荐使用前两种，更推荐第二种 Spring 封装的形式。</li><li>如果只是简单的服务器双向通信，推荐 stomp 的形式，因为他更容易规范使用。</li></ol><h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><ol><li>websocket 在线验证</li></ol><p>写完服务端代码后想调试，但是不会前端代码怎么办，点<a href="http://coolaf.com/tool/chattest">这里</a>，这是一个在线的 websocket 客户端，功能完全够我们调试了。</p><ol start="2"><li>stomp 验证</li></ol><p>这个没找到在线版的，但是网上有很多 demo 可以下载到本地进行调试，也可以通过后文的连接找到。</p><ol start="3"><li>另外由于篇幅有限，并不能放上所有代码，但是测试代码全都上传 gitlab，保证可以正常运行，可以在  <a href="https://github.com/kiwiflydream/study-example/tree/master/study-websocket-example">这里</a>  找到</li></ol><h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><ol><li><a href="https://www.xncoding.com/2017/07/15/spring/sb-websocket.html">SpringBoot 系统 - 集成 WebSocket 实时通信</a></li><li><a href="https://juejin.im/post/5b7071ade51d45665816f8c0">WebSocket 的故事（二）—— Spring 中如何利用 STOMP 快速构建 WebSocket 广播式消息模式</a></li><li><a href="https://blog.csdn.net/Ouyzc/article/details/79994401">SpringBoot 集成 WebSocket【基于纯 H5】进行点对点[一对一]和广播[一对多]实时推送</a></li><li><a href="https://segmentfault.com/a/1190000016718711">Spring Framework 参考文档（WebSocket STOMP）</a></li><li><a href="https://www.zifangsky.cn/1355.html">Spring Boot 中使用 WebSocket 总结（一）：几种实现方式详解</a></li><li><a href="https://www.jianshu.com/p/161df01cc8af">Spring Boot 系列 - WebSocket 简单使用</a></li><li><a href="https://my.oschina.net/panzi1/blog/3062746">tio-websocket-spring-boot-starter</a></li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/2bed5d1c/">https://blog.coder4j.cn/posts/2bed5d1c/</a> </p>]]></content>
      
      
      <categories>
          
          <category> websocket </category>
          
      </categories>
      
      
        <tags>
            
            <tag> websocket </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【并发那些事】创建线程的三种方式</title>
      <link href="/posts/8dfe4337/"/>
      <url>/posts/8dfe4337/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1571210975395-ea234d96-3b78-421d-92f5-1efdb5cfb706.jpeg#align=left&display=inline&height=1080&originHeight=1080&originWidth=1920&size=0&status=done&width=1920"></p><p>创建线程可以说是并发知识中最基础的操作了，JDK 提供的创建线程的方式，如果不包括通过线程池的话，目前有三种形式，它们分别是通过继承 Thread 类，通过实现 Runable 接口，通过 FutureTask。如下图所示</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1571231041090-878dd721-4df8-42f9-b979-a331f1e64ff0.png">下面整理了一下 3 种方法的具体使用与异同。</p><h3 id="创建线程的-3-种方法"><a href="#创建线程的-3-种方法" class="headerlink" title="创建线程的 3 种方法"></a>创建线程的 3 种方法</h3><h4 id="1-继承-Thread"><a href="#1-继承-Thread" class="headerlink" title="1. 继承 Thread"></a>1. 继承 Thread</h4><ol><li>创建一个类继承 Thread 并覆盖 run 方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String threadName = getName();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;线程[&quot;</span> + threadName + <span class="string">&quot;]运行开始,i = &quot;</span> + i + <span class="string">&quot; time = &quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建并启动线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MyThread myThread1 = <span class="keyword">new</span> MyThread();</span><br><span class="line">MyThread myThread2 = <span class="keyword">new</span> MyThread();</span><br><span class="line"></span><br><span class="line">myThread1.start();</span><br><span class="line">myThread2.start();</span><br><span class="line"></span><br><span class="line">String threadName = Thread.currentThread().getName();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;线程[&quot;</span> + threadName + <span class="string">&quot;]运行开始,i = &quot;</span> + i + <span class="string">&quot; time = &quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整体流程如下：<br><img src="https://cdn.nlark.com/yuque/__mermaid_v3/e516fbd2b0db871bf82504bdbd9140fe.svg#lake_card_v2=eyJjb2RlIjoiZ3JhcGggVEJcblx0c3RhcnQoKOW8gOWniykpIC0tPiBjcmVhdGVUaHJlYWRb5Yib5bu657un5om_6IeqVGhyZWFk55qE57G7LDxici8-5ZCM5pe26KaG55uWIHJ1biDmlrnms5VdXG5cdGNyZWF0ZVRocmVhZCAtLT4gY3JlYXRlT2JqW-WIm-W7uuWunuS-i11cblx0Y3JlYXRlT2JqIC0tPiBydW5b6LCD55So5a6e5L6L55qEIHN0YXJ0IOaWueazlV0gXG5cdHJ1biAtLT4gZW5kVCgo57uT5p2fKSlcbiIsInR5cGUiOiJtZXJtYWlkIiwiaWQiOiJPSEhtOCIsInVybCI6Imh0dHBzOi8vY2RuLm5sYXJrLmNvbS95dXF1ZS9fX21lcm1haWRfdjMvZTUxNmZiZDJiMGRiODcxYmY4MjUwNGJkYmQ5MTQwZmUuc3ZnIiwiY2FyZCI6ImRpYWdyYW0ifQ=="></p><p>这里步骤比较简单和清晰</p><ol><li>创建一个类，这类要继承 Thread</li><li>覆盖 Thread 的 run 方法，并在此方法中实现你的多线程任务</li><li>创建这个类的实例</li><li>调用它的 start() 方法（这里要注意，新手容易直接调用 run 方法，那样只是普通调用，而不多线程调用）</li></ol><h4 id="2-实现-Runable"><a href="#2-实现-Runable" class="headerlink" title="2. 实现 Runable"></a>2. 实现 Runable</h4><ol><li>创建一个类实现 Runable 接口，并覆盖 run 方法</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyRunable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String threadName = Thread.currentThread().getName();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;线程[&quot;</span> + threadName + <span class="string">&quot;]运行开始,i = &quot;</span> + i + <span class="string">&quot; time = &quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建类的实现，并将它传给 Thread 的构造函数来创建 Thread</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">MyRunable myRunable = <span class="keyword">new</span> MyRunable();</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Thread(myRunable).start();</span><br><span class="line"><span class="keyword">new</span> Thread(myRunable).start();</span><br><span class="line"></span><br><span class="line">String threadName = Thread.currentThread().getName();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;线程[&quot;</span> + threadName + <span class="string">&quot;]运行开始,i = &quot;</span> + i + <span class="string">&quot; time = &quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整体流程如下：<br><img src="https://cdn.nlark.com/yuque/__mermaid_v3/7161a3f6caeee5e7e7576532e2634d71.svg#lake_card_v2=eyJjb2RlIjoiZ3JhcGggVEJcblx0c3RhcnQoKOW8gOWniykpIC0tPiBjcmVhdGVSdW5hYmxlW-WIm-W7uuS4gOS4quWunueOsOS6hiBSdW5hYmxlIOaOpeWPo-eahOexuzxici8-LOW5tuimhuebliBydW4g5pa55rOVXVxuXHRjcmVhdGVSdW5hYmxlIC0tPiBjcmVhdGVPYmpb5Yib5bu6IFJ1bmFibGUg5a6e546w57G75a6e5L6LXVxuXHRjcmVhdGVPYmogLS0-IGNyZWF0ZVRocmVhZFvlsIYgUnVuYWJsZSDlrp7njrDnsbvlrp7kvos8YnIvPuS8oOe7mSBUaHJlYWQg5p6E6YCg5Ye95pWwPGJyLz7liJvlu7ogVGhyZWFkIOWunuS-i11cblx0Y3JlYXRlVGhyZWFkIC0tPiBydW5b6LCD55SoIHN0YXJ0IOaWueazlV1cblx0cnVuIC0tPiBlbmRUKCjnu5PmnZ8pKVxuXHQiLCJ0eXBlIjoibWVybWFpZCIsImlkIjoiM0VxZ2MiLCJ1cmwiOiJodHRwczovL2Nkbi5ubGFyay5jb20veXVxdWUvX19tZXJtYWlkX3YzLzcxNjFhM2Y2Y2FlZWU1ZTdlNzU3NjUzMmUyNjM0ZDcxLnN2ZyIsImNhcmQiOiJkaWFncmFtIn0=">具体步骤如下：</p><ol><li>创建一个实现了 Runable 接口的类</li><li>覆盖 run 方法，并在此方法中实现你的多线程任务</li><li>创建 Runable 接口实现类的实例</li><li>通过把上步得到的 Runable 接口实现类的实例，传给   Thread 的有参构造函数来创建 Thread 的实例</li><li>调用上步得来的 Thread 实例的 start() 方法（这里要注意，新手容易直接调用 run 方法，那样只是普通调用，而不多线程调用）</li></ol><h4 id="3-通过-FutureTask"><a href="#3-通过-FutureTask" class="headerlink" title="3. 通过 FutureTask"></a>3. 通过 FutureTask</h4><ol><li>创建一个实现了 Callable<T> 接口的类，并实现 call 方法 (T 代表你想要的返回值类型)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCallerTask</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行任务开始&quot;</span>);</span><br><span class="line">        Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;执行任务结束&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>创建并启动线程</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建异步任务</span></span><br><span class="line">FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> FutureTask&lt;&gt;(<span class="keyword">new</span> MyCallerTask());</span><br><span class="line"><span class="comment">// 启动线程</span></span><br><span class="line"><span class="keyword">new</span> Thread(futureTask).start();</span><br><span class="line">System.out.println(<span class="string">&quot;其它操作&quot;</span>);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 等待任务执行完，并获得任务执行完的结果</span></span><br><span class="line">    String result = futureTask.get();</span><br><span class="line">    System.out.println(result);</span><br><span class="line">&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>整体流程如下：<br><img src="https://cdn.nlark.com/yuque/__mermaid_v3/b1ffaadf81276165a310c7448b349d77.svg#lake_card_v2=eyJjb2RlIjoiZ3JhcGggVEJcblx0c3RhcnQoKOW8gOWniykpIC0tPiBjcmVhdGVDYWxsYWJsZVvliJvlu7rkuIDkuKrlrp7njrAgY2FsbGFibGUg5o6l5Y-j55qE57G7LDxici8-5bm26KaG55uWIGNhbGwg5pa55rOVXVxuXHRjcmVhdGVDYWxsYWJsZSAtLT4gY3JlYXRlQ09ialvliJvlu7ogY2FsbGFibGUg5a6e546w57G755qE5a6e5L6LXVxuXHRjcmVhdGVDT2JqIC0tPiBjcmVhdGVGT2JqW-mAmui_h-S4iuatpeeahCBjYWxsYWJsZSDlrp7kvoss5Yib5bu6IEZ1dHVyZVRhc2sg5a6e5L6LXVxuXHRjcmVhdGVGT2JqIC0tPiBjcmVhdGVUaHJlYWRb6YCa6L-H5LiK5q2l55qEIEZ1dHVyZVRhc2sg5a6e5L6LLOWIm-W7uiBUaHJlYWQg5a6e5L6LXVxuXHRjcmVhdGVUaHJlYWQgLS0-IHJ1blvosIPnlKggc3RhcnQg5pa55rOVXSBcblx0cnVuIC0tPiAgZ2V0W-iwg-eUqCBGdXR1cmVUYXNrIOWunuS-i-eahCBnZXQg5pa55rOVLOiOt-W-l-i_lOWbnuWAvF1cblx0Z2V0IC0tPiBlbmRUKCjnu5PmnZ8pKVxuXG5cdCIsInR5cGUiOiJtZXJtYWlkIiwiaWQiOiJrejhuWCIsInVybCI6Imh0dHBzOi8vY2RuLm5sYXJrLmNvbS95dXF1ZS9fX21lcm1haWRfdjMvYjFmZmFhZGY4MTI3NjE2NWEzMTBjNzQ0OGIzNDlkNzcuc3ZnIiwiY2FyZCI6ImRpYWdyYW0ifQ==">具体步骤如下：</p><ol><li>创建一个实现了 <strong>Callable<T></strong> 接口的类，这里 T 的类型就是你线程任务想要返回的类型</li><li>覆盖 <strong>call</strong> 方法，并在此方法中实现你的多线程任务</li><li>创建 <strong>Callable</strong> 接口实现类的实例</li><li>通过把上步得到的 <strong>Callable</strong> 接口实现类的实例，传给   <strong>FutureTask</strong> 的有参构造函数来创建 <strong>FutureTask</strong> 的实例</li><li>通过把上步得到的  <strong>FutureTask</strong> 实例，传给   <strong>Thread</strong>  的有参构造函数来创建 <strong>Thread</strong> 的实例</li><li>调用上步得来的 <strong>Thread</strong> 实例的 <strong>start()</strong> 方法（这里要注意，新手容易直接调用 run 方法，那样只是普通调用，而不多线程调用）</li><li>如果你还想获得返回值，需要再调用  <strong>FutureTask **实例的 **get()</strong> 方法（这里要注意，get()会阻塞线程）</li></ol><h3 id="3-种方法的优缺点"><a href="#3-种方法的优缺点" class="headerlink" title="3 种方法的优缺点"></a>3 种方法的优缺点</h3><p>通过上述的演示代码，可以看出这 3 种方法，其实各有优缺点</p><h4 id="复杂程度"><a href="#复杂程度" class="headerlink" title="复杂程度"></a>复杂程度</h4><p>通过代码量与逻辑可以明显感觉出来，第一种直接继承 Thread 最方便，并且其它两种到最后，还是要依赖创建 Thread 才能实现。所以从方便及难易程度来看，可以得到如下结论：<br><em><img src="https://cdn.nlark.com/yuque/__latex/8815a238f7257e13ab9459d03677c3f2.svg#card=math&code=Thread%20%20%3E%20Runable%20%3E%20FutureTask&height=16&width=251"></em></p><h4 id="可扩展性"><a href="#可扩展性" class="headerlink" title="可扩展性"></a>可扩展性</h4><p>通过演示代码可以看出，只有第一种是通过继承，其它两种是通过实现接口的形式。我们都知道 JAVA 是不允许多继承，但是可以多实现。所以如果使用了第一种方法，就无法再继承别的类了。另外第一种把线程与线程任务冗余在了一起，不利于后期的维护。所以可以得到如下结论：<br><img src="https://cdn.nlark.com/yuque/__latex/e0cbb5af2d7b897d688a44b27e4a42a2.svg#card=math&code=Runable%20%3D%20FutureTask%20%3E%20Thread&height=16&width=251"></p><h4 id="是否有返回值"><a href="#是否有返回值" class="headerlink" title="是否有返回值"></a>是否有返回值</h4><p>从代码中可以很容易看出，只有通过 FutureTask 的方式才有返回值，另外两种均没有，所以得出如下结论<br><img src="https://cdn.nlark.com/yuque/__latex/7416c5ebf9e2c788548d8ff6ed7a5b8a.svg#card=math&code=FutureTask%20%3E%20Runable%20%3D%20Thread&height=16&width=251"></p><h3 id="该用哪种方式创建线程"><a href="#该用哪种方式创建线程" class="headerlink" title="该用哪种方式创建线程"></a>该用哪种方式创建线程</h3><p>如果要用到返回值，那不用想，肯定只能使用 FutureTask 的方法。如果对于返回值没有要求，那 Thread 与   Runable 均可，不过，考虑到可扩展性，最好使用 Runable 的形式。不过，话说回来，如果在真正项目中使用，综合考虑，一般还是最推荐通过线程池去创建。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/8dfe4337/">https://blog.coder4j.cn/posts/8dfe4337/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 并发那些事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 并发那些事 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【随笔】跳出程序员思维看世界</title>
      <link href="/posts/9f58e145/"/>
      <url>/posts/9f58e145/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1570951045907-9a52ecf3-6ca0-4795-9de3-bdf2a8a92c9b.jpeg#align=left&display=inline&height=1080&originHeight=1080&originWidth=1920&size=0&status=done&width=1920"></p><p>作为程序员，我真的有时候特别想 debug 这个世界。看看这个世界究竟是怎么运行的。因为经常会遇到她的输出跟我断言的不一样，或者我觉得正常的输入，却被她判定为非法。</p><p>先分享两件事吧。</p><p>第一件事，记得去年考驾照的时候，应该是在练科目三。教练带着我练车，当开到一个地方时，让我停车。然后跟我说：『这里是一个考点，看到前面那棵树没？考试的时候，你把车开到离那棵树大概这么长的距离，停一下车』。我顿时懵逼了，我发现我对『大概这么长』完全没有个概念。我就问教练『大概这么长是多长？』，这下就轮到教练懵逼了，然后，就听到后座早就等的不耐烦排队练车的三个同学跟教练异口同声的对我说『大概这么长就是这么长呀』，同时给我一个看着智障一样的眼神。大概这么长就是这么长，那到底是多长，我彻底凌乱了。那一刻我才发现我和世界不一样。</p><p>好在后来教练没有放弃对我的治疗，但我能明显感觉出来，她教我的方式跟其它人不太一样。后面跟我说话的画风都是这样的。『看到前面那棵树没？考试的时候，你把车开到离那棵树半米的距离，停一下车。看到那个花台没？车轮与花台平行，并且保持 20 公分的距离。看到前面那个电线杆没？车头与它的夹角成 60 度的时候，方向盘及时回正』，半米、平行、20 公分、60 度，这些词让我觉得这才是正确的描述。但我还是不明白别人是怎么明白『大概这么长』是多长的。</p><p>第二件事，我发现我怎么都学不会做菜。究其原因是什么呢？因为我发现自己完全看不懂菜谱。每次看到里面充斥着类似盐少许、醋若干、酱油适量等这样的描述我都气不打一处来。我如果自己明白适量是多少，我还去看菜谱干什么。我一直觉得写这种菜谱的人，心里一点 B 数都没有。但是呢？跟上面练车的例子一样，别人就是可以通过这些少许、若干、适量的字眼学会做菜，还做的不错。这样看来我可能才是那个没有 B 数的那个。</p><p>说到 B 数，我其实觉得这是一个比较粗俗的词汇。但是，我一时又想不到有什么词可以去替换它。如果非要找个词的话，我就想起以前上学打『英雄联盟』的时候，各种坑队友。队友总是能预判出哪个草丛可能有人，哪个地方会有谁来 gank 你，什么时候该到哪里去。他们之间的沟通，一个眼神、一个信号就够了。而我啥也 get 不到，总是送人头，打单机。后来我就问他们是怎么感觉出来，简直像开挂一样，我怎么什么也感觉不到。他们给我的评价是『因为你没有意识』。对，就是『意识』这个词。</p><p>为什么我没有意识。可能意识这个东西比较偏感性思维，而我偏理性思维，也可能我天生就是一个意识薄弱的人。但是毫无疑问的是，当我选了理科，当我进入社会成了一名程序员，都一直在弱化意识这个东西。</p><p>就拿代码来说，代码里面写的最多的是什么，应该是方法。每个系统是由 N 个类组成，每个类又是由 N 个方法组成。而方法又叫函数，取自数学上的概念。wiki 上是这样描述它的，『<em>函数就像机器或黑箱，给予输入值便产生唯一输出值』。</em>注意唯一这个词，理论上函数的外部输入值一样，最终得到的结果也是一样。我们写代码的时候大部分情况下也是这样，少部分情况下不一致很可能是因为 BUG。这就跟意识没有半毛钱关系了，通常在你输入的情况就能知道他应该有什么样的输出，用程序员的话说就是断言。而如何知道输出断言，不是靠感觉出来的，是你通过逻辑一步一步推导出来的，容不得半点感性思维在里面。</p><p>另外一个场景，大家就很熟悉了。就是跟产品经理日常吵架。吵的原因如下，比如加需求了、比如改需求了、再比如需求不明确了。。。无外乎都是围绕着需求的。而其中最伤脑筋的就是需求不明确。</p><p>最近几年 AI 非常火，每种职业都有一种，以后会不会被 AI 取代的焦虑，程序员也不例外。以前就看到过这样的帖子，作者表达出类似的担忧。帖子的大概内容就是觉得 AI 发展十分迅速，假以时日，可能以后就没有什么程序员了，只有产品经理。以后开发系统的场景可能是这样的，产品经理登录一个 AI 系统，在系统界面劈哩叭啦把需求输入进去，然后 AI 系统根据输入的需求瞬间生成了一堆代码，组成一个新的系统。看到这个帖子，我瞬间就感受到了那种焦虑，然后我就往下拉，看帖子的回复，当我看到回复里面点赞最高的那一条时，我立刻就释然了。点赞最高的那一条回复是这样说的『这种场景永远也不可能出现，除非有一天，产品经理能把他们的需求说清楚』。🤣</p><p>需求是程序员与产品经理之间永恒的话题。每次产品提需求，你都是先抛一个 5W2H 的灵魂拷问。做什么、为什么做、谁来做、什么时候做、在哪里做、怎么做、做多少。有一点不清楚都要找产品经理倒腾清楚，说不清楚大家都别下班。记得，以前我在网上查项目经理与产品经理的区别。知乎上有一个答案让我印象深刻，他说『产品经理着眼于做正确的事情，项目经理着眼于正确的做事情』。项目经理其实代表了程序员这一类群体。这个回答其实很好的阐述两者的关系。产品经理其实更多的是设计出一张正确的图纸，而我们程序员作的是拿着这张图纸正确的去实施。其实，经常我们会自嘲是搬砖的，但是如果从这方面看，还真是这个样子。</p><p>产品经理会去想做什么，为什么这么做等问题。而我们可能只是被动去想怎么做。这是现在企业工作高度分工的原因导致的。这本身无可厚非，但是如果长此以往，可能会剥夺我们的思考能力。因为很大一部分思考，产品经理帮你做了，你不清楚的就找产品经理问清楚，缺乏思考的过程，久而久之很容易变成了一个没有感情的代码机器。</p><p>上面说的是工作上，生活中更是这样，虽然有本书叫作《人人都是产品经理》，但是现实世界中肯定不是这样。教练跟我说的时候，我抛个 5W2H 问题给她，她可能转身一脚就把我踹下车了。生活中太多不准确、不明确、不科学、不幂等的事情了。只能学的去接受，生活中没有产品经理，先什么都理好了，然后告诉你怎么做，也没有测试同学，帮你一遍遍调试定位问题。我们不能因为工作的分工原因，养成了依赖别人思考的习惯。要学着适当的跳出程序员的思维去看这个世界。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/9f58e145/">https://blog.coder4j.cn/posts/9f58e145/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>【随笔】爱因斯坦与科举制</title>
      <link href="/posts/ab94273d/"/>
      <url>/posts/ab94273d/</url>
      
        <content type="html"><![CDATA[<p>前段时间知乎上有一个热门问题–《<a href="https://www.zhihu.com/question/333199024/answer/746004419">历史上有哪两件事听起来不在同一个年代实际上却同时发生的?</a>》。点赞最高的是下面这个答案。<br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1569889057813-ab936263-8827-412b-b6e4-7d9a58c62d5f.png#align=left&display=inline&height=264&name=image.png&originHeight=528&originWidth=1382&size=107427&status=done&width=691" alt="image.png"></p><p>答主的答案是『爱因斯坦在他 1905 年的论文《论动体的电动力学》中介绍了其狭义相对论，同年中国废除科举制度。』，很多人留言大呼吃惊，难以相信这是同一年的事情。这个答案其实就是本文的题目。不知道点开这篇文章之前，第一次看到这个题目的你，当时脑海里是什么样的想法。标题党？挂羊头买狗肉？穿越小说？可能各种各样的猜测。但是很难觉得这只是一个简单到不能再简单的事实陈述。</p><p>还有另外一个问题，出处我已经找不到了，大致的问题是《美国有哪些细思极恐的地方？》。其中有一个问题让我印象很深。答主的回答是『当我们还处于抗日战争的时候，美国的小朋友就已经在电视上看《猫和老鼠》的动画片了。』</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1570095586223-649fe4cd-64fa-496a-8d81-79233a7a2cbb.png#align=left&display=inline&height=384&name=image.png&originHeight=768&originWidth=1024&size=685044&status=done&width=512" alt="image.png"></p><p>这两个问题给人的感受应该是相似的，都是难以置信，不可思议。谁能意识到清光绪三十一年，爱因斯坦发表的相对论。1939 年正处于抗日最艰难的时期，美国小朋友第一次在电视上看到《猫和老鼠》。而这部动画片我小时候还在看，乃至今日，还有很多频道在播放。还有许许多多这样让人感觉历史错位的例子比比皆是，有兴趣的读者可以看<a href="https://kuaibao.qq.com/s/20190319A0LBS100">这篇文章</a>。</p><p>最后一个例子，是我在前不久在语雀上看到了一篇名叫《<a href="https://www.yuque.com/zenany/up/high_productivity_work">高效工作</a>》的文章，通过这个题目，你或许就可以猜到这是一篇教大家如何提高工作效率的文章。事实也的确如此。但是有一张截图很值得玩味。作者在论述如何通过配置消息提醒来达到更高效的时候，配置了一张如下的截图</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1570096864390-17546218-2d84-4db4-a7d3-46226876e79c.png#align=left&display=inline&height=141&name=image.png&originHeight=282&originWidth=1050&size=134458&status=done&width=525" alt="image.png"></p><p>值得玩味的点就是，这是一篇教大家提高工作效率的文章。但是高效的作者竟然还要到 9:30 才能准时回家。不出所料，一看评论就发现有人已经在问了</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1570097068944-e9a21b5c-ad82-4720-aed6-a7d3f7207141.png#align=left&display=inline&height=119&name=image.png&originHeight=238&originWidth=696&size=26475&status=done&width=348" alt="image.png"></p><p>相对于这篇文章，作者对于这个问题的回复，才是让我印象最深刻的地方，他的回答如下</p><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1570097157652-6ab2dbe7-228c-4c3f-9af5-34279adfcbdc.png#align=left&display=inline&height=178&name=image.png&originHeight=356&originWidth=1600&size=79890&status=done&width=800" alt="image.png"></p><p>看到这里你或许会很奇怪，这三个例子有什么关系，这篇文章又是在说什么？其实我自己也不知道，前天，也就 2019 年 10 月 01 日的国庆佳节， 我上午看了祖国 70 周年阅兵仪式，下午又去电影院看了《我和我的祖国》，不知道为什么脑海里反复出现的就是上面三个片段。</p><p>当时的感受真的是心潮澎湃，热血激昂。短短几十年的光景，中国就像前两个答案一样的，从一个封闭、落后、积贫积弱、一穷二白，谁都能欺负的国家，奇迹般的上升到如今的世界第二，成为了一个没有任何国家能够忽视的民族。而创造这个奇迹的原因是什么呢？我想就那些追随国家大势、紧跟时代脚步、勤劳努力完成自己的责任与义务的每个普通的人们。</p><p>1929 年 5 月 4 日，上海《生活周刊》刊发《十问未来之中国》，现在读起来真的是感慨万千</p><blockquote><ol><li>吾国之军权何时归一，分散之军阀何时湮灭？</li><li>军人治政之权何时尽除，吾国之行政权何时统于中央？</li><li>三十四国治外法权何时可废，吾国之司法何时自主？</li><li>由北洋至国府，元首概为军界强人，吾国何时诞生文人执政？</li><li>吾国何时举行真正之代议选举，何时举行真正之国民普选？</li><li>吾国何时可稻产自丰、谷产自足，不忧饥馑？</li><li>吾国何时可自产水笔、灯罩、自行表、人工车等物什，供国人生存之需？</li><li>吾国何时可产巨量之钢铁、枪炮、舰船，供给吾国之边防军？</li><li>吾国何时可行义务之初级教育、兴十万之中级学堂、育百万之高级学子？</li><li>吾国何时可参与寰宇诸强国之角逐，拓势力于境外、通贸易以取利、输文明而和外人？</li></ol></blockquote><p>而用行动回答这些问题的，同样是每个努力而又普通的个体。就像《我和我的祖国》里面一样，镜头对准并不是王侯将相和那些叱咤风云的大人物，而是像林治远、高远、老李。。。这样那些平凡的不能再平凡，可能在历史的长河中并没有留下任何只言片语的普通人。他们就是这些奇迹的一个又一个的载体。</p><p>我相信下个十年，中国，一定会成为世界上最强大的国家。中华民族，一定会傲然屹立于世界之巅。历害了我的国！！！</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/ab94273d/">https://blog.coder4j.cn/posts/ab94273d/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 随笔 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 随笔 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>一个好看又能打的 swagger 工具包</title>
      <link href="/posts/5f40214/"/>
      <url>/posts/5f40214/</url>
      
        <content type="html"><![CDATA[<h1 id="【Swagger】可能是目前最好的-Spring-Boot-集成-swagger-的项目"><a href="#【Swagger】可能是目前最好的-Spring-Boot-集成-swagger-的项目" class="headerlink" title="【Swagger】可能是目前最好的 Spring Boot 集成 swagger 的项目"></a>【Swagger】可能是目前最好的 Spring Boot 集成 swagger 的项目</h1><p><img src="http://static.coder4j.cn/mweb/15677624942810.jpg#alt="></p><p>据说程序员最恨的两件事：一件是别人不写文档，另一件是自己写文档。</p><p>可见文档真的是程序员生活中相爱相杀的存在。一方面对于使用者来说，一份<strong>全面、准确</strong>的文档简直就是旅行时的地图，烹饪时的菜谱，通关时的攻略。可以极大的提高对接的效率与尽可能的减少踩坑的概率。然而，一份<strong>全面而又准确</strong>的文档谈何容易。</p><p>以接口文档来说，程序员不想写的原因跟写单元测试一样，很大程序上在于它完完全全是一个体力活，毫无创造性可言，枯燥并且乏味。更要紧的它不是一次性写完就可以了，还需要不停的维护，当你的业务变更进而导致代码变动，使得请求值、响应值、接口名称、字段注释、校验信息。。。。。都可能会修改。这个时候接口文档就要同步更新。否则它就会变的不准确了。如果经常对接接口的同学可能深有体会，这不光出现于公司内部，对接外部接口，或提供外部接口不时有这样的问题。</p><p><strong>天下苦接口文档久矣</strong>！突然有一天，一个头戴丝袜，气宇轩昂的大侠出现，改变了这个局面。他通过一套自创的注解，就可以自动生成一个在线的接口文档，而且随着代码的变更，它也会跟着变化。极大的减少了人们的工作量。为表达对于这位英雄的敬意，江湖人称–<strong>丝袜哥</strong>(Swagger 音译)。</p><p><img src="http://static.coder4j.cn/mweb/15678454841633.jpg#alt="></p><p>一个典型的生成后 swagger 的接口文档页面如上图所示。关于丝袜哥的传奇故事，我们今天就说到这里。通过图片其实可以看出原生的界面、功能还是比较有限的。首先没有一个登录界面，基本上在使用时没几个人改 swagger 的默认地址。所以别人发现你的接口地址很容易访问到你的 swagger 页面，这就带来了安全风险。另一点就是这个界面，怎么说呢，至少不是我喜欢的款。还是一点就是直接对接起 Spring Boot 还是有点麻烦的，各种 bean 要手动配置，一点也不 Spring Boot。</p><p>凡此种种，终于有一天。在 github 闲逛时，发现了一个不错的 swagger 的工具包，一用就爱不释手。<a href="https://github.com/battcn/swagger-spring-boot">项目地址</a>下面就演示一下如何使用。</p><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.battcn<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.5-RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p><code>2.1.5-RELEASE</code>是当前的最新版，后续版本大家可以在项目地址上去看。</p><h3 id="配置篇"><a href="#配置篇" class="headerlink" title="配置篇"></a>配置篇</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>配置结束了，如果你只想用最基本的 swagger 的功能的话。访问<code>http://&#123;host:port&#125;/swagger-ui.html</code>后会有如下界面</p><p><img src="http://static.coder4j.cn/mweb/15679291774614.jpg#alt="></p><p>该项目的 UI 是使用 Vue 重写的较原版无论是颜值还是功能都有很大的提升。比如添加了搜索、接口统计等很多实用功能。如果我们想开启登录验证，防止接口文档被外部人员访问到，只要添加三条配置就可以了。</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">swagger:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">security:</span></span><br><span class="line">      <span class="attr">filter-plugin:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">username:</span> <span class="string">kiwi</span></span><br><span class="line">      <span class="attr">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><p>我们再次访问接口页面，界面被拦截了，变成了如下登录界面。</p><p><img src="http://static.coder4j.cn/mweb/15679297752970.jpg#alt="></p><p>输入配置的账号与密码，又见到了熟悉的接口页面了。</p><h3 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h3><p>是不是感觉很方便，很 easy。其实还有很多功能，因为篇幅有限，更重要是作者本身已经写了很好的使用文档，没有必要在本文再一一列举出来（好吧，其实是我懒），大家可以到<a href="https://github.com/battcn/swagger-spring-boot">项目页面</a>接着学习。另外在作者的页面可以看到他本人的博客地址，是一个宝藏博主哦！</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/5f40214/">https://blog.coder4j.cn/posts/5f40214/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>【碎碎念】02(20190511)</title>
      <link href="/posts/f8a1a670/"/>
      <url>/posts/f8a1a670/</url>
      
        <content type="html"><![CDATA[<blockquote><p><strong>如果想要更好的阅读体验，请点击文章末尾的阅读原文跳转语雀阅读。</strong></p></blockquote><h4 id="1-动物世界"><a href="#1-动物世界" class="headerlink" title="1. 动物世界  "></a>1. 动物世界  </h4><p>for  <a href="https://weibo.com/tv/v/Hs374AAhp?fid=1034:4366804517065517">weibo</a><br><a href="https://www.yuque.com/buhao/blog/fty1nx?_lake_card=%7B%22status%22:%22done%22,%22name%22:%22000i7wVglx07tueoNRgQ01041200oGDw0E010.mp4%22,%22size%22:5883770,%22percent%22:0,%22id%22:%22Byr4b%22,%22videoId%22:%229b1a1b6e473c4b70bc018a8bc9a6227d%22,%22coverUrl%22:%22https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1556942614120-65b9236d-ef77-4c84-9676-ad5fa15ddcda.jpeg%22,%22aliyunVideoSrc%22:null,%22taobaoVideoId%22:%22225173898479%22,%22uploaderId%22:119443,%22authKey%22:%22YXBwX2tleT04MDAwMDAwMTImYXV0aF9pbmZvPXsidGltZXN0YW1wRW5jcnlwdGVkIjoiYjE4NTI2ZThkMjRkZTJiYjczMmM5OTRiZTNkOTBjNzkifSZkdXJhdGlvbj0mdGltZXN0YW1wPTE1NTc2NDQzODY=%22,%22docUrl%22:%22https://www.yuque.com/buhao/blog/fty1nx%22,%22card%22:%22video%22%7D#Byr4b"><img src="https://cdn.nlark.com/yuque/0/2019/jpeg/119443/1556942614120-65b9236d-ef77-4c84-9676-ad5fa15ddcda.jpeg?x-oss-process=image/resize,h_450" alt="000i7wVglx07tueoNRgQ01041200oGDw0E010.mp4 (5.61MB)"></a></p><h4 id="2-时间换收入"><a href="#2-时间换收入" class="headerlink" title="2. 时间换收入"></a>2. 时间换收入</h4><p>for <a href="https://www.yuque.com/ruanyf/share/issue-50">阮一峰</a></p><blockquote><p>前几天，我听一个广播节目。主持人问，现在很多人开网约车，这样能赚多少钱，能够赚到大钱吗？<br>这个问题很容易回答，答案就是不能。出租车司机的收入，主要由营业时间的长短决定。基本上，一天开 12 个小时，就是比开 6 个小时，收入高出一倍。每天只有 24 个小时，因此收入存在上限，不可能偏离平均水平很远。<br>出租车是“时间换收入”的典型行业，投入的时间越多，收入越高，在家休息就没收入。很多行业都属于“时间换收入”，所有此类行业都赚不到大钱。因为你能用来交换的时间是有限的，而且进入中年以后，你就拿不出更多的时间来交换。开出租车赚零花钱，或者作为短期过渡，这是没问题的，但作为终身职业是很糟糕的。<br>我觉得，越来越多的程序员正在落入这个陷井，用编码的时间换取收入。只有不停地做项目，才能拿到钱。项目做得越多，收入越高。这个项目开发完了，公司又让他去干下一个项目。 忙了好几年，项目完成了一大堆，但是自己什么也没留下，以后的收入还要取决于从零开始的新项目。这样的话，你跟出租车司机有何两样，哪一天你不写代码了，不是照样没收入。<br>那些赚到大钱的人，没有一个是靠时间换取收入的。他们要么通过积累资产致富，要么购买他人的时间，为自己创造财富。你应该警惕，不要落入“时间换取收入”的陷井，不要只顾着为别人生产代码，而要注意积累自己的资产，以及适时开展属于自己的业务。</p></blockquote><h4 id="3-积累资产"><a href="#3-积累资产" class="headerlink" title="3. 积累资产"></a>3. 积累资产</h4><p>for <a href="https://www.yuque.com/ruanyf/share/issue-45">阮一峰</a></p><blockquote><p>美国科幻小说大师阿西莫夫，写过一本回忆录《人生舞台》。他在里面提到，成名后，他的收入一年比一年高，完稿时的 1990 年是收入最高的一年。<br>很不幸，1992 年他就去世了，享年 72 岁。据他的妻子说，那一年的收入比 1990 年还要高。也就是说，去世时，他达到了一生最高的年收入。我当时心想，这种收入模式真是太好了。老了以后，收入反而更多了，根本不用为养老发愁。<br>大多数人的收入模式恰恰相反：工作时达到收入的高峰，退休停止工作以后，收入就逐渐减少，人到老年，手头越来越紧。所以，大多数人为了养老，年轻时必须足够储蓄。要是年轻就背负了很多房贷和卡债，老了以后，往往会陷入困境。<br>为什么阿西莫夫老了还有大量收入，其他大多数人就没有呢？原因是普通人的收入，来自出卖自己的时间，老了不工作，自然就没收入了。但是，阿西莫夫的收入来自于他的书，这些著作一再重版，为他带来了一年比一年多的版税收入。再加上，他勤奋写作，每年都有新书问世，自然就收入高了。<br>这件事的启示就是，如果退休以后，还想有稳定的收入保障，最好的方式就是你必须拥有资产。在阿西莫夫的例子里，就是他拥有版权，版权就是一种产生收入的资产。其他类型的资产包括房产、专利、股权等等。总之，年轻时就必须明确，你的工作目标不完全是高收入，更重要的是必须积累资产。</p></blockquote><h4 id="4-衡水出海"><a href="#4-衡水出海" class="headerlink" title="4. 衡水出海"></a>4. 衡水出海</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1557029135875-5712be0c-c7b4-4e1f-913c-45668ef1b29a.png#align=left&display=inline&height=960&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1920&originWidth=1080&size=694194&status=done&style=none&width=540" alt="image.png"></p><h4 id="5-mp4-的起始时间"><a href="#5-mp4-的起始时间" class="headerlink" title="5. mp4 的起始时间"></a>5. mp4 的起始时间</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1557029183279-7b320734-2646-4faf-bb68-7685bd2e47ec.png#align=left&display=inline&height=645&name=image.png&originHeight=1290&originWidth=1080&size=443453&status=done&width=540" alt="image.png"></p><h4 id="6-越独立越薄情"><a href="#6-越独立越薄情" class="headerlink" title="6. 越独立越薄情"></a>6. 越独立越薄情</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1557029217211-e1df264b-ce72-416d-b0a8-74749bf753f0.png#align=left&display=inline&height=153&name=image.png&originHeight=306&originWidth=596&size=159999&status=done&width=298" alt="image.png"></p><h4 id="7-滴滴司机"><a href="#7-滴滴司机" class="headerlink" title="7. 滴滴司机"></a>7. 滴滴司机</h4><p>from <a href="https://wx.zsxq.com/dweb/#/index/8424258282">知识星球</a><br><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1557029269491-3b6c6f91-ba65-4fc8-885a-5f13d0f0532f.png#align=left&display=inline&height=1380&name=image.png&originHeight=2760&originWidth=990&size=643838&status=done&width=495" alt="image.png"></p><h4 id="8-信息流广告"><a href="#8-信息流广告" class="headerlink" title="8. 信息流广告"></a>8. 信息流广告</h4><p>from <a href="https://wx.zsxq.com/dweb/#/index/224555455221">知识星球</a></p><blockquote><p>问：百家号页面很干净，只有右下角一个广告位，还要分钱给作者，百度不是亏死了？<br>答：说一个很颠覆大家认知的，也是最近了解了广告行业才知道的事情。<br>信息流的广告位是最值钱的，因为转化效果最好，大多数广告主投放，都是投信息流广告，比如头条信息流、百度信息流等等。<br>详情页的广告位更便宜，但是转化效果没那么好，所以广告主投放的比较少。<br>对于头条和百度来说，信息流广告位才是最赚钱的，然而鸡贼的是，他们不会分信息流的钱给你，只会分内页的钱给你。#广告知识</p></blockquote><h4 id="9-SCQA"><a href="#9-SCQA" class="headerlink" title="9. SCQA"></a>9. SCQA</h4><p>from <a href="https://mp.weixin.qq.com/s/j3-g1t1R9wF9RlhlN387ew">公众号</a></p><blockquote><p>SCQA 叙事模式各个字母是指：<br>S ：Situation(背景) <br>C ：Complication(冲突)</p></blockquote><blockquote><p>Q ：Question(疑问)</p></blockquote><blockquote><p>A ：Answer(解答)</p></blockquote><blockquote></blockquote><blockquote><p>SCQA 叙事模式能给读者或者观众一个环境、背景，让其置身其中，明白下面要关注的是什么，需要做的是什么，这样他才能更好地去接收你之后的信息。</p></blockquote><blockquote></blockquote><blockquote><p>比如说一个故事是这样讲的：</p></blockquote><blockquote></blockquote><blockquote></blockquote><blockquote><p>“王子说服了国王，迎娶了邻国的公主，他们过上了幸福美满的生活。几个月前，王子跟女巫进行了旷世的决斗，最终杀死了女巫。在这之前，王子每天辛苦练习剑法，用剑的能力不断提升，因为之前这个女巫不允许王子和公主的恋爱，这让王子想要除掉这个女巫。对了，这个故事发生在一个古老的王国。”</p></blockquote><blockquote><p>使用 SCQA 模式之后，故事会变得清晰、条例，听众会觉得更有吸引力：</p></blockquote><blockquote></blockquote><blockquote><p>**S: **从前有一个古老的王国，王子爱上了邻国公主。</p></blockquote><blockquote></blockquote><blockquote><p><strong>C:</strong>  但是邪恶的女巫不允许王子和公主在一起。</p></blockquote><blockquote></blockquote><blockquote><p><strong>Q:</strong>  那怎么办？王子想了各种办法：</p></blockquote><blockquote></blockquote><blockquote><p><strong>A:</strong></p></blockquote><blockquote><p>首先，王子努力提高自己的剑术，获得了和女巫决斗的能力</p></blockquote><blockquote><p>然后，他用激将法刺激了女巫，并与她决战，终于杀死了女巫</p></blockquote><blockquote><p>最后，他说服了国王并最终迎娶了邻国的公主</p></blockquote><blockquote></blockquote><blockquote><p>将 SCQA 运用到技术方案讲解也是一样的，先描述背景，然后说下遇到什么困难，关键是提出好问题让人家思考，最后亮出自己推荐的解决方案，思路顺畅而自然。</p></blockquote><h4 id="10-高考移民"><a href="#10-高考移民" class="headerlink" title="10. 高考移民"></a>10. 高考移民</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1557644336231-6afb4500-48d7-4709-9a1a-05c1af1369d6.png#align=left&display=inline&height=447&name=image.png&originHeight=893&originWidth=1038&size=754254&status=done&width=519" alt="image.png"></p><h4 id="11-让你强大的，终将埋葬你。"><a href="#11-让你强大的，终将埋葬你。" class="headerlink" title="11.  让你强大的，终将埋葬你。"></a>11.  让你强大的，终将埋葬你。</h4><p>from <a href="https://juejin.im/entry/5cd67b5bf265da039d32a138">掘金</a></p><blockquote><p>让你强大的，终将埋葬你。</p></blockquote><h4 id="12-流感"><a href="#12-流感" class="headerlink" title="12. 流感"></a>12. 流感</h4><p>from  尤瓦尔•赫拉利</p><blockquote><p>AI 眼里的爱情，跟一场流感没有区别。</p></blockquote><p>本文地址 <a href="https://blog.coder4j.cn/posts/f8a1a670/">https://blog.coder4j.cn/posts/f8a1a670/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 碎碎念 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JMH 简单入门</title>
      <link href="/posts/b8755310/"/>
      <url>/posts/b8755310/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1545838278500-0e333b6c-2ca5-4a0a-a7d6-59799f11ff91.png#align=left&display=inline&height=480&originHeight=480&originWidth=720&status=done&width=720"></p><h2 id="什么是-JMH"><a href="#什么是-JMH" class="headerlink" title="什么是 JMH"></a>什么是 JMH</h2><p>JMH 是 Java Microbenchmark Harness 的缩写。中文意思大致是 “JAVA 微基准测试套件”。首先先明白什么是“基准测试”。百度百科给的定义如下：</p><blockquote><p><a href="https://baike.baidu.com/item/%E5%9F%BA%E5%87%86%E6%B5%8B%E8%AF%95/5876292">基准测试</a>是指通过设计科学的测试方法、测试工具和测试系统，实现对一类测试对象的某项性能指标进行定量的和可对比的测试。</p></blockquote><p>可以简单的类比成我们电脑常用的鲁大师，或者手机常用的跑分软件安兔兔之类的性能检测软件。都是按一定的基准或者在特定条件下去测试某一对象的的性能，比如显卡、IO、CPU 之类的。</p><h2 id="为什么要使用-JMH"><a href="#为什么要使用-JMH" class="headerlink" title="为什么要使用 JMH"></a>为什么要使用 JMH</h2><p>基准测试的特质有如下几种：</p><blockquote><p><strong>①、可重复性</strong>：可进行重复性的测试，这样做有利于比较每次的测试结果，得到性能结果的长期变化趋势，为系统调优和上线前的容量规划做参考。</p></blockquote><blockquote><p><strong>②、可观测性</strong>：通过全方位的监控（包括测试开始到结束，执行机、服务器、数据库），及时了解和分析测试过程发生了什么。</p></blockquote><blockquote><p><strong>③、可展示性</strong>：相关人员可以直观明了的了解测试结果（web 界面、仪表盘、折线图树状图等形式）。</p></blockquote><blockquote><p><strong>④、真实性</strong>：测试的结果反映了客户体验到的真实的情况（真实准确的业务场景+与生产一致的配置+合理正确的测试方法）。</p></blockquote><blockquote><p><strong>⑤、可执行性</strong>：相关人员可以快速的进行测试验证修改调优（可定位可分析）。</p></blockquote><p>可见要做一次符合特质的基准测试，是很繁琐也很困难的。外界因素很容易影响到最终的测试结果。特别对于 JAVA 的基准测试。</p><p>有些文章会告诉我们 JAVA 是 C++编写的，一般来说 JAVA 编写的程序不太可能比 C++编写的代码运行效率更好。但是 JAVA 在某些场景的确要比 C++运行的更高效。不要觉得天方夜谭。其实 JVM 随着这些年的发展已经变得很智能，它会在运行期间不断的去优化。</p><p>这对于我们程序来说是好事，但是对于性能测试就头疼的。你运行的次数与时间不同可能获得的结果也不同，很难获得一个比较稳定的结果。对于这种情况，有一个解决办法就是大量的重复调用，并且在真正测试前还要进行一定的预热，使结果尽可能的准确。</p><p>除了这些，对于结果我们还需要一个很好的展示，可以让我们通过这些展示结果判断性能的好坏。</p><p><strong>而这些 JMH 都有！</strong>😊</p><h2 id="如何使用-JMH"><a href="#如何使用-JMH" class="headerlink" title="如何使用 JMH"></a>如何使用 JMH</h2><p>下面我们以字符串拼接的几种方法为例子使用 JMH 做基准测试。</p><h3 id="1-导入依赖"><a href="#1-导入依赖" class="headerlink" title="1. 导入依赖"></a>1. 导入依赖</h3><blockquote><p>JMH 是 JDK9 自带的，如果你是 JDK9 之前的版本也可以通过导入 openjdk</p></blockquote><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.openjdk.jmh<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jmh-generator-annprocess<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-目录结构"><a href="#2-目录结构" class="headerlink" title="2. 目录结构"></a>2. 目录结构</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">   ├── main</span><br><span class="line">   │  └── java</span><br><span class="line">   │     └── cn</span><br><span class="line">   │        └── coder4j</span><br><span class="line">   │           └── study</span><br><span class="line">   │              └── demo</span><br><span class="line">   │                 └── jmh</span><br><span class="line">   │                    ├── benchmark</span><br><span class="line">   │                    │  └── StringConnectBenchmark.java</span><br><span class="line">   │                    └── runner</span><br><span class="line">   │                       └── StringBuilderRunner.java</span><br><span class="line">   └── <span class="built_in">test</span></span><br><span class="line">      └── java</span><br><span class="line">         └── cn</span><br><span class="line">            └── coder4j</span><br><span class="line">               └── study</span><br><span class="line">                  └── demo</span><br></pre></td></tr></table></figure><h3 id="3-具体代码"><a href="#3-具体代码" class="headerlink" title="3. 具体代码"></a>3. 具体代码</h3><ul><li>StringBuilderRunner.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * coder4j.cn</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2013-2018 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.demo.jmh.runner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.coder4j.study.demo.jmh.benchmark.StringConnectBenchmark;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.annotations.Mode;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.Runner;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.RunnerException;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.Options;</span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.OptionsBuilder;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> StringBuilderRunner.java, v 0.1 2018-12-25 09:53 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringBuilderRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">( String[] args )</span> <span class="keyword">throws</span> RunnerException </span>&#123;</span><br><span class="line">        Options opt = <span class="keyword">new</span> OptionsBuilder()</span><br><span class="line">                <span class="comment">// 导入要测试的类</span></span><br><span class="line">                .include(StringConnectBenchmark.class.getSimpleName())</span><br><span class="line">                <span class="comment">// 预热5轮</span></span><br><span class="line">                .warmupIterations(<span class="number">5</span>)</span><br><span class="line">                <span class="comment">// 度量10轮</span></span><br><span class="line">                .measurementIterations(<span class="number">10</span>)</span><br><span class="line">                .mode(Mode.Throughput)</span><br><span class="line">                .forks(<span class="number">3</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Runner(opt).run();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>StringConnectBenchmark.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * coder4j.cn</span></span><br><span class="line"><span class="comment"> * Copyright (C) 2013-2018 All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.study.demo.jmh.benchmark;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.openjdk.jmh.annotations.Benchmark;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> StringConnectBenchmark.java, v 0.1 2018-12-25 09:29 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StringConnectBenchmark</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串拼接之 StringBuilder 基准测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringBuilder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="keyword">new</span> StringBuilder().append(<span class="number">1</span>).append(<span class="number">2</span>).append(<span class="number">3</span>).toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串拼接之直接相加基准测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringAdd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="keyword">new</span> String()+ <span class="number">1</span> + <span class="number">2</span> + <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串拼接之String Concat基准测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringConcat</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="keyword">new</span> String().concat(<span class="string">&quot;1&quot;</span>).concat(<span class="string">&quot;2&quot;</span>).concat(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串拼接之 StringBuffer 基准测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringBuffer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        print(<span class="keyword">new</span> StringBuffer().append(<span class="number">1</span>).append(<span class="number">2</span>).append(<span class="number">3</span>).toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 字符串拼接之 StringFormat 基准测试</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Benchmark</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringFormat</span><span class="params">()</span></span>&#123;</span><br><span class="line">        print(String.format(<span class="string">&quot;%s%s%s&quot;</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-运行结果"><a href="#4-运行结果" class="headerlink" title="4. 运行结果"></a>4. 运行结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Run progress: 93.33% complete, ETA 00:00:15</span></span><br><span class="line"><span class="comment"># Fork: 3 of 3</span></span><br><span class="line">objc[12440]: Class JavaLaunchHelper is implemented <span class="keyword">in</span> both /Library/Java/JavaVirtualMachines/jdk1.8.0_91.jdk/Contents/Home/jre/bin/java (0x106a7d4c0) and /Library/Java/JavaVirtualMachines/jdk1.8.0_91.jdk/Contents/Home/jre/lib/libinstrument.dylib (0x106af74e0). One of the two will be used. Which one is undefined.</span><br><span class="line"><span class="comment"># Warmup Iteration   1: 747281.755 ops/s</span></span><br><span class="line"><span class="comment"># Warmup Iteration   2: 924220.081 ops/s</span></span><br><span class="line"><span class="comment"># Warmup Iteration   3: 1129741.585 ops/s</span></span><br><span class="line"><span class="comment"># Warmup Iteration   4: 1135268.541 ops/s</span></span><br><span class="line"><span class="comment"># Warmup Iteration   5: 1062994.936 ops/s</span></span><br><span class="line">Iteration   1: 1142834.160 ops/s</span><br><span class="line">Iteration   2: 1143207.472 ops/s</span><br><span class="line">Iteration   3: 1178363.827 ops/s</span><br><span class="line">Iteration   4: 1156408.897 ops/s</span><br><span class="line">Iteration   5: 1123123.829 ops/s</span><br><span class="line">Iteration   6: 1086029.992 ops/s</span><br><span class="line">Iteration   7: 1108795.147 ops/s</span><br><span class="line">Iteration   8: 1125522.731 ops/s</span><br><span class="line">Iteration   9: 1120021.744 ops/s</span><br><span class="line">Iteration  10: 1119916.181 ops/s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Result <span class="string">&quot;cn.coder4j.study.demo.jmh.benchmark.StringConnectBenchmark.testStringFormat&quot;</span>:</span><br><span class="line">  1132633.183 ±(99.9%) 16252.303 ops/s [Average]</span><br><span class="line">  (min, avg, max) = (1082146.355, 1132633.183, 1182418.648), stdev = 24325.684</span><br><span class="line">  CI (99.9%): [1116380.879, 1148885.486] (assumes normal distribution)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Run complete. Total time: 00:03:57</span></span><br><span class="line"></span><br><span class="line">Benchmark                                  Mode  Cnt          Score         Error  Units</span><br><span class="line">StringConnectBenchmark.testStringAdd      thrpt   30   63728919.269 ±  906608.141  ops/s</span><br><span class="line">StringConnectBenchmark.testStringBuffer   thrpt   30  112423521.098 ± 1157072.848  ops/s</span><br><span class="line">StringConnectBenchmark.testStringBuilder  thrpt   30  110558976.274 ±  654163.111  ops/s</span><br><span class="line">StringConnectBenchmark.testStringConcat   thrpt   30   44820009.200 ±  524305.660  ops/s</span><br><span class="line">StringConnectBenchmark.testStringFormat   thrpt   30    1132633.183 ±   16252.303  ops/s</span><br></pre></td></tr></table></figure><h3 id="5-代码解析"><a href="#5-代码解析" class="headerlink" title="5. 代码解析"></a>5. 代码解析</h3><ul><li>StringBuilderRunner</li></ul><p>这个 runner 类的作用，就是启动基准测试。</p><p>JMH 通常有两种方式启动，一种就是通过命令行使用 maven 命令执行。这种适合对于大型基准测试，像那些要运行很多很多次，并且运行的时间也很长的情况下。你可以直接打个 jar 包，发到服务器上，敲个命令就不用管它，过几十分钟、几小时、几天的时间再回来看结果。</p><p>但是很多情况下，我们只是想简单测试一个小功能，没必要还要搞台服务器去跑。所以 JMH 还提供了一种通过 Main 方法运行的方式，就如上面代码所示。</p><p>在 Main 方法中，通过 org.openjdk.jmh.runner.Runner 类去运行 org.openjdk.jmh.runner.options.Options 实例即可。这里的重点在于 Options 对象的构建。官方提供了一个 OptionsBuilder 对象去构建。这个 Builder 对象是流式的。它的常用方法及对应的注解形式如下：</p><table><thead><tr><th>方法名</th><th>参数</th><th>作用</th><th>对应注解</th></tr></thead><tbody><tr><td>include</td><td>要运行基准测试类的简单名称 eg. StringConnectBenchmark</td><td>指定要运行的基准测试类</td><td>-</td></tr><tr><td>exclude</td><td>不要运行基准测试类的简单名称 eg. StringConnectBenchmark</td><td>指定不要运行的基准测试类</td><td>-</td></tr><tr><td>warmupIterations</td><td>预热的迭代次数</td><td>指定预热的迭代次数</td><td>@Warmup</td></tr><tr><td>warmupBatchSize</td><td>预热批量的大小</td><td>指定预热批量的大小</td><td>@Warmup</td></tr><tr><td>warmupForks</td><td>预热模式：INDI，BULK，BULK_INDI</td><td>指定预热模式</td><td>@Warmup</td></tr><tr><td>warmupMode</td><td>预热的模式</td><td>指定预热的模式</td><td>@Warmup</td></tr><tr><td>warmupTime</td><td>预热的时间</td><td>指定预热的时间</td><td>@Warmup</td></tr><tr><td>measurementIterations</td><td>测试的迭代次数</td><td>指定测试的迭代次数</td><td>@Measurement</td></tr><tr><td>measurementBatchSize</td><td>测试批量的大小</td><td>指定测试批量的大小</td><td>@Measurement</td></tr><tr><td>measurementTime</td><td>测试的时间</td><td>指定测试的时间</td><td>@Measurement</td></tr><tr><td>mode</td><td>测试模式： Throughput（吞吐量）， AverageTime（平均时间），SampleTime（在测试中，随机进行采样执行的时间），SingleShotTime（在每次执行中计算耗时），All</td><td>指定测试的模式</td><td>@BenchmarkMode</td></tr></tbody></table><ul><li>StringConnectBenchmark</li></ul><p>这个就是真正执行基准测试的类，这个类很像单元测试的类，每个测试方法中写上你要执行的测试代码。只不过这里把@Test 换成了@Benchmark 注解。</p><p>而加上了这个就指明这个方法是基准测试方法，当 Runner 类的 Main 方法运行时，它就会找这些被注解修饰的方法，再按指定的规则去进行基准测试。当然可能不同的方法有时候需要不同的规则，这个时间可以通过上面方法对应的注解形式去单独指定某个方法的规则即可。</p><h3 id="6-结果解析"><a href="#6-结果解析" class="headerlink" title="6. 结果解析"></a>6. 结果解析</h3><p>结果主要分成三个部分。</p><p>第一部分以 “#Warmup Iteration。。。。”这种形式的内容。这表明每次预热迭代的结果。</p><p>另一部分以“Iteration。。。”形式内容，这表明每次基准测试迭代的结果。</p><p>最后一部分以“Result。。。”形式的内容，这就是所有迭代跑完最终的结果。第一段结果告诉了我们最大值、最小值、平均值的信息。</p><p>而最最后的表格结构的信息才是我们分析的重点，但是它输出的结果有点错位，刚开始我一直在纠结 Error 是 ±  906608.141 代表什么意思，google 了一圈发现，Error 它其实什么都没输出，而且 Score 是 63728919.269 ±  906608.141。我用表格排板了一下，解释如下：</p><table><thead><tr><th>Benchmark</th><th>Mode</th><th>Cnt</th><th>Score</th><th>Error</th><th>Units</th></tr></thead><tbody><tr><td>基准测试执行的方法</td><td>测试模式，这里是吞吐量</td><td>运行多少次</td><td>分数</td><td>错误</td><td>单位</td></tr><tr><td>StringConnectBenchmark.testStringAdd</td><td>thrpt</td><td>30</td><td>63728919.269 ±  906608.141</td><td></td><td>ops/s</td></tr><tr><td>StringConnectBenchmark.testStringBuffer</td><td>thrpt</td><td>30</td><td>112423521.098 ± 1157072.848</td><td></td><td>ops/s</td></tr><tr><td>StringConnectBenchmark.testStringBuilder</td><td>thrpt</td><td>30</td><td>110558976.274 ±  654163.111</td><td></td><td>ops/s</td></tr><tr><td>StringConnectBenchmark.testStringConcat</td><td>thrpt</td><td>30</td><td>44820009.200 ±  524305.660</td><td></td><td>ops/s</td></tr><tr><td>StringConnectBenchmark.testStringFormat</td><td>thrpt</td><td>30</td><td>1132633.183 ±   16252.303</td><td></td><td>ops/s</td></tr></tbody></table><p>结论：</p><p>StringBuffer  &gt;= StringBuilder &gt; String 直接相加 &gt; StringConcat &gt;&gt; StringFormat</p><p>可见 StringBuffer 与 StringBuilder 大致性能相同，都比直接相加高几个数量级，而且直接相加与 Concat 方法相加差不多。但是这里不管哪种都比 StringFormat 高 N 个数量级。<strong>所以 String 的 Format 方法一定要慎用、不用、禁用！！！</strong></p><h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><ol><li><p><a href="http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/">openjdk 官方 DEMO</a></p></li><li><p><a href="https://github.com/Childe-Chen/goodGoodStudy/tree/master/src/main/java/com/cxd/benchmark">openjdk 官方 DEMO （翻译版）</a></p></li><li><p><a href="https://www.cnblogs.com/imyalost/p/9630843.html">浅谈基准测试</a></p></li><li><p><a href="http://www.blogjava.net/qileilove/archive/2012/07/05/382241.html">什么是基准测试</a></p></li><li><p><a href="https://blog.csdn.net/myjcxd/article/details/83501333">JMH 学习笔记</a>   ← 很不错</p></li><li><p><a href="https://www.jianshu.com/p/bcb0b60c7ca7">使用 JMH 做 JAVA 基准测试</a></p></li><li><p><a href="http://irfen.me/java-jmh-simple-microbenchmark/">JMH 做 JAVA 基准测试</a></p></li></ol><h3 id="代码链接"><a href="#代码链接" class="headerlink" title="代码链接"></a>代码链接</h3><ol><li><a href="https://github.com/kiwiflydream/study-demo/tree/master/study-jmh-demo">DEMO 代码链接</a></li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/b8755310/">https://blog.coder4j.cn/posts/b8755310/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>【碎碎念】01(20190504)</title>
      <link href="/posts/1df65e03/"/>
      <url>/posts/1df65e03/</url>
      
        <content type="html"><![CDATA[<h4 id="1-生命、宇宙以及任何事情的终极答案"><a href="#1-生命、宇宙以及任何事情的终极答案" class="headerlink" title="1. 生命、宇宙以及任何事情的终极答案"></a>1. 生命、宇宙以及任何事情的终极答案</h4><blockquote><p>答案是 42。这其实是一个梗<br>相关链接：&gt; <a href="https://www.yuque.com/buhao/blog/to1mkz/edit">链接</a></p></blockquote><p>####</p><h4 id="2-生存余力理论模型"><a href="#2-生存余力理论模型" class="headerlink" title="2. 生存余力理论模型"></a>2. 生存余力理论模型</h4><p><img src="https://cdn.nlark.com/yuque/__latex/e79364826b9d0bda3038bb618df3a06b.svg#card=math&code=%E7%94%9F%E5%AD%98%E4%BD%99%E5%8A%9B%3D%E7%94%9F%E5%AD%98%E5%8A%9B%E9%87%8F%2F%E7%94%9F%E5%AD%98%E8%B4%9F%E8%BD%BD&height=26&width=222"></p><blockquote><p>相关链接：<a href="https://www.jianshu.com/p/a404ea58ea15">链接</a></p></blockquote><h4 id="3-好人与坏人"><a href="#3-好人与坏人" class="headerlink" title="3. 好人与坏人"></a>3. 好人与坏人</h4><blockquote><p>电视节目习惯把一个人塑造为好人，另一个是坏人，实际上这个世界上没有好人和坏人，只有做了好事的人，和做了坏事的人。                                                                                                                                <br>–《看见》</p></blockquote><h4 id="4-庐山烟雨浙江潮"><a href="#4-庐山烟雨浙江潮" class="headerlink" title="4. 庐山烟雨浙江潮"></a>4. 庐山烟雨浙江潮</h4><blockquote><p>庐山烟雨浙江潮，<br>未到千般恨不消。<br>到得还来别无事，<br>庐山烟雨浙江潮。</p></blockquote><h4 id="5-社会惰性"><a href="#5-社会惰性" class="headerlink" title="5. 社会惰性"></a>5. 社会惰性</h4><blockquote><p>社会上这么多问题，改起来有很多惰性，怎么改？他说，让问题浮出水面，让它“不得不”改变。<br>–《看见》</p></blockquote><h4 id="6-中国人的性格缺乏精确性"><a href="#6-中国人的性格缺乏精确性" class="headerlink" title="6. 中国人的性格缺乏精确性"></a>6. 中国人的性格缺乏精确性</h4><blockquote><p>美国传教士亚瑟·史密斯写过一本书叫《中国人的性格》。他观察到当时的国人有一个强烈的特点是缺乏精确性：“分布在城市边的几个村子，跟城相距一到六里，但每个村子都叫三里屯。”中国的“一串钱”永远不可能是预想的一百文，陕西省是八十三文，直隶是三十三文，“这给诚实的人带来无穷的烦恼”。<br>–《看见》</p></blockquote><h4 id="7-司法弹性"><a href="#7-司法弹性" class="headerlink" title="7. 司法弹性"></a>7. 司法弹性</h4><blockquote><p>司法弹性这么大，还怎么树立权威啊<br>–《看见》</p></blockquote><h4 id="8-淘宝的猥琐发育"><a href="#8-淘宝的猥琐发育" class="headerlink" title="8. 淘宝的猥琐发育"></a>8. 淘宝的猥琐发育</h4><blockquote><p>为了不引起 eBay 的注意，淘宝网在 2003 年里一直声称自己是一个“个人网站”。由于这个创业团队强大的市场开拓和运营能力，淘宝网的发展非常迅猛，2003 年年底就吸引了注册用户 23 万个，每日 31 万个 PV，从 2003 年 5 月到同年年底成交额达 3371 万元。这没有引起 eBay 的注意，却引起了阿里巴巴内部很多员工的注意，他们觉得这个网站以后会成为阿里巴巴强劲的对手，甚至有人在内网发帖，忠告管理层要警惕这个刚刚起步的网站，但管理层似乎无动于衷。（这个团队的保密工作做得真好！）<br>–《淘宝技术这十年》</p></blockquote><h4 id="9-IOE"><a href="#9-IOE" class="headerlink" title="9. IOE"></a>9. IOE</h4><blockquote><p>IBM 小型机、Oracle、EMC 存储</p></blockquote><h4 id="10-标签与类目"><a href="#10-标签与类目" class="headerlink" title="10. 标签与类目"></a>10. 标签与类目</h4><blockquote><p>他说品牌、款式、材质等都可以叫做“属性”，属性是类似 Tag（标签）的一个概念，与类目相比更加离散、灵活，这样也缩减了类目的深度。<br>–《淘宝技术这十年》</p></blockquote><h4 id="11-火车模型"><a href="#11-火车模型" class="headerlink" title="11. 火车模型"></a>11. 火车模型</h4><blockquote><p>他告诉我们一切要以稳定为中心，所有影响系统稳定的因素都要解决掉。例如，每做一个日常修改，都必须对整个系统回归测试一遍；多个日常修改如果放在一个版本中，要是一个功能没有测试通过，整个系统都不能发布。我们把这个叫做“火车模型”，即任何一个乘客没有上车，都不许发车。这样做最直接的后果就是火车一直晚点。<br>–《淘宝技术这十年》</p></blockquote><h4 id="12-工程师分类"><a href="#12-工程师分类" class="headerlink" title="12. 工程师分类"></a>12. 工程师分类</h4><blockquote><p>工程师大致分了类：普通工程师跟着业务跑，来啥需求做啥事；文艺工程师专注于自己的领域，研究得非常精深；2B 工程师跳来跳去，啥都干，啥都浅尝辄止；还有一种工程师叫牛 B 工程师，啥都能干，啥都精通（这种人在工程师心中叫“神”）。<br>–《淘宝技术这十年》</p></blockquote><h4 id="13-一条道走到黑"><a href="#13-一条道走到黑" class="headerlink" title="13. 一条道走到黑"></a>13. 一条道走到黑</h4><blockquote><p>这个世界，坚持也可能是一种一条道走到黑啊。<br>–《你的人生还可以再抢救一下》</p></blockquote><h4 id="14-收藏"><a href="#14-收藏" class="headerlink" title="14. 收藏"></a>14. 收藏</h4><blockquote><p>你别以为是我忘了，我什么也没忘，但是有些事只适合收藏。不能说，也不能想，却又不能忘。它们不能变成语言，它们无法变成语言，一旦变成语言就不再是它们了。<br>–《我与地坛》</p></blockquote><h4 id="15-一步登天"><a href="#15-一步登天" class="headerlink" title="15. 一步登天"></a>15. 一步登天</h4><blockquote><p>1 号和 2 号是病危室，是一步登天的地方<br>–《我与地坛》</p></blockquote><h4 id="16-生命本轻盈"><a href="#16-生命本轻盈" class="headerlink" title="16. 生命本轻盈"></a>16. 生命本轻盈</h4><blockquote><p>我们的生命本来多轻盈，都是被这肉体和各种欲望的污浊给拖住。<br>–《皮囊》</p></blockquote><h4 id="17-希望"><a href="#17-希望" class="headerlink" title="17. 希望"></a>17. 希望</h4><blockquote><p>人生的不可预测，告诉我们在任何时候都要抱着一份希望。<br>      –《朗读者》</p></blockquote><h4 id="18-人生"><a href="#18-人生" class="headerlink" title="18. 人生"></a>18. 人生</h4><blockquote><p>我们的人生，就是一次又一次选择的结果。<br>–《朗读者》</p></blockquote><h4 id="19-历史"><a href="#19-历史" class="headerlink" title="19. 历史"></a>19. 历史</h4><blockquote><p>历史，要用许多不幸和错误去铺路，人类才变得比那些蚂蚁更聪明。人类浩荡前行，在这条路上，不是靠的恨，而是靠的爱……<br>–《朗读者》</p></blockquote><h4 id="20-水和电"><a href="#20-水和电" class="headerlink" title="20. 水和电"></a>20. 水和电</h4><blockquote><p>当时，亚马逊创始人贝佐斯对 2001 年出版的一本名为《创造》的书非常痴迷，让公司高管人人必读。这本书有个理念：最有价值和竞争壁垒、最不可或缺的公司，是那些能够提供类似于水电一样的基础设施服务的公司。<br>–《云端战争 20 年》</p></blockquote><h4 id="21-xx-即服务"><a href="#21-xx-即服务" class="headerlink" title="21. xx 即服务"></a>21. xx 即服务</h4><blockquote><p>IaaS：Infrastructure-as-a-Service(基础设施即服务)<br>PaaS：Platform-as-a-Service(平台即服务)<br>SaaS：Software-as-a-Service(软件即服务)<br>详见：<a href="https://zhuanlan.zhihu.com/p/43216852">链接</a></p></blockquote><h4 id="22-对对对，您说的都对"><a href="#22-对对对，您说的都对" class="headerlink" title="22. 对对对，您说的都对"></a>22. 对对对，您说的都对</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1556934536040-c3a35491-90d3-422f-9842-ed0570784763.png#align=left&display=inline&height=574&name=image.png&originHeight=1148&originWidth=1173&size=1439086&status=done&width=586.5" alt="image.png"></p><h4 id="23-有点娘"><a href="#23-有点娘" class="headerlink" title="23. 有点娘"></a>23. 有点娘</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1556934582328-24d74b3a-d8ac-48ef-bd42-3b1c2bfa8406.png#align=left&display=inline&height=640&name=image.png&originHeight=1280&originWidth=720&size=310014&status=done&width=360" alt="image.png">  《你今天真可爱》</p><h4 id="24-理解灭霸"><a href="#24-理解灭霸" class="headerlink" title="24. 理解灭霸"></a>24. 理解灭霸</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1556934659141-61e5705f-e946-4072-b090-737c08522c2e.png#align=left&display=inline&height=278&name=image.png&originHeight=556&originWidth=1080&size=255428&status=done&width=540" alt="image.png"></p><h4 id="25-从需求打造解决方案"><a href="#25-从需求打造解决方案" class="headerlink" title="25. 从需求打造解决方案"></a>25. 从需求打造解决方案</h4><blockquote><p>从基因和气质来说，亚马逊的技术虽然也很强，但起于电商的亚马逊更习惯直接从市场需求打造解决方案，而不是靠技术或产品创造市场需求。<br>–《云端战争 20 年》</p></blockquote><h4 id="26-规模游戏"><a href="#26-规模游戏" class="headerlink" title="26. 规模游戏"></a>26. 规模游戏</h4><blockquote><p>亚马逊在这种规模的游戏中，比我们这样的竞争者装备得更好，因为他们可以通过核心业务来筹集资金。他们设定了一段很长的不赚钱的时间——他们是为了增长进行再投资。而我们的创新无法跟上这种脚步。<br>–《云端战争 20 年》</p></blockquote><h4 id="27-运气好"><a href="#27-运气好" class="headerlink" title="27. 运气好"></a>27. 运气好</h4><blockquote><p>事情做不完就明天再做吧，运气好的话，明天死了就不用做了！<br>– 冷兔</p></blockquote><h4 id="28-早起也是一种胜利"><a href="#28-早起也是一种胜利" class="headerlink" title="28. 早起也是一种胜利"></a>28. 早起也是一种胜利</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1556934967743-4bf251ec-16b2-4196-9e77-b9598c6c8754.png#align=left&display=inline&height=302&name=image.png&originHeight=604&originWidth=690&size=476647&status=done&width=345" alt="image.png"></p><h4 id="29-好想做一个程序员呀"><a href="#29-好想做一个程序员呀" class="headerlink" title="29. 好想做一个程序员呀"></a>29. 好想做一个程序员呀</h4><p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1556935047132-68135701-7f32-4983-ac76-aede90171764.png#align=left&display=inline&height=855&name=image.png&originHeight=1710&originWidth=598&size=575317&status=done&width=299" alt="image.png"></p><h4 id="30-电影院效应-剧场效应"><a href="#30-电影院效应-剧场效应" class="headerlink" title="30. 电影院效应 / 剧场效应"></a>30. 电影院效应 / 剧场效应</h4><blockquote><p>说法 1：<br>假如在一个座位按传统方式安排的电影院里，大家都在看电影，这个过程中有一个人要去洗手间，如果这个人是坐在靠边的位置，他只要站起来悄悄离开就可以了，但如果这个人是坐在中间的位置，他站起来往外走，则他旁边的人就要给他让路，整排的人都要站起来。<br>同样的人做同样的事，影响的人和引发的场面却不一样，这并不是因为他自身的影响力或素质发生了变化，只是因为他所处的位置不同。正是因为位置不同，所以他做同一件事所影响的范围和场面就发生了完全不同的变化。</p></blockquote><blockquote><p>说法 2：<br>一个剧场，大家都在看戏。每个人都有座位，大家都能看到演员的演出。忽然，有一个观众站起来看戏（可能是为了看的更清楚，也可能因为身高较矮），周围的人劝他坐下，他置若罔闻，求助剧场管理员，管理员却不在岗位。于是，周围的人为了看到演出，也被迫站起来看戏。最后全场的观众都从坐着看戏变成了站着看戏。<br>详见：<a href="http://blog.sina.com.cn/s/blog_65a246c70102x00i.html">链接</a> <a href="https://kknews.cc/zh-my/news/3jv6j5g.html">链接</a></p></blockquote><h4 id="31-边际效应"><a href="#31-边际效应" class="headerlink" title="31. 边际效应"></a>31. 边际效应</h4><blockquote><p>在<a href="https://zh.wikipedia.org/wiki/%E5%BE%AE%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6">微观经济学</a>中，边际效用（英语：marginal utility），又译为边际效应，是指每新增（或减少）一个单位的<a href="https://zh.wikipedia.org/wiki/%E5%95%86%E5%93%81">商品</a>或<a href="https://zh.wikipedia.org/wiki/%E6%9C%8D%E5%8A%A1">服务</a>，它对商品或服务的收益增加（或减少）的<a href="https://zh.wikipedia.org/wiki/%E6%95%88%E7%94%A8">效用</a>，也即是“效用 ── 商品或服务量”图的<a href="https://zh.wikipedia.org/wiki/%E6%96%9C%E7%8E%87">斜率</a>。经济学通常认为，随着商品或服务的量增加，边际效用将会逐步减少，称为<a href="https://zh.wikipedia.org/wiki/%E8%BE%B9%E9%99%85%E6%95%88%E5%BA%94%E9%80%92%E5%87%8F%E5%AE%9A%E5%BE%8B">边际效应递减定律</a>。</p></blockquote><p>– wikipedia</p><blockquote><p>饿了你会想吃饼<br>一个饼要花你一块钱，这一块钱和吃饼花去的时间是你的成本（Cost)</p></blockquote><blockquote><p>吃到饼带来的愉快感，是你的收益（Benefit）</p></blockquote><blockquote><p>收益减去成本</p></blockquote><blockquote><p>就是你的净收益</p></blockquote><blockquote><p>所谓边际收益</p></blockquote><blockquote><p>即是你每多吃一个饼带来的收益</p></blockquote><blockquote><p>吃一个你很开心</p></blockquote><blockquote><p>一块钱花的很值</p></blockquote><blockquote><p>净边际收益很高</p></blockquote><blockquote><p>吃第二个时变得不那么开心</p></blockquote><blockquote><p>一块钱花的没那么值了</p></blockquote><blockquote><p>净边际收益减少</p></blockquote><blockquote><p>你已经有点饱了</p></blockquote><blockquote><p>但是你还是吃了第三个</p></blockquote><blockquote><p>花去的钱和买来的愉快感已基本抵消</p></blockquote><blockquote><p>净边际收益为零</p></blockquote><blockquote><p>硬要吃第四个的话</p></blockquote><blockquote><p>可能就会撑恶心了</p></blockquote><blockquote><p>一块钱花了不如不花</p></blockquote><blockquote><p>这时候净边际收益就是负值了</p></blockquote><blockquote><p>然后你就不会继续吃了</p></blockquote><blockquote></blockquote><blockquote><p>作者：匿名用户</p></blockquote><blockquote><p>链接：<a href="https://www.zhihu.com/question/26415450/answer/32698819">https://www.zhihu.com/question/26415450/answer/32698819</a></p></blockquote><blockquote><p>来源：知乎</p></blockquote><p>本文地址 <a href="https://blog.coder4j.cn/posts/1df65e03/">https://blog.coder4j.cn/posts/1df65e03/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 碎碎念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 碎碎念 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>创建 Java 对象有几种写法？</title>
      <link href="/posts/e292c612/"/>
      <url>/posts/e292c612/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2019/png/119443/1555856125208-739fc957-7fd1-4fbf-b076-736f03247fb5.png#align=left&display=inline&height=198&name=image.png&originHeight=198&originWidth=307&size=42238&status=done&width=307" alt="image.png"></p><blockquote><p>创建 Java 对象，跟”回”字一样也有好几种写法。虽然简单，但是也涉及到了几个 Java 关键的基础知识，比如反射、克隆、序列化与反序列化，所以面试也经常会遇到，然后不断扩展的问。</p></blockquote><h3 id="第一种：通过-new-关键字创建"><a href="#第一种：通过-new-关键字创建" class="headerlink" title="第一种：通过 new 关键字创建"></a>第一种：通过 new 关键字创建</h3><blockquote><p>这一种没啥好说的，从学 Java 第一天就不停的跟两样东西打交道，一个的是 new 关键字，一个是<strong>NullPointerException 😂。代码如下</strong></p></blockquote><h4 id="测试对象代码-Person-java"><a href="#测试对象代码-Person-java" class="headerlink" title="测试对象代码 Person.java"></a>测试对象代码 Person.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.coder4j.blog.demo.code.crete.object.method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.builder.ReflectionToStringBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.builder.ToStringStyle;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 人员类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Cloneable</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 年龄</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(Integer age, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> age value to be assigned to property age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name value to be assigned to property name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ReflectionToStringBuilder.reflectionToString(<span class="keyword">this</span>,</span><br><span class="line">                ToStringStyle.SHORT_PREFIX_STYLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建对象代码"><a href="#创建对象代码" class="headerlink" title="创建对象代码"></a>创建对象代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过 new 关键字去创建对象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNew</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.setAge(<span class="number">18</span>);</span><br><span class="line">    person.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第二种：通过-class-的-newInstance-方法"><a href="#第二种：通过-class-的-newInstance-方法" class="headerlink" title="第二种：通过  class 的  newInstance*() 方法*"></a>第二种：通过  class 的  newInstance*() 方法*</h3><blockquote><p>这里就涉及到了 Java 基础里面的反射知识了，大多数框架也是通过这种方式创建的对象，比如说 spring。通过反射拿到 class 对象，再直接调用 newInstance() 方法就可以直接创建出一个对象。获得 class 对象的方法也有好几种，这里直接通过类来获得。代码如下：</p></blockquote><h4 id="创建对象代码-1"><a href="#创建对象代码-1" class="headerlink" title="创建对象代码"></a>创建对象代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过类反射</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClassReflect</span><span class="params">()</span> <span class="keyword">throws</span> IllegalAccessException, InstantiationException </span>&#123;</span><br><span class="line">    Person person = Person.class.newInstance();</span><br><span class="line">    person.setAge(<span class="number">18</span>);</span><br><span class="line">    person.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第三种：通过-constructor-的-newInstance-方法"><a href="#第三种：通过-constructor-的-newInstance-方法" class="headerlink" title="第三种：通过  constructor 的  newInstance() 方法"></a>第三种：通过  constructor 的  newInstance() 方法</h3><blockquote><p>与第二种方法一样，同样是通过反射。也是拿到 class 对象，不过这里，拿到对象后，又多了一步去拿构造函数。可能有人觉得疑问了，与第二种达到的结果是一样的，但是还要多写一些代码，为什么还要用他。其实对于有无参构造函数的类来说，两种方法都一样，哪个都可以使用。但是是对于只有有参构造函数的类来说，只能使用第三种。因为第二种无法指定构建函数。所以因为大多数框架使用的都是第二种包括 spring，所以当你的 bean 没有无参构造函数时，框架就会报错，他是不会帮你用第三种的。代码如下：</p></blockquote><h4 id="创建对象代码-2"><a href="#创建对象代码-2" class="headerlink" title="创建对象代码"></a>创建对象代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过构建函数反射创建</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchMethodException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalAccessException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvocationTargetException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InstantiationException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConstructReflect</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">    Constructor&lt;Person&gt; constructor = Person.class.getConstructor();</span><br><span class="line">    Person person = constructor.newInstance();</span><br><span class="line">    person.setAge(<span class="number">18</span>);</span><br><span class="line">    person.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过有参构造函数反射创建</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchMethodException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalAccessException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InvocationTargetException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> InstantiationException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testConstructWithParamReflect</span><span class="params">()</span> <span class="keyword">throws</span> NoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException </span>&#123;</span><br><span class="line">    Constructor&lt;Person&gt; constructor = Person.class.getConstructor(Integer.class, String.class);</span><br><span class="line">    Person person = constructor.newInstance(<span class="number">18</span>, <span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(person);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第四种：通过-clone"><a href="#第四种：通过-clone" class="headerlink" title="第四种：通过 clone"></a>第四种：通过 clone</h3><blockquote><p>可以看到 Person.java 实现了接口 Cloneable 并覆盖了 clone 方法（其实只是调用了父类方法），然后调用对象的 clone 方法就可以创建一个一毛一样的对象。需要注意的是这是是浅克隆，啥是浅克隆？浅克隆是指复制出来的对象的所有变量都含有与原来的对象相同的值，而所有的对其他对象的引用仍然指向原来的对象。也就是说修改克隆后的对象中的引用变量，也会导致原对象也产生变化。深克隆反之。代码如下：</p></blockquote><h4 id="创建对象代码-3"><a href="#创建对象代码-3" class="headerlink" title="创建对象代码"></a>创建对象代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过克隆</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException </span>&#123;</span><br><span class="line">    Person person = <span class="keyword">new</span> Person();</span><br><span class="line">    person.setAge(<span class="number">18</span>);</span><br><span class="line">    person.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Person personClone = (Person)person.clone();</span><br><span class="line">    System.out.println(personClone);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="第五种：通过反序列化"><a href="#第五种：通过反序列化" class="headerlink" title="第五种：通过反序列化"></a>第五种：通过反序列化</h3><blockquote><p>序列化与反序列化有很多种，包括 json,xml 其实都是。这里使用的是 java 原生的  Serializable 实现的序列化。很多 rpc 框架，比如 dubbo 使用的就是这种方式，这里需要类实现 jdk 的  Serializable 接口，并且给他一个  <em>serialVersionUID 属性。代码如下：</em></p></blockquote><h4 id="测试对象代码-PersonDto-java"><a href="#测试对象代码-PersonDto-java" class="headerlink" title="测试对象代码 PersonDto.java"></a>测试对象代码 PersonDto.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.coder4j.blog.demo.code.crete.object.method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.builder.ReflectionToStringBuilder;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.builder.ToStringStyle;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 人员类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PersonDto</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">3911118195380172132L</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 年龄</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonDto</span><span class="params">(Integer age, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PersonDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getAge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;age&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> age value to be assigned to property age</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAge</span><span class="params">(Integer age)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Getter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> property value of name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Setter method for property &lt;tt&gt;name&lt;/tt&gt;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name value to be assigned to property name</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ReflectionToStringBuilder.reflectionToString(<span class="keyword">this</span>,</span><br><span class="line">                ToStringStyle.SHORT_PREFIX_STYLE);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="创建对象代码-4"><a href="#创建对象代码-4" class="headerlink" title="创建对象代码"></a>创建对象代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过反序列化</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSerializable</span><span class="params">()</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    PersonDto person = <span class="keyword">new</span> PersonDto();</span><br><span class="line">    person.setAge(<span class="number">18</span>);</span><br><span class="line">    person.setName(<span class="string">&quot;kiwi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把对象序列化</span></span><br><span class="line">    ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;person&quot;</span>));</span><br><span class="line">    oos.writeObject(person);</span><br><span class="line">    oos.close();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 反序列化</span></span><br><span class="line">    ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;person&quot;</span>));</span><br><span class="line">    PersonDto personSeri = (PersonDto) ois.readObject();</span><br><span class="line">    System.out.println(personSeri);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里就说完了，比较常用的几种 Java 对象创建方法了。由此可以看出单例模式是无法保证系统中只有一个对象的。</p></blockquote><p>本文地址 <a href="https://blog.coder4j.cn/posts/e292c612/">https://blog.coder4j.cn/posts/e292c612/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>dubbo 过滤器使用</title>
      <link href="/posts/e57e2db9/"/>
      <url>/posts/e57e2db9/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1537282396426-96544e5f-a1b7-49e0-a244-850912ebbd96.png#width=458"></p><h3 id="什么是-dubbo-过滤器"><a href="#什么是-dubbo-过滤器" class="headerlink" title="什么是 dubbo 过滤器"></a>什么是 dubbo 过滤器</h3><p>学过 servlet 或 spring mvc 的同学都知道有一个叫作过滤器的东西。顾名思义他就是用于过滤的。它本身不产生请求或者响应，它只是修改对某一资源的请求，或者修改某一资源的响应。</p><h3 id="为什么需要-dubbo-过滤器"><a href="#为什么需要-dubbo-过滤器" class="headerlink" title="为什么需要 dubbo 过滤器"></a>为什么需要 dubbo 过滤器</h3><p>对于有些操作，我们可能每个接口都需要使用。比如打印接口调用的请求与响应信息，计算接口调用的时间。或者字符编码的转换。再或者就接口的权限判断。。。不胜枚举。对于这些通用且是大多数接口都会使用的内容。如果在第一个接口里面去实现或者调用，就太过于麻烦。这个时候就可以把它抽到一个调用接口时都会经过的地方去。这个地方就是过滤器。其实可以简单理解成接口层面的 AOP。</p><h3 id="什么时候运行"><a href="#什么时候运行" class="headerlink" title="什么时候运行"></a>什么时候运行</h3><p>一般情况下过滤器不只一个。比如说有一个编码转换的过滤器，一个接口调用日志的过滤器，两个同时存在。因为打印日志时是使用一个固定编码的。所以为了防止打印时不产生乱码，必须要在编码转换过滤器之后运行。这种情况下我们就需要一个顺序。这也就形成了常说的过滤器链。至于如何控制顺序，会在下文介绍。</p><h3 id="在哪种场景下使用"><a href="#在哪种场景下使用" class="headerlink" title="在哪种场景下使用"></a>在哪种场景下使用</h3><blockquote><p>主要是一些通用的操作</p></blockquote><ol><li><p>接口的调用日志打印</p></li><li><p>接口权限判断</p></li><li><p>编码转换</p></li></ol><h3 id="相关角色有哪些"><a href="#相关角色有哪些" class="headerlink" title="相关角色有哪些"></a>相关角色有哪些</h3><p>对于 servlet 来说，一个是接口的调用方比如浏览器，爬虫。。。。，一个是提供的接口。对于 dubbo 来说，一个是生产者，一个是消费者。</p><h3 id="怎么去使用-dubbo-过滤器"><a href="#怎么去使用-dubbo-过滤器" class="headerlink" title="怎么去使用 dubbo 过滤器"></a>怎么去使用 dubbo 过滤器</h3><ol><li>继承<strong>com.alibaba.dubbo.rpc.Filter</strong>并且实现它的 <strong>invoke 方法。</strong></li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.fshows.fsframework.extend.dubbo.filter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.Filter;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.Invocation;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.Invoker;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.Result;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.dubbo.rpc.RpcException;</span><br><span class="line"><span class="keyword">import</span> com.fshows.fsframework.core.utils.SystemClock;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> buhao</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> LogFilter.java, v 0.1 2018-09-18 20:40 buhao</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Result <span class="title">invoke</span><span class="params">(Invoker&lt;?&gt; invoker, Invocation invocation)</span> <span class="keyword">throws</span> RpcException </span>&#123;</span><br><span class="line">        <span class="comment">// 获得 RPC 方法名</span></span><br><span class="line">        String methodName = invoker.getUrl().getPath();</span><br><span class="line">        <span class="comment">// 获得开始时间</span></span><br><span class="line">        <span class="keyword">long</span> startTime = SystemClock.millisClock().now();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印调用前日志</span></span><br><span class="line">        <span class="comment">// 获得参数</span></span><br><span class="line">        Object[] arguments = invocation.getArguments();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">&quot;RPC 接口开始 methodName = &#123;&#125;, agruments = &#123;&#125;&quot;</span>, methodName, arguments);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用接口</span></span><br><span class="line">        Result result = invoker.invoke(invocation);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印调用后日志</span></span><br><span class="line">        <span class="comment">// 抛出的异常</span></span><br><span class="line">        Throwable exception = result.getException();</span><br><span class="line">        <span class="comment">// 返回结果</span></span><br><span class="line">        Object value = result.getValue();</span><br><span class="line">        <span class="comment">// 打印结束日志</span></span><br><span class="line">        <span class="keyword">if</span> (exception != <span class="keyword">null</span>) &#123;</span><br><span class="line">            log.info(<span class="string">&quot;RPC 接口异常结束 methodName = &#123;&#125;,  exception = &#123;&#125;, time = &#123;&#125;ms &quot;</span>, methodName, exception, SystemClock.millisClock().now() - startTime);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.info(<span class="string">&quot;RPC 接口结束 methodName = &#123;&#125;,  result =&#123;&#125;, time = &#123;&#125;ms &quot;</span>, methodName, value, SystemClock.millisClock().now() - startTime);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><p>配置过滤器</p><ol><li><p>在 resources 目录下创建一个名为 META-INF 的目录</p></li><li><p>在 META-INF 的目录下创建一个名为 dubbo 目录</p></li><li><p>在 dubbo 目录下创建一个名为 <strong>com.alibaba.dubbo.rpc.Filter</strong> 的文本文件</p></li><li><p>在文本中配置自定义的过滤器</p></li></ol></li></ol><p>文件目录如下：</p><p><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1537274909108-5f7e2642-b813-432d-95d9-6ee786c57adc.png#width=608"></p><p><strong>com.alibaba.dubbo.rpc.Filter</strong>文件内容如下：</p><blockquote><p>内容： 过滤器名称=过滤器全限定名</p></blockquote><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logFilter=com<span class="selector-class">.fshows</span><span class="selector-class">.fsframework</span><span class="selector-class">.extend</span><span class="selector-class">.dubbo</span><span class="selector-class">.filter</span>.LogFilter</span><br></pre></td></tr></table></figure><blockquote><p>至于为什么要这些写？因为这里使用的是 SPI 机制。类似于 spring 的 IOC,详情可以看<a href="https://juejin.im/post/5b9b1c115188255c5e66d18c">理解的 Java 中 SPI 机制</a></p></blockquote><ol><li>指定过滤器的拦截对象与过滤器顺序</li></ol><blockquote><p>通过@Adaptive 去指定</p></blockquote><ul><li>Adaptive 源码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Activate &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Group过滤条件。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * 包含&#123;<span class="doctag">@link</span> ExtensionLoader#getActivateExtension&#125;的group参数给的值，则返回扩展。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     * 如没有Group设置，则不过滤。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] group() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Key过滤条件。包含&#123;<span class="doctag">@link</span> ExtensionLoader#getActivateExtension&#125;的URL的参数Key中有，则返回扩展。</span></span><br><span class="line"><span class="comment">     * &lt;p/&gt;</span></span><br><span class="line"><span class="comment">     * 示例：&lt;br/&gt;</span></span><br><span class="line"><span class="comment">     * 注解的值 &lt;code&gt;<span class="doctag">@Activate</span>(&quot;cache,validatioin&quot;)&lt;/code&gt;，</span></span><br><span class="line"><span class="comment">     * 则&#123;<span class="doctag">@link</span> ExtensionLoader#getActivateExtension&#125;的URL的参数有&lt;code&gt;cache&lt;/code&gt;Key，或是&lt;code&gt;validatioin&lt;/code&gt;则返回扩展。</span></span><br><span class="line"><span class="comment">     * &lt;br/&gt;</span></span><br><span class="line"><span class="comment">     * 如没有设置，则不过滤。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序信息，可以不提供。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] before() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序信息，可以不提供。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    String[] after() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 排序信息，可以不提供。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">order</span><span class="params">()</span> <span class="keyword">default</span> 0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>用法</p><ul><li><p>指定过滤器使用方</p><pre><code>- group   - 例子 - 指定生产者使用      - ```</code></pre><p>@Activate(group = {Constants.PROVIDER})</p></li></ul></li></ul><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> -<span class="ruby"> 指定特定参数</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">    - value</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">       - 例子 - 指定参数 accessToken=<span class="number">123</span>的参数使用</span></span><br><span class="line"></span><br><span class="line"><span class="ruby">          - <span class="string">``</span><span class="string">`java</span></span></span><br><span class="line"><span class="ruby">@Activate(<span class="string">&quot;accessToken=123&quot;</span>)</span></span><br></pre></td></tr></table></figure><pre><code>     - 例子 - 指定有 accessToken参数使用        - ```java</code></pre><p>@Activate(“accessToken”)</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> - 指定过滤器顺序</span><br><span class="line"></span><br><span class="line">    - order</span><br><span class="line"></span><br><span class="line">       - 例子 - 数字越小优先级越高</span><br><span class="line"></span><br><span class="line">          - ```java</span><br><span class="line">@Activate(<span class="keyword">order</span> <span class="title">= -1</span>)</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://juejin.im/post/5ab0699f6fb9a028c42e0517">Dubbo 过滤器 Filter 的使用及应用场景</a><br><a href="https://juejin.im/post/5b9b1c115188255c5e66d18c">理解的 Java 中 SPI 机制</a><br><a href="http://dubbo.apache.org/zh-cn/docs/dev/SPI.html">dubbo 官方文档-扩展点加载</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/e57e2db9/">https://blog.coder4j.cn/posts/e57e2db9/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>黑客马拉松比赛有感</title>
      <link href="/posts/396c71bd/"/>
      <url>/posts/396c71bd/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1535213291218-8052f245-122f-4adc-be6d-a0222a8e7d68.png#width=747"></p><p>今天有幸参加了公司举办的黑客马拉松，并且取得了第一名的成绩。当然我对这个第一的成绩还是比较心虚的。因为每一组都很优秀。本来已经做好了冲第三保第四的准备（一共四组参赛 😂）。最后能赢真的感到实在太意外了。心情只能用下图去表达</p><p><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1535213679393-fe8889d6-e3e7-4ffa-849b-45be3f96922d.png#width=492"></p><p>但是总体下来还是有一些个人的感悟。评委给的评价是，我们这一组是参赛组内完成度最高的一组，也是 ppt 演讲过程中逻辑最清楚的一个。<br>当然 ppt 演讲逻辑清晰这个最大的功劳当然是 MVP 张贤，人称首展贾跃亭。而功能完成度最高，我想很大一部分是我们更在意效率。<br>因为从一开始我们就知道我们根本不占优势。参加比赛没有语言限制，而且在只有 8 个小时的时间内开发。所以我们跟一同参赛的 PHPer 比，已经输在了起跑线上。所以我们没有按均衡的角色去组队。而是 2 名 java 开发 1 名前端 1 名测试 1 名 UI。2 名 java 是为了能用人数弥补语言开发效率上的不足。而测试跟 UI 也是比较偏产品的同学。<br>另一个重要的原因是我们引入了一个 java 开发脚手架，并同时使用了一些代码的自动生成。这使得效率大大的提高。这可以使得开发有更多的时间去优化，比如在前端来不及的情况下，浩翔一个人写完了整个后台。<br><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1535215540578-2f5ce0fe-c11f-49ad-bf46-11fb746e08d3.png#width=747"><br>还有一个关键点我觉得是我们方向比较清晰与明确。因为从一开始我们就有了标准答案–蚂蚁微客。而且知道蚂蚁微客也是在一次很偶然的机会收到支付宝的推送。然后当时也没在意。然后上面说的 java 脚手架也是偶然看到，从来没有使用过。但是正如乔帮主所说生活中的点滴会在你未来的某一天产生联系。<br>所以趁着年轻，多学点知识，多认识点人，多去一些地方。可能就在未来的某一刻，他们就像珍珠一样点点滴滴的串联起来成为你生命中最美好的记忆。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/396c71bd/">https://blog.coder4j.cn/posts/396c71bd/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>jvm 运行时数据区域</title>
      <link href="/posts/3c225cb5/"/>
      <url>/posts/3c225cb5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>根据《Java 虚拟机规范》的规定，Java 虚拟机所管理的内存将会包括如下几个运行时数据区域</p></blockquote><h3 id="思维导图"><a href="#思维导图" class="headerlink" title="思维导图"></a>思维导图</h3><p><img src="https://cdn.nlark.com/yuque/0/2018/png/119443/1534660000696-28eff01e-7db1-4bef-8900-5afa0e1fb00f.png"></p><h3 id="程序计数器"><a href="#程序计数器" class="headerlink" title="程序计数器"></a>程序计数器</h3><h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><ul><li>字节码行号指示器</li></ul><blockquote><p>程序计数器是一块较小的内存空间，它等同于当前执行字节码的行号指示器。字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令，分支、循环、跳转、异常处理、线程恢复等功能都依赖于计数器。</p></blockquote><h4 id="线程存储"><a href="#线程存储" class="headerlink" title="线程存储"></a>线程存储</h4><ul><li>线程私有</li></ul><blockquote><p>因为 JAVA 的多线程是通过线程的轮流切换并分配处理器时间的方式来实现的，因此，为了线程切换后能恢复到正确的执行位置，每条线程都要一个独立的程序计数器，所以是线程私有的。</p></blockquote><h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><blockquote><p>如果线程执行的是 JAVA 方法，这个计数器保存的就是正在执行的虚拟机字节码指令的地址。如果执行的是 Native 方法，计数器保存值为空。</p></blockquote><h4 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h4><ul><li>无</li></ul><blockquote><p>是唯一一个规范中没有规定的任何 OutOfMemoryError 情况的区域。</p></blockquote><h3 id="JAVA-虚拟机栈"><a href="#JAVA-虚拟机栈" class="headerlink" title="JAVA 虚拟机栈"></a>JAVA 虚拟机栈</h3><h4 id="作用-1"><a href="#作用-1" class="headerlink" title="作用"></a>作用</h4><blockquote><p>虚拟机栈描述的是 Java 方法执行的内存模型：每个方法在执行的同时都会创建一个栈帧用于存储局部变量表、操作数栈、动态链接、方法出口等信息。每一个方法从调用直至执行完成的过程，就对应着一个栈帧在虚拟机栈中入栈到出栈的过程。<br>局部变量表存放了编译期可知的各种基本数据类型、对象引用和 returnAddress 类型（指向了一条字节码指令的地址）</p></blockquote><h4 id="线程存储-1"><a href="#线程存储-1" class="headerlink" title="线程存储"></a>线程存储</h4><ul><li>线程私有</li></ul><h4 id="注意-1"><a href="#注意-1" class="headerlink" title="注意"></a>注意</h4><blockquote><p>局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。</p></blockquote><h4 id="异常-1"><a href="#异常-1" class="headerlink" title="异常"></a>异常</h4><ul><li><p>StackOverflowError</p><ul><li>原因<blockquote><p>如果线程请求的栈深度大于虚拟机所允许的深度，就会抛出</p></blockquote></li></ul></li><li><p>OutOfMemoryError</p><ul><li>原因<blockquote><p>如果虚拟机栈可以动态扩展，扩展时无法申请到足够的内存，就会抛出</p></blockquote></li></ul></li></ul><h3 id="本地方法栈"><a href="#本地方法栈" class="headerlink" title="本地方法栈"></a>本地方法栈</h3><h4 id="作用-2"><a href="#作用-2" class="headerlink" title="作用"></a>作用</h4><blockquote><p>与 Java 虚拟机栈功能几乎一致，只是一个是运行 JAVA 方法，一个运行 Native 方法。有些虚拟机会直接把这两个栈合二为一（HotSpot）</p></blockquote><h4 id="线程存储-2"><a href="#线程存储-2" class="headerlink" title="线程存储"></a>线程存储</h4><ul><li>线程私有</li></ul><h4 id="注意-2"><a href="#注意-2" class="headerlink" title="注意"></a>注意</h4><blockquote><p>局部变量表所需的内存空间在编译期间完成分配，当进入一个方法时，这个方法需要在帧中分配多大的局部变量空间是完全确定的，在方法运行期间不会改变局部变量表的大小。</p></blockquote><h4 id="异常-2"><a href="#异常-2" class="headerlink" title="异常"></a>异常</h4><ul><li><p>StackOverflowError</p><ul><li>原因<blockquote><p>如果线程请求的栈深度大于虚拟机所允许的深度，就会抛出</p></blockquote></li></ul></li><li><p>OutOfMemoryError</p><ul><li>原因<blockquote><p>如果虚拟机栈可以动态扩展，扩展时无法申请到足够的内存，就会抛出</p></blockquote></li></ul></li></ul><h3 id="JAVA-堆"><a href="#JAVA-堆" class="headerlink" title="JAVA 堆"></a>JAVA 堆</h3><h4 id="作用-3"><a href="#作用-3" class="headerlink" title="作用"></a>作用</h4><blockquote><p>是虚拟机管理的内存中最大的一块。唯一的作用就是存放对象实例。</p></blockquote><h4 id="线程存储-3"><a href="#线程存储-3" class="headerlink" title="线程存储"></a>线程存储</h4><ul><li>线程共有</li></ul><h4 id="注意-3"><a href="#注意-3" class="headerlink" title="注意"></a>注意</h4><blockquote><p>由于收集器基本上都采用分代收集算法，所以 JAVA 堆中还可以细分为：新生代和老年代；再细致一点的有 Eden 空间、From Surviror 空间、To Surviror 空间</p></blockquote><h4 id="异常-3"><a href="#异常-3" class="headerlink" title="异常"></a>异常</h4><ul><li><p>OutOfMemoryError</p><ul><li>原因</li></ul></li></ul><blockquote><p>如果在堆中没有内存完成实例分配，并且堆也无法再扩展时，将会抛出 OutOfMemoryError 异常。</p></blockquote><h3 id="方法区"><a href="#方法区" class="headerlink" title="方法区"></a>方法区</h3><h4 id="作用-4"><a href="#作用-4" class="headerlink" title="作用"></a>作用</h4><blockquote><p>用于存储已被虚拟机加载 的类信息、常量、静态变量、即时编译器后的代码等数据。</p></blockquote><h4 id="线程存储-4"><a href="#线程存储-4" class="headerlink" title="线程存储"></a>线程存储</h4><ul><li>线程共有</li></ul><h4 id="注意-4"><a href="#注意-4" class="headerlink" title="注意"></a>注意</h4><blockquote><p>也有人称之为『永久代』，本质上两者并不等价，只是有些虚拟机实现时把用永久代实现方法区而已。</p></blockquote><h4 id="异常-4"><a href="#异常-4" class="headerlink" title="异常"></a>异常</h4><ul><li><p>OufOfMemoryError</p><ul><li>原因</li></ul></li></ul><blockquote><p>当方法区无法满足内存分配需求时，将抛出</p></blockquote><h3 id="运行时常量池（方法区的一部分）"><a href="#运行时常量池（方法区的一部分）" class="headerlink" title="运行时常量池（方法区的一部分）"></a>运行时常量池（方法区的一部分）</h3><h4 id="作用-5"><a href="#作用-5" class="headerlink" title="作用"></a>作用</h4><blockquote><p>是方法区的一部分。Class 文件中除了有类的版本、字段、方法、接口等描述信息外，还有一项信息是常量池，用于存入编译期生成的各种字面量和符号引用，这部分内容将在类加载后进入方法区的运行时常量池中存入。</p></blockquote><h4 id="线程存储-5"><a href="#线程存储-5" class="headerlink" title="线程存储"></a>线程存储</h4><ul><li>线程共有</li></ul><h4 id="注意-5"><a href="#注意-5" class="headerlink" title="注意"></a>注意</h4><blockquote><p>Java 语言并不要常量一定只有编译期才能产生，也就是并非预置入 Class 文件中常量池的内容才能进入方法区运行时常量池，运行期间也可以，比如 String 类的 intern()方法</p></blockquote><h4 id="异常-5"><a href="#异常-5" class="headerlink" title="异常"></a>异常</h4><ul><li><p>OutOfMemoryError</p><ul><li>原因</li></ul></li></ul><blockquote><p>当常量池无法再申请到内存时就会抛出</p></blockquote><p>本文地址 <a href="https://blog.coder4j.cn/posts/3c225cb5/">https://blog.coder4j.cn/posts/3c225cb5/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot 集成 redis</title>
      <link href="/posts/e1ce5e4c/"/>
      <url>/posts/e1ce5e4c/</url>
      
        <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--集成redis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">######################redis配置#########################</span><br><span class="line"># REDIS (RedisProperties)</span><br><span class="line"># Redis数据库索引（默认为<span class="number">0</span>）</span><br><span class="line">spring.redis.database=<span class="number">0</span></span><br><span class="line"># Redis服务器地址</span><br><span class="line">spring.redis.host=localhost</span><br><span class="line"># Redis服务器连接端口</span><br><span class="line">spring.redis.port=<span class="number">6379</span></span><br><span class="line"># Redis服务器连接密码（默认为空）</span><br><span class="line">spring.redis.password=</span><br><span class="line"># 连接池最大连接数（使用负值表示没有限制）</span><br><span class="line">spring.redis.pool.max-active=<span class="number">8</span></span><br><span class="line"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span><br><span class="line">spring.redis.pool.max-wait=<span class="number">-1</span></span><br><span class="line"># 连接池中的最大空闲连接</span><br><span class="line">spring.redis.pool.max-idle=<span class="number">8</span></span><br><span class="line"># 连接池中的最小空闲连接</span><br><span class="line">spring.redis.pool.min-idle=<span class="number">0</span></span><br><span class="line"># 连接超时时间（毫秒）</span><br><span class="line">spring.redis.timeout=<span class="number">0</span></span><br></pre></td></tr></table></figure><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"><span class="meta">@Resource</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;<span class="built_in">String</span>, Users&gt; redisTemplate;</span><br></pre></td></tr></table></figure><blockquote><p>然后就可以在类里使用了，使用泛型的时候如果用@Autowired 按类型注入会报错，要用@Resource</p></blockquote><p><em>如果方法想用缓存，要在配置类上加上@EnableCaching 打开缓存，并且要在方法上加上@Cacheable(value = “getByUsername”)</em></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/e1ce5e4c/">https://blog.coder4j.cn/posts/e1ce5e4c/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>spring-boot 不使用parent POM</title>
      <link href="/posts/66a29cf2/"/>
      <url>/posts/66a29cf2/</url>
      
        <content type="html"><![CDATA[<ul><li>一般情况下，推荐使用 parent 标签去继承</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.2.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!--这里不能使用标签引用，必须写死，maven的bug?--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>如果不想用继承的方法，可以使用 import</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-dependencies<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;sprint.boot.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/66a29cf2/">https://blog.coder4j.cn/posts/66a29cf2/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>spring boot 生成 war 包</title>
      <link href="/posts/69a2a230/"/>
      <url>/posts/69a2a230/</url>
      
        <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--spring boot 内置了tomcat，所以我们没有tomcat也可以直接通过jar运行，如果想通过常规的war来部署就在这里移除tomcat就可以了--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                &lt;exclusion&gt;</span></span><br><span class="line"><span class="comment">                    &lt;artifactId&gt;spring-boot-starter-tomcat&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">                    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">                &lt;/exclusion&gt;--&gt;</span></span><br><span class="line">                <span class="comment">&lt;!--spring boot 内置的日志是slf4j与logback,如果想用log4j就移除，并添加相应依赖就可以了--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/69a2a230/">https://blog.coder4j.cn/posts/69a2a230/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux ssh 相关操作</title>
      <link href="/posts/d500547b/"/>
      <url>/posts/d500547b/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ssh 相关的，都是修改/etc/ssh/sshd_config<br>文件修改要重启 sshd 生效<br>/etc/init.d/sshd restart</p></blockquote><h3 id="修改-SSH-默认端口"><a href="#修改-SSH-默认端口" class="headerlink" title="修改 SSH 默认端口"></a>修改 SSH 默认端口</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Port xxxx</span></span><br></pre></td></tr></table></figure><h3 id="指定用户连接"><a href="#指定用户连接" class="headerlink" title="指定用户连接"></a>指定用户连接</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">AllowUsers</span> user<span class="number">1</span>,user<span class="number">2</span>,user<span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="禁止-root-连接"><a href="#禁止-root-连接" class="headerlink" title="禁止 root 连接"></a>禁止 root 连接</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PermitRootLogin</span> <span class="literal">no</span></span><br></pre></td></tr></table></figure><h3 id="ip-白名单"><a href="#ip-白名单" class="headerlink" title="ip 白名单"></a>ip 白名单</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">修改 <span class="regexp">/etc/</span>hosts.allow</span><br></pre></td></tr></table></figure><h3 id="重启-ssh"><a href="#重启-ssh" class="headerlink" title="重启 ssh"></a>重启 ssh</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">service sshd restart</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/d500547b/">https://blog.coder4j.cn/posts/d500547b/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>idea 常用配置</title>
      <link href="/posts/5789550e/"/>
      <url>/posts/5789550e/</url>
      
        <content type="html"><![CDATA[<h3 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a>全局配置</h3><blockquote><p>File –&gt; Other Settings –&gt; Default Settings</p></blockquote><h3 id="设置代码编辑视图的行号显示"><a href="#设置代码编辑视图的行号显示" class="headerlink" title="设置代码编辑视图的行号显示"></a>设置代码编辑视图的行号显示</h3><blockquote><p>Editor -&gt; General -&gt; Appearance，勾选 show line numbers。</p></blockquote><h3 id="代码自动补全忽略大小写"><a href="#代码自动补全忽略大小写" class="headerlink" title="代码自动补全忽略大小写"></a>代码自动补全忽略大小写</h3><blockquote><p>Editor -&gt; General -&gt; Code Completion -&gt; Case sensitive completion -&gt; 下拉选择 None</p></blockquote><h3 id="关闭单词拼写检查"><a href="#关闭单词拼写检查" class="headerlink" title="关闭单词拼写检查"></a>关闭单词拼写检查</h3><blockquote><p>Editor -&gt; Spelling -&gt; Typo，设置 Options，去掉去掉勾选 Process code、Procss literals、Process comments。</p></blockquote><h3 id="设置字体"><a href="#设置字体" class="headerlink" title="设置字体"></a>设置字体</h3><blockquote><p>首先， Editor -&gt; Colors &amp; Fonts，Scheme 点击 Save As…按钮，输入另存为字体配置的名称，点击 OK 按钮。<br>再设置，Editor -&gt; Colors &amp; Fonts -&gt; Font，取消勾选 show only monospaced fonts，Primary font 设置为 Monaco(Monaco 字体需要系统已安装该字体)，Size 设置为 14。点击 OK 按钮完成字体样式及大小设置。</p></blockquote><h3 id="编码设置"><a href="#编码设置" class="headerlink" title="编码设置"></a>编码设置</h3><blockquote><p>由于需要避免乱码问题，我们通常情况会将编码统一为 UTF-8。<br>Editor -&gt; File Encodings，将 IDE Encoding、Project Encoding、Default Encoding for properties files，全部设置为 UTF-8。并且勾选 Default Encoding for properties files 后面的 Transparent natice-to-ascii conversion，点击 OK 按钮完成设置。</p></blockquote><h3 id="过滤文件夹及目录类型"><a href="#过滤文件夹及目录类型" class="headerlink" title="过滤文件夹及目录类型"></a>过滤文件夹及目录类型</h3><blockquote><p>Editor -&gt; File Types，Ignore files and folders 过滤列表输入框中添加.iml;.idea;_.gradle;_build;<br>各个过滤项之间以分号( ; )隔开。</p></blockquote><h3 id="生成序列化-serialVersionUID"><a href="#生成序列化-serialVersionUID" class="headerlink" title="生成序列化 serialVersionUID"></a>生成序列化 serialVersionUID</h3><blockquote><p>Editor -&gt; Inspections -&gt; Java -&gt; Serialization issues，勾选 Serializable class without ‘serialVersionUID’，至此以后，在你的 Java 类实现 java.io.Serializable 接口时，使用快捷键 Alt+Enter 就会提示 add ‘serialVersionUID’ field，自动创建 serialVersionUID 了。</p></blockquote><h3 id="配置-Java-编译版本"><a href="#配置-Java-编译版本" class="headerlink" title="配置 Java 编译版本"></a>配置 Java 编译版本</h3><blockquote><p>Build，Execution，Deployment -&gt; Compiler -&gt; Java Compiler，设置 Use Cimpiler 为 javac，Project bytecode version(leave blank for JDK default)下拉列表选中 1.8(需要设置的 JDK 编译版本)，点击 OK 按钮完成设置。</p></blockquote><h3 id="备份-IDEA-全局配置"><a href="#备份-IDEA-全局配置" class="headerlink" title="备份 IDEA 全局配置"></a>备份 IDEA 全局配置</h3><blockquote><p>IDEA 主界面，点击菜单 File，选择 Export Settings，选择导出全部配置文件存放目录，点击 OK 按钮完成导出。</p></blockquote><h3 id="导入备份的-IDEA-全局配置"><a href="#导入备份的-IDEA-全局配置" class="headerlink" title="导入备份的 IDEA 全局配置"></a>导入备份的 IDEA 全局配置</h3><blockquote><p>IDEA 主界面，点击菜单 File，选择 Import Settings，选择导出全部配置文件存放目录的 settings.jar 配置备份文件，点击 OK 按钮完成导入。</p></blockquote><h3 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h3><p><a href="http://www.oschina.net/question/948439_243781">intellij IDEA 如何设置默认的 maven 配置？</a><br><a href="http://blog.csdn.net/eugeneheen/article/details/50370334">IntelliJ IDEA15 简要使用手册</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/5789550e/">https://blog.coder4j.cn/posts/5789550e/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>git 常用命令</title>
      <link href="/posts/48e28a7b/"/>
      <url>/posts/48e28a7b/</url>
      
        <content type="html"><![CDATA[<h3 id="添加远程库"><a href="#添加远程库" class="headerlink" title="添加远程库"></a>添加远程库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add xxx</span><br></pre></td></tr></table></figure><h3 id="第一次提交"><a href="#第一次提交" class="headerlink" title="第一次提交"></a>第一次提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="强制提交"><a href="#强制提交" class="headerlink" title="强制提交"></a>强制提交</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f origin master</span><br></pre></td></tr></table></figure><h3 id="同时提交两个远程库"><a href="#同时提交两个远程库" class="headerlink" title="同时提交两个远程库"></a>同时提交两个远程库</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; vim .git/config</span><br><span class="line">&gt; [remote <span class="string">&quot;web&quot;</span>]</span><br><span class="line">&gt; url = ssh://server.example.org/home/ams/website.git</span><br><span class="line">&gt; url = ssh://other.exaple.org/home/foo/website.git</span><br></pre></td></tr></table></figure><h3 id="查看本地配置的远程仓库"><a href="#查看本地配置的远程仓库" class="headerlink" title="查看本地配置的远程仓库"></a>查看本地配置的远程仓库</h3><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">git remote -v</span></span><br></pre></td></tr></table></figure><h3 id="删除原来的远程分支"><a href="#删除原来的远程分支" class="headerlink" title="删除原来的远程分支"></a>删除原来的远程分支</h3><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="built_in">remove</span> <span class="built_in">origin</span></span><br></pre></td></tr></table></figure><h3 id="关联新的远程仓库"><a href="#关联新的远程仓库" class="headerlink" title="关联新的远程仓库"></a>关联新的远程仓库</h3><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote <span class="keyword">add</span><span class="bash"> origin url</span></span><br></pre></td></tr></table></figure><h3 id="本地分支关联远程分支"><a href="#本地分支关联远程分支" class="headerlink" title="本地分支关联远程分支"></a>本地分支关联远程分支</h3><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch --<span class="keyword">set</span>-upstream-<span class="keyword">to</span>=origin/xxx</span><br></pre></td></tr></table></figure><h3 id="新库操作"><a href="#新库操作" class="headerlink" title="新库操作"></a>新库操作</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">Git global setup</span><br><span class="line"></span><br><span class="line">git config --global user.name &quot;KiwiFly&quot;</span><br><span class="line">git config --global user.email &quot;xx@qq.com&quot;</span><br><span class="line"></span><br><span class="line">Create a new repository</span><br><span class="line"></span><br><span class="line">git clone git@xx.com:Java/abc.git</span><br><span class="line">cd fs_saledian_lovelife</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;add README&quot;</span><br><span class="line">git push -u origin master</span><br><span class="line"></span><br><span class="line">Existing folder or Git repository</span><br><span class="line"></span><br><span class="line">cd existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@xx.com:Java/abc.git</span><br><span class="line">git add .</span><br><span class="line">git commit</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure><h3 id="创建公钥"><a href="#创建公钥" class="headerlink" title="创建公钥"></a>创建公钥</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;your_email@youremail.com&quot;</span></span><br></pre></td></tr></table></figure><h2 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h2><ol><li>error: failed to push some refs to</li></ol><ul><li><p>原因</p><ul><li><blockquote><p>这个问题是因为远程库与本地库不一致造成的，那么我们把远程库同步到本地库就可以了。</p></blockquote></li></ul></li><li><p>解决</p></li></ul><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull <span class="comment">--rebase origin master</span></span><br></pre></td></tr></table></figure><ul><li>引用</li></ul><p><a href="https://blog.csdn.net/MBuger/article/details/70197532">链接</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/48e28a7b/">https://blog.coder4j.cn/posts/48e28a7b/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>常用服务安装(原生)</title>
      <link href="/posts/37c69c79/"/>
      <url>/posts/37c69c79/</url>
      
        <content type="html"><![CDATA[<h3 id="centos-7-安装-docker"><a href="#centos-7-安装-docker" class="headerlink" title="centos 7 安装 docker"></a>centos 7 安装 docker</h3><ol><li>安装 docker</li></ol><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> docker</span><br></pre></td></tr></table></figure><ol start="2"><li>启动并开机自启 docker</li></ol><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span>  <span class="selector-tag">start</span> <span class="selector-tag">docker</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span>  <span class="selector-tag">enable</span> <span class="selector-tag">docker</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure><p><a href="https://linux.cn/article-4340-1.html">centos 安装 docker</a></p><h3 id="安装-docker-compose"><a href="#安装-docker-compose" class="headerlink" title="安装 docker-compose"></a>安装 docker-compose</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></table></figure><h3 id="安装-JDK"><a href="#安装-JDK" class="headerlink" title="安装 JDK"></a>安装 JDK</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget</span><br><span class="line">http://111.1.14.201/files/6036000006C14836/download.oracle.com/otn-pub/java/jdk/8u172-b11/a58eab1ec242421181065cdc37240b08/jdk-8u172-linux-x64.rpm</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 RPM 包</span></span><br><span class="line">rpm -i xx.rpm</span><br></pre></td></tr></table></figure><h3 id="安装-GIT"><a href="#安装-GIT" class="headerlink" title="安装 GIT"></a>安装 GIT</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install git-core</span><br></pre></td></tr></table></figure><h3 id="安装-MAVEN"><a href="#安装-MAVEN" class="headerlink" title="安装 MAVEN"></a>安装 MAVEN</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget</span><br><span class="line">http://repos.fedorapeople.org/repos/dchen/apache-maven/epel-apache-maven.repo</span><br><span class="line"> -O /etc/yum.repos.d/epel-apache-maven.repo</span><br><span class="line">yum -y install apache-maven</span><br></pre></td></tr></table></figure><h3 id="安装-ftp-客户端"><a href="#安装-ftp-客户端" class="headerlink" title="安装 ftp 客户端"></a>安装 ftp 客户端</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install ftp</span><br></pre></td></tr></table></figure><h3 id="安装-rz"><a href="#安装-rz" class="headerlink" title="安装 rz"></a>安装 rz</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install lrzsz</span><br></pre></td></tr></table></figure><h3 id="安装-nginx"><a href="#安装-nginx" class="headerlink" title="安装 nginx"></a>安装 nginx</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/helloxz/nginx-cdn/master/nginx.sh &amp;&amp; bash nginx.sh</span><br></pre></td></tr></table></figure><h3 id="安装-redis"><a href="#安装-redis" class="headerlink" title="安装 redis"></a>安装 redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装</span></span><br><span class="line">sudo yum -y install redis</span><br><span class="line"><span class="comment"># 启动</span></span><br><span class="line">sudo systemctl start redis</span><br><span class="line"><span class="comment"># 修改配置</span></span><br><span class="line">vi /etc/redis.conf</span><br><span class="line"><span class="comment"># 注释本地访问</span></span><br><span class="line"><span class="comment">#bind 127.0.0.1</span></span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line">requirepass 密码</span><br><span class="line"><span class="comment"># 其它常用命令</span></span><br><span class="line">systemctl start redis.service <span class="comment">#启动redis服务器</span></span><br><span class="line">systemctl stop redis.service <span class="comment">#停止redis服务器</span></span><br><span class="line">systemctl restart redis.service <span class="comment">#重新启动redis服务器</span></span><br><span class="line">systemctl status redis.service <span class="comment">#获取redis服务器的运行状态</span></span><br><span class="line">systemctl <span class="built_in">enable</span> redis.service <span class="comment">#开机启动redis服务器</span></span><br><span class="line">systemctl <span class="built_in">disable</span> redis.service <span class="comment">#开机禁用redis服务器</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/37c69c79/">https://blog.coder4j.cn/posts/37c69c79/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>常用服务安装(docker)</title>
      <link href="/posts/b1229581/"/>
      <url>/posts/b1229581/</url>
      
        <content type="html"><![CDATA[<ol><li>mariadb</li></ol><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> --name db --env <span class="attribute">MYSQL_PASSWORD</span>=example -d mariadb</span><br></pre></td></tr></table></figure><ol><li>wordpress</li></ol><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --MyWordPress --link db:mysql -p <span class="number">8080</span>:<span class="number">80</span> -d wordpress</span><br></pre></td></tr></table></figure><ol><li>postgresql</li></ol><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker </span><span class="string">run </span><span class="built_in">--postgresql</span> -d \</span><br><span class="line"><span class="built_in">--env</span> <span class="string">&#x27;DB_NAME=gitlabhq_production&#x27;</span> \</span><br><span class="line"><span class="built_in">--env</span> <span class="string">&#x27;DB_USER=gitlab&#x27;</span> \</span><br><span class="line"><span class="built_in">--env</span> <span class="string">&#x27;DB_PASS=password&#x27;</span> \</span><br><span class="line"><span class="string">sameersbn/</span><span class="string">postgresql:9.</span><span class="string">4-12</span></span><br></pre></td></tr></table></figure><ol><li>redis</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">run</span> <span class="comment">--name redis -d sameersbn/redis:latest</span></span><br></pre></td></tr></table></figure><ol><li>gitlab</li></ol><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker </span><span class="string">run </span><span class="built_in">--name</span> <span class="string">gitlab </span>-d \</span><br><span class="line"><span class="built_in">--link</span> <span class="string">postgresql:postgresql </span>\</span><br><span class="line"><span class="built_in">--link</span> <span class="string">redis:redisio </span>\</span><br><span class="line"><span class="built_in">--publish</span> <span class="string">10022:22 </span>\</span><br><span class="line"><span class="built_in">--publish</span> <span class="string">10080:80 </span>\</span><br><span class="line"><span class="built_in">--env</span> <span class="string">&#x27;GITLAB_PORT=10080&#x27;</span> \</span><br><span class="line"><span class="built_in">--env</span> <span class="string">&#x27;GITLAB_SSH_PORT=10022&#x27;</span> \</span><br><span class="line"><span class="built_in">--env</span> <span class="string">&#x27;GITLAB_SECRETS_DB_KEY_BASE-long-and-random-alpha-numeric-string&#x27;</span>\</span><br><span class="line"><span class="string">sameersbn/</span><span class="string">gitlab:8.</span>4.4</span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/b1229581/">https://blog.coder4j.cn/posts/b1229581/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker compose使用</title>
      <link href="/posts/10c8507f/"/>
      <url>/posts/10c8507f/</url>
      
        <content type="html"><![CDATA[<ol><li>安装(<a href="https://get.daocloud.io/">https://get.daocloud.io/</a>)</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.15.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/<span class="built_in">local</span>/bin/docker-compose</span><br><span class="line">chmod +x /usr/<span class="built_in">local</span>/bin/docker-compose</span><br></pre></td></tr></table></figure><ol><li>配置文件 docker-compose.yml</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">wordpress:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">wordpress</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db:mysql</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="number">8080</span><span class="string">:80</span></span><br><span class="line"><span class="attr">db:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">mariadb</span></span><br><span class="line">  <span class="attr">environment:</span></span><br><span class="line">    <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">example</span></span><br></pre></td></tr></table></figure><ol><li>启动</li></ol><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># 创建与启动</span></span><br><span class="line">docker-compose up</span><br><span class="line"><span class="meta"># -f 指定配置文件名，默认docker-compose.yml</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># 启动</span></span><br><span class="line">docker-compose start</span><br></pre></td></tr></table></figure><ol><li>关闭</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose stod</span></span><br></pre></td></tr></table></figure><ol><li>查询</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose ps</span></span><br></pre></td></tr></table></figure><ol><li>删除</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-compose down</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/10c8507f/">https://blog.coder4j.cn/posts/10c8507f/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker 常用命令</title>
      <link href="/posts/d76bceb7/"/>
      <url>/posts/d76bceb7/</url>
      
        <content type="html"><![CDATA[<ol><li>基础命令</li></ol><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 命令格式</span></span><br><span class="line">docker 命令关键字(<span class="keyword">command</span>) 一系列参数([<span class="title">args</span>...])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询命令帮助</span></span><br><span class="line">docker <span class="keyword">command</span> --<span class="title">help</span></span><br></pre></td></tr></table></figure><ol><li><p>启动容器<br><code>docker start id/name</code></p></li><li><p>关闭容器<br><code>docker stop id/name</code></p></li><li><p>查询在线容器</p></li></ol><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> ps<span class="meta"> [-a]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># -a 显示所有，包括已经关闭的</span></span><br></pre></td></tr></table></figure><ol><li><p>查询容器信息<br><code>docker inspect id/name</code></p></li><li><p>查看容器日志<br><code>docker logs [-f] id/name</code></p></li><li><p>查看容器资源占用<br><code>docker stats</code></p></li><li><p>容器内部命令</p></li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在容器内部执行命令</span></span><br><span class="line">docker exec <span class="built_in">id</span>/<span class="built_in">name</span> 执行命令</span><br><span class="line"><span class="comment"># 以root用户执行命令</span></span><br><span class="line">docker exec -<span class="keyword">it</span> <span class="built_in">id</span>/<span class="built_in">name</span> 执行命令</span><br><span class="line"><span class="comment"># 以root用户打开一个终端,exit退出</span></span><br><span class="line">docker exec -<span class="keyword">it</span> <span class="built_in">id</span>/<span class="built_in">name</span> /bin/bash</span><br></pre></td></tr></table></figure><ol><li>镜像查询</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker search xx</span></span><br></pre></td></tr></table></figure><ol><li>镜像下载</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker pull xx</span></span><br></pre></td></tr></table></figure><ol><li>本地镜像列表</li></ol><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker images</span></span><br></pre></td></tr></table></figure><ol><li>启动容器</li></ol><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run [--name] [--link] 镜像id/name</span><br><span class="line"></span><br><span class="line"><span class="meta"># --link 容器连接</span></span><br><span class="line"><span class="meta"># --name 容器起的名称</span></span><br><span class="line"><span class="meta"># --p 端口映射 8080:80</span></span><br><span class="line"><span class="meta"># --e 环境变量设置</span></span><br></pre></td></tr></table></figure><ol><li>删除容器</li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm <span class="built_in">id</span>/<span class="built_in">name</span></span><br></pre></td></tr></table></figure><ol><li>创建镜像</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">commit</span> <span class="keyword">id</span> imageName</span><br></pre></td></tr></table></figure><ol><li>关闭所有运行的容器</li></ol><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop <span class="constructor">$(<span class="params">docker</span> <span class="params">ps</span> -<span class="params">q</span>)</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/d76bceb7/">https://blog.coder4j.cn/posts/d76bceb7/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>lombok 基础教程</title>
      <link href="/posts/e36fd55e/"/>
      <url>/posts/e36fd55e/</url>
      
        <content type="html"><![CDATA[<h1 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h1><h4 id="作用：帮使用者提高编码效率，减少重复与冗余的代码"><a href="#作用：帮使用者提高编码效率，减少重复与冗余的代码" class="headerlink" title="作用：帮使用者提高编码效率，减少重复与冗余的代码"></a>作用：帮使用者提高编码效率，减少重复与冗余的代码</h4><h4 id="原理：ASM-动态修改-class-文件"><a href="#原理：ASM-动态修改-class-文件" class="headerlink" title="原理：ASM   动态修改 class 文件"></a>原理：ASM   动态修改 class 文件</h4><hr><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h3><ul><li>安装插件<br><img src="http://ww2.sinaimg.cn/large/68f7efe0gw1fb0hl2gmyzj20su0kagqg.jpg#align=left&display=inline&height=730&margin=%5Bobject%20Object%5D&originHeight=730&originWidth=1038&status=done&style=none&width=1038"></li></ul><hr><h1 id="常用注解："><a href="#常用注解：" class="headerlink" title="常用注解："></a>常用注解：</h1><h2 id="java-bean-相关"><a href="#java-bean-相关" class="headerlink" title="java bean 相关"></a>java bean 相关</h2><h3 id="Setter"><a href="#Setter" class="headerlink" title="@Setter"></a>@Setter</h3><ul><li><code>功能</code></li></ul><blockquote><p>生成 setter 方法</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line">       <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">private</span> Integer id;</span><br><span class="line">           <span class="keyword">private</span> String name;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Getter"><a href="#Getter" class="headerlink" title="@Getter"></a>@Getter</h3><ul><li><code>功能</code></li></ul><blockquote><p>生成 getter 方法</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h3><ul><li><code>功能</code></li></ul><blockquote><p>生成 toString 方法</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@ToString</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">String</span> <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokDemo(id=&quot;</span> + <span class="keyword">this</span>.id + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Getter-lazy-true"><a href="#Getter-lazy-true" class="headerlink" title="@Getter(lazy = true)"></a>@Getter(lazy = true)</h3><ul><li><code>功能</code></li></ul><blockquote><p>懒加载属性</p></blockquote><ul><li><code>注意:</code></li></ul><blockquote><p>这个与上面@Getter 不同，那个是修饰在类上的，也可以修饰在属性上。如果有 lazy=true 只能修饰在属性，并且还要是 private final 修饰，限制很大</p></blockquote><ul><li><code>编码</code></li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">LombokDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    @Getter(lazy = <span class="literal">true</span>) <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Integer&gt; ids = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicReference&lt;Object&gt; ids = new AtomicReference();</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; getIds() &#123;</span><br><span class="line">        Object value = <span class="keyword">this</span>.ids.<span class="keyword">get</span>();</span><br><span class="line">        <span class="keyword">if</span>(value == <span class="literal">null</span>) &#123;</span><br><span class="line">            AtomicReference var2 = <span class="keyword">this</span>.ids;</span><br><span class="line">            synchronized(<span class="keyword">this</span>.ids) &#123;</span><br><span class="line">                value = <span class="keyword">this</span>.ids.<span class="keyword">get</span>();</span><br><span class="line">                <span class="keyword">if</span>(value == <span class="literal">null</span>) &#123;</span><br><span class="line">                    List actualValue = Arrays.asList(new Integer[]&#123;Integer.valueOf(<span class="number">1</span>), Integer.valueOf(<span class="number">2</span>), Integer.valueOf(<span class="number">3</span>), Integer.valueOf(<span class="number">4</span>)&#125;);</span><br><span class="line">                    value = actualValue == <span class="literal">null</span>?<span class="keyword">this</span>.ids:actualValue;</span><br><span class="line">                    <span class="keyword">this</span>.ids.<span class="keyword">set</span>(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (List)((List)(value == <span class="keyword">this</span>.ids?<span class="literal">null</span>:value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="EqualsAndHashCode"><a href="#EqualsAndHashCode" class="headerlink" title="@EqualsAndHashCode"></a>@EqualsAndHashCode</h3><ul><li><code>功能</code></li></ul><blockquote><p>生成 equals 方法与 hashCode 方法</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@EqualsAndHashCode</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> boolean equals(Object o) &#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!(o instanceof LombokDemo)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokDemo other = (LombokDemo)o;</span><br><span class="line">            <span class="keyword">if</span>(!other.canEqual(<span class="keyword">this</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Integer <span class="keyword">this</span>$id = <span class="keyword">this</span>.id;</span><br><span class="line">                Integer other$id = other.id;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$id == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$id != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$id.equals(other$id)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String <span class="keyword">this</span>$name = <span class="keyword">this</span>.name;</span><br><span class="line">                String other$name = other.name;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$name == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$name != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> boolean canEqual(Object other) &#123;</span><br><span class="line">        <span class="keyword">return</span> other instanceof LombokDemo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int hashCode() &#123;</span><br><span class="line">        boolean PRIME = <span class="literal">true</span>;</span><br><span class="line">        byte result = <span class="number">1</span>;</span><br><span class="line">        Integer $id = <span class="keyword">this</span>.id;</span><br><span class="line">        int result1 = result * <span class="number">59</span> + ($id == <span class="literal">null</span>?<span class="number">43</span>:$id.hashCode());</span><br><span class="line">        String $name = <span class="keyword">this</span>.name;</span><br><span class="line">        result1 = result1 * <span class="number">59</span> + ($name == <span class="literal">null</span>?<span class="number">43</span>:$name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="NoAragsConstructor"><a href="#NoAragsConstructor" class="headerlink" title="@NoAragsConstructor"></a>@NoAragsConstructor</h3><ul><li><code>功能</code></li></ul><blockquote><p>添加一个无参构造函数</p></blockquote><ul><li><code>注意</code></li></ul><blockquote><p>这个注解在没有其它有参构造函数的情况下使用意义不大，因为在这种情况下 java 默认会添加一个无参构造函数</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@NoArgsConstructor</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="AllArgsConstructor"><a href="#AllArgsConstructor" class="headerlink" title="@AllArgsConstructor"></a>@AllArgsConstructor</h3><ul><li><code>功能</code></li></ul><blockquote><p>添加一个所有参数的构造函数</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@AllArgsConstructor</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.ConstructorProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;<span class="meta-string">&quot;id&quot;</span>, <span class="meta-string">&quot;name&quot;</span>&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> LombokDemo(Integer id, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="RequiredArgsConstructor"><a href="#RequiredArgsConstructor" class="headerlink" title="@RequiredArgsConstructor"></a>@RequiredArgsConstructor</h3><ul><li><code>功能</code></li></ul><blockquote><p>生成一个包含必填参数的构造函数</p></blockquote><ul><li><code>注意</code></li></ul><blockquote><p>要与@NonNull 搭配使用，该注解修饰的属性就是必填参数</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.ConstructorProperties;</span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;id&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">(<span class="meta">@NonNull</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a>@Data</h3><ul><li><code>功能</code></li></ul><blockquote><p>这是一个综合注解了，等于同时使用</p></blockquote><blockquote><p><code>@Getter</code>, <code>@Setter</code>, <code>@ToString</code>, <code>@EqualsAndHashCode</code>,<code>@RequiredArgsConstructor</code></p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    @NonNull <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> String <span class="keyword">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer getId() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void setId(Integer id) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> void setName(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> boolean equals(Object o) &#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!(o instanceof LombokDemo)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokDemo other = (LombokDemo)o;</span><br><span class="line">            <span class="keyword">if</span>(!other.canEqual(<span class="keyword">this</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Integer <span class="keyword">this</span>$id = <span class="keyword">this</span>.getId();</span><br><span class="line">                Integer other$id = other.getId();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$id == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$id != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$id.equals(other$id)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">                String other$name = other.getName();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$name == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$name != <span class="literal">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> boolean canEqual(Object other) &#123;</span><br><span class="line">        <span class="keyword">return</span> other instanceof LombokDemo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int hashCode() &#123;</span><br><span class="line">        boolean PRIME = <span class="literal">true</span>;</span><br><span class="line">        byte result = <span class="number">1</span>;</span><br><span class="line">        Integer $id = <span class="keyword">this</span>.getId();</span><br><span class="line">        int result1 = result * <span class="number">59</span> + ($id == <span class="literal">null</span>?<span class="number">43</span>:$id.hashCode());</span><br><span class="line">        String $name = <span class="keyword">this</span>.getName();</span><br><span class="line">        result1 = result1 * <span class="number">59</span> + ($name == <span class="literal">null</span>?<span class="number">43</span>:$name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokDemo(id=&quot;</span> + <span class="keyword">this</span>.getId() + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.getName() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><ul><li><code>功能</code></li></ul><blockquote><p>不可变类的@Data, 他会默认给属性加上 final</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">Value</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> String <span class="keyword">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.ConstructorProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;<span class="meta-string">&quot;id&quot;</span>, <span class="meta-string">&quot;name&quot;</span>&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> LombokDemo(Integer id, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer getId() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> boolean equals(Object o) &#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!(o instanceof LombokDemo)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokDemo other = (LombokDemo)o;</span><br><span class="line">            Integer <span class="keyword">this</span>$id = <span class="keyword">this</span>.getId();</span><br><span class="line">            Integer other$id = other.getId();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>$id == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(other$id != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$id.equals(other$id)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">            String other$name = other.getName();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>$name == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(other$name != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> int hashCode() &#123;</span><br><span class="line">        boolean PRIME = <span class="literal">true</span>;</span><br><span class="line">        byte result = <span class="number">1</span>;</span><br><span class="line">        Integer $id = <span class="keyword">this</span>.getId();</span><br><span class="line">        int result1 = result * <span class="number">59</span> + ($id == <span class="literal">null</span>?<span class="number">43</span>:$id.hashCode());</span><br><span class="line">        String $name = <span class="keyword">this</span>.getName();</span><br><span class="line">        result1 = result1 * <span class="number">59</span> + ($name == <span class="literal">null</span>?<span class="number">43</span>:$name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String toString() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokDemo(id=&quot;</span> + <span class="keyword">this</span>.getId() + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.getName() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Accessors"><a href="#Accessors" class="headerlink" title="@Accessors"></a>@Accessors</h3><ul><li><code>功能</code></li></ul><blockquote><p>这个注解要搭配@Getter 与@Setter 使用，用来修改默认的 setter 与 getter 方法的形式</p></blockquote><ul><li><code>注意</code></li></ul><blockquote><p>@Accessors 有三个参数可以使用</p></blockquote><blockquote><ol><li>chain   链式的形式</li></ol></blockquote><blockquote><ol start="2"><li>fluent   流式的形式</li></ol></blockquote><blockquote><ol start="3"><li>prefix   生成指定前缀的属性的 getter 与 setter 方法，并且生成的 getter 与 setter 方法时会去除前缀</li></ol></blockquote><ul><li><code>源码 chain = true</code></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Accessors</span>(chain = true)</span><br><span class="line"><span class="variable">@Setter</span></span><br><span class="line"><span class="variable">@Getter</span></span><br><span class="line">public class LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">id</span>;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后 chain = true</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo setId(Integer id) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo setName(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer getId() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>源码 fluent = true</code></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Accessors</span>(fluent = true)</span><br><span class="line"><span class="variable">@Setter</span></span><br><span class="line"><span class="variable">@Getter</span></span><br><span class="line">public class LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">id</span>;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后 fluent = true</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo id(Integer id) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo name(String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer id() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String name() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>源码 prefix = &quot;xxx&quot;</code></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Accessors</span>(prefix = <span class="string">&quot;xxx&quot;</span>)</span><br><span class="line"><span class="variable">@Setter</span></span><br><span class="line"><span class="variable">@Getter</span></span><br><span class="line">public class LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">Integer</span> <span class="selector-tag">xxxId</span>;</span><br><span class="line">    <span class="selector-tag">private</span> <span class="selector-tag">String</span> <span class="selector-tag">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后 prefix = &quot;xxx&quot;</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer xxxId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.xxxId = xxxId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.xxxId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h1 id="其它注解："><a href="#其它注解：" class="headerlink" title="其它注解："></a>其它注解：</h1><h2 id="日志相关"><a href="#日志相关" class="headerlink" title="日志相关"></a>日志相关</h2><h3 id="Log4j"><a href="#Log4j" class="headerlink" title="@Log4j"></a>@Log4j</h3><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Log4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger <span class="built_in">log</span> = Logger.getLogger(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="CommonsLog"><a href="#CommonsLog" class="headerlink" title="@CommonsLog"></a>@CommonsLog</h3><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@CommonsLog</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package xyz<span class="number">.</span>mrwood<span class="number">.</span>study<span class="number">.</span>lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org<span class="number">.</span>apache<span class="number">.</span>commons<span class="number">.</span>logging<span class="number">.</span><span class="built_in">Log</span>;</span><br><span class="line"><span class="keyword">import</span> org<span class="number">.</span>apache<span class="number">.</span>commons<span class="number">.</span>logging<span class="number">.</span>LogFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> LombokDemo &#123;</span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">final</span> <span class="built_in">Log</span> <span class="built_in">log</span> = LogFactory<span class="number">.</span>getLog(LombokDemo<span class="number">.</span><span class="keyword">class</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> xxxId;</span><br><span class="line">    <span class="keyword">private</span> String <span class="keyword">name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> LombokDemo() &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Log"><a href="#Log" class="headerlink" title="@Log"></a>@Log</h3><ul><li><code>源码</code></li></ul><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@<span class="built_in">Log</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> xxxId;</span><br><span class="line">    <span class="keyword">private</span> String <span class="keyword">name</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger <span class="built_in">log</span> = Logger.getLogger(LombokDemo.class.getName());</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Log4j2"><a href="#Log4j2" class="headerlink" title="@Log4j2"></a>@Log4j2</h3><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Log4j2</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger <span class="built_in">log</span> = LogManager.getLogger(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Slf4j"><a href="#Slf4j" class="headerlink" title="@Slf4j"></a>@Slf4j</h3><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger <span class="built_in">log</span> = LoggerFactory.getLogger(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="设计模式相关"><a href="#设计模式相关" class="headerlink" title="设计模式相关"></a>设计模式相关</h2><h3 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h3><ul><li><code>功能</code></li></ul><blockquote><p>通过建造者模块来生成 bean</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Builder</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    LombokDemo(Integer id, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> static LombokDemo.LombokDemoBuilder builder() &#123;</span><br><span class="line">        <span class="keyword">return</span> new LombokDemo.LombokDemoBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> static <span class="class"><span class="keyword">class</span> <span class="title">LombokDemoBuilder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Integer id;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        LombokDemoBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> LombokDemo.LombokDemoBuilder id(Integer id) &#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> LombokDemo.LombokDemoBuilder name(String name) &#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> LombokDemo build() &#123;</span><br><span class="line">            <span class="keyword">return</span> new LombokDemo(<span class="keyword">this</span>.id, <span class="keyword">this</span>.name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String toString() &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;LombokDemo.LombokDemoBuilder(id=&quot;</span> + <span class="keyword">this</span>.id + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Delegate"><a href="#Delegate" class="headerlink" title="@Delegate"></a>@Delegate</h3><ul><li><code>功能</code></li></ul><blockquote><p>@Delegate 注释的属性，会把这个属性对象的公有非静态方法合到当前类</p></blockquote><ul><li><code>注意</code></li></ul><blockquote><p>公共 非静态方法</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Delegate</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">byteValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.byteValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">shortValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.shortValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">longValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.longValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">floatValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.floatValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">doubleValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Integer arg0)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.compareTo(arg0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="工具相关"><a href="#工具相关" class="headerlink" title="工具相关"></a>工具相关</h2><h3 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h3><ul><li><code>功能</code></li></ul><blockquote><p>关闭流</p></blockquote><ul><li><code>注意</code></li></ul><blockquote><p>关闭流的方式有点怪异，而且没有在<strong>finally</strong>里面关闭，如果出现异常的就不会关闭了</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Cleanup</span> InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;xxx.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;xxx.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(Collections.singletonList(inputStream).get(<span class="number">0</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            inputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Synchronized"><a href="#Synchronized" class="headerlink" title="@Synchronized"></a>@Synchronized</h3><ul><li><code>功能</code></li></ul><blockquote><p>给方法加一个同步块</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Synchronized</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Object var1 = <span class="keyword">this</span>.$lock;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.$lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h3><ul><li><code>功能</code></li></ul><blockquote><p>忽略异常</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    @SneakyThrows</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">String</span> s = <span class="keyword">new</span> <span class="keyword">String</span>(<span class="string">&quot;test&quot;</span>.getBytes(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Object var1 = <span class="keyword">this</span>.$lock;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.$lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h3><ul><li><code>功能</code></li></ul><blockquote><p>设置不能为空的参数</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">class</span> <span class="selector-tag">LombokDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="selector-tag">public</span> <span class="selector-tag">void</span> <span class="selector-tag">test</span>(<span class="variable">@NonNull</span> String val) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="meta">@NonNull</span> String val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UtilityClass"><a href="#UtilityClass" class="headerlink" title="@UtilityClass"></a>@UtilityClass</h3><ul><li><code>功能</code></li></ul><blockquote><p>把普通类转为工具类</p></blockquote><ul><li><code>源码</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@UtilityClass</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name = <span class="string">&quot;kiwi&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">util</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">package xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> &#123;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer id = Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">String</span> name = <span class="string">&quot;kiwi&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">util</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.<span class="built_in">println</span>(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">&quot;This is a utility class and cannot be instantiated&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/e36fd55e/">https://blog.coder4j.cn/posts/e36fd55e/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>maven 按环境加载配置文件</title>
      <link href="/posts/e0dc8c3f/"/>
      <url>/posts/e0dc8c3f/</url>
      
        <content type="html"><![CDATA[<p>通过 maven 的 profile 实现按环境来加载配置文件</p><h6 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h6><p>project_file_root<br>|—main<br>|——–java<br>|——–resources<br>|——–profile<br>|—————dev<br>|—————test<br>|—————beta<br>|—————release</p><h6 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h6><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">&lt;profiles&gt;</span></span><br><span class="line">true<span class="params">&lt;profile&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;id&gt;</span>dev<span class="params">&lt;/id&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;activation&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;activeByDefault&gt;</span>true<span class="params">&lt;/activeByDefault&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/activation&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;properties&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;config.dir&gt;</span>dev<span class="params">&lt;/config.dir&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/properties&gt;</span></span><br><span class="line">true<span class="params">&lt;/profile&gt;</span></span><br><span class="line">true<span class="params">&lt;profile&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;id&gt;</span>test<span class="params">&lt;/id&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;properties&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;config.dir&gt;</span>test<span class="params">&lt;/config.dir&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/properties&gt;</span></span><br><span class="line">true<span class="params">&lt;/profile&gt;</span></span><br><span class="line">true<span class="params">&lt;profile&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;id&gt;</span>beta<span class="params">&lt;/id&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;properties&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;config.dir&gt;</span>beta<span class="params">&lt;/config.dir&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/properties&gt;</span></span><br><span class="line">true<span class="params">&lt;/profile&gt;</span></span><br><span class="line">true<span class="params">&lt;profile&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;id&gt;</span>release<span class="params">&lt;/id&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;properties&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;config.dir&gt;</span>release<span class="params">&lt;/config.dir&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/properties&gt;</span></span><br><span class="line">true<span class="params">&lt;/profile&gt;</span></span><br><span class="line"><span class="params">&lt;/profiles&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="params">&lt;build&gt;</span></span><br><span class="line">true<span class="params">&lt;resources&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;resource&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;directory&gt;</span>src<span class="meta-keyword">/main/</span>profile/$&#123;config.dir&#125;<span class="params">&lt;/directory&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;targetPath&gt;</span>./<span class="params">&lt;/targetPath&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/resource&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;resource&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;directory&gt;</span>src<span class="meta-keyword">/main/</span>resources<span class="params">&lt;/directory&gt;</span></span><br><span class="line">truetruetrue<span class="params">&lt;targetPath&gt;</span>./<span class="params">&lt;/targetPath&gt;</span></span><br><span class="line">truetrue<span class="params">&lt;/resource&gt;</span></span><br><span class="line">true<span class="params">&lt;/resources&gt;</span></span><br><span class="line">     <span class="params">&lt;/build&gt;</span></span><br></pre></td></tr></table></figure><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><blockquote><p>大致思路就是建一个 profile 的目录，这个目录名可以随意只要跟后面保持一致就行，然后在这个目录下面建几个按环境区分的目录，通常是 dev(开发)，test（测试），beta（预发），release(正式)。然后再通过 maven 的 profile 特性，生成按环境的${config.dir}的值。最后通过 maven 的 resources 标签来完成配置文件的拷贝，大功告成。</p></blockquote><h5 id="打包命令"><a href="#打包命令" class="headerlink" title="打包命令"></a>打包命令</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn clean <span class="keyword">install</span> -P(profile_id)</span><br><span class="line">eg. mvn clean <span class="keyword">install</span> -Pdev  <span class="comment">--打包开发环境的配置文件</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/e0dc8c3f/">https://blog.coder4j.cn/posts/e0dc8c3f/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>spring aop注解教程</title>
      <link href="/posts/e66e4043/"/>
      <url>/posts/e66e4043/</url>
      
        <content type="html"><![CDATA[<blockquote><p>spring aop 常用的有以下：</p><ul><li>通知类型：</li></ul></blockquote><ul><li>前置通知（Before advice）：在某连接点之前执行的通知，但这个通知不能阻止连接点之前的执行流程（除非它抛出一个异常）。</li><li>后置通知（After returning advice）：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</li><li>异常通知（After throwing advice）：在方法抛出异常退出时执行的通知。</li><li>最终通知（After (finally) advice）：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。</li><li>环绕通知（Around Advice）：包围一个连接点的通知，如方法调用。这是最强大的一种通知类型。环绕通知可以在方法调用前后完成自定义的行为。它也会选择是否继续执行连接点或直接返回它自己的返回值或抛出异常来结束执行。</li></ul><blockquote><ul><li>核心配置只要在 AOP 的实现方法上加上@Aspect 与在 spring 配置文件中加上 aop:aspectj-autoproxy/,spring 就可以配置 aop 方法，然后再根据方法的增强标签不同的效果，这里需要注意是它们的参数不同。</li></ul></blockquote><ul><li>pom.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mrwood_study<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xyz.mrwood.study<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>study-spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>study-spring-aop<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring开始 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring 结束--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- AOP begin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- AOP end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志开始 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志结束 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>spring-context.xml</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--自动注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;xyz.mrwood.study&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>AopHandler.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2016, 791650277@qq.com(Mr.kiwi) All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> xyz.mrwood.study.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 项目：study</span></span><br><span class="line"><span class="comment"> * 包名：xyz.mrwood.study.aop</span></span><br><span class="line"><span class="comment"> * 功能：aop实现</span></span><br><span class="line"><span class="comment"> * 时间：2016-05-28 10:33</span></span><br><span class="line"><span class="comment"> * 作者：Mr.Kiwi</span></span><br><span class="line"><span class="comment"> * 通知类型：</span></span><br><span class="line"><span class="comment"> * 前置通知（Before advice）：在某连接点之前执行的通知，但这个通知不能阻止连接点之前的执行流程（除非它抛出一个异常）。</span></span><br><span class="line"><span class="comment"> * 后置通知（After returning advice）：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</span></span><br><span class="line"><span class="comment"> * 异常通知（After throwing advice）：在方法抛出异常退出时执行的通知。</span></span><br><span class="line"><span class="comment"> * 最终通知（After (finally) advice）：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。</span></span><br><span class="line"><span class="comment"> * 环绕通知（Around Advice）：包围一个连接点的通知，如方法调用。这是最强大的一种通知类型。环绕通知可以在方法调用前后完成自定义的行为。它也会选择是否继续执行连接点或直接返回它自己的返回值或抛出异常来结束执行。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截工程下所有的切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* xyz.mrwood.study..*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAllPoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截所有service层下的切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* xyz.mrwood.study.service..*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServicePoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置增强</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;getServicePoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[前置增强开始]：&quot;</span> + <span class="string">&quot;方法开始了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;getServicePoint()&quot;, throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionMethod</span><span class="params">(JoinPoint joinPoint, Exception ex)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[异常增强]：&quot;</span> + <span class="string">&quot;如果你看到这行，就说明你的程序报错了！&quot;</span> + <span class="string">&quot;异常信息：&quot;</span> + ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置增强，只有在方法正常结束才会调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnVal</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;getServicePoint()&quot;,returning = &quot;returnVal&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturningMethod</span><span class="params">(Object returnVal)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[后置增强]：&quot;</span> + <span class="string">&quot;当你看到这个说明，你的方法没有正常结束了！&quot;</span> + <span class="string">&quot;它的返回值为：&quot;</span> + returnVal);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终增强，类似于finally的功能</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After(&quot;getServicePoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[最终增强]：&quot;</span> + <span class="string">&quot;无论发论发生什么事，我都会运行！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕增强</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proceedingJoinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;getServicePoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[环绕增强开始]：&quot;</span> + <span class="string">&quot;方法开始了！&quot;</span>);</span><br><span class="line">        Object returnVal = proceedingJoinPoint.proceed(proceedingJoinPoint.getArgs());</span><br><span class="line">        System.out.println(<span class="string">&quot;[环绕增强结束]：&quot;</span> + <span class="string">&quot;方法已经结束了！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>TargetService.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2016, 791650277@qq.com(Mr.kiwi) All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> xyz.mrwood.study.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 项目：study</span></span><br><span class="line"><span class="comment"> * 包名：xyz.mrwood.study.service</span></span><br><span class="line"><span class="comment"> * 功能：被拦截的目标类</span></span><br><span class="line"><span class="comment"> * 时间：2016-05-28 10:32</span></span><br><span class="line"><span class="comment"> * 作者：Mr.Kiwi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>运行结果</li></ul><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">环绕增强开始</span>]：方法开始了！</span><br><span class="line">[<span class="meta">前置增强开始</span>]：方法开始了</span><br><span class="line">[<span class="meta">环绕增强结束</span>]：方法已经结束了！</span><br><span class="line">[<span class="meta">最终增强</span>]：无论发论发生什么事，我都会运行！</span><br><span class="line">[<span class="meta">后置增强</span>]：当你看到这个说明，你的方法没有正常结束了！它的返回值为：test</span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/e66e4043/">https://blog.coder4j.cn/posts/e66e4043/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>tomcat 配置https证书</title>
      <link href="/posts/25b9abff/"/>
      <url>/posts/25b9abff/</url>
      
        <content type="html"><![CDATA[<h1 id="Tomcat-配置-https-证书"><a href="#Tomcat-配置-https-证书" class="headerlink" title="Tomcat 配置 https 证书"></a>Tomcat 配置 https 证书</h1><blockquote><p>网上搜索出来大多数是通过 keytool 自已生成证书来完成，这种在工作很少用到（浏览器会报不安全）。以下是通过申请的证书配置过程。因为在配置中遇到了一些坑，记之</p></blockquote><h4 id="1、准备证书与私钥"><a href="#1、准备证书与私钥" class="headerlink" title="1、准备证书与私钥"></a>1、准备证书与私钥</h4><p><code>demo.crt</code>  <code>demo.key</code></p><h4 id="2、合并证书"><a href="#2、合并证书" class="headerlink" title="2、合并证书"></a>2、合并证书</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -export -<span class="keyword">in</span> <span class="built_in">demo</span>.crt -inkey <span class="built_in">demo</span>.<span class="built_in">key</span> -out <span class="built_in">demo</span>.p12 -name <span class="built_in">demo</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>1、 demo.crt 是你的证书<br>2、 demo.key 是你的私钥<br>3、 demo.p12 是合并后的证书<br>4、-name 后面的 demo 是指定的别名，后面配置 tomcat8.5 之后的版本需要用到，要记住<br>5、执行这条命令要设置一个导出密码，后面要用到，要记住，最好 6 位以上</p></blockquote><h4 id="3、生成-keystore-文件"><a href="#3、生成-keystore-文件" class="headerlink" title="3、生成 keystore 文件"></a>3、生成 keystore 文件</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keytool</span> -importkeystore -srckeystore demo.p<span class="number">12</span> -srcstoretype PKCS<span class="number">12</span> -destkeystore demo.jks</span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>1、demo.p12 是第二步生成的证书名<br>2、demo.jks 是生成的 keystore 文件名<br>3、执行这条命令会首先让你设置一个密码，这个密码后面配置会用到，要记住。然后验证上一步设置的密码。推荐该步骤设置的密码与上一步一致，如果不一致可能会出现错误详见 <a href="http://hw1287789687.iteye.com/blog/1965703">java.security.UnrecoverableKeyException: Cannot recover key - 简单的幸福 - ITeye 技术网站</a></p></blockquote><h4 id="4、配置-tomcat"><a href="#4、配置-tomcat" class="headerlink" title="4、配置 tomcat"></a>4、配置 tomcat</h4><p><code>tomcat 8.5 之前</code></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;Connector <span class="attribute">SSLEnabled</span>=<span class="string">&quot;true&quot;</span> <span class="attribute">acceptCount</span>=<span class="string">&quot;100&quot;</span> <span class="attribute">clientAuth</span>=<span class="string">&quot;false&quot;</span></span><br><span class="line">    <span class="attribute">disableUploadTimeout</span>=<span class="string">&quot;true&quot;</span> <span class="attribute">enableLookups</span>=<span class="string">&quot;false&quot;</span> <span class="attribute">maxThreads</span>=<span class="string">&quot;25&quot;</span></span><br><span class="line">    <span class="attribute">port</span>=<span class="string">&quot;8443&quot;</span> <span class="attribute">keystoreFile</span>=<span class="string">&quot;~/ssl/demo.jks&quot;</span> <span class="attribute">keystorePass</span>=<span class="string">&quot;123456&quot;</span></span><br><span class="line">    <span class="attribute">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span> <span class="attribute">scheme</span>=<span class="string">&quot;https&quot;</span></span><br><span class="line">    <span class="attribute">secure</span>=<span class="string">&quot;true&quot;</span> <span class="attribute">sslProtocol</span>=<span class="string">&quot;TLS&quot;</span> /&gt;</span><br></pre></td></tr></table></figure><p><code>tomcat 8.5 之后</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8643&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">maxThreads</span>=<span class="string">&quot;150&quot;</span> <span class="attr">SSLEnabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Certificate</span> <span class="attr">certificateKeystoreFile</span>=<span class="string">&quot;~/ssl/demo.jks&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">certificateKeyAlias</span>=<span class="string">&quot;demo&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">certificateKeystorePassword</span>=<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">type</span>=<span class="string">&quot;RSA&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Connector</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>1、~_ssl_demo.jks   是你前面步骤生成的 storekey 文件的路径<br>2、123456 是前面第 3 步设置的密码<br>3、tomcat8.5 之后有一个 certificateKeyAlias 这个是 2 步设置-name 的值</p></blockquote><h4 id="参数地址："><a href="#参数地址：" class="headerlink" title="参数地址："></a>参数地址：</h4><p><a href="http://blog.csdn.net/freeiceflame/article/details/50420059">TOMCAT 导入通过第三方证书机构获取的证书 - IceFlame 博客频道 - CSDN.NET</a></p><p><a href="http://hw1287789687.iteye.com/blog/1965703">java.security.UnrecoverableKeyException: Cannot recover key - 简单的幸福 - ITeye 技术网站</a></p><p><a href="https://www.oschina.net/question/12_23148">5 分钟内搞定 Tomcat 的 SSL 配置 - 开源中国社区</a></p><p><a href="https://bbs.wosign.com/forum.php?mod=viewthread&tid=2881">tomcat 8.5+版本 SSL 证书部署-沃通 CA 官方论坛 -   专业数字证书论坛</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/25b9abff/">https://blog.coder4j.cn/posts/25b9abff/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring boot 对于 js 的 long 精度问题处理</title>
      <link href="/posts/6bfa638e/"/>
      <url>/posts/6bfa638e/</url>
      
        <content type="html"><![CDATA[<p>这几天前后端联调，遇到一个诡异的问题。前端请求后端提供的详情接口得到用户的 Id 与其它数据。然后前端又把这个 Id 与修改的数据内容一同传回后端的修改接口。结果前端反馈死活修改不了。</p><p>然后各种 debug 查日志，发现详情接口返回给前端的与前端调用修改接口传回的 Id 不一致。</p><p>然后一查发现是 js 的精度问题，原以为 js 只是浮点型会有精度问题，没想到长整型也会出现。因为是语言的限制，前端要解决这个问题，还是很吃力的。所以只能在后端在传 json 的时候把 long 全部转成 string 类型。</p><p>然后问题又来了，因为项目已写了差不多了。太多地方用了 long 类型，改基础类的字段类型是不可能了。于是想在对象转 json 的时候能否统一处理。</p><p>因为使用的是 spring boot 框架，而 spring boot 默认的 json 框架的 Jackson。就是找了一下，果然 jackson 有一个可以自定义的类型转换器机制。直接上代码 ↓</p><ul><li>json 转换器<br>JsonLong2StrConverter<br>public class JsonLong2StrConverter extends StdSerializer {</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">JsonLong2StrConverter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(Long.class);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Long value, JsonGenerator gen, SerializerProvider provider)</span></span></span><br><span class="line"><span class="function">      <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">    gen.writeString(value.toString());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用配置<br>JsonConf<br>@Configuration<br>@EnableWebMvc<br>public class JsonConf extends WebMvcConfigurerAdapter {</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">configureMessageConverters</span><span class="params">(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters)</span> </span>&#123;</span><br><span class="line">    converters.add(<span class="keyword">new</span> MappingJackson2HttpMessageConverter(</span><br><span class="line">        <span class="keyword">new</span> Jackson2ObjectMapperBuilder()</span><br><span class="line"><span class="comment">//            .propertyNamingStrategy(PropertyNamingStrategy.SNAKE_CASE)</span></span><br><span class="line">            .serializationInclusion(</span><br><span class="line">                Include.NON_NULL)</span><br><span class="line">            .serializerByType(Long.class, <span class="keyword">new</span> JsonLong2StrConverter())</span><br><span class="line">            .serializerByType(Long.TYPE, <span class="keyword">new</span> JsonLong2StrConverter()).build()));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样 spring boot 在转换 json 时，发现是 Long 类型就直接转成 String 类型，也就是加个单引号。</p><p>参考：<br><a href="http://okeeper.leanote.com/post/Spring-boot-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89Json%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">Spring boot 配置自定义 Json 类型转换</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/6bfa638e/">https://blog.coder4j.cn/posts/6bfa638e/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker 安装 workpress</title>
      <link href="/posts/cd036045/"/>
      <url>/posts/cd036045/</url>
      
        <content type="html"><![CDATA[<ul><li>使用 docker 安装 wordpress</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装数据库</span></span><br><span class="line">docker run --name db --env MYSQL_ROOT_PASSWORD=example -d mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 wordpress</span></span><br><span class="line">docker run --name MyWordPress --link db:mysql -p 8080:80 -d wordpress</span><br></pre></td></tr></table></figure><p>安装成功效果图<br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fn1igx342oj21sc0tsdjn.jpg#width="></p><ul><li><p>命令解析</p><ul><li>安装数据库</li></ul></li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> --name db --env <span class="attribute">MYSQL_ROOT_PASSWORD</span>=example -d mariadb</span><br></pre></td></tr></table></figure><pre><code>  - docker run     - 启动容器的命令  - --name db     - 指定启动容器的名称  - --env MYSQL_ROOT_PASSWORD=example     - 传入环境变量，此处是设置 mysql 密码为 example  - -d     - 后台运行，否则前台进行</code></pre><ul><li>安装 wordpress</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name MyWordPress --link db:mysql -p <span class="number">8080</span>:<span class="number">80</span> -d wordpress</span><br></pre></td></tr></table></figure><pre><code>  - --link db:mysql     - 与上面启动的 db 容器建立联系  - -p 8080:80     - 端口映射，把宿主机的8080端口映射到容器内的80端口</code></pre><p>本文地址 <a href="https://blog.coder4j.cn/posts/cd036045/">https://blog.coder4j.cn/posts/cd036045/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>docker 安装 gitlab</title>
      <link href="/posts/55158d62/"/>
      <url>/posts/55158d62/</url>
      
        <content type="html"><![CDATA[<ul><li>使用 docker 安装 gitlab</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 postgresql</span></span><br><span class="line">docker <span class="builtin-name">run</span> <span class="attribute">--name</span>=gitlab-postgresql -d --env <span class="attribute">DB_NAME</span>=gitlabhq_prodution --env <span class="attribute">DB_USER</span>=gitlab --env <span class="attribute">DB_PASS</span>=password sameersbn/postgresql:9.4-12</span><br><span class="line"><span class="comment"># 安装 redis</span></span><br><span class="line">docker <span class="builtin-name">run</span> --name gitlab-redis -d sameersbn/redis</span><br><span class="line"><span class="comment"># 安装 gitlab</span></span><br><span class="line">docker <span class="builtin-name">run</span> --name gitlab -d --link gitlab-postgresql:postgresql --link gitlab-redis:redisio --publish 10022:22 --publish 10080:80 --env <span class="attribute">GITLAB_PORT</span>=10080 --env <span class="attribute">GITLAB_SSH_PORT</span>=10022 --env <span class="attribute">GITLAB_SECRETS_DB_KEY_BASE</span>=long-and-random-alpha-numeric-string sameersbn/gitlab:8.4.4</span><br></pre></td></tr></table></figure><ul><li><p>访问 <a href="http://本地ip:10080/">http://本地 ip:10080</a><br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fn1jbcqanij21ro11sq8s.jpg#width="></p></li><li><p>参考链接<br><a href="https://github.com/sameersbn/docker-gitlab">docker-gitlab</a><br><a href="http://www.damagehead.com/docker-gitlab/">Zero to GitLab in 5 seconds or less*</a></p></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/55158d62/">https://blog.coder4j.cn/posts/55158d62/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>linux 用户管理</title>
      <link href="/posts/e3f07f7a/"/>
      <url>/posts/e3f07f7a/</url>
      
        <content type="html"><![CDATA[<h4 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd 用户名称</span><br><span class="line">adduser 用户名称</span><br></pre></td></tr></table></figure><p><a href="https://my.oschina.net/lyp82nlf/blog/477319">Linux 添加新用户命令：useradd 与 adduser 的区别</a></p><h4 id="设置用户密码"><a href="#设置用户密码" class="headerlink" title="设置用户密码"></a>设置用户密码</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd 用户名称</span><br></pre></td></tr></table></figure><h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel 用户名称</span><br></pre></td></tr></table></figure><h4 id="常见问题："><a href="#常见问题：" class="headerlink" title="常见问题："></a>常见问题：</h4><h5 id="添加后并设置密码仍无法登录"><a href="#添加后并设置密码仍无法登录" class="headerlink" title="添加后并设置密码仍无法登录?"></a>添加后并设置密码仍无法登录?</h5><blockquote><p>查看 /etc/ssh/sshd_config 文件中是否允许登录，更多无法登录问题 <a href="http://lakemoonstar.iteye.com/blog/1471532">root 帐户无法登陆解决办法</a></p></blockquote><h5 id="修改了-etc-ssh-sshd-config-仍然无效"><a href="#修改了-etc-ssh-sshd-config-仍然无效" class="headerlink" title="修改了/etc/ssh/sshd_config 仍然无效?"></a>修改了/etc/ssh/sshd_config 仍然无效?</h5><blockquote><p>要更新配置，不能直接使用 source xxx,要重启 ssh 服务，使用<code>service sshd restart</code></p></blockquote><h4 id="相关博客"><a href="#相关博客" class="headerlink" title="相关博客"></a>相关博客</h4><p><a href="https://blog.csdn.net/beitiandijun/article/details/41678251">linux 用户管理（1）—-创建用户（adduser 和 useradd）和删除用户（userdel）</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/e3f07f7a/">https://blog.coder4j.cn/posts/e3f07f7a/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>nginx 常用配置</title>
      <link href="/posts/59e56e3a/"/>
      <url>/posts/59e56e3a/</url>
      
        <content type="html"><![CDATA[<h3 id="配置结构"><a href="#配置结构" class="headerlink" title="配置结构"></a>配置结构</h3><p><img src="https://upload-images.jianshu.io/upload_images/9824247-6f7a9706b9f3982b.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240#width="></p><h3 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h3><ol><li>配置 https</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span> <span class="number">443</span>;</span><br><span class="line">    <span class="attribute">server_name</span> localhost;</span><br><span class="line">    <span class="attribute">ssl</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">root</span> html;</span><br><span class="line">    <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    <span class="attribute">ssl_certificate</span>   cert/<span class="number">1535407297197</span>.pem;</span><br><span class="line">    <span class="attribute">ssl_certificate_key</span>  cert/<span class="number">1535407297197</span>.key;</span><br><span class="line">    <span class="attribute">ssl_session_timeout</span> <span class="number">5m</span>;</span><br><span class="line">    <span class="attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">    <span class="attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="number">1</span> TLSv1.<span class="number">2</span>;</span><br><span class="line">    <span class="attribute">ssl_prefer_server_ciphers</span> <span class="literal">on</span>;</span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span> html;</span><br><span class="line">        <span class="attribute">index</span> index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>配置端口转发</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">http&#123;</span><br><span class="line">    <span class="attribute">proxy_read_timeout</span> <span class="number">300s</span>;</span><br><span class="line">    <span class="attribute">proxy_send_timeout</span> <span class="number">300s</span>;</span><br><span class="line">    <span class="attribute">keepalive_requests</span> <span class="number">1000</span>;</span><br><span class="line">    <span class="attribute">keepalive_timeout</span> <span class="number">300s</span>;</span><br><span class="line">    server&#123;</span><br><span class="line">        <span class="attribute">listen</span>  <span class="number">8888</span>;</span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://192.168.1.20:8080;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>参考</p><ul><li><a href="https://blog.csdn.net/qq_31226223/article/details/78766314">Nginx 配置端口转发 映射 以及连接超时问题</a></li></ul></li></ul><ol><li>跨域问题解决</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">        listen       8081;//前端调试打开localhost:8081页面;js文件中后台接口访问localhost:8081/data;这样就保证不跨域了</span><br><span class="line">        <span class="attribute">server_name</span>  localhost;</span><br><span class="line">        <span class="attribute">access_log</span>  logs/host.access.log  main;</span><br><span class="line">        location / &#123;//访问localhost:8081实际上访问是前端端口http://localhost:8080/</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://localhost:8080/;</span><br><span class="line">        &#125;</span><br><span class="line">        location ^~ /data &#123;//访问localhost:8081/data实际上访问是后端接口http://10.128.166.42:8533/</span><br><span class="line">            <span class="attribute">rewrite</span><span class="regexp"> ^/data/(.*)</span> /<span class="variable">$1</span> <span class="literal">break</span>;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://10.128.166.42:8533/;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li>配置压缩</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_disable</span> <span class="string">&quot;msie6&quot;</span>;</span><br><span class="line"><span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_proxied</span> any;</span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">6</span>;</span><br><span class="line"><span class="attribute">gzip_buffers</span> <span class="number">16</span> <span class="number">8k</span>;</span><br><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">1</span>;</span><br><span class="line"><span class="attribute">gzip_types</span> text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss image/jpeg image/gif image/png</span><br></pre></td></tr></table></figure><ul><li><p>参考</p><ul><li><a href="https://blog.csdn.net/u013160932/article/details/50704618">Nginx—-使用压缩传输</a></li></ul></li></ul><ol><li>负载均衡</li></ol><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">upstream</span> favtomcat &#123;</span><br><span class="line">       <span class="attribute">server</span> <span class="number">10.0.6.108:7080</span> weight=<span class="number">5</span>;</span><br><span class="line">       <span class="attribute">server</span> <span class="number">10.0.0.85:8980</span> weight=<span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">root</span>   html;</span><br><span class="line">            <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://favtomcat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>参考</p><ul><li><a href="http://blog.51cto.com/favccxx/1622091">Nginx 配置 upstream 实现负载均衡</a></li></ul></li></ul><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新打开日志文件</span></span><br><span class="line"><span class="attribute">nginx</span> -s reopen</span><br><span class="line"><span class="comment"># 重新加载配置文件</span></span><br><span class="line">nginx -s reload</span><br><span class="line"><span class="comment"># 查看nginx的配置文件的目录，测试配置文件是否正确</span></span><br><span class="line">nginx -t</span><br><span class="line"><span class="comment"># 停止ngix（优雅关闭）</span></span><br><span class="line">nginx -s quit</span><br><span class="line"><span class="comment"># 关闭 nginx(快速关闭，不管有没有请求)</span></span><br><span class="line">nginx -s stop</span><br></pre></td></tr></table></figure><h3 id="常见错误"><a href="#常见错误" class="headerlink" title="常见错误"></a>常见错误</h3><ol><li><p>invalid PID</p><ul><li>错误信息</li></ul></li></ol><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx: [error] invalid PID number &quot;&quot; in &quot;/usr/local/var/run/nginx</span><br></pre></td></tr></table></figure><ul><li>解决方法</li></ul><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nginx -c <span class="regexp">/usr/</span>local<span class="regexp">/etc/</span>nginx/nginx.conf</span><br><span class="line">$ sudo nginx -s reload</span><br></pre></td></tr></table></figure><ol start="2"><li><p>nginx 做转发时，带’_‘的 header 内容丢失</p><ul><li>解决方法</li></ul></li></ol><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">underscores_in_headers <span class="keyword">on</span>;</span><br></pre></td></tr></table></figure><ul><li><p>参考</p></li><li><p><a href="https://blog.csdn.net/Nazir2513/article/details/70889319">nginx 做转发时，带’_‘的 header 内容丢失</a></p></li></ul><h3 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h3><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">worker_processes  1; //开启进程数小于CPU数</span><br><span class="line">error_log  logs/error.log;  //自定义错误日志保存位置，全局设置，默认logs/error.log</span><br><span class="line"><span class="section">events</span> &#123;</span><br><span class="line">    worker_connections  1024;//每个进程最大连接数（最大连接=连接数x进程数）每个worker允许同时产生多少个链接，默认1024</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    include       mime.types;//文件扩展名与文件类型映射表</span><br><span class="line">    default_type  application/octet-stream; //默认文件类型</span><br><span class="line">    <span class="attribute">log_format</span>  main  <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span>//自定义日志文件输出格式 全局设置</span><br><span class="line">              <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span></span><br><span class="line">              <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; &quot;<span class="variable">$http_x_forwarded_for</span>&quot;&#x27;</span>;</span><br><span class="line">    access_log  logs/access.log  main;自定义全局请求日志保存位置，全局设置，默认logs/access.log， 定义格式：文件存储位置 + 日志输出格式</span><br><span class="line">    sendfile        on; //打开发送文件</span><br><span class="line">    keepalive_timeout  0; //连接超时时间</span><br><span class="line">    <span class="attribute">keepalive_timeout</span>  <span class="number">65</span>;</span><br><span class="line">    gzip  on;//打开gzip压缩</span><br><span class="line">    配置虚拟主机，基于域名、ip和端口，可以配置多个server</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        listen       80;//监听端口，可以是ip:port 或者 port</span><br><span class="line">        server_name  10.128.166.57; //监听域名,可以是ip或者域名，server_name有三种匹配方式：精准匹配（www.domain.com）、通配符匹配（*.domain.com 、www.*）、正则表达式匹配（~^(?.+)\.domain\.com$）</span><br><span class="line">        access_log  logs/host.access.log  main; //自定义请求日志，局部，当前server有效</span><br><span class="line">        error_page   500 502 503 504  /50x.html;  //错误页面及其返回地址</span><br><span class="line">        charset UTF-8;//设置字符集</span><br><span class="line">        location / &#123; //当访问10.128.166.57:80时</span><br><span class="line">           proxy_pass http://10.128.166.57:80:8083; //实际上访问的时http://10.128.166.57:80:8083地址</span><br><span class="line">        &#125;</span><br><span class="line">        location ^~/data &#123; //当访问10.128.166.57:80/data时</span><br><span class="line">           proxy_pass http://10.128.166.57:80:8084; //实际上访问的时http://10.128.166.57:80:8084地址</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ol><li><a href="https://my.oschina.net/hansonwang99/blog/1835408">从一份配置清单详解 Nginx 服务器配置</a></li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/59e56e3a/">https://blog.coder4j.cn/posts/59e56e3a/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>[Linux] Linux用户管理</title>
      <link href="/posts/7e5abba9/"/>
      <url>/posts/7e5abba9/</url>
      
        <content type="html"><![CDATA[<h4 id="添加用户"><a href="#添加用户" class="headerlink" title="添加用户"></a>添加用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd 用户名称</span><br><span class="line">adduser 用户名称</span><br></pre></td></tr></table></figure><p><a href="https://my.oschina.net/lyp82nlf/blog/477319">Linux添加新用户命令：useradd 与adduser的区别</a></p><h4 id="设置用户密码"><a href="#设置用户密码" class="headerlink" title="设置用户密码"></a>设置用户密码</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd 用户名称</span><br></pre></td></tr></table></figure><h4 id="删除用户"><a href="#删除用户" class="headerlink" title="删除用户"></a>删除用户</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel 用户名称</span><br></pre></td></tr></table></figure><h4 id="常见问题："><a href="#常见问题：" class="headerlink" title="常见问题："></a>常见问题：</h4><h5 id="添加后并设置密码仍无法登录"><a href="#添加后并设置密码仍无法登录" class="headerlink" title="添加后并设置密码仍无法登录?"></a>添加后并设置密码仍无法登录?</h5><blockquote><p>查看 /etc/ssh/sshd_config 文件中是否允许登录，更多无法登录问题 <a href="http://lakemoonstar.iteye.com/blog/1471532">root 帐户无法登陆解决办法</a></p></blockquote><h5 id="修改了-etc-ssh-sshd-config仍然无效"><a href="#修改了-etc-ssh-sshd-config仍然无效" class="headerlink" title="修改了/etc/ssh/sshd_config仍然无效?"></a>修改了/etc/ssh/sshd_config仍然无效?</h5><blockquote><p>要更新配置，不能直接使用source xxx,要重启ssh服务，使用<code>service sshd restart</code></p></blockquote><h4 id="相关博客"><a href="#相关博客" class="headerlink" title="相关博客"></a>相关博客</h4><p><a href="https://blog.csdn.net/beitiandijun/article/details/41678251">linux用户管理（1）—-创建用户（adduser和useradd）和删除用户（userdel）</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/7e5abba9/">https://blog.coder4j.cn/posts/7e5abba9/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[问题集] mysql 数据库存储表情</title>
      <link href="/posts/b2644b76/"/>
      <url>/posts/b2644b76/</url>
      
        <content type="html"><![CDATA[<h4 id="问题出现原因"><a href="#问题出现原因" class="headerlink" title="问题出现原因"></a>问题出现原因</h4><blockquote><p>Emoji表情符号为4个字节的字符，而 utf8 字符集只支持1-3个字节的字符，导致无法写入数据库。  </p></blockquote><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><ul><li>语言<ul><li>java</li></ul></li><li>数据库连接池<ul><li>druid</li></ul></li><li>数据库<ul><li>mysql</li></ul></li><li>持久性框架<ul><li>mybatis</li></ul></li></ul><h4 id="数据库修改"><a href="#数据库修改" class="headerlink" title="数据库修改"></a>数据库修改</h4><ul><li>修改数据库字符集character-set-server=utf8mb4 重启数据库生效 </li></ul><h4 id="代码修改"><a href="#代码修改" class="headerlink" title="代码修改"></a>代码修改</h4><ul><li>druid 配置文件修改</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;connectionInitSqls&quot;</span> <span class="attr">value</span>=<span class="string">&quot;set names utf8mb4;&quot;</span>/&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/b2644b76/">https://blog.coder4j.cn/posts/b2644b76/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 问题 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 问题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转] 有没有安全的工作？</title>
      <link href="/posts/6d5f96f/"/>
      <url>/posts/6d5f96f/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="http://www.ruanyifeng.com/blog/2015/12/safe-job.html">http://www.ruanyifeng.com/blog/2015/12/safe-job.html</a></p></blockquote><p>如果你经常使用互联网，可能知道有一种东西叫做 Flash。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015121501.jpg"></p><p>它是一种软件，用来制作网页游戏、动画，以及视频播放器。只要观看网络视频，基本都会用到它。</p><p>七八年前，它是最热门的互联网技术之一。如果不安装 Flash，很多网站根本打不开。那时还流行用它制作动画，随便一个作品，就有几十万、上百万的浏览量。电视台甚至开辟栏目，播放网上流行的 Flash 动画。各大互联网公司都有专门的 Flash 工程师，还是属于那种比较抢手、收入较高的工程师。我记得那个时候，社会上也有大量的 Flash 培训班，它们的招生广告都写着保证就业。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015121502.jpg"></p><p>后来，Flash 就不行了。2010 年，乔布斯宣布，苹果手机不会使用 Flash，因为影响手机性能。再后来，新的技术兴起，它就开始没落了。上个月，BBC 发表一篇报道，名字就叫<a href="http://www.bbc.com/news/technology-34799790">《Flash 还能活多久？》</a>。话音刚落，一周后，这项技术的拥有者 Adobe 公司<a href="http://arstechnica.com/information-technology/2015/12/adobe-to-kill-off-flash-in-januarys-creative-cloud-update/">宣布</a>，放弃 Flash 这个名字，软件将<a href="http://www.zdnet.com/article/adobe-renames-flash-professional-to-animate-pivots-to-html5/">重新定位</a>，只用来制作动画。</p><p>说了这么多，我并不是感叹 Flash 这项技术的没落，这也是很正常的事，而是感叹那些从事 Flash 开发的工程师，他们该怎么办呢？你在一个领域钻研多年，都成了专家，突然之间那个领域过时了，你的所学所长没人需要了，那将是怎样的处境？</p><p>那些年里，我在上海遇见过一个朋友。他开了一家软件公司，专门面向海外市场开发 Flash 游戏。公司不大，十几个人，那时正是最好的年景，每个月都有几十万、甚至上百万人民币进账，看上去前景一片大好。可是，谁能想到 Flash 技术突然就会不行了呢？开始时，公司还能维持，后来手机游戏起来了，Flash 游戏的市场顿时萎缩。我见过他的招聘广告，改招手机游戏的开发者。再后来，就再没听到过他的消息。</p><p>当一种技术消亡的时候，与它相关的工作岗位也就消亡了。这种事情在技术行业特别多，因为技术的升级换代太快了。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015121503.jpg"></p><p>我再举一个例子。苹果手机出现之前，最流行的手机都使用 Nokia 公司开发的 “塞班” 操作系统。你可能还记得，它的典型标志就是 “九宫格” 菜单。那时，塞班工程师也是非常抢手的，彻底掌握它那一套开发技术，我估计至少要一两年时间。后来，智能手机流行，塞班一败涂地。2010 年，诺基亚宣布放弃塞班，改用微软的操作系统。再后来，Nokia 自己也没了，所有手机工程师都遣散了。我知道，Nokia 中国有一个资深工程师，选择重进大学去读 MBA 学位。</p><p><img src="http://www.ruanyifeng.com/blogimg/asset/2015/bg2015121504.jpg"></p><p>试想一下，你花了多年的心血，孜孜不倦地投入和练习，终于掌握了一门赖以谋生的手艺，还进入了世界排名第一位的通信业跨国公司。就在你觉得人生终于有一点安全感的时候，一切就变了，几年之间，曾经的巨无霸土崩瓦解，不仅你的职位没了，更可怕的是，以前的产品已经没人用了，全世界现在不生产任何塞班设备。你的手艺的价值变成了零。</p><p>有人说，可以再学习、然后重新就业啊，塞班不行了，可以学习苹果手机开发。没错，说得完全正确。但是，你以前的积累没了，需要从零开始。跟现在刚刚走出校门的学生，站在同一条起跑线上，学习同样的东西。说实话，虽然你有几年开发经验，但很可能并没有那些 20 岁的年轻人学得快。在一个高速变化的行业，经验有时候不是帮助，而是障碍，因为以前的那套行不通了。退一步说，就算你重新学习了，但苹果手机的开发也在变，你得不停地追赶新东西 。一个人的人生，能经受得起多少次从零开始呢？</p><p>“终身学习” 这个词完全没错，但是想通过 “终身学习” 保持职业竞争力，我觉得不太可能。</p><p>程序员，乃至其他很多技术岗位，其实是青春饭。只有底层的技术，还有一些稳定性，越接近应用层，技术的升级换代就越快。你学会一门技术，然后吃上三十年，这种事情越来越少见了。更常见的是，几年以后，你会的东西就淘汰了，你被迫重新学习新东西，或者重新就业。</p><p>为什么中国很少见 35 岁以上的程序员？因为他们上学时学习的东西都淘汰了，必须和年轻人一起学习新技术。你很难比年轻人更有竞争力，其中最关键的是，雇佣刚走出校门的学生，比雇佣你便宜得多。</p><p>其他行业的升级换代，不如技术行业那么夸张和激进。职业的安全感可以保持得更久一些，但远不是高枕无忧。技术正在取代人力劳动，比如财务会计这样的行业，随着电子支付的兴起，将来肯定不会需要这么多财务人员。”互联网 +” 从某个方面说，就是使用互联网技术取代一部分人力，更便宜地服务更多的顾客。</p><p>回到本文的题目，世界上有没有安全的工作？应该是有的吧，但真的不多。公务员可能比较安全，因为这个职业改变得比较缓慢，而且没有技术升级的压力。医生和律师，也比较安全，因为对于这些行业，经验很重要，但技术正在把它们的成本降下来。厨师和物流，也是比较安全的行业，因为技术再进步，也总需要人来做饭和送货，但是它们是纯粹的体力劳动，没有进入门槛，供给非常大，想拿到高工资不容易。</p><p>最终来说，人类社会的就业形态正在发生深刻的改变，”终生职业” 越来越少了。每个人都应该尽早打算，如果明天你的职业消失了，你该怎么办？</p><p>[说明] 原文发表在<a href="http://culture.caixin.com/2015-12-11/100885728.html">《财新周刊》</a>（2015 年 12 月 11 日）的专栏。</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/6d5f96f/">https://blog.coder4j.cn/posts/6d5f96f/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 转载 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 转载 </tag>
            
            <tag> 职业道路 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转] Java 8 开发的 4 大顶级技巧</title>
      <link href="/posts/e0656c9c/"/>
      <url>/posts/e0656c9c/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="http://www.importnew.com/22417.html">http://www.importnew.com/22417.html</a> 译文出处： <a href="https://www.evget.com/article/2016/8/10/24674.html">Elyn</a>   原文出处：<a href="https://dzone.com/articles/java-8-top-tips">Java 8 Top Tips</a></p></blockquote><p>我使用 Java 8 编码已经有些年头，既用于新的应用程序，也用来迁移现有的应用，感觉是时候写一些我发现的非常有用的 “最佳实践”。我个人并不喜欢“最佳实践” 这个说法，因为它意味着 “一刀切” 的解决方案，而编码不可能是这样的工作方式——我们需要亲自去发现什么样的解决方案才是有效的。但是我发现了一些 Java 8 代码中可以帮助我们的一些选择，让我们一起来看看吧。</p><h3 id="1-Optional"><a href="#1-Optional" class="headerlink" title="1.Optional"></a><strong>1.Optional</strong></h3><p>Optional 是一个严重被低估的功能，并且有潜力删除很多困扰我们的 NullPointerExceptions。这在代码边界中（要么是正在使用的 API，要么是正在暴露的 API）特别有用，因为它允许你和你的调用代码来推理所期待的东西。</p><p>然而，不加思考和设计就应用 Optional 可能会导致影响大量的类，并可能导致可读性更差。下面是一些关于如何高效使用 Optional 的技巧。</p><h4 id="Optional-应该只用于返回类型"><a href="#Optional-应该只用于返回类型" class="headerlink" title="Optional 应该只用于返回类型"></a><strong>Optional 应该只用于返回类型</strong></h4><p>…… 不是参数，也不是字段。幸运的是，IntelliJ IDEA 的让你打开检查来查看是是否遵循这些建议。</p><p><img src="http://image.evget.com/images/article/2016/java81.png"></p><p>Optional 值应在遇到它们的地方中处理。IntelliJ IDEA 的建议会防止代码 Optional 泄漏，所以请记得在你发现 Optional 的地方处理它，迅速采取行动。</p><p><img src="http://image.evget.com/images/article/2016/java82.png"></p><h4 id="不应该简单调用-get"><a href="#不应该简单调用-get" class="headerlink" title="不应该简单调用 get()"></a><strong>不应该简单调用 get()</strong></h4><p>Optional 的功能是表达这个值可能是空的，并让你应对这种情况。因此，在对它做任何事情之前一定要检查是否有一个值。只是简单得调用 get() 而不先检查 isPresent() 在某些时候可能会导致空指针。幸运的是，IntelliJ IDEA 也有检查可以提醒你这一点。</p><p><img src="http://image.evget.com/images/article/2016/java83.png"></p><h4 id="可能有更优雅的方式"><a href="#可能有更优雅的方式" class="headerlink" title="可能有更优雅的方式"></a><strong>可能有更优雅的方式</strong></h4><p>结合了 get() 的 isPresent() 当然会很赞…</p><p><img src="http://image.evget.com/images/article/2016/java84.png"></p><p>…… 但也有更优雅的解决方案。你可以使用 orElse 在万一是空值的情况下给一个替代方案。</p><p><img src="http://image.evget.com/images/article/2016/java85.png"></p><p>…… 或者你可以使用 orElseGet 说明在值为空的情况下调用哪个方法。这似乎与上面的例子相同，但 supplier 方法将只在需要的时候调用，因此，如果这是一种昂贵的方法，那么使用 lambda 会有更佳性能。</p><p><img src="http://image.evget.com/images/article/2016/java86.png"></p><h3 id="2-使用-Lambda-表达式"><a href="#2-使用-Lambda-表达式" class="headerlink" title="2. 使用 Lambda 表达式"></a><strong>2. 使用 Lambda 表达式</strong></h3><p>Lambda 表达式是 Java 8 的主要特点之一。即使你还没有使用 Java 8，你现在可能已经对它们有了基本的了解。它们是用 Java 编程的一种新的方式，并且什么是 “最佳实践” 还不明显。下面是我喜欢遵循的一些指引。</p><h4 id="保持简短"><a href="#保持简短" class="headerlink" title="保持简短"></a><strong>保持简短</strong></h4><p>函数式程序员与较长的 lambda 表达式相处会更愉快，但那些淫浸于 Java 多年的人会发现保持 lambda 表达式为区区几行代码更容易。你甚至可能更愿意将其限制到一行代码，并且你可以轻松<a href="http://www.amazon.cn/gp/product/B003BY6PLK/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&tag=importnew-23&linkCode=as2&camp=536&creative=3200&creativeASIN=B003BY6PLK" title="重构">重构</a>较长的表达式为一个方法。</p><p><img src="http://image.evget.com/images/article/2016/java87.png"></p><p>这些甚至可能会成为方法引用。方法引用一开始会觉得有点陌生，但实际上坚持方法引用是有价值的，因为它们在某些情况下有助于可读性，后面我会讨论到这一点。</p><p><img src="http://image.evget.com/images/article/2016/java88.png"></p><h4 id="明确"><a href="#明确" class="headerlink" title="明确"></a><strong>明确</strong></h4><p>类型信息缺少 lambda 表达式，所以你可能会觉得包含类型信息用于参数会很有用。</p><p><img src="http://image.evget.com/images/article/2016/java899.png"></p><p>正如你所见，这回变得相当笨拙。所以我更喜欢给参数取一个有用的名字。当然，不管你有没有这么做，IntelliJ IDEA 可以让你看到参数得类型信息。</p><p><img src="http://image.evget.com/images/article/2016/java89.png"></p><p>甚至是 lambda 所代表的函数式接口：</p><p><img src="http://image.evget.com/images/article/2016/java810.png"></p><h3 id="3-针对-Lambda-表达式设计"><a href="#3-针对-Lambda-表达式设计" class="headerlink" title="3. 针对 Lambda 表达式设计"></a><strong>3. 针对 Lambda 表达式设计</strong></h3><p>我认为 lambda 表达式有点像泛型——和泛型一起，我们经常使用它们（例如，添加类型信息到 List&lt;&gt;），但最好我们可以设计一种方法或一个具有泛型类型（例如 Person&lt; T&gt;）的类。同样的，当使用类似于 Streams API 的东西时，我们会传递 lambda 表达式，但更好的是创造一个需要 lambda 参数的方法。</p><p>但是，如果你发现自己处于这类情况下，下面有一些超棒的技巧。</p><h4 id="IntelliJ-IDEA-可以帮你引进函数式参数"><a href="#IntelliJ-IDEA-可以帮你引进函数式参数" class="headerlink" title="IntelliJ IDEA 可以帮你引进函数式参数"></a><strong>IntelliJ IDEA 可以帮你引进函数式参数</strong></h4><p>这让你可以在有人将传递一个 lambda 而非 Object 的地方创建一个参数。此功能的好处是，它表明，现有函数式接口匹配规格说明。</p><p><img src="http://image.evget.com/images/article/2016/java811.png"></p><p>这会导致…</p><h4 id="使用现有的函数式接口"><a href="#使用现有的函数式接口" class="headerlink" title="使用现有的函数式接口"></a><strong>使用现有的函数式接口</strong></h4><p>随着开发人员越来越熟悉 Java 8 代码，我们就能知道当使用如 Supplier 和 Consumer 的接口时，会发生什么，以及创建一个本地的 ErrorMessageCreator（举个例子）可能会造成混乱，而且浪费。看看这个函数包了解一下哪些已经是可用的。</p><h4 id="添加-FunctionalInterface-到函数式接口"><a href="#添加-FunctionalInterface-到函数式接口" class="headerlink" title="添加 @FunctionalInterface 到函数式接口"></a><strong>添加 @FunctionalInterface 到函数式接口</strong></h4><p>如果你确实需要创建自己的函数式接口，那么就这样用此注释标记。这似乎没有太大的作用，但 IntelliJ IDEA 会告诉你，在你的接口不能匹配用于函数式接口的异常的时候。当你没有指定要覆盖的方法时，它会标志：</p><p><img src="http://image.evget.com/images/article/2016/java812.png"></p><p>当你指定了太多方法的时候，它会标志：</p><p><img src="http://image.evget.com/images/article/2016/java813.png"></p><p>并且如果你应用它到一个类而不是接口时，它会警告你：</p><p><img src="http://image.evget.com/images/article/2016/java814.png"></p><p>lambda 表达式可用于带有一个单一抽象方法的任何接口，但它们不能用于符合相同标准的抽象类。似乎不合逻辑，但就是这样。</p><h3 id="4-Stream"><a href="#4-Stream" class="headerlink" title="4.Stream"></a><strong>4.Stream</strong></h3><p>Stream API 是 Java 8 另一个大特点，并且我认为我们还真的不知道这对我们的编码方式会产生多大的改变。下面是我发现的一些有用的东西</p><h4 id="排队点操作符"><a href="#排队点操作符" class="headerlink" title="排队点操作符"></a><strong>排队点操作符</strong></h4><p>我个人更喜欢排队我的流操作。当然，你没有必要这样，当我发现这样做对我有帮助：</p><ul><li>一目了然地看到我有哪些操作</li><li>调试更容易（虽然 IntelliJ IDEA 确实提供了对一行中的任意多个 lambda 表达式设置断点的能力，但是拆分到不同的行会变得更简单）</li><li>当我测试东西的时候注释操作</li><li>轻松插入 peek() 用于调试或测试</li></ul><p><img src="http://image.evget.com/images/article/2016/java815.png"></p><p>此外，在我看来，它更整洁。如果我们按照这个模式，在减少代码行数方面我们并没有增加很多。</p><p>你可能需要调整格式设置以排列点操作符。</p><p><img src="http://image.evget.com/images/article/2016/java816.png"></p><h4 id="使用方法引用"><a href="#使用方法引用" class="headerlink" title="使用方法引用"></a><strong>使用方法引用</strong></h4><p>是的，确实需要一段时间来适应这个奇怪的语法。但是，如果使用得当，它确实可以增加可读性。请看：</p><p><img src="http://image.evget.com/images/article/2016/java817.png"></p><p>与（相对）新的 Objects 类上的辅助方法相比较：</p><p><img src="http://image.evget.com/images/article/2016/java818.png"></p><p>后者的代码对于哪些值是要保存的更加明确。当 lambda 可以被折叠到方法参考的时候，IntelliJ IDEA 通常会让你知道。</p><p><img src="http://image.evget.com/images/article/2016/java819.png"></p><h4 id="当遍历一个集合时，在可行的情况下使用-Streams-API"><a href="#当遍历一个集合时，在可行的情况下使用-Streams-API" class="headerlink" title="当遍历一个集合时，在可行的情况下使用 Streams API"></a><strong>当遍历一个集合时，在可行的情况下使用 Streams API</strong></h4><p>… 或者新的集合方法，如 forEach。IntelliJ IDEA 给你建议是：</p><p><img src="http://image.evget.com/images/article/2016/java820.png"></p><p>一般使用 Streams API 比循环和 if 语句的组合更加明确。例如：</p><p><img src="http://image.evget.com/images/article/2016/java821.png"></p><p>IntelliJ IDEA 建议这可重构为：</p><p><img src="http://image.evget.com/images/article/2016/java822.png"></p><p>我所做的性能测试表明这种重构令人惊讶——并不总是可预测性能是保持不变，改善还是变得更糟。与往常一样，如果性能在应用程序中是关键，那么在交付一种风格到另一种之前衡量它。</p><h4 id="遍历数组时使用循环"><a href="#遍历数组时使用循环" class="headerlink" title="遍历数组时使用循环"></a><strong>遍历数组时使用循环</strong></h4><p>但是，使用 Java 8 并不一定意味着你必须到处使用流和新的集合方法。IntelliJ IDEA 会建议转换成流，但是，这并不意味着你必须回答 “yes”（记得检查是可以抑制或关闭的）。</p><p>特别是，遍历原始类型的小型数组几乎肯定会用，以获得更好的性能循环，很可能（至少对于 Java 开发人员是新的流）更具可读性。</p><p><img src="http://image.evget.com/images/article/2016/java823.png"></p><p>与任何技巧一样，规则并不是一成不变的，但你应该决定是尽可能地使用 Streams API，还是依然对一些操作使用循环。总之，要一致。</p><h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a><strong>最后</strong></h3><p>每天都在发现新的东西，并且有时候我的偏好会发生变化——例如，方法引用，我曾经深恶痛绝并且避免在我的代码中使用。现在我很想听听你的秘诀！</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/e0656c9c/">https://blog.coder4j.cn/posts/e0656c9c/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> jdk8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转] 使用 Java8 Optional 的正确姿势</title>
      <link href="/posts/1c080b4/"/>
      <url>/posts/1c080b4/</url>
      
        <content type="html"><![CDATA[<p><a href="http://www.importnew.com/22060.html">原文链接</a></p><p><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fou0ynetdcj21hc3847rl.jpg"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/1c080b4/">https://blog.coder4j.cn/posts/1c080b4/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> jdk8 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转] 版本号命名指南</title>
      <link href="/posts/e6ce36f0/"/>
      <url>/posts/e6ce36f0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="http://www.importnew.com/28063.html">http://www.importnew.com/28063.html</a> 原文出处： <a href="http://wsfdl.com/devops/2016/09/27/%E7%89%88%E6%9C%AC%E5%8F%B7.html">koala bear</a></p></blockquote><p>首先看看某些常见软件的版本号：</p><ul><li>Linux Kernel： 0.0.1，1.0.0，2.6.32，3.0.18…，若用 X.Y.Z 表示，则偶数 Y 表示稳定版本，奇数 Y 表示开发版本。</li><li>Windows：windows 98，windows 2000，windows xp，windows 7…，最大的特点是杂乱无章，毫无规律。</li><li>SSH Client：0.9.8。</li><li>OpenStack：2014.1.3，2015.1.1.dev8。</li></ul><p>从上可以看出，不同的软件版本号风格各异，随着系统的规模越大，依赖的软件越多，如果这些软件没有遵循一套规范的命名风格，容易造成 <a href="https://en.wikipedia.org/wiki/Dependency_hell">Dependency Hell</a>。所以当我们发布版本时，版本号的命名需要遵循某种规则，其中 <a href="http://semver.org/">Semantic Versioning 2.0.0</a> 定义了一套简单的规则及条件来约束版本号的配置和增长。本文根据 <a href="http://semver.org/">Semantic Versionning 2.0.0</a> 和 <a href="http://docs.openstack.org/developer/pbr/semver.html">Semantic Versioning 3.0.0</a> 选择性的整理出版本号命名规则指南。</p><hr><h1 id="版本号命名规则指南"><a href="#版本号命名规则指南" class="headerlink" title="版本号命名规则指南"></a>版本号命名规则指南</h1><p>版本号的格式为 X.Y.Z(又称 Major.Minor.Patch)，递增的规则为：</p><ul><li>X 表示主版本号，当 API 的兼容性变化时，X 需递增。</li><li>Y 表示次版本号，当增加功能时 (不影响 API 的兼容性)，Y 需递增。</li><li>Z 表示修订号，当做 Bug 修复时 (不影响 API 的兼容性)，Z 需递增。</li></ul><p>详细的规则如下：</p><ol><li>X, Y, Z 必须为非负整数，且不得包含前导零，必须按数值递增，如 1.9.0 -&gt; 1.10.0 -&gt; 1.11.0</li><li>0.Y.Z 的版本号表明软件处于初始开发阶段，意味着 API 可能不稳定；1.0.0 表明版本已有稳定的 API。</li><li>当 API 的兼容性变化时，X 必须递增，Y 和 Z 同时设置为 0；当新增功能 (不影响 API 的兼容性) 或者 API 被标记为 Deprecated 时，Y 必须递增，同时 Z 设置为 0；当进行 bug fix 时，Z 必须递增。</li><li>先行版本号 (Pre-release) 意味该版本不稳定，可能存在兼容性问题，其格式为：X.Y.Z.[a-c][正整数]，如 1.0.0.a1，1.0.0.b99，1.0.0.c1000。</li><li>开发版本号常用于 CI-CD，格式为 X.Y.Z.dev[正整数]，如 1.0.1.dev4。</li><li>版本号的排序规则为依次比较主版本号、次版本号和修订号的数值，如 1.0.0 &lt; 1.0.1 &lt; 1.1.1 &lt; 2.0.0；对于先行版本号和开发版本号，有：1.0.0.a100 &lt; 1.0.0，2.1.0.dev3 &lt; 2.1.0；当存在字母时，以 ASCII 的排序来比较，如 1.0.0.a1 &lt; 1.0.0.b1。</li><li>注意：版本一经发布，不得修改其内容，任何修改必须在新版本发布！</li></ol><hr><h1 id="一些修饰的词"><a href="#一些修饰的词" class="headerlink" title="一些修饰的词"></a>一些修饰的词</h1><ul><li>alpha：内部版本</li><li>beta：测试版</li><li>demo：演示版</li><li>enhance：增强版</li><li>free：自由版</li><li>full version：完整版，即正式版</li><li>lts：长期维护版本</li><li>release：发行版</li><li>rc：即将作为正式版发布</li><li>standard：标准版</li><li>ultimate：旗舰版</li><li>upgrade：升级版</li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/e6ce36f0/">https://blog.coder4j.cn/posts/e6ce36f0/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 程序员的自我修养 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 程序员的自我修养 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转] 正则表达式简明参考</title>
      <link href="/posts/2c2a8af7/"/>
      <url>/posts/2c2a8af7/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="http://xiaoleilu.com/regex-guide">http://xiaoleilu.com/regex-guide</a></p></blockquote><h1 id="正则表达式简明参考"><a href="#正则表达式简明参考" class="headerlink" title="正则表达式简明参考"></a><a href="/regex-guide" title="正则表达式简明参考">正则表达式简明参考</a></h1><p>2014-09-11</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我想在网上最出名的正则相关的一篇文章就是《正则表达式30分钟入门教程》了，说实话这篇文章确实是我的正则入门，但是随着使用熟练，冗长的文章已经不能满足我了，在此做个归纳总结，用于快速查阅。</p><p>以下语法在<strong>Java</strong>中有效，大部分应该是通用的。</p><h2 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h2><p>元字符，又叫字符集，就是用一些特殊符号表示特定种类的字符或位置。</p><p><strong>匹配字符</strong></p><ul><li><code>.</code> 匹配除换行符以外的任意字符</li><li><code>\w</code> 匹配字母或数字或下划线或汉字</li><li><code>\s</code> 匹配任意的空白符</li><li><code>\d</code> 匹配数字</li></ul><p><strong>匹配位置</strong></p><ul><li><code>\b</code> 匹配单词的开始或结束</li><li><code>^</code> 匹配字符串的开始</li><li><code>$</code> 匹配字符串的结束</li><li><code>\G</code> 上一个匹配的结尾（本次匹配开始）</li><li><code>\A</code> 字符串开头(类似<code>^</code>，但不受处理多行选项的影响)</li><li><code>\Z</code> 字符串结尾或行尾(不受处理多行选项的影响)</li><li><code>\z</code> 字符串结尾(类似<code>$</code>，但不受处理多行选项的影响)</li></ul><p><strong>重复</strong></p><ul><li><code>*</code> 重复零次或更多次</li><li><code>+</code> 重复一次或更多次</li><li><code>?</code> 重复零次或一次</li><li><code>&#123;n&#125;</code> 重复n次</li><li><code>&#123;n,&#125;</code> 重复n次或更多次</li><li><code>&#123;n,m&#125;</code> 重复n到m次</li></ul><h2 id="字符转义"><a href="#字符转义" class="headerlink" title="字符转义"></a>字符转义</h2><p>如果想匹配元字符本身或者正则中的一些特殊字符，使用<code>\</code>转义。例如匹配<code>*</code>这个字符则使用<code>\*</code>，匹配<code>\</code>这个字符，使用<code>\\</code>。</p><p>需要转义的字符：<code>$</code>, <code>(</code>, <code>)</code>, <code>*</code>, <code>+</code>, <code>.</code>, <code>[</code>, <code>]</code>, <code>?</code>, <code>\</code>, <code>^</code>, <code>&#123;</code>, <code>&#125;</code>, <code>|</code></p><h2 id="字符类"><a href="#字符类" class="headerlink" title="字符类"></a>字符类</h2><p>当需要匹配明确的字符或字符集合时候，就用到字符类。</p><p><strong>特殊字符</strong></p><ul><li><code>\0hh</code> 8进制值hh所表示的字符</li><li><code>\xhh</code> 16进制值hh所表示的字符</li><li><code>\uhhhh</code> 16进制值hhhh所表示的Unicode字符</li><li><code>\t</code> Tab</li><li><code>\n</code> 换行符</li><li><code>\r</code> 回车符</li><li><code>\f</code> 换页符</li><li><code>\e</code> Escape</li><li><code>\cN</code> ASCII控制字符。比如<code>\cC</code>代表<code>Ctrl+C</code></li><li><code>\p&#123;name&#125;</code> Unicode中命名为name的字符类，例如<code>\p&#123;IsGreek&#125;</code></li></ul><p><strong>陈列</strong></p><ul><li><code>[aeiou]</code> 匹配一个元音字符</li><li><code>[.?!]</code> 匹配给定的一个标点</li></ul><p><strong>范围</strong></p><ul><li><code>[0-9]</code> 匹配0~9的数字，同<code>\d</code></li><li><code>[a-z]</code> 匹配所有小写字母</li><li><code>[a-zA-Z]</code> 匹配所有字母</li><li><code>[a-z0-9A-Z_\u4E00-\u9FFF]</code> 等同于<code>\w</code></li></ul><h2 id="反义"><a href="#反义" class="headerlink" title="反义"></a>反义</h2><p>表示不属于元字符或者字符类的字符</p><p><strong>反义元字符</strong></p><ul><li><code>\W</code> 匹配任意不是字母，数字，下划线，汉字的字符</li><li><code>\S</code> 匹配任意不是空白符的字符</li><li><code>\D</code> 匹配任意非数字的字符</li><li><code>\B</code> 匹配不是单词开头或结束的位置</li></ul><p><strong>反义字符类</strong></p><ul><li><code>[^x]</code> 匹配除了x以外的任意字符</li><li><code>[^aeiou]</code> 匹配除了aeiou这几个字母以外的任意字符</li></ul><h2 id="分枝条件"><a href="#分枝条件" class="headerlink" title="分枝条件"></a>分枝条件</h2><p>又叫逻辑运算符，在此<code>X</code>和<code>Y</code>表示两个<strong>表达式</strong></p><ul><li><code>XY</code> X紧跟Y</li><li><code>X|Y</code> 表示X或Y，从左到右，满足第一个条件就不会继续匹配了。</li></ul><h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>在这里我把<strong>表达式</strong>统一以<code>\w</code>为例：</p><ul><li><code>(\w)</code> 被一个括号包围起来是一个整体，表示一个分组</li><li><code>(\w)(\w)</code> 自动命名分组，第一个小括号是分组1，第二个小括号是分组2</li><li><code>(?&#39;Word&#39;\w+))</code> 表示定义了一个叫做<code>Word</code>的分组</li><li><code>(?&lt;Word&gt;\w+))</code> 表示定义了一个叫做<code>Word</code>的分组</li><li><code>(?:\w+)</code> 匹配exp,不捕获匹配的文本，也不给此分组分配组号</li></ul><h2 id="后向引用"><a href="#后向引用" class="headerlink" title="后向引用"></a>后向引用</h2><p>后面的表达式可以引用前面的某个分组，用<code>\1</code>表示，就好像分组1的值赋值给了<code>\1</code>这个变量，这个变量可以在后面任意位置引用。</p><ul><li><code>\1</code> 表示分组1匹配的文本</li><li><code>\k&lt;Word&gt;</code> 表示分组<code>Word</code>匹配的文本</li></ul><p>匹配重复两个的英文，例如匹配<code>Hello Hello</code>、<code>lei123 lei123</code>：</p><ol><li><code>(\w+)\s+\1</code></li><li><code>(?&lt;Word&gt;\w+)\s+\k&lt;Word&gt;</code></li></ol><h2 id="零宽断言（正向和负向）"><a href="#零宽断言（正向和负向）" class="headerlink" title="零宽断言（正向和负向）"></a>零宽断言（正向和负向）</h2><p>零宽断言表示匹配字符的时候再添加一些定位条件，使匹配更精准。</p><ul><li><code>\w+(?=ing)</code> 匹配以<code>ing</code>结尾的多个字符（不包括ing）</li><li><code>\w+(?!ing)</code> 匹配<strong>不是</strong>以<code>ing</code>结尾的多个字符</li></ul><hr><ul><li><code>(?&lt;=re)\w+</code> 匹配以<code>re</code>开头的多个字符（不包括re）</li><li><code>(?&lt;!re)\w+</code> 匹配<strong>不是</strong>以<code>re</code>开头的多个字符</li></ul><hr><ul><li><code>(?&lt;=\s)\d+(?=\s)</code> 匹配两边是空白符的数字，不包括空白符</li></ul><h2 id="贪婪与懒惰"><a href="#贪婪与懒惰" class="headerlink" title="贪婪与懒惰"></a>贪婪与懒惰</h2><p><strong>贪婪</strong>：匹配尽可能长的字符串</p><p><strong>懒惰</strong>：匹配尽可能短的字符串</p><p>懒惰模式的启用只需在<strong>重复元字符</strong>之后加<code>?</code>既可。</p><ul><li><code>*?</code> 重复任意次，但尽可能少重复</li><li><code>+?</code> 重复1次或更多次，但尽可能少重复</li><li><code>??</code> 重复0次或1次，但尽可能少重复</li><li><code>&#123;n,m&#125;?</code> 重复n到m次，但尽可能少重复</li><li><code>&#123;n,&#125;?</code> 重复n次以上，但尽可能少重复</li></ul><h2 id="处理选项"><a href="#处理选项" class="headerlink" title="处理选项"></a>处理选项</h2><p>在表达式里插记号的方式来启用绝大多数的模式，在正则的哪里插入，就从哪里启用。</p><ol><li><code>(?i)</code>：忽略大小写(CASE_INSENSITIVE)</li><li><code>(?x)</code>：忽略空格字符(COMMENTS)</li><li><code>(?s)</code>：<code>.</code>匹配任意字符，包括换行符（DOTALL）</li><li><code>(?m)</code>：多行模式（MULTILINE）</li><li><code>(?u)</code>：对Unicode符大小写不敏感（UNICODE_CASE），必须启用<strong>CASE_INSENSITIVE</strong></li><li><code>(?d)</code>：只有’\n’才被认作一行的中止（UNIX_LINES）</li></ol><h2 id="平衡组-递归匹配"><a href="#平衡组-递归匹配" class="headerlink" title="平衡组/递归匹配"></a>平衡组/递归匹配</h2><p>平衡组用于匹配嵌套层次结构，常用于匹配HTML标签（当HTML内容不规范，起始标签和结束标签数量不同时，匹配出正确配对的标签），在此把表达式统一以<code>\w</code>为例。</p><ul><li><code>(?&#39;group&#39;\w)</code> 捕获的分组（<code>\w</code>匹配到的内容）命名为<code>group</code>，并压入堆栈</li><li><code>(?&#39;-group&#39;\w)</code> 捕获分组（<code>\w</code>匹配到的内容）后，弹出<code>group</code>分组栈的栈顶内容（最后压入的捕获内容），堆栈本来为空，则本分组的匹配失败</li><li><code>(?(group)yes|no)</code> 如果<code>group</code>栈非空匹配表达式<code>yes</code>，否则匹配表达式<code>no</code></li><li><code>(?!)</code> 零宽负向先行断言，由于没有后缀表达式，试图匹配总是失败</li></ul><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><p>注释语法：<code>(?#comment)</code>，这个语法的内容会被正则忽略，用于注释含义。可以放在正则表达式的任意位置。</p><hr><p>参考：</p><p><a href="http://www.jb51.net/tools/zhengze.html">正则表达式30分钟入门教程</a></p><p><a href="http://www.java3z.com/cwbwebhome/article/article2/2311.html?id=877">正则表达式</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/2c2a8af7/">https://blog.coder4j.cn/posts/2c2a8af7/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> 正则 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转] 小明历险记：规则引擎drools教程一</title>
      <link href="/posts/2b59e1bf/"/>
      <url>/posts/2b59e1bf/</url>
      
        <content type="html"><![CDATA[<p>转自 <a href="http://www.ityouknow.com/drools/2017/08/07/drools-started.html">小明历险记：规则引擎drools教程一</a><br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fobrwwkdg4j21hc6jpe82.jpg"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/2b59e1bf/">https://blog.coder4j.cn/posts/2b59e1bf/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 规则引擎 </category>
          
          <category> java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> drools </tag>
            
            <tag> 规则引擎 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mysql 中 between and 的边界问题</title>
      <link href="/posts/77226281/"/>
      <url>/posts/77226281/</url>
      
        <content type="html"><![CDATA[<blockquote><p>mysql 中的 between … and … 语法，相信大家都会，但是在边界这个细节上一不留神就可能会出错。下面就以一个简单的例子去理解边界性的问题。</p></blockquote><ol><li><p>首先我们建一个简单的用户表，简单到只有一个 age 和 name 字段（其实可以没有），下面是建表语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t_user</span><br><span class="line">(</span><br><span class="line">    age <span class="built_in">int</span> <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">30</span>) <span class="literal">null</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">engine</span>=<span class="keyword">InnoDB</span></span><br><span class="line">;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p>插入几条测试语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytest.t_user (age, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">15</span>, <span class="string">&#x27;kiwi&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytest.t_user (age, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">17</span>, <span class="string">&#x27;kimi&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytest.t_user (age, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">18</span>, <span class="string">&#x27;tony&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytest.t_user (age, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">23</span>, <span class="string">&#x27;kim&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> mytest.t_user (age, <span class="keyword">name</span>) <span class="keyword">VALUES</span> (<span class="number">25</span>, <span class="string">&#x27;tom&#x27;</span>);</span><br></pre></td></tr></table></figure></li><li><p>执行完插入语句后，表应该是如下这样<br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fobqkynwtbj20b005mjrk.jpg"></p></li><li><p>准备工作已经做完了，我们先执行一下 between and 语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> age <span class="keyword">BETWEEN</span> <span class="number">17</span> <span class="keyword">AND</span> <span class="number">23</span>;</span><br></pre></td></tr></table></figure><ul><li>执行结果如下<br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fobqo084drj20am03qq2y.jpg"></li><li>分析<blockquote><p>可见结果是包含边界的，在这里也就是包含 17 与 23，相当于如下 sql ，<br><code>SELECT * FROM t_user WHERE age &gt;= 17 AND age &lt;= 23;</code></p></blockquote></li></ul></li><li><p>我们接着执行 not between and 语句</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t_user <span class="keyword">WHERE</span> age <span class="keyword">NOT</span> <span class="keyword">BETWEEN</span> <span class="number">17</span> <span class="keyword">AND</span> <span class="number">23</span>; </span><br></pre></td></tr></table></figure><ul><li>执行结果如下<br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fobqv3ybjxj20am02u3yg.jpg"><ul><li>分析<blockquote><p>可见结果是不包含边界的，在这里也就是 17 与 23 不在检索条件内，相当于如下 sql ,<br><code>SELECT * FROM t_user WHERE age &lt; 17 OR age &gt; 23;</code></p></blockquote></li></ul></li></ul></li><li><p>最终结论</p><ol><li>between … and … 是包含边界的，相当于 … &gt;= AND &lt;= … ，很容易以为是大于并且小于边界的</li><li>not between … and … 是不包含边界的，相当于 … &gt; OR &lt; …，这里可以理解为是 between  … and 的否命题</li></ol></li></ol><p>本文地址 <a href="https://blog.coder4j.cn/posts/77226281/">https://blog.coder4j.cn/posts/77226281/</a> </p>]]></content>
      
      
      <categories>
          
          <category> mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> between and </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>docker 常用命令</title>
      <link href="/posts/d76bceb7/"/>
      <url>/posts/d76bceb7/</url>
      
        <content type="html"><![CDATA[<h5 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h5>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 命令格式</span></span><br><span class="line">docker 命令关键字(command) 一系列参数([args...]) </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询命令帮助</span></span><br><span class="line">docker command --help</span><br></pre></td></tr></table></figure><h6 id="1-启动容器"><a href="#1-启动容器" class="headerlink" title="1. 启动容器"></a>1. 启动容器</h6><p><code>docker start id/name</code></p><h6 id="2-关闭容器"><a href="#2-关闭容器" class="headerlink" title="2. 关闭容器"></a>2. 关闭容器</h6><p><code>docker stop id/name</code></p><h6 id="3-查询在线容器"><a href="#3-查询在线容器" class="headerlink" title="3. 查询在线容器"></a>3. 查询在线容器</h6>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker ps [-a] </span><br><span class="line"><span class="meta">#</span><span class="bash"> -a 显示所有，包括已经关闭的</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="4-查询容器信息"><a href="#4-查询容器信息" class="headerlink" title="4. 查询容器信息"></a>4. 查询容器信息</h6><p><code>docker inspect id/name</code></p><h6 id="5-查看容器日志"><a href="#5-查看容器日志" class="headerlink" title="5. 查看容器日志"></a>5. 查看容器日志</h6><p><code>docker logs [-f] id/name</code></p><h6 id="6-查看容器资源占用"><a href="#6-查看容器资源占用" class="headerlink" title="6. 查看容器资源占用"></a>6. 查看容器资源占用</h6><p><code>docker stats</code></p><h6 id="7-容器内部命令"><a href="#7-容器内部命令" class="headerlink" title="7. 容器内部命令"></a>7. 容器内部命令</h6>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在容器内部执行命令</span></span><br><span class="line">docker exec id/name 执行命令  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 以root用户执行命令</span></span><br><span class="line">docker exec -it id/name 执行命令</span><br><span class="line"><span class="meta">#</span><span class="bash"> 以root用户打开一个终端,<span class="built_in">exit</span>退出</span></span><br><span class="line">docker exec -it id/name /bin/bash</span><br></pre></td></tr></table></figure><h6 id="8-镜像查询"><a href="#8-镜像查询" class="headerlink" title="8. 镜像查询"></a>8. 镜像查询</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker search xx</span><br></pre></td></tr></table></figure><h6 id="9-镜像下载"><a href="#9-镜像下载" class="headerlink" title="9. 镜像下载"></a>9. 镜像下载</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull xx</span><br></pre></td></tr></table></figure><h6 id="10-本地镜像列表"><a href="#10-本地镜像列表" class="headerlink" title="10. 本地镜像列表"></a>10. 本地镜像列表</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure><h6 id="11-启动容器"><a href="#11-启动容器" class="headerlink" title="11. 启动容器"></a>11. 启动容器</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run [--name] [--link] 镜像id/name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --link 容器连接</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name 容器起的名称</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --p 端口映射 8080:80</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --e 环境变量设置</span></span><br></pre></td></tr></table></figure><h6 id="12-删除容器"><a href="#12-删除容器" class="headerlink" title="12. 删除容器"></a>12. 删除容器</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm id/name</span><br></pre></td></tr></table></figure><h6 id="13-创建镜像"><a href="#13-创建镜像" class="headerlink" title="13. 创建镜像"></a>13. 创建镜像</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker commit id imageName</span><br></pre></td></tr></table></figure><h6 id="14-关闭所有运行的容器"><a href="#14-关闭所有运行的容器" class="headerlink" title="14. 关闭所有运行的容器"></a>14. 关闭所有运行的容器</h6><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker stop $(docker ps -q)</span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/d76bceb7/">https://blog.coder4j.cn/posts/d76bceb7/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[转]spring 循环依赖</title>
      <link href="/posts/22c54be1/"/>
      <url>/posts/22c54be1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="http://www.importnew.com/17580.html">http://www.importnew.com/17580.html</a> 原文出处： <a href="http://sishuok.com/forum/blogPost/list/2448.html">张开涛</a></p></blockquote><h3 id="3-2-1-什么是循环依赖"><a href="#3-2-1-什么是循环依赖" class="headerlink" title="3.2.1  什么是循环依赖"></a>3.2.1  什么是循环依赖</h3><p>循环依赖就是循环引用，就是两个或多个 Bean 相互之间的持有对方，比如 CircleA 引用 CircleB，CircleB 引用 CircleC，CircleC 引用 CircleA，则它们最终反映为一个环。此处不是循环调用，循环调用是方法之间的环调用。如图 3-5 所示：</p><p> <img src="http://sishuok.com/forum/upload/2012/2/20/07001b6dc0a31b138de5923cf5c28314__1.JPG"></p><p>图 3-5 循环引用</p><p>       循环调用是无法解决的，除非有终结条件，否则就是死循环，最终导致内存溢出错误。</p><p>Spring 容器循环依赖包括构造器循环依赖和 setter 循环依赖，那 Spring 容器如何解决循环依赖呢？首先让我们来定义循环引用类： </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleA</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CircleB circleB;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleA</span><span class="params">(CircleB circleB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.circleB = circleB;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircleB</span><span class="params">(CircleB circleB)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.circleB = circleB;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   circleB.b();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleB</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CircleC circleC;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleB</span><span class="params">(CircleC circleC)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.circleC = circleC;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircleC</span><span class="params">(CircleC circleC)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.circleC = circleC;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        circleC.c();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.javass.spring.chapter3.bean;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CircleC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CircleC circleC;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CircleB</span><span class="params">(CircleC circleC)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.circleC = circleC;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCircleC</span><span class="params">(CircleC circleC)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.circleC = circleC;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        circleC.c();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="3-2-2-Spring-如何解决循环依赖"><a href="#3-2-2-Spring-如何解决循环依赖" class="headerlink" title="3.2.2        Spring 如何解决循环依赖"></a>3.2.2        Spring 如何解决循环依赖</h3><p><strong>一、构造器循环依赖：</strong>表示通过构造器注入构成的循环依赖，此依赖是无法解决的，只能抛出 BeanCurrentlyInCreationException 异常表示循环依赖。</p><p>如在创建 CircleA 类时，构造器需要 CircleB 类，那将去创建 CircleB，在创建 CircleB 类时又发现需要 CircleC 类，则又去创建 CircleC，最终在创建 CircleC 时发现又需要 CircleA；从而形成一个环，没办法创建。</p><p>Spring 容器将每一个正在创建的 Bean 标识符放在一个 “当前创建 Bean 池” 中，Bean 标识符在创建过程中将一直保持在这个池中，因此如果在创建 Bean 过程中发现自己已经在 “当前创建 Bean 池” 里时将抛出 BeanCurrentlyInCreationException 异常表示循环依赖；而对于创建完毕的 Bean 将从 “当前创建 Bean 池” 中清除掉。</p><p>1）首先让我们看一下配置文件（chapter3/circleInjectByConstructor.xml）：</p><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">&quot;circleA&quot;</span> <span class="built_in">class</span>=<span class="string">&quot;cn.javass.spring.chapter3.bean.CircleA&quot;</span>&gt;</span><br><span class="line">&lt;constructor-arg index=<span class="string">&quot;0&quot;</span> <span class="keyword">ref</span>=<span class="string">&quot;circleB&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">&quot;circleB&quot;</span> <span class="built_in">class</span>=<span class="string">&quot;cn.javass.spring.chapter3.bean.CircleB&quot;</span>&gt;</span><br><span class="line">&lt;constructor-arg index=<span class="string">&quot;0&quot;</span> <span class="keyword">ref</span>=<span class="string">&quot;circleC&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean <span class="built_in">id</span>=<span class="string">&quot;circleC&quot;</span> <span class="built_in">class</span>=<span class="string">&quot;cn.javass.spring.chapter3.bean.CircleC&quot;</span>&gt;</span><br><span class="line">&lt;constructor-arg index=<span class="string">&quot;0&quot;</span> <span class="keyword">ref</span>=<span class="string">&quot;circleA&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure><p>2）写段测试代码（cn.javass.spring.chapter3.CircleTest）测试一下吧：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test(expected = BeanCurrentlyInCreationException.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCircleByConstructor</span><span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;chapter3/circleInjectByConstructor.xml&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">      <span class="comment">//因为要在创建circle3时抛出；</span></span><br><span class="line">      Throwable e1 = e.getCause().getCause().getCause();</span><br><span class="line">      <span class="keyword">throw</span> e1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>让我们分析一下吧：</p><p>1、Spring 容器创建 “circleA” Bean，首先去“当前创建 Bean 池” 查找是否当前 Bean 正在创建，如果没发现，则继续准备其需要的构造器参数“circleB”，并将“circleA” 标识符放到“当前创建 Bean 池”；</p><p>2、Spring 容器创建 “circleB” Bean，首先去“当前创建 Bean 池” 查找是否当前 Bean 正在创建，如果没发现，则继续准备其需要的构造器参数“circleC”，并将“circleB” 标识符放到“当前创建 Bean 池”；</p><p>3、Spring 容器创建 “circleC” Bean，首先去“当前创建 Bean 池” 查找是否当前 Bean 正在创建，如果没发现，则继续准备其需要的构造器参数“circleA”，并将“circleC” 标识符放到“当前创建 Bean 池”；</p><p>4、到此为止 Spring 容器要去创建 “circleA”Bean，发现该 Bean 标识符在“当前创建 Bean 池” 中，因为表示循环依赖，抛出 BeanCurrentlyInCreationException。</p><p><strong>二、setter 循环依赖：</strong>表示通过 setter 注入方式构成的循环依赖。</p><p>对于 setter 注入造成的依赖是通过 Spring 容器提前暴露刚完成构造器注入但未完成其他步骤（如 setter 注入）的 Bean 来完成的，而且只能解决单例作用域的 Bean 循环依赖。</p><p>如下代码所示，通过提前暴露一个单例工厂方法，从而使其他 Bean 能引用到该 Bean。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">add<span class="constructor">SingletonFactory(<span class="params">beanName</span>, <span class="params">new</span> ObjectFactory()</span> &#123;</span><br><span class="line">    public Object get<span class="constructor">Object()</span> throws BeansException &#123;</span><br><span class="line">        return get<span class="constructor">EarlyBeanReference(<span class="params">beanName</span>, <span class="params">mbd</span>, <span class="params">bean</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>具体步骤如下：</p><p>1、Spring 容器创建单例 “circleA” Bean，首先根据无参构造器创建 Bean，并暴露一个“ObjectFactory ” 用于返回一个提前暴露一个创建中的 Bean，并将“circleA” 标识符放到“当前创建 Bean 池”；然后进行 setter 注入“circleB”；</p><p>2、Spring 容器创建单例 “circleB” Bean，首先根据无参构造器创建 Bean，并暴露一个“ObjectFactory” 用于返回一个提前暴露一个创建中的 Bean，并将“circleB” 标识符放到“当前创建 Bean 池”，然后进行 setter 注入“circleC”；</p><p>3、Spring 容器创建单例 “circleC” Bean，首先根据无参构造器创建 Bean，并暴露一个“ObjectFactory ” 用于返回一个提前暴露一个创建中的 Bean，并将 “circleC” 标识符放到“当前创建 Bean 池”，然后进行 setter 注入“circleA”；进行注入“circleA” 时由于提前暴露了 “ObjectFactory” 工厂从而使用它返回提前暴露一个创建中的 Bean；</p><p>4、最后在依赖注入 “circleB” 和“circleA”，完成 setter 注入。</p><p>对于 “prototype” 作用域 Bean，Spring 容器无法完成依赖注入，因为 “prototype” 作用域的 Bean，Spring 容器不进行缓存，因此无法提前暴露一个创建中的 Bean。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义Bean配置文件，注意scope都是“prototype”--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;circleA&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.javass.spring.chapter3.bean.CircleA&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;circleB&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;circleB&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;circleB&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.javass.spring.chapter3.bean.CircleB&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;circleC&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;circleC&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;circleC&quot;</span> <span class="attr">class</span>=<span class="string">&quot;cn.javass.spring.chapter3.bean.CircleC&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;prototype&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;circleA&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;circleA&quot;</span>/&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试代码cn.javass.spring.chapter3.CircleTest</span></span><br><span class="line"><span class="meta">@Test(expected = BeanCurrentlyInCreationException.class)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCircleBySetterAndPrototype</span> <span class="params">()</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ClassPathXmlApplicationContext ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(</span><br><span class="line"><span class="string">&quot;chapter3/circleInjectBySetterAndPrototype.xml&quot;</span>);</span><br><span class="line">        System.out.println(ctx.getBean(<span class="string">&quot;circleA&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Throwable e1 = e.getCause().getCause().getCause();</span><br><span class="line">        <span class="keyword">throw</span> e1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对于 “singleton” 作用域 Bean，可以通过 “setAllowCircularReferences(false);” 来禁用循环引用：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@<span class="constructor">Test(<span class="params">expected</span> = BeanCurrentlyInCreationException.<span class="params">class</span>)</span></span><br><span class="line">public void test<span class="constructor">CircleBySetterAndSingleton2()</span> throws Throwable &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ClassPathXmlApplicationContext ctx =</span><br><span class="line"><span class="keyword">new</span> <span class="constructor">ClassPathXmlApplicationContext()</span>;</span><br><span class="line">        ctx.set<span class="constructor">ConfigLocation(<span class="string">&quot;chapter3/circleInjectBySetterAndSingleton.xml&quot;</span>)</span>;</span><br><span class="line">        ctx.refresh<span class="literal">()</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    catch (Exception e) &#123;</span><br><span class="line">        Throwable e1 = e.get<span class="constructor">Cause()</span>.get<span class="constructor">Cause()</span>.get<span class="constructor">Cause()</span>;</span><br><span class="line">        throw e1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/22c54be1/">https://blog.coder4j.cn/posts/22c54be1/</a> </p>]]></content>
      
      
      <categories>
          
          <category> exception </category>
          
          <category> spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> exception </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>人的一切痛苦，本质上都是对自己无能的愤怒</title>
      <link href="/posts/8e904538/"/>
      <url>/posts/8e904538/</url>
      
        <content type="html"><![CDATA[<p>&emsp;人的一切痛苦，本质上都是对自己无能的愤怒！</p><p>&emsp;为什么不欺负别人，只欺负你，因为你好欺负，因为你是完美受害人，因为你无能！</p><p>&emsp;为什么不坑别人，只坑你，因为你傻，因为你蠢，因为你懦弱，因为你无能！</p><p>&emsp;为什么你活的那么累，因为你无能！</p><p>&emsp;为什么你总能接受不平等，因为你无能！</p><p>&emsp;为什么你明明可以说不，但是自我放弃，因为你无能！</p><p>&emsp;为什么你压力那么大，因为你无能！</p><p>&emsp;为什么你那么焦虑，因为你无能！</p><p>&emsp;为什么你觉得自己没有错，但是还是要卑躬屈膝去认错，因为你无能！</p><p>&emsp;为什么你一无所有，因为你无能！</p><p>&emsp;为什么你总是感觉尴尬，因为你无能！</p><p>&emsp;为什么别人可以不在乎你的感受，因为你无能！</p><p>&emsp;为什么你总是感到不好意思，因为你无能！</p><p>&emsp;为什么你总是抱怨，因为你无能！</p><p>&emsp;为什么你总是叹气，因为你无能！</p><p>&emsp;为什么别人觉得你是一个老好人，因为你无能！</p><p>&emsp;为什么你总是容易生气，因为你无能！</p><p>&emsp;为什么别人过的比你开心，比你好，因为你无能！</p><p>&emsp;为什么那么多机会你把握不住，因为你无能！</p><p>&emsp;为什么你总是觉得不公平，因为你无能！</p><p>&emsp;为什么你感觉害怕，因为你无能！</p><p>&emsp;为什么你总是不敢暴露自己的真实想法，因为你无能！</p><p>&emsp;为什么你喜欢看电影，因为你想逃避，逃避现实，逃避人生，逃避一切。逃避你的种种无能！</p><p>&emsp;为什么你什么事情都做不好，因为你无能！</p><p>&emsp;为什么你什么都坚持不下去，因为你无能！</p><p>&emsp;为什么当你想做什么事时，别人爱打击你，因为你无能！</p><p>&emsp;你就是一个 loser!</p><p>&emsp;怎么样也过不好这一生！</p><p>&emsp;一切的一切都是因为你无能！</p><p>&emsp;别人玩转着你的一切，别人侵蚀着你的一切，但是只是毫无表情的在一旁看着。因为你懦弱，因为你无能！</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/8e904538/">https://blog.coder4j.cn/posts/8e904538/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 漫漫人生路 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>[转]为什么年轻时要多赚钱？</title>
      <link href="/posts/bef934ed/"/>
      <url>/posts/bef934ed/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="https://mp.weixin.qq.com/s?__biz=MjM5MTA4MjE5OA==&amp;mid=2660133503&amp;idx=1&amp;sn=cd14d3771918901b405008797c5728e8#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MjM5MTA4MjE5OA%3D%3D&amp;mid=2660133503&amp;idx=1&amp;sn=cd14d3771918901b405008797c5728e8#wechat_redirect</a></p></blockquote><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/ZsUic8pXgxFibEU1JABRpqPzSdmCYRCWiajsKBGPGOqcdAKZWSDLic6ibLtibYCfOjytScMdPR8tVyPwMdGOaPkYvczw/?wx_fmt=gif"></p><p>文 | 王耳朵</p><p>来源 | 王耳朵先生（ID:huangezishiba）</p><p><strong>Part1</strong></p><p><strong>那年，你 23 岁。第一次去女朋友家，见父母。</strong></p><p>其实，以前你们也见过，在视频里。这次不一样，是女朋友父母的盛情邀请。</p><p>坐在满满的一桌饭菜前，场面太正式，你有些隐隐不安。</p><p>餐过半程，女朋友的父亲，果然开始提问，先是些无关紧要的话题，然后话锋一转：</p><blockquote><p>大概什么时候买房？</p></blockquote><p>旁边，女朋友的母亲，也漫不经心说，隔壁家老刘的准女婿，刚买了套三室两厅。</p><p>你不知道，说些什么才好。你脑袋里，满是那张每月 4000 的工资卡。</p><p>然后，气氛就冷了。你匆匆吃完饭，找了个公司有事的借口，当天就返程了。</p><p><strong>一个星期后，你约了女朋友出来，平静地分了手。</strong></p><p>她的泪水，就像决堤的坝，但你仍然冷静的走了。</p><p>不是你冷静，而是你开始懂得，谈不起钱的爱情，注定走不远。</p><p>爱情中可以没钱，但结婚不行。</p><p><strong>Part2</strong></p><p><strong>你 26 岁了，你终于有了些积蓄。</strong></p><p>这三年，你去了新的城市，换了新工作。你曾拼命陪客户喝酒，也曾加班到天亮。</p><p>你的工资翻了两倍，某个时刻，你甚至感觉全身充满了力量。你决定去买房。</p><p>含着职业微笑的销售顾问，带你去了样板间。</p><p>南北通透的户型，小区绿化很好，推开窗，你就能看到远方的山脊线。</p><p>但问了总价，你就沉默了。房子涨价的速度，太快了。</p><p>你慢慢走回家，决定过些日子，房价降了再买。但你打开朋友圈，看到的第一条动态，就是市民连夜排队买房。</p><p>你知道，还不出手，可能再也追不上房价了。</p><p>你狠下心，给父母打电话，拿来了他们的 10 万养老钱。你给所有的亲戚打电话，陪着笑脸，向他们借钱。</p><p>三天后，凑够了首付，你去签了购房合同。</p><p><strong>按上指印的那一刻，你的眼睛酸了。</strong></p><p>有钱多好啊。</p><p>你开始懂得，有钱，就有家，你就有稳稳的确定感。</p><p><strong>Part3</strong></p><p><strong>离 28 岁只有四个月的时候，你失去了工作。</strong></p><p>是被动的失业，集团公司撤销了华南办事处，象征性地补偿后，你被遣散了。</p><p>你开始重新找工作，从这个城市的南边，奔波到北边。</p><p>你突然发现，过了 30 以后，工作越来越难找了。</p><p>要么是薪水太低，要么是要求太高，一大群刚出校门的大学生，等在面试室外，随时准备把你 PK 掉。</p><p><strong>还完 3 个月的房贷，你突然发现，卡里只剩下 1000 块钱了。</strong></p><p>幸运的是，你终于赶在 28 岁前，找到了新工作。</p><p>虽然公司距离住的地方，有点远，但一切看起来，都是有希望的样子。</p><p>所以，28 岁生日那天，你特意给自己点了一个小小的蛋糕。烛光里，你安静的许愿。</p><p>不是为了犒劳自己。</p><p>而是你开始懂得，有时候，稳定的收入，也是有温度的。</p><p>它能免你惊，免你苦，免你无枝可依。</p><p><strong>Part4</strong></p><p><strong>转眼，你 32 岁了，成了别人眼里的中产。</strong></p><p>日子过得波澜不惊，一切都走上了正轨，孩子也已经 3 岁，该上幼儿园了。</p><p>你有两种选择：楼下的双语幼稚园；或者是把他送到隔壁安置小区，那里也有一家民营的幼教机构。</p><p>前一家，每月费用 4000，有外教。后一家，1800 就够了，老师都是中年的阿姨。</p><p>你在电脑上，看了一晚上的虐童新闻，第二天早餐时，你和妻子说：</p><blockquote><p>就去那家 4000 块的优质幼儿园吧。</p></blockquote><p>你没有和妻子说，这段时间，公司正在进行岗位调整。</p><p>你准备申请调岗，从现在悠闲的办公室工作，调到一线工作部门。虽然会累些，但收入会增加不少。</p><p><strong>知道调岗的消息后，妻子果然抱怨了你，说你不自量力。</strong></p><p>你没有辩解，相反你在心里笑了。</p><p>因为你开始懂了，累是累些，但至少在孩子需要时，你不会囊中羞涩，你不会让他在起跑线上就输了。</p><p><strong>Part5</strong></p><p><strong>又过了三年。</strong></p><p>所有的事情，都在向好处发展，你甚至有了野心勃勃的计划，等父母都退休了，就把他们接到身边来。</p><p>但清晨，母亲的电话就来了，父亲在晨练时突发脑溢血，县城的医院束手无策。</p><p>你疯了地开车，往老家赶，把父母接到了你住的一线城市里。</p><p>你相信，这里有优质的医疗资源，有一流的医生，一切会重新回到原来的样子。</p><p>在那家三甲医院里，科室里的医生，果然都给出了肯定的回答，你的父亲，也一天天好起来。</p><p><strong>但每天几千块的支出，很快就让你感觉到了压力。父亲的医保证，在这里形同废纸。</strong></p><p>两个月后，父亲坚持要出院。你不肯，但父亲用含糊的固执的声音告诉你，剩下的，就是康复训练了，老家也可以，哪里都一样。</p><p>你送他们回家，平时三个小时的路程，你开了六个小时。</p><p>因为你总是忍不住，想爬在方向盘上想哭。</p><p>父母老去的速度，比你想象的快多了。</p><p>你开始懂了，钱有时也是孝心。如果你有足够的钱，就不会对父母无能为力。</p><p><strong>Part6</strong></p><p>如果你没有经历过买房，你不会知道钱有多重要；</p><p>如果你没有经历过家人生病，你不会知道，钱是多么不可或缺；</p><p>如果你没有过月薪三千的生活，你不会知道，赚钱是为了什么。</p><p>在《亲爱的安德烈》里，作家龙应台有一段话说的很好：</p><blockquote><p>“孩子，我要求你读书用功，不是因为我要你跟别人比成绩，而是，我希望你将来会拥有选择的权利，选择有意义、有时间的工作，而不是被迫谋生。”</p></blockquote><p>同样，为什么年轻时要努力赚钱？</p><p><strong>不是为了成为富豪，也不是为了享受。</strong></p><p>而是有一天，你有底气说，我可过上更好的生活；</p><p>你也有底气对亲人说，亲爱的，别怕，一切有我。</p><p>王尔德说：</p><blockquote><p>“我年轻时还以为金钱最重要，如今年纪大了，发现那句话一点不假。”</p></blockquote><p>千万别在年轻时假装不爱钱，你应该更努力一些。</p><p><strong>我们努力赚钱，就是为了不对亲人无能为力，就是为了能够对世界说 “不”。</strong></p><p>你为什么年轻时要多赚钱？这是我听过的最好的回答。</p><ul><li>作者简介：王耳朵先生，青年作家，知名媒体前首席记者，关注于职场和个人成长，千万级阅读代表作《别扯了，这世界上根本没有稳定的工作》，微信公众号：王耳朵先生（ID：huangezishiba）。转载请联系原作者授权！</li></ul><p>— THE END —</p><p><img src="https://mmbiz.qpic.cn/mmbiz_gif/mTzGsLCNvribcZPNdfZUzENkKhDafiaCqARhGjSB9lWicSctia48SvEicSINjd6WhiaXlfuVnmmXSM0veibjeOxjPBvuA/?wx_fmt=gif"></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/bef934ed/">https://blog.coder4j.cn/posts/bef934ed/</a> </p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>[转] springboot 过滤器和拦截器的实现和区别</title>
      <link href="/posts/17d41b3e/"/>
      <url>/posts/17d41b3e/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本文由 <a href="http://ksria.com/simpread/">简悦 SimpRead</a> 转码， 原文地址 <a href="https://segmentfault.com/a/1190000012072060">https://segmentfault.com/a/1190000012072060</a></p></blockquote><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>springmvc 中有两种很普遍的 AOP 实现：<br>1. 过滤器（Filter）<br>2. 拦截器（Interceptor）</p><p>本篇面对的是一些刚接触 springboot 的人群<br>所以主要讲解 filter 和 interceptor 的简单实现和它们之间到底有什么区别<br>（一些复杂的功能我会之后发出文章，请记得关注）</p><h2 id="Filter-的简单实现"><a href="#Filter-的简单实现" class="headerlink" title="Filter 的简单实现"></a>Filter 的简单实现</h2><p>字面意思：过滤器就是过滤的作用，在 web 开发中过滤一些我们指定的 url<br>那么它能帮我们过滤什么呢？<br>那功能可就多了：<br>比如过拦截掉我们不需要的接口请求<br>修改请求（request）和响应（response）内容<br>完成 CORS 跨域请求等等</p><p>现在我们来实现一个简单的过滤器：<br>可以新建一个 filter 包，随着项目的扩大过滤器会越来越多<br>在这里我新建了一个<code>TestFilter</code>类，实现 Filter 接口</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Component</span></span><br><span class="line"><span class="variable">@WebFilter</span>(urlPatterns = <span class="string">&quot;/Blogs&quot;</span>,filterName = <span class="string">&quot;blosTest&quot;</span>)</span><br><span class="line">public class TestFilter implements Filter&#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们一步步来<br>1.@Component 就是把这个类注入到 IOC 容器中<br>2.@WebFilter(urlPatterns = “/Blogs”,filterName = “blosTest”) 说明这是一个 web 过滤器，它拦截的 url 为<code>/Blogs</code>，过滤器名字为<code>blogsTest</code></p><p>下面贴出实现接口之后的三个重构方法：</p><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        HttpServletRequest request= (HttpServletRequest) servletRequest;</span><br><span class="line">        HttpServletResponse response = (HttpServletResponse) servletResponse;</span><br><span class="line">        System.out.printf(<span class="string">&quot;过滤器实现&quot;</span>);</span><br><span class="line">        filterChain.doFilter(request,response);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>初始化（init）和摧毁（destroy）方法一般不会用到，具体使用看下源码便知<br>doFilter（）是过滤器的核心<br>注意：在实现接口方法之后，我们要转换 request 和 response 类型至 HttpServlet，否则接下去的操作可能会报错。<br>如果过滤通过，执行<code>filterChain.doFilter(request,response);</code><br>说明这个 url 已经经过了我们的 Filter<br>其他不要设置，我们执行看下结果：</p><p><img src="https://segmentfault.com/img/bVYOwA?w=806&h=168"></p><p><img src="https://segmentfault.com/img/bVYOwD?w=708&h=182"></p><p>可以看到，只需要一个类我们就实现了一个简单的过滤器</p><p>当然可以不用注解的方式，配置启动类</p><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//过滤器</span></span><br><span class="line">    @Bean</span><br><span class="line">    <span class="keyword">public</span> FilterRegistrationBean filterRegistrationBean()&#123;</span><br><span class="line">        FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> <span class="type">FilterRegistrationBean</span>();</span><br><span class="line">        List&lt;<span class="keyword">String</span>&gt; urlPatterns = <span class="keyword">new</span> <span class="type">ArrayList</span>&lt;<span class="keyword">String</span>&gt;();</span><br><span class="line"></span><br><span class="line">        TestFilter testFilter = <span class="keyword">new</span> <span class="type">TestFilter</span>();   <span class="comment">//new过滤器</span></span><br><span class="line">        urlPatterns.add(<span class="string">&quot;/Blogs&quot;</span>);      <span class="comment">//指定需要过滤的url</span></span><br><span class="line">        filterRegistrationBean.setFilter(testFilter);       <span class="comment">//set</span></span><br><span class="line">        filterRegistrationBean.setUrlPatterns(urlPatterns);     <span class="comment">//set</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>这也是可以的，本人其实还是比较推荐这种方式添加过滤器</p><h2 id="Interceptor-的简单实现"><a href="#Interceptor-的简单实现" class="headerlink" title="Interceptor 的简单实现"></a>Interceptor 的简单实现</h2><p>拦截器的实现比过滤器稍微复杂一点<br>我们同样可以新建一个 interceptor 包<br>在里面新建一个名为<code>MyInterceptor</code>的类</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">MyInterceptor</span> <span class="symbol">implements</span> <span class="symbol">HandlerInterceptor</span> &#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这个类实现了<code>HandleInterceptor</code>接口<br>直接贴类代码，我会在代码中注释功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="comment">//在请求处理之前进行调用（Controller方法调用之前</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.printf(<span class="string">&quot;preHandle被调用&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;    <span class="comment">//如果false，停止流程，api被拦截</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//请求处理之后进行调用，但是在视图被渲染之前（Controller方法调用之后）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;postHandle被调用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在整个请求结束之后被调用，也就是在DispatcherServlet 渲染了对应的视图之后执行（主要是用于进行资源清理工作）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterCompletion被调用&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>它依次实现了三个方法<br>相比过滤器，拦截器还需要在 springmvc 中注入<br>所以我们打开启动类，写入以下代码</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WarApplication</span> &#123;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">String</span>[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.<span class="built_in">run</span>(WarApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//mvc控制器</span></span><br><span class="line">    <span class="comment">//@Configuration</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcConfigurer</span> <span class="title">extends</span> <span class="title">WebMvcConfigurerAdapter</span>&#123;</span></span><br><span class="line">        <span class="comment">//增加拦截器</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span></span>&#123;</span><br><span class="line">            registry.addInterceptor(<span class="keyword">new</span> MyInterceptor())    <span class="comment">//指定拦截器类</span></span><br><span class="line">                    .addPathPatterns(<span class="string">&quot;/Handles&quot;</span>);        <span class="comment">//指定该类拦截的url</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这里我在<code>/Handles</code>这个 url 中进行拦截<br>代码写完了，来看下结果</p><p><img src="https://segmentfault.com/img/bVYOyA?w=722&h=200"></p><p><img src="https://segmentfault.com/img/bVYOyI?w=652&h=194"></p><p>当进入指定 url 时，我们执行到了拦截器<br>接下来就可以根据需求去使用拦截器了</p><h2 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h2><p>过滤器和拦截器非常相似，但是它们有很大的区别<br>最简单明了的区别就是<strong>过滤器可以修改 request，而拦截器不能</strong><br><strong>过滤器需要在 servlet 容器中实现，拦截器可以适用于 javaEE，javaSE 等各种环境</strong><br><strong>拦截器可以调用 IOC 容器中的各种依赖，而过滤器不能</strong><br><strong>过滤器只能在请求的前后使用，而拦截器可以详细到每个方法</strong><br>区别很多，大家可以去查下</p><p>总的来说<br>过滤器就是筛选出你要的东西，比如 requeset 中你要的那部分<br>拦截器在做安全方面用的比较多，比如终止一些流程<br>网上有一张图片很不错，这里拷过来给大家看一下</p><p><img src="https://segmentfault.com/img/bVYOEG?w=1392&h=808"></p><p><strong>以上便是 springboot 中过滤器和拦截器的实现和区别；</strong><br><strong>觉得还可以的请点个赞，赞不了也可以收藏下；</strong><br><strong>总之，谢谢阅读～</strong></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/17d41b3e/">https://blog.coder4j.cn/posts/17d41b3e/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 转载 </category>
          
          <category> spring boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring boot </tag>
            
            <tag> 过滤器 </tag>
            
            <tag> 拦截器 </tag>
            
            <tag> web </tag>
            
            <tag> 转载 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 docker 光速安装 gitlab</title>
      <link href="/posts/3f39df5c/"/>
      <url>/posts/3f39df5c/</url>
      
        <content type="html"><![CDATA[<ul><li>使用 docker 安装 gitlab<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 postgresql</span></span><br><span class="line">docker <span class="builtin-name">run</span> <span class="attribute">--name</span>=gitlab-postgresql -d --env <span class="attribute">DB_NAME</span>=gitlabhq_prodution --env <span class="attribute">DB_USER</span>=gitlab --env <span class="attribute">DB_PASS</span>=password sameersbn/postgresql:9.4-12</span><br><span class="line"><span class="comment"># 安装 redis</span></span><br><span class="line">docker <span class="builtin-name">run</span> --name gitlab-redis -d sameersbn/redis</span><br><span class="line"><span class="comment"># 安装 gitlab</span></span><br><span class="line">docker <span class="builtin-name">run</span> --name gitlab -d --link gitlab-postgresql:postgresql --link gitlab-redis:redisio --publish 10022:22 --publish 10080:80 --env <span class="attribute">GITLAB_PORT</span>=10080 --env <span class="attribute">GITLAB_SSH_PORT</span>=10022 --env <span class="attribute">GITLAB_SECRETS_DB_KEY_BASE</span>=long-and-random-alpha-numeric-string sameersbn/gitlab:8.4.4</span><br></pre></td></tr></table></figure></li><li>访问 http://本地ip:10080<br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fn1jbcqanij21ro11sq8s.jpg"></li></ul><ul><li>参考链接<br><a href="https://github.com/sameersbn/docker-gitlab">docker-gitlab</a><br><a href="http://www.damagehead.com/docker-gitlab/">Zero to GitLab in 5 seconds or less*</a>  </li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/3f39df5c/">https://blog.coder4j.cn/posts/3f39df5c/</a> </p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
          <category> gitlab </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>使用 docker 光速安装 wordpress</title>
      <link href="/posts/a8f54955/"/>
      <url>/posts/a8f54955/</url>
      
        <content type="html"><![CDATA[<ul><li>使用 docker 安装 wordpress</li></ul><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装数据库</span></span><br><span class="line">docker <span class="builtin-name">run</span> --name db --env <span class="attribute">MYSQL_ROOT_PASSWORD</span>=example -d mariadb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装 wordpress</span></span><br><span class="line">docker <span class="builtin-name">run</span> --name MyWordPress --link db:mysql -p 8080:80 -d wordpress</span><br></pre></td></tr></table></figure><p>安装成功效果图<br><img src="http://ww1.sinaimg.cn/large/68f7efe0gy1fn1igx342oj21sc0tsdjn.jpg"></p><ul><li>命令解析  <ul><li>安装数据库  <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> --name db --env <span class="attribute">MYSQL_ROOT_PASSWORD</span>=example -d mariadb</span><br></pre></td></tr></table></figure><ul><li>docker run <ul><li>启动容器的命令</li></ul></li><li>–name db<ul><li>指定启动容器的名称</li></ul></li><li>–env MYSQL_ROOT_PASSWORD=example<ul><li>传入环境变量，此处是设置 mysql 密码为 example</li></ul></li><li>-d <ul><li>后台运行，否则前台进行</li></ul></li></ul></li><li>安装 wordpress  <figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --name MyWordPress --link db:mysql -p <span class="number">8080</span>:<span class="number">80</span> -d wordpress</span><br></pre></td></tr></table></figure><ul><li>–link db:mysql<ul><li>与上面启动的 db 容器建立联系</li></ul></li><li>-p 8080:80<ul><li>端口映射，把宿主机的8080端口映射到容器内的80端口</li></ul></li></ul></li></ul></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/a8f54955/">https://blog.coder4j.cn/posts/a8f54955/</a> </p>]]></content>
      
      
      <categories>
          
          <category> docker </category>
          
          <category> wordpress </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2018年新年愿景</title>
      <link href="/posts/f596c62f/"/>
      <url>/posts/f596c62f/</url>
      
        <content type="html"><![CDATA[<div class="tip">  今天是2018年第一天，转眼2017就这样过去了，感觉荒废了大把时光，新的一年希望自己可以蜕变！    成为一个靠谱的人！</div><ul><li><p>生活</p><ul><li>更爱萍萍，以后少怼她了。别太孩子气，老惹她生气。</li><li>也该考虑结婚的事了</li><li>学会几个拿手菜</li><li>活的健康一点，少吃辣，少熬夜，少喝碳酸饮料</li><li>减肥，回到120斤</li><li>看几本书</li><li>一个星期写一篇博客</li></ul></li><li><p>学习</p><ul><li>docker学习</li><li>elasticsearch学习</li><li>zookeeper学习</li><li>mongodb学习</li><li>jvm学习</li><li>设计模式学习</li><li>nginx学习</li><li>hadoop学习</li><li>hbase 学习</li><li>架构学习</li></ul></li><li><p>工作</p><ul><li>提高工作效率，不要那么累</li><li>提高管理能力与人际交往能力</li><li>提高代码的可读性，可用性</li><li>对业务的熟练度要提高</li><li>使服务器的稳定性提升一个档次，全力做到0事故，0宕机</li></ul></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/f596c62f/">https://blog.coder4j.cn/posts/f596c62f/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 新年愿景 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2018 </tag>
            
            <tag> 新年愿景 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring boot 对于 js 的 long 精度问题处理</title>
      <link href="/posts/6bfa638e/"/>
      <url>/posts/6bfa638e/</url>
      
        <content type="html"><![CDATA[<p>这几天前后端联调，遇到一个诡异的问题。前端请求后端提供的详情接口得到用户的 Id 与其它数据。然后前端又把这个 Id与修改的数据内容一同传回后端的修改接口。结果前端反馈死活修改不了。  </p><p>然后各种 debug 查日志，发现详情接口返回给前端的与前端调用修改接口传回的 Id 不一致。  </p><p>然后一查发现是 js 的精度问题，原以为 js 只是浮点型会有精度问题，没想到长整型也会出现。因为是语言的限制，前端要解决这个问题，还是很吃力的。所以只能在后端在传 json 的时候把 long 全部转成 string 类型。  </p><p>然后问题又来了，因为项目已写了差不多了。太多地方用了 long 类型，改基础类的字段类型是不可能了。于是想在对象转 json 的时候能否统一处理。  </p><p>因为使用的是 spring boot 框架，而 spring boot 默认的 json 框架的Jackson。就是找了一下，果然 jackson 有一个可以自定义的类型转换器机制。直接上代码↓  </p><ul><li><p>json 转换器<br>JsonLong2StrConverter</p><pre><code>public class JsonLong2StrConverter extends StdSerializer&lt;Long&gt; &#123;  public JsonLong2StrConverter() &#123;    super(Long.class);  &#125;  @Override  public void serialize(Long value, JsonGenerator gen, SerializerProvider provider)      throws IOException &#123;    gen.writeString(value.toString());  &#125;&#125;</code></pre></li><li><p>使用配置<br>JsonConf</p><pre><code>@Configuration@EnableWebMvcpublic class JsonConf extends WebMvcConfigurerAdapter &#123;  @Override  public void configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) &#123;    converters.add(new MappingJackson2HttpMessageConverter(        new Jackson2ObjectMapperBuilder()//            .propertyNamingStrategy(PropertyNamingStrategy.SNAKE_CASE)            .serializationInclusion(                Include.NON_NULL)            .serializerByType(Long.class, new JsonLong2StrConverter())            .serializerByType(Long.TYPE, new JsonLong2StrConverter()).build()));  &#125;&#125;</code></pre></li></ul><p>这样 spring boot 在转换 json 时，发现是 Long 类型就直接转成 String 类型，也就是加个单引号。</p><p>参考：<br><a href="http://okeeper.leanote.com/post/Spring-boot-%E9%85%8D%E7%BD%AE%E8%87%AA%E5%AE%9A%E4%B9%89Json%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">Spring boot 配置自定义Json类型转换</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/6bfa638e/">https://blog.coder4j.cn/posts/6bfa638e/</a> </p>]]></content>
      
      
      <categories>
          
          <category> spring boot </category>
          
          <category> json </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring boot </tag>
            
            <tag> json </tag>
            
            <tag> 精度 </tag>
            
            <tag> js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CDN原理</title>
      <link href="/posts/ccbef645/"/>
      <url>/posts/ccbef645/</url>
      
        <content type="html"><![CDATA[<blockquote><p>&emsp;&emsp;CDN是构建在网络之上的内容分发网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块，使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。CDN的关键技术主要有内容存储和分发技术。<br>&emsp;&emsp;CDN的基本原理是广泛采用各种缓存服务器，将这些缓存服务器分布到用户访问相对集中的地区或网络中，在用户访问网站时，利用全局负载技术将用户的访问指向距离最近的工作正常的缓存服务器上，由缓存服务器直接响应用户请求。  –百度百科</p></blockquote><p>&emsp;&emsp;其实CDN说白了，就是一个分布式缓存。只不过是CDN机构会把在全国各地热点的地方，部署一些服务器。如果你的网站使用CDN后，会把你网站上<strong>静态</strong>的内容缓存在这些服务器上。如果用户访问你的网站，用户的请求会被发送到离他最近的CDN服务器上，以此提高响应速度。</p><p>&emsp;&emsp;对于<strong>静态</strong>内容居多的网站，提速明显。对于<strong>动态网站</strong>会回源到原服务器，基本上没有任何提高。所以要想达到最好效果，可以对网站实现动静分离，比如前后端分离。把前端页面加到CDN，而后端接口还是用原服务器的。</p><p>&emsp;&emsp;随便说一下，CDN对DDOS有一定的防护作用，因为全国大量的肉鸡访问会被分散到各个CDN服务器，对主站影响就减小很多。当然也是只针对于静态类型有效，动态网站该挂还是会挂！</p><p>本文地址 <a href="https://blog.coder4j.cn/posts/ccbef645/">https://blog.coder4j.cn/posts/ccbef645/</a> </p>]]></content>
      
      
      <categories>
          
          <category> 架构 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> cdn </tag>
            
            <tag> 架构 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>maven按环境加载配置文件</title>
      <link href="/posts/b5fc9dfd/"/>
      <url>/posts/b5fc9dfd/</url>
      
        <content type="html"><![CDATA[<p>通过maven的profile实现按环境来加载配置文件</p><a id="more"></a><h6 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h6><p><img src="/images/pasted-0.png" alt="upload successful"></p><h6 id="pom-xml"><a href="#pom-xml" class="headerlink" title="pom.xml"></a>pom.xml</h6><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">activation</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">activation</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">config.dir</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">config.dir</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">id</span>&gt;</span>test<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">config.dir</span>&gt;</span>test<span class="tag">&lt;/<span class="name">config.dir</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">id</span>&gt;</span>beta<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">config.dir</span>&gt;</span>beta<span class="tag">&lt;/<span class="name">config.dir</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">id</span>&gt;</span>release<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">config.dir</span>&gt;</span>release<span class="tag">&lt;/<span class="name">config.dir</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br><span class="line">   </span><br><span class="line">   <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/profile/$&#123;config.dir&#125;<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>./<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">truetruetrue<span class="tag">&lt;<span class="name">targetPath</span>&gt;</span>./<span class="tag">&lt;/<span class="name">targetPath</span>&gt;</span></span><br><span class="line">truetrue<span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">true<span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">build</span>&gt;</span>  </span><br></pre></td></tr></table></figure><h5 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h5><blockquote><p>大致思路就是建一个profile的目录，这个目录名可以随意只要跟后面保持一致就行，然后在这个目录下面建几个按环境区分的目录，通常是dev(开发)，test（测试），beta（预发），release(正式)。然后再通过maven的profile特性，生成按环境的${config.dir}的值。最后通过maven的resources标签来完成配置文件的拷贝，大功告成。</p></blockquote><h5 id="打包命令"><a href="#打包命令" class="headerlink" title="打包命令"></a>打包命令</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mvn clean <span class="keyword">install</span> -P(profile_id)</span><br><span class="line">eg. mvn clean <span class="keyword">install</span> -Pdev  <span class="comment">--打包开发环境的配置文件</span></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/b5fc9dfd/">https://blog.coder4j.cn/posts/b5fc9dfd/</a> </p>]]></content>
      
      
      <categories>
          
          <category> maven </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
            <tag> profile </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexo搭建整理</title>
      <link href="/posts/e8182b73/"/>
      <url>/posts/e8182b73/</url>
      
        <content type="html"><![CDATA[<p>本博客搭建参考的教程</p><a id="more"></a><ul><li><p>基础教程：<br><a href="https://xuanwo.org/2015/03/26/hexo-intor/">史上最详细的Hexo博客搭建图文教程</a></p></li><li><p>模板<br><a href="https://material.viosey.com/">material</a></p></li><li><p>http转https:<br><a href="https://g2ex.github.io/2015/10/14/Hexo-with-SSL-Hosted-on-Github-Page/">为Github的Hexo博客启用SSL/TLS</a></p></li><li><p>其它配置:<br><a href="http://www.jianshu.com/p/a52b68794a6b">hexo创建个人博客（附加插入音乐、分享、评论、标签页、搜索）</a></p></li><li><p>访问分流:<br><a href="http://www.franktly.com/2016/07/05/Hexo%E5%90%8C%E6%97%B6%E9%83%A8%E7%BD%B2%E5%9C%A8Coding%E5%92%8CGitHub%E4%B8%8A%E5%B9%B6%E4%BD%BF%E7%94%A8DNSPod%E5%88%86%E6%B5%81/">Hexo同时部署在Coding和GitHub上并使用DNSPod分流</a></p></li><li><p>SEO:<br><a href="http://www.jianshu.com/p/86557c34b671">Hexo Seo优化让你的博客在google搜索排名第一</a><br><a href="http://www.jianshu.com/p/619dab2d3c08">hexo提交搜索引擎（百度+谷歌）</a></p></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/e8182b73/">https://blog.coder4j.cn/posts/e8182b73/</a> </p>]]></content>
      
      
      <categories>
          
          <category> hexo </category>
          
      </categories>
      
      
        <tags>
            
            <tag> hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Aop注解教程</title>
      <link href="/posts/e634ec1e/"/>
      <url>/posts/e634ec1e/</url>
      
        <content type="html"><![CDATA[<blockquote><p>spring aop常用的有以下：</p><ul><li>通知类型：<ul><li>前置通知（Before advice）：在某连接点之前执行的通知，但这个通知不能阻止连接点之前的执行流程（除非它抛出一个异常）。</li><li>后置通知（After returning advice）：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</li><li>异常通知（After throwing advice）：在方法抛出异常退出时执行的通知。</li><li>最终通知（After (finally) advice）：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。</li><li>环绕通知（Around Advice）：包围一个连接点的通知，如方法调用。这是最强大的一种通知类型。环绕通知可以在方法调用前后完成自定义的行为。它也会选择是否继续执行连接点或直接返回它自己的返回值或抛出异常来结束执行。</li></ul></li></ul></blockquote><blockquote><ul><li>核心配置只要在AOP的实现方法上加上@Aspect与在spring 配置文件中加上 <a href="aop:aspectj-autoproxy/">aop:aspectj-autoproxy/</a>,spring 就可以配置aop方法，然后再根据方法的增强标签不同的效果，这里需要注意是它们的参数不同。</li></ul></blockquote><ul><li><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mrwood_study<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>xyz.mrwood.study<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>study-spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>study-spring-aop<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.apache.org<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span>4.2.5.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring开始 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--spring 结束--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- AOP begin --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjrt<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cglib<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- AOP end --&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志开始 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志结束 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>spring-context.xml</p></li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd   http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--自动注入--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;xyz.mrwood.study&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--开启aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>AopHandler.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2016, 791650277@qq.com(Mr.kiwi) All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> xyz.mrwood.study.aop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 项目：study</span></span><br><span class="line"><span class="comment"> * 包名：xyz.mrwood.study.aop</span></span><br><span class="line"><span class="comment"> * 功能：aop实现</span></span><br><span class="line"><span class="comment"> * 时间：2016-05-28 10:33</span></span><br><span class="line"><span class="comment"> * 作者：Mr.Kiwi</span></span><br><span class="line"><span class="comment"> * 通知类型：</span></span><br><span class="line"><span class="comment"> * 前置通知（Before advice）：在某连接点之前执行的通知，但这个通知不能阻止连接点之前的执行流程（除非它抛出一个异常）。</span></span><br><span class="line"><span class="comment"> * 后置通知（After returning advice）：在某连接点正常完成后执行的通知：例如，一个方法没有抛出任何异常，正常返回。</span></span><br><span class="line"><span class="comment"> * 异常通知（After throwing advice）：在方法抛出异常退出时执行的通知。</span></span><br><span class="line"><span class="comment"> * 最终通知（After (finally) advice）：当某连接点退出的时候执行的通知（不论是正常返回还是异常退出）。</span></span><br><span class="line"><span class="comment"> * 环绕通知（Around Advice）：包围一个连接点的通知，如方法调用。这是最强大的一种通知类型。环绕通知可以在方法调用前后完成自定义的行为。它也会选择是否继续执行连接点或直接返回它自己的返回值或抛出异常来结束执行。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截工程下所有的切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* xyz.mrwood.study..*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getAllPoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 拦截所有service层下的切点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* xyz.mrwood.study.service..*.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getServicePoint</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 前置增强</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> joinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Before(&quot;getServicePoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">beforeMethod</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[前置增强开始]：&quot;</span> + <span class="string">&quot;方法开始了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;getServicePoint()&quot;, throwing = &quot;ex&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">exceptionMethod</span><span class="params">(JoinPoint joinPoint, Exception ex)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[异常增强]：&quot;</span> + <span class="string">&quot;如果你看到这行，就说明你的程序报错了！&quot;</span> + <span class="string">&quot;异常信息：&quot;</span> + ex.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 后置增强，只有在方法正常结束才会调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnVal</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;getServicePoint()&quot;,returning = &quot;returnVal&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterReturningMethod</span><span class="params">(Object returnVal)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[后置增强]：&quot;</span> + <span class="string">&quot;当你看到这个说明，你的方法没有正常结束了！&quot;</span> + <span class="string">&quot;它的返回值为：&quot;</span> + returnVal);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 最终增强，类似于finally的功能</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@After(&quot;getServicePoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterMethod</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[最终增强]：&quot;</span> + <span class="string">&quot;无论发论发生什么事，我都会运行！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 环绕增强</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> proceedingJoinPoint</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Around(&quot;getServicePoint()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">aroundMethod</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;[环绕增强开始]：&quot;</span> + <span class="string">&quot;方法开始了！&quot;</span>);</span><br><span class="line">        Object returnVal = proceedingJoinPoint.proceed(proceedingJoinPoint.getArgs());</span><br><span class="line">        System.out.println(<span class="string">&quot;[环绕增强结束]：&quot;</span> + <span class="string">&quot;方法已经结束了！&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> returnVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>TargetService.java</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2016, 791650277@qq.com(Mr.kiwi) All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> xyz.mrwood.study.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 项目：study</span></span><br><span class="line"><span class="comment"> * 包名：xyz.mrwood.study.service</span></span><br><span class="line"><span class="comment"> * 功能：被拦截的目标类</span></span><br><span class="line"><span class="comment"> * 时间：2016-05-28 10:32</span></span><br><span class="line"><span class="comment"> * 作者：Mr.Kiwi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TargetService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hello</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello &quot;</span> + name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String  <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;test&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>运行结果<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">环绕增强开始</span>]：方法开始了！</span><br><span class="line">[<span class="meta">前置增强开始</span>]：方法开始了</span><br><span class="line">[<span class="meta">环绕增强结束</span>]：方法已经结束了！</span><br><span class="line">[<span class="meta">最终增强</span>]：无论发论发生什么事，我都会运行！</span><br><span class="line">[<span class="meta">后置增强</span>]：当你看到这个说明，你的方法没有正常结束了！它的返回值为：test</span><br></pre></td></tr></table></figure></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/e634ec1e/">https://blog.coder4j.cn/posts/e634ec1e/</a> </p>]]></content>
      
      
      <categories>
          
          <category> spring </category>
          
          <category> aop </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring </tag>
            
            <tag> aop </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring 集成druid</title>
      <link href="/posts/f23e3ef2/"/>
      <url>/posts/f23e3ef2/</url>
      
        <content type="html"><![CDATA[<p><strong>application.properties</strong></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">######################数据库访问配置#########################</span></span><br><span class="line"><span class="comment"># 数据库链接</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://localhost:3306/coder4j?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span></span><br><span class="line"><span class="comment"># 数据库用户名</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"># 数据库用户密码</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment"># 数据库驱动类</span></span><br><span class="line"><span class="comment"># spring.datasource.driver-class-name=com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="comment"># mysql driver 6.0以后要使用下面的类</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="comment"># 主数据源(这里使用的druid),如果是通过代码注入，这里没什么用</span></span><br><span class="line"><span class="comment">#spring.datasource.type=com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line"><span class="comment">######################数据库连接池配置#########################</span></span><br><span class="line"><span class="comment"># sb1.3以前这样配置是可以直接注入的，1.4之后只支持几种内置的，所以我们要通过</span></span><br><span class="line"><span class="comment"># 代码手动注入，代码配置优先级比配置文件的高</span></span><br><span class="line"><span class="comment"># 初始化大小，最小，最大</span></span><br><span class="line"><span class="meta">spring.datasource.initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="meta">spring.datasource.minIdle</span>=<span class="string">5</span></span><br><span class="line"><span class="meta">spring.datasource.maxActive</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 配置获取连接等待超时的时间</span></span><br><span class="line"><span class="meta">spring.datasource.maxWait</span>=<span class="string">60000</span></span><br><span class="line"><span class="comment"># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span></span><br><span class="line"><span class="meta">spring.datasource.timeBetweenEvictionRunsMillis</span>=<span class="string">60000</span></span><br><span class="line"><span class="comment"># 配置一个连接在池中最小生存的时间，单位是毫秒</span></span><br><span class="line"><span class="meta">spring.datasource.minEvictableIdleTimeMillis</span>=<span class="string">300000</span></span><br><span class="line"><span class="meta">spring.datasource.validationQuery</span>=<span class="string">SELECT 1 FROM DUAL</span></span><br><span class="line"><span class="meta">spring.datasource.testWhileIdle</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.testOnBorrow</span>=<span class="string">false</span></span><br><span class="line"><span class="meta">spring.datasource.testOnReturn</span>=<span class="string">false</span></span><br><span class="line"><span class="comment"># 打开PSCache，并且指定每个连接上PSCache的大小</span></span><br><span class="line"><span class="meta">spring.datasource.poolPreparedStatements</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.datasource.maxPoolPreparedStatementPerConnectionSize</span>=<span class="string">20</span></span><br><span class="line"><span class="comment"># 配置监控统计拦截的filters，去掉后监控界面sql无法统计，&#x27;wall&#x27;用于防火墙</span></span><br><span class="line"><span class="meta">spring.datasource.filters</span>=<span class="string">stat,wall,log4j</span></span><br><span class="line"><span class="comment"># 通过connectProperties属性来打开mergeSql功能；慢SQL记录</span></span><br><span class="line"><span class="meta">spring.datasource.connectionProperties</span>=<span class="string">druid.stat.mergeSql=true;druid.stat.slowSqlMillis=5000</span></span><br><span class="line"><span class="comment"># 合并多个DruidDataSource的监控数据</span></span><br><span class="line"><span class="comment">#spring.datasource.useGlobalDataSourceStat=true</span></span><br></pre></td></tr></table></figure><p><strong>注意：spring boot 1.4以前版本，这些配置已经够了，spring boot会自动注入，但是之后的版本，只有几种内置的数据源可以通过配置注入，druid暂时没有内置，所以要通过代码注入</strong></p><p><strong>DruidConfig.java</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2017, 791650277@qq.com(Mr.kiwi) All Rights Reserved.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">package</span> cn.coder4j.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.pool.DruidDataSource;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.http.StatViewServlet;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.support.http.WebStatFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.FilterRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.web.servlet.ServletRegistrationBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Primary;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 项目：jalfred</span></span><br><span class="line"><span class="comment"> * 包名：cn.coder4j</span></span><br><span class="line"><span class="comment"> * 功能：数据源druid的配置</span></span><br><span class="line"><span class="comment"> * 时间：2017-02-17 23:30</span></span><br><span class="line"><span class="comment"> * 作者：Mr.Kiwi</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">// Primary同名bean，会以些为准</span></span><br><span class="line"><span class="meta">@Primary</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataSourceConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">// ConfigurationProperties会注入同名属性</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;spring.datasource&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druidDataSource</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        DruidDataSource druidDataSource = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> druidDataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册一个StatViewServlet</span></span><br><span class="line"><span class="comment">     * durid统计页面相关的servlet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">druidStatViewServle</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean servletRegistrationBean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(),<span class="string">&quot;/druid2/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加初始化参数：initParams</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//白名单：</span></span><br><span class="line">        servletRegistrationBean.addInitParameter(<span class="string">&quot;allow&quot;</span>,<span class="string">&quot;127.0.0.1&quot;</span>);</span><br><span class="line">        <span class="comment">//IP黑名单 (存在共同时，deny优先于allow) : 如果满足deny的话提示:Sorry, you are not permitted to view this page.</span></span><br><span class="line">        servletRegistrationBean.addInitParameter(<span class="string">&quot;deny&quot;</span>,<span class="string">&quot;192.168.1.73&quot;</span>);</span><br><span class="line">        <span class="comment">//登录查看信息的账号密码.</span></span><br><span class="line">        servletRegistrationBean.addInitParameter(<span class="string">&quot;loginUsername&quot;</span>,<span class="string">&quot;admin2&quot;</span>);</span><br><span class="line">        servletRegistrationBean.addInitParameter(<span class="string">&quot;loginPassword&quot;</span>,<span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        <span class="comment">//是否能够重置数据.</span></span><br><span class="line">        servletRegistrationBean.addInitParameter(<span class="string">&quot;resetEnable&quot;</span>,<span class="string">&quot;false&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 注册一个：filterRegistrationBean</span></span><br><span class="line"><span class="comment">     * 拦截要被druid统计的页面</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">druidStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span> FilterRegistrationBean(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加过滤规则.</span></span><br><span class="line">        filterRegistrationBean.addUrlPatterns(<span class="string">&quot;/*&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//添加不需要忽略的格式信息.</span></span><br><span class="line">        filterRegistrationBean.addInitParameter(<span class="string">&quot;exclusions&quot;</span>,<span class="string">&quot;*.js,*.gif,*.jpg,*.png,*.css,*.ico,/druid/*&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>本文地址 <a href="https://blog.coder4j.cn/posts/f23e3ef2/">https://blog.coder4j.cn/posts/f23e3ef2/</a> </p>]]></content>
      
      
      <categories>
          
          <category> spring boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring boot </tag>
            
            <tag> druid </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring boot 集成 redis</title>
      <link href="/posts/126591a7/"/>
      <url>/posts/126591a7/</url>
      
        <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--集成redis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">######################redis配置#########################</span><br><span class="line"># REDIS (RedisProperties)</span><br><span class="line"># Redis数据库索引（默认为0）</span><br><span class="line">spring.redis.database&#x3D;0</span><br><span class="line"># Redis服务器地址</span><br><span class="line">spring.redis.host&#x3D;localhost</span><br><span class="line"># Redis服务器连接端口</span><br><span class="line">spring.redis.port&#x3D;6379</span><br><span class="line"># Redis服务器连接密码（默认为空）</span><br><span class="line">spring.redis.password&#x3D;</span><br><span class="line"># 连接池最大连接数（使用负值表示没有限制）</span><br><span class="line">spring.redis.pool.max-active&#x3D;8</span><br><span class="line"># 连接池最大阻塞等待时间（使用负值表示没有限制）</span><br><span class="line">spring.redis.pool.max-wait&#x3D;-1</span><br><span class="line"># 连接池中的最大空闲连接</span><br><span class="line">spring.redis.pool.max-idle&#x3D;8</span><br><span class="line"># 连接池中的最小空闲连接</span><br><span class="line">spring.redis.pool.min-idle&#x3D;0</span><br><span class="line"># 连接超时时间（毫秒）</span><br><span class="line">spring.redis.timeout&#x3D;0</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span>  </span><br><span class="line"><span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;  </span><br><span class="line"><span class="meta">@Resource</span>  </span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String, Users&gt; redisTemplate;</span><br></pre></td></tr></table></figure><blockquote><p>然后就可以在类里使用了，使用泛型的时候如果用@Autowired按类型注入会报错，要用@Resource    </p></blockquote><p><em>如果方法想用缓存，要在配置类上加上@EnableCaching打开缓存，并且要在方法上加上@Cacheable(value = “getByUsername”)</em></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/126591a7/">https://blog.coder4j.cn/posts/126591a7/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> spring boot </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>spring boot 集成监控</title>
      <link href="/posts/407827fd/"/>
      <url>/posts/407827fd/</url>
      
        <content type="html"><![CDATA[<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring boot 系统监控--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-actuator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-security<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对外开放监控</span></span><br><span class="line"><span class="comment"># 将其它健康接口也暴露出去</span></span><br><span class="line"><span class="meta">endpoints.health.sensitive</span> = <span class="string">false</span></span><br><span class="line"><span class="meta">management.security.enabled</span> = <span class="string">false</span></span><br><span class="line"><span class="comment"># 设置健康监控的应用名</span></span><br><span class="line"><span class="comment">#management.context-path=/manage/api/</span></span><br><span class="line"><span class="comment"># 开启基础鉴权</span></span><br><span class="line"><span class="comment">#security.basic.enabled=true</span></span><br><span class="line"><span class="comment"># 要鉴权路径</span></span><br><span class="line"><span class="comment">#security.basic.path=/manage/api/*</span></span><br><span class="line"><span class="comment">#security.user.name=admin</span></span><br><span class="line"><span class="comment">#security.user.password=123456</span></span><br></pre></td></tr></table></figure><p><em>不加security也可以使用，但是会报权限不足</em></p><blockquote><p>有两种方法解决这个问题，一个是加上security，做拦截，并且配置相应的账号密码。另一个配置上面所示的属性，对监控页面关闭默认权限验证，然后我们自己去实现</p></blockquote><p>本文地址 <a href="https://blog.coder4j.cn/posts/407827fd/">https://blog.coder4j.cn/posts/407827fd/</a> </p>]]></content>
      
      
      <categories>
          
          <category> spring boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spring boot </tag>
            
            <tag> 监控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Tomcat配置https证书</title>
      <link href="/posts/ca6bae8b/"/>
      <url>/posts/ca6bae8b/</url>
      
        <content type="html"><![CDATA[<h1 id="Tomcat配置https证书"><a href="#Tomcat配置https证书" class="headerlink" title="Tomcat配置https证书"></a>Tomcat配置https证书</h1><blockquote><p>网上搜索出来大多数是通过keytool自已生成证书来完成，这种在工作很少用到（浏览器会报不安全）。以下是通过申请的证书配置过程。因为在配置中遇到了一些坑，记之  </p></blockquote><h4 id="1、准备证书与私钥"><a href="#1、准备证书与私钥" class="headerlink" title="1、准备证书与私钥"></a>1、准备证书与私钥</h4><p><code>demo.crt</code>  <code>demo.key</code></p><h4 id="2、合并证书"><a href="#2、合并证书" class="headerlink" title="2、合并证书"></a>2、合并证书</h4><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl pkcs12 -export -<span class="keyword">in</span> <span class="built_in">demo</span>.crt -inkey <span class="built_in">demo</span>.<span class="built_in">key</span> -out <span class="built_in">demo</span>.p12 -name <span class="built_in">demo</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>1、 demo.crt 是你的证书<br>2、 demo.key 是你的私钥<br>3、 demo.p12 是合并后的证书<br>4、-name 后面的demo是指定的别名，后面配置tomcat8.5之后的版本需要用到，要记住<br>5、执行这条命令要设置一个导出密码，后面要用到，要记住，最好6位以上  </p></blockquote><h4 id="3、生成keystore文件"><a href="#3、生成keystore文件" class="headerlink" title="3、生成keystore文件"></a>3、生成keystore文件</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">keytool</span> -importkeystore -srckeystore demo.p<span class="number">12</span> -srcstoretype PKCS<span class="number">12</span> -destkeystore demo.jks  </span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>1、demo.p12 是第二步生成的证书名<br>2、demo.jks 是生成的keystore文件名<br>3、执行这条命令会首先让你设置一个密码，这个密码后面配置会用到，要记住。然后验证上一步设置的密码。推荐该步骤设置的密码与上一步一致，如果不一致可能会出现错误详见 <a href="http://hw1287789687.iteye.com/blog/1965703">java.security.UnrecoverableKeyException: Cannot recover key - 简单的幸福 - ITeye技术网站</a>   </p></blockquote><h4 id="4、配置tomcat"><a href="#4、配置tomcat" class="headerlink" title="4、配置tomcat"></a>4、配置tomcat</h4><p><code>tomcat 8.5 之前</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">SSLEnabled</span>=<span class="string">&quot;true&quot;</span> <span class="attr">acceptCount</span>=<span class="string">&quot;100&quot;</span> <span class="attr">clientAuth</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">disableUploadTimeout</span>=<span class="string">&quot;true&quot;</span> <span class="attr">enableLookups</span>=<span class="string">&quot;false&quot;</span> <span class="attr">maxThreads</span>=<span class="string">&quot;25&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">port</span>=<span class="string">&quot;8443&quot;</span> <span class="attr">keystoreFile</span>=<span class="string">&quot;~/ssl/demo.jks&quot;</span> <span class="attr">keystorePass</span>=<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span> <span class="attr">scheme</span>=<span class="string">&quot;https&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">secure</span>=<span class="string">&quot;true&quot;</span> <span class="attr">sslProtocol</span>=<span class="string">&quot;TLS&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p><code>tomcat 8.5 之后</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">&quot;8643&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;org.apache.coyote.http11.Http11NioProtocol&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">maxThreads</span>=<span class="string">&quot;150&quot;</span> <span class="attr">SSLEnabled</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Certificate</span> <span class="attr">certificateKeystoreFile</span>=<span class="string">&quot;~/ssl/demo.jks&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">certificateKeyAlias</span>=<span class="string">&quot;demo&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">certificateKeystorePassword</span>=<span class="string">&quot;123456&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">type</span>=<span class="string">&quot;RSA&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">SSLHostConfig</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Connector</span>&gt;</span></span><br></pre></td></tr></table></figure><blockquote><p>注意：<br>1、~_ssl_demo.jks  是你前面步骤生成的storekey文件的路径<br>2、123456 是前面第3步设置的密码<br>3、tomcat8.5之后有一个certificateKeyAlias这个是2步设置-name的值  </p></blockquote><h4 id="参数地址："><a href="#参数地址：" class="headerlink" title="参数地址："></a>参数地址：</h4><p><a href="http://blog.csdn.net/freeiceflame/article/details/50420059">TOMCAT导入通过第三方证书机构获取的证书 - IceFlame博客频道 - CSDN.NET</a></p><p>  <a href="http://hw1287789687.iteye.com/blog/1965703">java.security.UnrecoverableKeyException: Cannot recover key - 简单的幸福 - ITeye技术网站</a></p><p><a href="https://www.oschina.net/question/12_23148">5分钟内搞定 Tomcat 的 SSL 配置 - 开源中国社区</a></p><p><a href="https://bbs.wosign.com/forum.php?mod=viewthread&tid=2881">tomcat 8.5+版本SSL证书部署-沃通CA官方论坛 -  专业数字证书论坛</a></p><p>本文地址 <a href="https://blog.coder4j.cn/posts/ca6bae8b/">https://blog.coder4j.cn/posts/ca6bae8b/</a> </p>]]></content>
      
      
      <categories>
          
          <category> tomcat </category>
          
          <category> https </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tomcat </tag>
            
            <tag> https </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lombok使用教程</title>
      <link href="/posts/488c3b78/"/>
      <url>/posts/488c3b78/</url>
      
        <content type="html"><![CDATA[<h1 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h1><h4 id="作用：帮使用者提高编码效率，减少重复与冗余的代码"><a href="#作用：帮使用者提高编码效率，减少重复与冗余的代码" class="headerlink" title="作用：帮使用者提高编码效率，减少重复与冗余的代码"></a>作用：帮使用者提高编码效率，减少重复与冗余的代码</h4><h4 id="原理：ASM-动态修改class文件"><a href="#原理：ASM-动态修改class文件" class="headerlink" title="原理：ASM  动态修改class文件"></a>原理：ASM  动态修改class文件</h4><hr><h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.6.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="idea"><a href="#idea" class="headerlink" title="idea"></a>idea</h3><ul><li>安装插件<br><img src="http://ww2.sinaimg.cn/large/68f7efe0gw1fb0hl2gmyzj20su0kagqg.jpg"></li></ul><hr><h1 id="常用注解："><a href="#常用注解：" class="headerlink" title="常用注解："></a>常用注解：</h1><h2 id="java-bean相关"><a href="#java-bean相关" class="headerlink" title="java bean相关"></a>java bean相关</h2><h3 id="Setter"><a href="#Setter" class="headerlink" title="@Setter"></a>@Setter</h3><ul><li><p><code>功能</code></p><blockquote><p>生成setter方法</p></blockquote></li></ul><ul><li><code>源码</code>     <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Setter</span></span><br><span class="line">       <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">           <span class="keyword">private</span> Integer id;</span><br><span class="line">           <span class="keyword">private</span> String name;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></li><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Getter"><a href="#Getter" class="headerlink" title="@Getter"></a>@Getter</h3><ul><li><p><code>功能</code></p><blockquote><p>生成getter方法</p></blockquote></li></ul><ul><li><code>源码</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p><h3 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h3><ul><li><p><code>功能</code></p><blockquote><p>生成toString方法</p></blockquote></li></ul><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokDemo(id=&quot;</span> + <span class="keyword">this</span>.id + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="Getter-lazy-true"><a href="#Getter-lazy-true" class="headerlink" title="@Getter(lazy = true)"></a>@Getter(lazy = true)</h3><ul><li><p><code>功能</code></p><blockquote><p>懒加载属性</p></blockquote></li></ul><ul><li><p><code>注意:</code></p><blockquote><p>这个与上面@Getter不同，那个是修饰在类上的，也可以修饰在属性上。如果有lazy=true只能修饰在属性，并且还要是private final修饰，限制很大</p></blockquote></li><li><p><code>编码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Getter(lazy = true)</span> <span class="keyword">private</span> <span class="keyword">final</span> List&lt;Integer&gt; ids = Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AtomicReference&lt;Object&gt; ids = <span class="keyword">new</span> AtomicReference();</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">getIds</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Object value = <span class="keyword">this</span>.ids.get();</span><br><span class="line">        <span class="keyword">if</span>(value == <span class="keyword">null</span>) &#123;</span><br><span class="line">            AtomicReference var2 = <span class="keyword">this</span>.ids;</span><br><span class="line">            <span class="keyword">synchronized</span>(<span class="keyword">this</span>.ids) &#123;</span><br><span class="line">                value = <span class="keyword">this</span>.ids.get();</span><br><span class="line">                <span class="keyword">if</span>(value == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    List actualValue = Arrays.asList(<span class="keyword">new</span> Integer[]&#123;Integer.valueOf(<span class="number">1</span>), Integer.valueOf(<span class="number">2</span>), Integer.valueOf(<span class="number">3</span>), Integer.valueOf(<span class="number">4</span>)&#125;);</span><br><span class="line">                    value = actualValue == <span class="keyword">null</span>?<span class="keyword">this</span>.ids:actualValue;</span><br><span class="line">                    <span class="keyword">this</span>.ids.set(value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (List)((List)(value == <span class="keyword">this</span>.ids?<span class="keyword">null</span>:value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="EqualsAndHashCode"><a href="#EqualsAndHashCode" class="headerlink" title="@EqualsAndHashCode"></a>@EqualsAndHashCode</h3><ul><li><p><code>功能</code></p><blockquote><p>生成equals方法与hashCode方法</p></blockquote></li></ul><ul><li><code>源码</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><code>编译后</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> LombokDemo)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokDemo other = (LombokDemo)o;</span><br><span class="line">            <span class="keyword">if</span>(!other.canEqual(<span class="keyword">this</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Integer <span class="keyword">this</span>$id = <span class="keyword">this</span>.id;</span><br><span class="line">                Integer other$id = other.id;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$id == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$id != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$id.equals(other$id)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String <span class="keyword">this</span>$name = <span class="keyword">this</span>.name;</span><br><span class="line">                String other$name = other.name;</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$name == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$name != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">canEqual</span><span class="params">(Object other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> other <span class="keyword">instanceof</span> LombokDemo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> PRIME = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">byte</span> result = <span class="number">1</span>;</span><br><span class="line">        Integer $id = <span class="keyword">this</span>.id;</span><br><span class="line">        <span class="keyword">int</span> result1 = result * <span class="number">59</span> + ($id == <span class="keyword">null</span>?<span class="number">43</span>:$id.hashCode());</span><br><span class="line">        String $name = <span class="keyword">this</span>.name;</span><br><span class="line">        result1 = result1 * <span class="number">59</span> + ($name == <span class="keyword">null</span>?<span class="number">43</span>:$name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result1;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p><h3 id="NoAragsConstructor"><a href="#NoAragsConstructor" class="headerlink" title="@NoAragsConstructor"></a>@NoAragsConstructor</h3><ul><li><p><code>功能</code></p><blockquote><p>添加一个无参构造函数</p></blockquote></li><li><p><code>注意</code></p><blockquote><p>这个注解在没有其它有参构造函数的情况下使用意义不大，因为在这种情况下java默认会添加一个无参构造函数</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@NoArgsConstructor</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">Integer</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">String</span> name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="AllArgsConstructor"><a href="#AllArgsConstructor" class="headerlink" title="@AllArgsConstructor"></a>@AllArgsConstructor</h3><ul><li><p><code>功能</code></p><blockquote><p>添加一个所有参数的构造函数</p></blockquote></li></ul><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.ConstructorProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;id&quot;, &quot;name&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">(Integer id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="RequiredArgsConstructor"><a href="#RequiredArgsConstructor" class="headerlink" title="@RequiredArgsConstructor"></a>@RequiredArgsConstructor</h3><ul><li><p><code>功能</code></p><blockquote><p>生成一个包含必填参数的构造函数</p></blockquote></li><li><p><code>注意</code></p><blockquote><p>要与@NonNull 搭配使用，该注解修饰的属性就是必填参数</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequiredArgsConstructor</span><br><span class="line">public class LombokDemo &#123;</span><br><span class="line"></span><br><span class="line">    @NonNull private Integer id;</span><br><span class="line">    private String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.ConstructorProperties;</span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;id&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">(<span class="meta">@NonNull</span> Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(id == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="Date"><a href="#Date" class="headerlink" title="@Date"></a>@Date</h3><ul><li><p><code>功能</code></p><blockquote><p>这是一个综合注解了，等于同时使用</p><p><code>@Getter</code>, <code>@Setter</code>, <code>@ToString</code>, <code>@EqualsAndHashCode</code>,<code>@RequiredArgsConstructor</code></p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NonNull</span> <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> LombokDemo)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokDemo other = (LombokDemo)o;</span><br><span class="line">            <span class="keyword">if</span>(!other.canEqual(<span class="keyword">this</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Integer <span class="keyword">this</span>$id = <span class="keyword">this</span>.getId();</span><br><span class="line">                Integer other$id = other.getId();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$id == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$id != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$id.equals(other$id)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                String <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">                String other$name = other.getName();</span><br><span class="line">                <span class="keyword">if</span>(<span class="keyword">this</span>$name == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(other$name != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">canEqual</span><span class="params">(Object other)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> other <span class="keyword">instanceof</span> LombokDemo;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> PRIME = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">byte</span> result = <span class="number">1</span>;</span><br><span class="line">        Integer $id = <span class="keyword">this</span>.getId();</span><br><span class="line">        <span class="keyword">int</span> result1 = result * <span class="number">59</span> + ($id == <span class="keyword">null</span>?<span class="number">43</span>:$id.hashCode());</span><br><span class="line">        String $name = <span class="keyword">this</span>.getName();</span><br><span class="line">        result1 = result1 * <span class="number">59</span> + ($name == <span class="keyword">null</span>?<span class="number">43</span>:$name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokDemo(id=&quot;</span> + <span class="keyword">this</span>.getId() + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.getName() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><ul><li><p><code>功能</code></p><blockquote><p>不可变类的@Date, 他会默认给属性加上final</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.beans.ConstructorProperties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConstructorProperties(&#123;&quot;id&quot;, &quot;name&quot;&#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">(Integer id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(o == <span class="keyword">this</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!(o <span class="keyword">instanceof</span> LombokDemo)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            LombokDemo other = (LombokDemo)o;</span><br><span class="line">            Integer <span class="keyword">this</span>$id = <span class="keyword">this</span>.getId();</span><br><span class="line">            Integer other$id = other.getId();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>$id == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(other$id != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$id.equals(other$id)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            String <span class="keyword">this</span>$name = <span class="keyword">this</span>.getName();</span><br><span class="line">            String other$name = other.getName();</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>$name == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(other$name != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span>(!<span class="keyword">this</span>$name.equals(other$name)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> PRIME = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">byte</span> result = <span class="number">1</span>;</span><br><span class="line">        Integer $id = <span class="keyword">this</span>.getId();</span><br><span class="line">        <span class="keyword">int</span> result1 = result * <span class="number">59</span> + ($id == <span class="keyword">null</span>?<span class="number">43</span>:$id.hashCode());</span><br><span class="line">        String $name = <span class="keyword">this</span>.getName();</span><br><span class="line">        result1 = result1 * <span class="number">59</span> + ($name == <span class="keyword">null</span>?<span class="number">43</span>:$name.hashCode());</span><br><span class="line">        <span class="keyword">return</span> result1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;LombokDemo(id=&quot;</span> + <span class="keyword">this</span>.getId() + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.getName() + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="Accessors"><a href="#Accessors" class="headerlink" title="@Accessors"></a>@Accessors</h3><ul><li><p><code>功能</code></p><blockquote><p>这个注解要搭配@Getter与@Setter使用，用来修改默认的setter与getter方法的形式</p></blockquote></li><li><p><code>注意</code></p><blockquote><p>@Accessors有三个参数可以使用</p><ol><li>chain  链式的形式</li><li>fluent  流式的形式</li><li>prefix  生成指定前缀的属性的getter与setter方法，并且生成的getter与setter方法时会去除前缀</li></ol></blockquote></li><li><p><code>源码 chain = true</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Accessors(chain = true)</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后 chain = true</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LombokDemo <span class="title">setId</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LombokDemo <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li><li><p><code>源码 fluent = true</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Accessors(fluent = true)</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后 fluent = true</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LombokDemo <span class="title">id</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LombokDemo <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">id</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>源码 prefix = &quot;xxx&quot;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Accessors(prefix = &quot;xxx&quot;)</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后 prefix = &quot;xxx&quot;</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Integer xxxId)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.xxxId = xxxId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.xxxId;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><hr><h1 id="其它注解："><a href="#其它注解：" class="headerlink" title="其它注解："></a>其它注解：</h1><h2 id="日志相关"><a href="#日志相关" class="headerlink" title="日志相关"></a>日志相关</h2><h3 id="Log4j"><a href="#Log4j" class="headerlink" title="@Log4j"></a>@Log4j</h3><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = Logger.getLogger(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="CommonsLog"><a href="#CommonsLog" class="headerlink" title="@CommonsLog"></a>@CommonsLog</h3><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CommonsLog</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.Log;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.logging.LogFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Log log = LogFactory.getLog(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Log"><a href="#Log" class="headerlink" title="@Log"></a>@Log</h3><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.logging.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = Logger.getLogger(LombokDemo.class.getName());</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Log4j2"><a href="#Log4j2" class="headerlink" title="@Log4j2"></a>@Log4j2</h3><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Log4j2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</span><br><span class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LogManager.getLogger(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="Slf4j"><a href="#Slf4j" class="headerlink" title="@Slf4j"></a>@Slf4j</h3><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(LombokDemo.class);</span><br><span class="line">    <span class="keyword">private</span> Integer xxxId;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="设计模式相关"><a href="#设计模式相关" class="headerlink" title="设计模式相关"></a>设计模式相关</h2><h3 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h3><ul><li><p><code>功能</code></p><blockquote><p>通过建造者模块来生成bean</p></blockquote></li></ul><ul><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    LombokDemo(Integer id, String name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> LombokDemo.<span class="function">LombokDemoBuilder <span class="title">builder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LombokDemo.LombokDemoBuilder();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemoBuilder</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> Integer id;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        LombokDemoBuilder() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> LombokDemo.<span class="function">LombokDemoBuilder <span class="title">id</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.id = id;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> LombokDemo.<span class="function">LombokDemoBuilder <span class="title">name</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> LombokDemo <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LombokDemo(<span class="keyword">this</span>.id, <span class="keyword">this</span>.name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;LombokDemo.LombokDemoBuilder(id=&quot;</span> + <span class="keyword">this</span>.id + <span class="string">&quot;, name=&quot;</span> + <span class="keyword">this</span>.name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="Delegate"><a href="#Delegate" class="headerlink" title="@Delegate"></a>@Delegate</h3><ul><li><p><code>功能</code></p><blockquote><p>@Delegate注释的属性，会把这个属性对象的公有非静态方法合到当前类</p></blockquote></li><li><p><code>注意</code></p><blockquote><p>公共 非静态方法</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delegate</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">byte</span> <span class="title">byteValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.byteValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">short</span> <span class="title">shortValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.shortValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">intValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.intValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">longValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.longValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">floatValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.floatValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">doubleValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.doubleValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Integer arg0)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id.compareTo(arg0);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h2 id="工具相关"><a href="#工具相关" class="headerlink" title="工具相关"></a>工具相关</h2><h3 id="Cleanup"><a href="#Cleanup" class="headerlink" title="@Cleanup"></a>@Cleanup</h3><ul><li><p><code>功能</code></p><blockquote><p>关闭流</p></blockquote></li><li><p><code>注意</code></p><blockquote><p>关闭流的方式有点怪异，而且没有在<strong>finally</strong>里面关闭，如果出现异常的就不会关闭了</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Cleanup</span> InputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;xxx.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;xxx.txt&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(Collections.singletonList(inputStream).get(<span class="number">0</span>) != <span class="keyword">null</span>) &#123;</span><br><span class="line">            inputStream.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="Synchronized"><a href="#Synchronized" class="headerlink" title="@Synchronized"></a>@Synchronized</h3><ul><li><p><code>功能</code></p><blockquote><p>给方法加一个同步块</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Synchronized</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Object var1 = <span class="keyword">this</span>.$lock;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.$lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>​</p></li></ul><h3 id="SneakyThrows"><a href="#SneakyThrows" class="headerlink" title="@SneakyThrows"></a>@SneakyThrows</h3><ul><li><p><code>功能</code></p><blockquote><p>忽略异常</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        String s = <span class="keyword">new</span> String(<span class="string">&quot;test&quot;</span>.getBytes(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object $lock = <span class="keyword">new</span> Object[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Object var1 = <span class="keyword">this</span>.$lock;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="keyword">this</span>.$lock) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="NonNull"><a href="#NonNull" class="headerlink" title="@NonNull"></a>@NonNull</h3><ul><li><p><code>功能</code></p><blockquote><p>设置不能为空的参数</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="meta">@NonNull</span> String val)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.NonNull;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">(<span class="meta">@NonNull</span> String val)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException(<span class="string">&quot;val&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="UtilityClass"><a href="#UtilityClass" class="headerlink" title="@UtilityClass"></a>@UtilityClass</h3></li><li><p><code>功能</code></p><blockquote><p>把普通类转为工具类</p></blockquote></li><li><p><code>源码</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@UtilityClass</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> String name = <span class="string">&quot;kiwi&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">util</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><code>编译后</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> xyz.mrwood.study.lombok;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">LombokDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Integer id = Integer.valueOf(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String name = <span class="string">&quot;kiwi&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">util</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;xxx&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">LombokDemo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">&quot;This is a utility class and cannot be instantiated&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​</p></li></ul><p>本文地址 <a href="https://blog.coder4j.cn/posts/488c3b78/">https://blog.coder4j.cn/posts/488c3b78/</a> </p>]]></content>
      
      
      
        <tags>
            
            <tag> lombok </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
